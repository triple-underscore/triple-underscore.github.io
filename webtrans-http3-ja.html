<!DOCTYPE html><html lang="ja"><head><meta charset="utf-8">
<title>WebTransport over HTTP/3（日本語訳）</title>

<link rel="stylesheet" href="common.css" type="text/css">
<link rel="stylesheet" href="http-common.css" type="text/css">

<style>
.settings-parameter,
.frame-type,
.capsule,
.error-code {
	font-family: sans-serif0, sans-serif;
	color: var(--K-color);
}

.frame-diagram {
	margin: 0;
}

.frame-diagram > span[lang="en"] {
	white-space: pre;
}
</style>


<script src="common0.js"></script>
<script src="common1.js" async></script>

<script>

Util.ready = function(){
	const source_data = {
		toc_main: 'MAIN0',
		generate: expand,
	};
	Util.switchWordsInit(source_data);
}

function expand(){
	const class_map = this.class_map;
	const tag_map = this.tag_map;
	const link_map = this.link_map;

	return this.html.replace(
		/%[\w\-~一-鿆あ-ん]+|`(.+?)([$@\^§])(\w*)/g,
		create_html
	);

	function create_html(match, key, indicator, klass){

if(!key) {//%
	return `<var>${match.slice(1)}</var>`;
}

let href = '';
let href1 = '';
{
	const n = key.indexOf('＠');
	if(n > 0) {
		href1 = key.slice(n + 1);
		key = key.slice(0, n);
	}
}
let text = key;

switch(klass){
case 'r':
	text = `[${key}]`;
	href = `#${key}`;
	break;
case 'ph':
	text = `:${key}`;
	break;
case 'pull':
	text = `#${key}`;
	href = `https://github.com/ietf-wg-webtrans/draft-ietf-webtrans-http3/pull/${key}`;
	break;
case 'en':
	return `<span lang="en">${key}</span>`;
	break;
}

let tag = tag_map[klass];
if(tag) {
	let classname = class_map[klass];
	classname = classname ? ` class="${classname}"` : '';
	text = `<${tag}${classname}>${text}</${tag}>`;
}

if(indicator !== '^'){
	href = href1 || link_map[ klass ? `${klass}.${key}` : key ] || href;
	if(!href){
		console.log(match); // check error
		return match;
	}

	switch(indicator){
	case '$':
		text = `<a href="${href}">${text}</a>`;
		break;
	case '§':
		text = ` <a href="${href}">§ ${text}</a> `;
		break;
	case '@':
		text = `<dfn id="${href.slice(1)}">${text}</dfn>`;
		break;
	}
}

return text;

	}
}

</script>


<script type="text/plain" id="_source_data">

●●options

spec_date:2023-12-12
trans_update:2023-12-30
source_checked:231212
original_url:https://ietf-wg-webtrans.github.io/draft-ietf-webtrans-http3/draft-ietf-webtrans-http3.html
	abbr_url:WT-HTTP3
spec_status:IETFID
page_state_key:HTTP
no_original_dfn:true
	ref_id_prefix:
ref_rfc:true
site_nav:network
trans_1st_pub:2023-12-30

●●original_urls

●●class_map
ft:frame-type
cps:capsule
er:error-code
sp:settings-parameter
st:status
h:header
ph:pseudo-header
m:method
hex:hex-value
2119:rfc2119

●●tag_map
2119:em
ft:code
cps:code
er:code
hex:span
sp:code
st:code
h:code
ph:code
m:code
c:code
p:code
cite:cite
i:i

●●original_id_map
abstract:
	fig-unidi:name-unidirectional-webtranspor
	fig-unidi:figure-1
	fig-bidi-client:name-bidirectional-webtransport-
	fig-bidi-client:figure-2
	fig-remap-errors:name-pseudocode-for-converting-b
	fig-remap-errors:figure-3

●●link_map

p.authority:~RFCx/rfc3986#section-3.2
p.path:~RFCx/rfc3986#section-3.3

c.https:~HTTPinfra#https.uri

ph.scheme:~HTTPv3#ph-scheme
ph.authority:~HTTPv3#ph-authority
ph.path:~HTTPv3#ph-path

h.Capsule-Protocol:~RFCx/rfc9297#hdr
	~RFCx/rfc9297#section-3.4
	~RFCx/rfc9297#name-the-capsule-protocol-header
h.Priority:~RFCx/rfc9218#section-5
h.Origin:~FETCH#http-origin
	h.Origin:~RFCx/rfc6454#section-4
h.WebTransport-Subprotocols-Available:#field-webtransport-subprotocols-available
h.WebTransport-Subprotocol:#field-webtransport-subprotocols

m.CONNECT:~HTTPsem#CONNECT

st.404:~HTTPsem#status.404
st.403:~HTTPsem#status.403
st.2xx:~HTTPsem#status.2xx
st.3xx:~HTTPsem#status.3xx
st.429:~RFC6585#status-429

cps.CLOSE_WEBTRANSPORT_SESSION:#CLOSE_WEBTRANSPORT_SESSION
cps.DRAIN_WEBTRANSPORT_SESSION:#DRAIN_WEBTRANSPORT_SESSION

ft.WEBTRANSPORT_STREAM:#WEBTRANSPORT_STREAM
ft.RESET_STREAM:~RFCx/rfc9000#frame-reset-stream
ft.STOP_SENDING:~RFCx/rfc9000#frame-stop-sending
ft.CONNECTION_CLOSE:~RFCx/rfc9000#frame-connection-close
ft.DATAGRAM:~RFCx/rfc9221#datagram-frame-types
ft.SETTINGS:~HTTPv3#frame-settings
ft.GOAWAY:~HTTPv3#frame-goaway
ft.PRIORITY_UPDATE:~RFCx/rfc9218#section-7

sp.SETTINGS_WEBTRANSPORT_MAX_SESSIONS:#SETTINGS_WEBTRANSPORT_MAX_SESSIONS
sp.SETTINGS_H3_DATAGRAM:~RFCx/rfc9297#section-2.1.1
	sp.SETTINGS_ENABLE_CONNECT_PROTOCOL:~RFCx/rfc8441#

~HTTP~datagram:~RFCx/rfc9297#format
	~RFCx/rfc9297#section-2.1
	~RFCx/rfc9297#name-http-3-datagrams

er.WEBTRANSPORT_BUFFERED_STREAM_REJECTED:#WEBTRANSPORT_BUFFERED_STREAM_REJECTED
er.WEBTRANSPORT_SESSION_GONE:#WEBTRANSPORT_SESSION_GONE
er.WEBTRANSPORT_APPLICATION_ERROR:#WEBTRANSPORT_APPLICATION_ERROR

er.H3_SETTINGS_ERROR:~HTTPv3#H3_SETTINGS_ERROR
er.H3_FRAME_ERROR:~HTTPv3#H3_FRAME_ERROR
er.H3_MESSAGE_ERROR:~HTTPv3#H3_MESSAGE_ERROR
er.H3_ID_ERROR:~HTTPv3#H3_ID_ERROR
er.H3_REQUEST_REJECTED:~HTTPv3#H3_REQUEST_REJECTED

~CONNECT~stream:#connect-stream
~session~ID:#session-id
~WebTransport~stream:#webtransport-stream

安全:~HTTPsem#safe-method

~HTTP3接続:~HTTPv3#h3-connection
~stream~ID:~HTTPv3#quic-stream-id
接続~error:~HTTPv3#quic-connection-error
設定:~HTTPv3#setting
一方向~stream:~HTTPv3#quic-unidirectional-stream
双方向~stream:~HTTPv3#quic-bidirectional-stream
~HTTP3~server:~HTTPv3#h3-server
~stream種別:~HTTPv3#h3-stream-type
可変長な整数:~HTTPv3#variable-length-integer

~WebTransport~client:~WT-OVERVIEW#webtransport-server
~WebTransport~server:~WT-OVERVIEW#webtransport-server
~WebTransport~session:~WT-OVERVIEW#webtransport-session
	~datagram:~WT-OVERVIEW#datagram

~reset:~RFCx/rfc9000#stream-operations
~capsule:~RFCx/rfc9297#capsule-protocol
~capsule~protocol:~RFCx/rfc9297#capsule
	~RFCx/rfc9297#section-3
	~RFCx/rfc9297#name-capsules

有構造~field:~STRUCTURED-FIELDS#structured-field
~sf~list:~STRUCTURED-FIELDS#sf-list
~sf~token:~STRUCTURED-FIELDS#sf-token

●●words_table1

WEBTRANSPORT:webtransport-ja.html
WT-OVERVIEW:webtrans-overview-ja.html
RFC6585:http-status-code-428-429-431-511-ja.html

sf:<sub>sf-</sub>

●●words_table

	●名称
QUIC:
WebTransport:
HTTP3:HTTP/3
CONNECT:
URI:
TLS:
0-RTT:
ALPN:
	ALPN:TLS Application-Layer Protocol Negotiation Extension (ALPN)
	~WG:Working Group
	有構造~field:Structured Field

	●transport／network
多重化-:multiplex::~
逆多重化-:demultiplex::~
確立:establishment:~
端点:endpoint::~::エンドポイント
伝送路:wire:~
受信者:recipient::~
中継者:intermediary:~
送信者:sender::~
回送-:forward::~
交換-:exchange:~
下位protocol:subprotocol::下位 protocol:下位プロトコル
到着-:arrive:~
返信-:reply::~
側:side:~
flight:
封入-:enclose:~

	^i:FIN
	`~capsule~protocol$:the Capsule Protocol
	~quarter~stream~ID^i:Quarter Stream ID
	~HTTP~datagram:HTTP Datagram
	~datagram^i:Datagram
	~HTTP~datagram~payload^i:HTTP Datagram Payload

	●stream／frame
capsule::::カプセル
可変長:variable length:長さ可変
packet::::パケット
datagram::::データグラム
流入:incoming::~
流出:outgoing::~
一方向:unidirectional::~
双方向:bidirectional::~
payload::::ペイロード
quarter:

	●処理
reset:
中途で:abruptに:~
併合-:merge::~
shutdown:
shut-down:shut down
clean:
	~cleanに:cleanly
早期:early:~
輻輳:congestion::~
優先度:priority:~
優先度化:prioritization:優先度付け
優先度化-:prioritize:優先度付け
	優先度化し直:reprioritize:優先度~付け
停滞-:stall:~
open:
close:
credit:
rate::::レート
schedule::::スケジュール
	~schedule法:scheduling
承認-:acknowledge:~
pool:

	●保安
枯渇-:exhaust:~
枯渇:exhaustion:~
積極的:aggressive:~
潜在的:potential:~
公平性:fairness:~
出生-:originate:~
共有分:share::~

	信用されない:untrusted
	信用-済み:trusted

	●仕様
opt-in:
楽観的:optimistic:~
上品:graceful:~
視点:perspective:~
Upgrade:
恒久的:permanent:~
暫定的:provisional:~
連絡先:contact:~
合格-:pass:~
著作権:copyright:~
告知:notice:~
拡げた:expandした:~
合理的:reasonable:~
選ぶ:chooseする:~
メモ:memo:~

	課され:impose
	と称される:referred to as
	指す:refer
	悟った:learn
	満たす:satisfy
	してもよい:may
	~port法:porting

	●言い換え
	1 以上の値:greater than "0"
	1 以上の値:greater than 0
	端点:any peer
	相手の端点:peer
	双方の端点:peer
	双方の端点:the peer
	対応付ける:remap
	所有者であること:ownership
	〜能力がある:〜-capable
	順に:correspondingly
	変更~log:changelog
	最善な労:best-effort
	最善な労:best effort
	互換でない:incompatible
	変換した上で:within 〜 range
	前項:the previous method
	これまで既存の:pre-existing
	とは限らない:potentially
	場合もある:could potentially
	~WebTransport~protocol:the protocol
	0:"0"

	●未分類
衝突:collision:~
無符号:unsigned:~
隣接な:adjacent:隣接する
符号点:codepoint:~
	符号点:code point
超過-:exceed:~
近過去:recent:~
疑似-:pseudo-:~
	疑似-~code:pseudocode
維持-:retain:~
追従-:follow:~
上限:limit:~
内包-:include::~
欠如:lack:~
欠如-:lack:~
数えら:countさ:~
	向かって数えられる:counted against
量:amount:~
後続-:follow:~
対応-:correspond:~

	上層:on top of
	~sf~token$:Token
	~sf~list$:List
	改変されずに:unmodified
	利用し尽くす:using up
	同じく:Just like
	いつでも:at any point
	各種:a variety of
	残り:the rest
	一番最初の:very first
	順序どおりに〜ない:out of order
	占める:takes up
	始め:at the beginning
	同時に:simultaneously
	当の:in question
	同時:simultaneous
	来ている:coming
	なり得る:potentially
	属する:belonging
	置かれる:~put
	〜以下:inclusive
	残り:the remainder
	両方^i:Both
	前回:the previous
	一括して:all
	行く:going


●●ref_data
OVERVIEW=副 ~/webtrans-overview-ja.html

●●ref_key_map
HTTP3:RFC9114

●●ref_normative

[HTTP]
    Fielding, R., Ed., Nottingham, M., Ed., and J. Reschke, Ed., "HTTP Semantics", STD 97, ~RFC9110, June 2022
[HTTP-DATAGRAM]
    Schinazi, D. and L. Pardue, "HTTP Datagrams and the Capsule Protocol", ~RFC9297, August 2022
[HTTP3]
    Bishop, M., Ed., "HTTP/3", ~RFC9114, June 2022
[OVERVIEW]
    Vasiliev, V., "The WebTransport Protocol Framework", Work in Progress, Internet-Draft, draft-ietf-webtrans-overview-06, 6 September 2023
    URL: https://datatracker.ietf.org/doc/html/draft-ietf-webtrans-overview-06
[QUIC-DATAGRAM]
    Pauly, T., Kinnear, E., and D. Schinazi, "An Unreliable Datagram Extension to QUIC", ~RFC9221, March 2022
[RFC2119]
    Bradner, S., "Key words for use in RFCs to Indicate Requirement Levels", BCP 14, ~RFC2119, March 1997
[RFC3986]
    Berners-Lee, T., Fielding, R., and L. Masinter, "Uniform Resource Identifier (URI): Generic Syntax", STD 66, ~RFC3986, January 2005
[RFC6454]
    Barth, A., "The Web Origin Concept", ~RFC6454, December 2011
[RFC6585]
    Nottingham, M. and R. Fielding, "Additional HTTP Status Codes", ~RFC6585, April 2012
[RFC8174]
    Leiba, B., "Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words", BCP 14, ~RFC8174, May 2017
[RFC8441]
    McManus, P., "Bootstrapping WebSockets with HTTP/2", ~RFC8441, September 2018
[RFC8941]
    Nottingham, M. and P. Kamp, "Structured Field Values for HTTP", ~RFC8941, February 2021
[RFC9000]
    Iyengar, J., Ed. and M. Thomson, Ed., "QUIC: A UDP-Based Multiplexed and Secure Transport", ~RFC9000, May 2021
[RFC9218]
    Oku, K. and L. Pardue, "Extensible Prioritization Scheme for HTTP", ~RFC9218, June 2022
[RFC9220]
    Hamilton, R., "Bootstrapping WebSockets with HTTP/3", ~RFC9220, June 2022

●●ref_informative

[I-D.ietf-webtrans-http2]
    Frindell, A., Kinnear, E., Pauly, T., Thomson, M., Vasiliev, V., and G. Xie, "WebTransport over HTTP/2", Work in Progress, Internet-Draft, draft-ietf-webtrans-http2-07, 23 October 2023
    URL: https://datatracker.ietf.org/doc/html/draft-ietf-webtrans-http2-07
[RFC7301]
    Friedl, S., Popov, A., Langley, A., and E. Stephan, "Transport Layer Security (TLS) Application-Layer Protocol Negotiation Extension", ~RFC7301, July 2014

●●trans_metadata
<p>
~THIS_PAGEは、
~IETF により Internet-Draft として公開された，
<a href="~SPEC_URL">WebTransport over HTTP/3</a>
を日本語に翻訳したものです。
~PUB
</p>

●●spec_metadata

Workgroup
	Network WG<!-- WebTransport WG？ -->
位置付け
	Internet-Draft
	draft-ietf-webtrans-http3-latest
意図される位置付け
	Standards Track
失効日
	日付から半年後
編集／著作者アドレス
	<a href="mailto:afrind@fb.com">Alan Frindell</a> (Facebook)
	<a href="mailto:ekinnear@apple.com">Eric Kinnear</a> (Apple Inc.)
	<a href="mailto:vasilvv@google.com">Victor Vasiliev</a> (Google)
commit 履歴
	https://github.com/ietf-wg-webtrans/draft-ietf-webtrans-http3/commits/main
課題追跡
	https://github.com/ietf-wg-webtrans/draft-ietf-webtrans-http3/issues
メーリングリスト
	<a href="mailto:webtransport@ietf.org">webtransport@ietf.org</a> (<a href="https://mailarchive.ietf.org/arch/search/?email_list=webtransport">archive</a>)

</script>

</head>

<body>

<header>
	<hgroup>
<h1>HTTP/3 越しの WebTransport</h1>
<p lang="en">WebTransport over HTTP/3</p>

	</hgroup>
</header>

<div id="MAIN" hidden>
	<section id="abstract">
◎要約

<p>
~WebTransport `OVERVIEW$r は、［
~Web~security~modelにより拘束された~clientが
~secureな多重化された~transportを利用して，~remote~serverと通信する
］ことを可能化する，~protocol~frameworkである。
この文書は、
~HTTP3 `HTTP3$r に基づく~WebTransport~protocolを述べるとともに，
同じ`~HTTP3接続$の中ですべて多重化される［
`一方向~stream$,
`双方向~stream$,
~datagram
］用の~supportを供する。
◎
WebTransport [OVERVIEW] is a protocol framework that enables clients constrained by the Web security model to communicate with a remote server using a secure multiplexed transport. This document describes a WebTransport protocol that is based on HTTP/3 [HTTP3] and provides support for unidirectional streams, bidirectional streams and datagrams, all multiplexed within the same HTTP/3 connection.
</p>

	</section>
	<section>
<h2 title="Note to Readers">読者~向け注記</h2>

<p>
この草案について論を交わす場や この草案の課題は、
冒頭の “`この文書についての詳細＠#_spec_metadata$” の中（末尾）から見出せる。
◎
Discussion of this draft takes place on the WebTransport mailing list (webtransport@ietf.org), which is archived at &lt;https://mailarchive.ietf.org/arch/search/?email_list=webtransport&gt;.
◎
The repository tracking the issues for this draft can be found at &lt;https://github.com/ietf-wg-webtrans/draft-ietf-webtrans-http3/issues&gt;.＼
</p>

<p>
この文書に対応している~web~API草案は、
`WebTransport＠~WEBTRANSPORT$cite
にて見出せる。
◎
The web API draft corresponding to this document can be found at &lt;https://w3c.github.io/webtransport/&gt;.
</p>

	</section>
	<section id="status-of-memo">
<h2 title="Status of This Memo">このメモの位置付け</h2>

<p class="trans-note">【
この節の内容は
`~IETF日本語訳 共通~page＠~IETFcommon#status-draft$に移譲。
】</p>

<!-- 
This Internet-Draft will expire on 14 June 2024.
-->
	</section>
	<section id="copyright">
<h2 title="Copyright Notice">著作権の告知</h2>

<p lang="en">
Copyright (c) 2023 IETF Trust and the persons identified as the document authors. All rights reserved.
</p>

<p class="trans-note">【
以下、この節の他の内容は
`~IETF日本語訳 共通~page＠~IETFcommon#copyright-notice$に移譲。
】</p>

	</section>

<main id="MAIN0">

	<section id="introduction">
<h2 title="Introduction">1. 序論</h2>

<p>
~HTTP3 `HTTP3$r は、
~QUIC `RFC9000$r の上層に定義され，
~QUIC接続~越しに~HTTP要請を多重化できる~protocolである。
この文書は、
~WebTransport~protocolの要件と意味論 `OVERVIEW$r に適合する方式
で，非-~HTTP~dataを~HTTP3で多重化するための仕組みを定義する。
ここに述べられる仕組みを利用すれば、
複数の~WebTransport~instanceを同じ`~HTTP3接続$上の定例の~HTTP流通と同時に多重化できる。
◎
HTTP/3 [HTTP3] is a protocol defined on top of QUIC [RFC9000] that can multiplex HTTP requests over a QUIC connection. This document defines a mechanism for multiplexing non-HTTP data with HTTP/3 in a manner that conforms with the WebTransport protocol requirements and semantics[OVERVIEW]. Using the mechanism described here, multiple WebTransport instances can be multiplexed simultaneously with regular HTTP traffic on the same HTTP/3 connection.
</p>

		<section id="terminology">
<h3 title="Terminology">1.1. 各種用語</h3>

<p>
この文書~内の~keyword "MUST" …
【以下、この段落の内容は`~IETF日本語訳~共通~page＠~IETFcommon#requirements-notation$に移譲。】
◎
The keywords "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT", "SHOULD", "SHOULD NOT", "RECOMMENDED", "NOT RECOMMENDED", "MAY", and "OPTIONAL" in this document are to be interpreted as described in BCP 14 [RFC2119] [RFC8174] when, and only when, they appear in all capitals, as shown here.
</p>

<p>
この文書は、
`OVERVIEW$r `§ 規約と定義＠~WT-OVERVIEW#conventions-and-definitions$
にて定義された各種用語に従う。
この文書は、
`~WebTransport~server$と`~HTTP3~server$を判別することに注意。
~HTTP3~serverが，`~HTTP3接続$を終了する~serverである。
~WebTransport~serverは、
`~WebTransport~session$を受容する応用であり，
~HTTP3~serverを介して~accessされ得るものである。
◎
This document follows terminology defined in Section 1.2 of [OVERVIEW]. Note that this document distinguishes between a WebTransport server and an HTTP/3 server. An HTTP/3 server is the server that terminates HTTP/3 connections; a WebTransport server is an application that accepts WebTransport sessions, which can be accessed via an HTTP/3 server.
</p>

<p class="trans-note">【
単に［
~server／~client
］と記される箇所も多々あるが、
ほとんどは［
`~WebTransport~client$／`~WebTransport~server$
］を意味するであろう。
】</p>

		</section>
	</section>
	<section id="protocol-overview">
<h2 title="Protocol Overview">2. ~protocolの概観</h2>

<p>
`~WebTransport~server$は、
一般に［
`authority$p 値, `path$p 値
］（ `RFC3986$r ）が成す~pairにより識別される。
◎
WebTransport servers in general are identified by a pair of authority value and path value (defined in [RFC3986] Sections 3.2 and 3.3 correspondingly).
</p>

<p>
`~HTTP3接続$が確立されるときには、
~client, ~serverどちらも，［
~HTTP3越しの~WebTransportを~supportする
］ことを指示するために［
`SETTINGS_WEBTRANSPORT_MAX_SESSIONS$sp `設定$を送信する
］必要がある。
この処理nは、
追加的な~HTTP3拡張の利用も折衝する。
◎
When an HTTP/3 connection is established, both the client and server have to send a SETTINGS_WEBTRANSPORT_MAX_SESSIONS setting in order to indicate that they both support WebTransport over HTTP/3. This process also negotiates the use of additional HTTP/3 extensions.
</p>

<p>
`~WebTransport~session$は、
所与の`~HTTP3接続$の内側で［
拡張d `CONNECT$m 要請 `RFC8441$r を送信する~client
］により起動される。
~serverが当の要請を受容する場合，`~WebTransport~session$が確立される。
結果の~streamは，
`~CONNECT~stream@
と称され、
その`~stream~ID$は
`~session~ID@
と称される。
`~session~ID$は、［
当の接続の中で所与の`~WebTransport~session$を一意に識別する
］ために【他の~streamにより】利用される。
◎
WebTransport sessions are initiated inside a given HTTP/3 connection by the client, who sends an extended CONNECT request [RFC8441]. If the server accepts the request, a WebTransport session is established. The resulting stream will be further referred to as a CONNECT stream, and its stream ID is used to uniquely identify a given WebTransport session within the connection. The ID of the CONNECT stream that established a given WebTransport session will be further referred to as a Session ID.
</p>

<p>
~sessionが確立されたなら、
双方の端点は，次に挙げる仕組みを利用して~dataを交換できるようになる：
◎
After the session is established, the peers can exchange data using the following mechanisms:
</p>
<ul>
	<li>
~clientは、
`双方向~stream$を作成でき，
その所有者であることを［
最初の~byte列~内に特別な通達を供する
］ことにより~WebTransportへ転送する。
◎
A client can create a bidirectional stream and transfer its ownership to WebTransport by providing a special signal in the first bytes.
</li>
	<li>
~serverは、
`双方向~stream$を作成でき，
その所有者であることを［
最初の~byte列~内に特別な通達を供する
］ことにより~WebTransportへ転送する。
◎
A server can create a bidirectional stream and transfer its ownership to WebTransport by providing a special signal in the first bytes..
</li>
	<li>
［
~client／~server
］は、
ある特別な~stream種別を利用して，`一方向~stream$を作成できる。
◎
Both client and server can create a unidirectional stream using a special stream type.
</li>
	<li>
~datagramは、
`~HTTP~datagram$ `HTTP-DATAGRAM$r を利用して送信できる。
◎
A datagram can be sent using HTTP Datagrams [HTTP-DATAGRAM].
</li>
</ul>

<p>
`~WebTransport~session$が終了されるのは、
それを作成した`~CONNECT~stream$が~closeされたときである。
◎
A WebTransport session is terminated when the CONNECT stream that created it is closed.
</p>


	</section>
	<section id="session-establishment">
<h2 title="Session Establishment">3. ~sessionの確立</h2>

		<section id="establishing">
<h3 title="Establishing a Transport-Capable HTTP/3 Connection">3.1. ~transport能力がある~HTTP3接続の確立-法</h3>

<p>
~WebTransport用の~supportを指示するためには、
~client, ~serverどちらも，［
各自の `SETTINGS$ft ~frame内で 1 以上の値を伴う `SETTINGS_WEBTRANSPORT_MAX_SESSIONS$sp
］を送信しなければ`ナラナイ^2119。
`SETTINGS_WEBTRANSPORT_MAX_SESSIONS$sp ~parameter用の既定の値は 0 であり，［
端点は`~WebTransport~session$を受信する用意はない
］ことを意味する。
~clientが送信する必要がある値は 1 以上なら何でもよいことに注意
— `~WebTransport~session$は~clientが起動するので、
実際の値は有意でない。
◎
In order to indicate support for WebTransport, both the client and the server MUST send a SETTINGS_WEBTRANSPORT_MAX_SESSIONS value greater than "0" in their SETTINGS frame. The default value for the SETTINGS_WEBTRANSPORT_MAX_SESSIONS parameter is "0", meaning that the endpoint is not willing to receive any WebTransport sessions. Note that the client only needs to send a value greater than "0"; since clients initiate WebTransport sessions, the actual value is not significant.
</p>

<p>
~clientは、
~serverから~WebTransport用の~supportを指示している`設定$を受信するまでは，
~WebTransport要請を送信しては`ナラナイ^2119。
◎
The client MUST NOT send a WebTransport request until it has received the setting indicating WebTransport support from the server.
</p>

<p class="note">注記：
次の段落は、
~RFCとして公表する前に除去されることになる。
◎
[[RFC editor: please remove the following paragraph before publication.]]
</p>

<p>
類似に，~serverは、
~clientから設定~群を受信するまでは，
どの流入~WebTransport要請も処理しては`ナラナイ^2119
— ~clientは、
~WebTransport拡張として［
~serverが利用するものとは異なる~version
］を利用していることもあるので。
◎
Similarly, the server MUST NOT process any incoming WebTransport requests until the client settings have been received, as the client may be using a version of the WebTransport extension that is different from the one used by the server.
</p>

<p>
~HTTP3越しの~WebTransportは、
`~HTTP~datagram$【！HTTP/3 Datagram】と`~capsule~protocol$ `HTTP-DATAGRAM$r
用の~supportを要求するので、
~client, ~serverどちらも、
各自の `SETTINGS$ft ~frame内に［
値 1 に設定された `SETTINGS_H3_DATAGRAM$sp `HTTP-DATAGRAM$r
］を送信することにより，
~HTTP3~datagram用の~supportを指示しなければ`ナラナイ^2119。
◎
Because WebTransport over HTTP/3 requires support for HTTP/3 datagrams and the Capsule Protocol, both the client and the server MUST indicate support for HTTP/3 datagrams by sending a SETTINGS_H3_DATAGRAM value set to 1 in their SETTINGS frame (see Section 2.1.1 of [HTTP-DATAGRAM]).
</p>

<p>
~HTTP3越しの~WebTransportには、
~QUIC~datagram用の~supportも要求される。
~supportを指示するためには、
~client, ~serverどちらも，［
1 以上の値を伴う `max_datagram_frame_size＠~RFCx/rfc9221#section-3$c ~transport~parameter `QUIC-DATAGRAM$r
］を送信しなければ`ナラナイ^2119。
◎
WebTransport over HTTP/3 also requires support for QUIC datagrams. To indicate support, both the client and the server MUST send a max_datagram_frame_size transport parameter with a value greater than 0 (see Section 3 of [QUIC-DATAGRAM]).
</p>

		</section>
		<section id="extended-connect-in-http3">
<h3 title="Extended CONNECT in HTTP/3">3.2. ~HTTP3における拡張d~CONNECT</h3>

<p>
`RFC8441$r `§ 4＠~RFCx/rfc8441#section-4$ は、
拡張d `CONNECT$m ~methodを定義する
— それは、
`SETTINGS_ENABLE_CONNECT_PROTOCOL^sp 設定により可能化される。
この`設定$は、
~HTTP3用には `RFC9220$r により定義される。
~HTTP3越しの~WebTransportを~supportしている［
~client, ~server
］は、
1 以上の値を伴う `SETTINGS_WEBTRANSPORT_MAX_SESSIONS$sp 設定を送信しなければ`ナラナイ^2119。
加えて，~serverは、
値 1 を伴う `SETTINGS_ENABLE_CONNECT_PROTOCOL^sp 設定も送信しなければ`ナラナイ^2119。
◎
[RFC8441] defines an extended CONNECT method in Section 4, enabled by the SETTINGS_ENABLE_CONNECT_PROTOCOL setting. That setting is defined for HTTP/3 by [RFC9220]. A client supporting WebTransport over HTTP/3 MUST send the SETTINGS_WEBTRANSPORT_MAX_SESSIONS setting with a value greater than "0". A server supporting WebTransport over HTTP/3 MUST send both the SETTINGS_WEBTRANSPORT_MAX_SESSIONS setting with a value greater than "0" and the SETTINGS_ENABLE_CONNECT_PROTOCOL setting with a value of "1".
</p>

		</section>
		<section id="creating-a-new-session">
<h3 title="Creating a New Session">3.3. 新たな~sessionの作成-法</h3>

<p>
`~WebTransport~session$は，~HTTP3越しに確立されるので、
`https$c ~URI~scheme `HTTP$r を利用して識別される。
◎
As WebTransport sessions are established over HTTP/3, they are identified using the https URI scheme ([HTTP], Section 4.2.2).
</p>

<p>
~clientは、
~HTTP `CONNECT$m 要請を送信して，
新たな`~WebTransport~session$を作成できる
— この要請は、
次を満たさなければ`ナラナイ^2119：
◎
In order to create a new WebTransport session, a client can send an HTTP CONNECT request.＼
</p>
<ul>
	<li>
`protocol^ph 疑似-~header `RFC8441$r を伴い，
その値は `webtransport^c をとる。
◎
The :protocol pseudo-header field ([RFC8441]) MUST be set to webtransport.＼
</li>
	<li>
`scheme$ph 疑似-~headerを伴い，
その値は `https^c をとる。
◎
The :scheme field MUST be https.＼
</li>
	<li>
［
`authority$ph, `path$ph
］両~疑似-~headerを伴う
— これらは、
欲される`~WebTransport~server$を指示する。
◎
Both the :authority and the :path value MUST be set; those fields indicate the desired WebTransport server.＼
</li>
	<li>
~clientは~browser~clientである場合、
`Origin$h ~header `RFC6454$r を伴う
— 他の場合、
この~headerは`任意選択^2119である。
◎
If the WebTransport session is coming from a browser client, an Origin header [RFC6454] MUST be provided within the request; otherwise, the header is OPTIONAL.
</li>
</ul>

<p>
`~HTTP3~server$は、
`webtransport^c に設定された `protocol^ph ~fieldを伴う拡張d `CONNECT$m 要請を受信した際には，当の要請にて指定された
( `authority$ph 値, `path$ph 値 )
に結付けられた`~WebTransport~server$を有するか否か検査できる。
有さない場合、
状態s~code `404$st `HTTP$r で返信する`ベキ^2119である。
`~WebTransport~server$は：
◎
Upon receiving an extended CONNECT request with a :protocol field set to webtransport, the HTTP/3 server can check if it has a WebTransport server associated with the specified :authority and :path values. If it does not, it SHOULD reply with status code 404 (Section 15.5.5 of [HTTP]).＼
</p>

<ul>
	<li>
当の要請が `Origin$h ~headerを包含するときは、
この~headerを検証yして，［
この~headerに指定された生成元が当の~serverへ~accessすることは許容される
］ことを確保しなければ`ナラナイ^2119
— 検証yに失敗した場合、
状態s~code `403$st `HTTP$r で返信する`ベキ^2119である。
◎
When the request contains the Origin header, the WebTransport server MUST verify the Origin header to ensure that the specified origin is allowed to access the server in question.＼
If the verification fails, the WebTransport server SHOULD reply with status code 403 (Section 15.5.4 of [HTTP]).＼
</li>
	<li>
すべての検査に合格したなら、
状態s~code `2xx$st `HTTP$r を返信することにより，
`~WebTransport~session$を受容しても`ヨイ^2119。
◎
If all checks pass, the WebTransport server MAY accept the session by replying with a 2xx series status code, as defined in Section 15.3 of [HTTP].
</li>
</ul>

<p>
`~WebTransport~session$が確立されたことになる時点は、
~clientの視点からは，自身が `2xx$st 応答を受信したときであり、
~serverの視点からは，自身が `2xx$st 応答を送信したときである。
◎
From the client's perspective, a WebTransport session is established when the client receives a 2xx response. From the server's perspective, a session is established once it sends a 2xx response.
</p>

<p>
~serverは、
`3xx$st 応答 `HTTP$r を返信して，~redirectionを指示してもよい。
~UAは、
そのような~redirectに対し，自動的に追従しては`ナラナイ^2119
— ~clientは、
当の`~WebTransport~session$用の~dataをすでに送信した場合もあるので。
~UA【！it】は、
~redirectについて~clientに通知しても`ヨイ^2119。
◎
The server may reply with a 3xx response, indicating a redirection (Section 15.4 of [HTTP]). The user agent MUST NOT automatically follow such redirects, as the client could potentially already have sent data for the WebTransport session in question; it MAY notify the client about the redirect.
</p>

<p>
`CONNECT$m ~methodは`安全$とは見なされないので、
~clientは，~WebTransportを~0-RTT~packet内では起動し得ない
— `HTTP3$r `§ 早期~data＠~HTTPv3#early-data$
を見よ。
しかしながら，
~WebTransportに関係する `SETTINGS$ft ~parameterは、
`HTTP3$r `§ 初期化＠~HTTPv3#settings-initialization$
にて述べられるとおり，前回の~sessionから維持してもよい。
~serverは、
~0-RTTを受容する場合には，［
~openな`~WebTransport~session$の最大な個数
］に対する上限を［
前回の~sessionの間に折衝した上限
］から抑制しては`ナラナイ^2119 
— そのような変更は、
互換でないものと判断され，その結果は
`接続~error$( `H3_SETTINGS_ERROR$er )
にならなければ`ナラナイ^2119。
◎
Clients cannot initiate WebTransport in 0-RTT packets, as the CONNECT method is not considered safe; see Section 10.9 of [HTTP3]. However, WebTransport-related SETTINGS parameters may be retained from the previous session as described in Section 7.2.4.2 of [HTTP3]. If the server accepts 0-RTT, the server MUST NOT reduce the limit of maximum open WebTransport sessions from the one negotiated during the previous session; such change would be deemed incompatible, and MUST result in a H3_SETTINGS_ERROR connection error.
</p>

<p>
~HTTP~Upgrade~token `webtransport^c は、
`HTTP-DATAGRAM$r にて定義されるとおり，`~capsule~protocol$を利用する。
`~capsule~protocol$は、
~serverが `2xx$st 応答を送信するときに折衝される。
`Capsule-Protocol$h ~header `HTTP-DATAGRAM$r は，
~WebTransportには要求されないので、
~WebTransport端点は，それを安全に無視できる。
◎
The webtransport HTTP Upgrade Token uses the Capsule Protocol as defined in [HTTP-DATAGRAM]. The Capsule Protocol is negotiated when the server sends a 2xx response. The capsule-protocol header field Section 3.4 of [HTTP-DATAGRAM] is not required by WebTransport and can safely be ignored by WebTransport endpoints.
</p>

		</section>
		<section id="subprotocol-negotiation">
<h3 title="Subprotocol Negotiation">3.4. 下位protocolの折衝</h3>

<p>
~HTTP3越しの~WebTransportは、
~ALPN `RFC7301$r に類似な下位protocol折衝の仕組みを提供する
— その意図は、
これまで既存の~protocolのうち［
~QUICを利用していて，この機能性に依拠するもの
］の~port法を単純~化することにある。
◎
WebTransport over HTTP/3 offers a subprotocol negotiation mechanism, similar to TLS Application-Layer Protocol Negotiation Extension (ALPN) [RFC7301]; the intent is to simplify porting pre-existing protocols that use QUIC and rely on this functionality.
</p>

<p>
~UAは、
`CONNECT$m 要請~内に［
アリな下位protocolたちを列挙している `WebTransport-Subprotocols-Available$h ~header
］を内包しても`ヨイ^2119。
この~headerを受信した~serverは、
対する成功裡な応答（ `2xx$st ）内に `WebTransport-Subprotocol$h ~fieldを内包しても`ヨイ^2119。
そうする場合、
~serverは，その~fieldに［
~clientからの~listを成す下位protocolのうち いずれか 1 つ
］を内包しなければ`ナラナイ^2119【！SHALL】。
~serverは、
~clientが相応しい下位protocolを内包しなかった場合には，
当の要請を却下しても`ヨイ^2119。
◎
The user agent MAY include a WebTransport-Subprotocols-Available header field in the CONNECT request, enumerating the possible subprotocols. If the server receives such a header, it MAY include a WebTransport-Subprotocol field in a successful (2xx) response. If it does, the server SHALL include a single subprotocol from the client's list in that field. Servers MAY reject the request if the client did not include a suitable subprotocol.
</p>

<p>
［
`WebTransport-Subprotocols-Available@h ／
`WebTransport-Subprotocol@h
］は、
`有構造~field$ `RFC8941$r である。
`WebTransport-Subprotocols-Available$h は、
`~sf~token$たちが成す`~sf~list$をとる。
`WebTransport-Subprotocol$h は、
`~sf~token$をとる。
`WebTransport-Subprotocol$h 応答~header内の~tokenは、
それが応対した要請の `WebTransport-Subprotocols-Available$h 内に挙げられた，いずれかの~tokenでなければ`ナラナイ^2119。
個々の~token値の意味論は、
当の~WebTransport資源により決定される
— ~IANAの
`~ALPN~protocol~ID~registry＠~IANA-a/tls-extensiontype-values/tls-extensiontype-values.xhtml#alpn-protocol-ids$cite
には登録されない。
◎
Both WebTransport-Subprotocols-Available and WebTransport-Subprotocol are Structured Fields [RFC8941]. WebTransport-Subprotocols-Available is a List of Tokens, and WebTransport-Subprotocol is a Token. The token in the WebTransport-Subprotocol response header field MUST be one of the tokens listed in WebTransport-Subprotocols-Available of the request. The semantics of individual token values is determined by the WebTransport resource in question, and are not registered in IANA's "ALPN Protocol IDs" registry.
</p>


		</section>
		<section id="limiting-the-number-of-simultaneous-sessions">
<h3 title="Limiting the Number of Simultaneous Sessions">3.5. 同時な~sessionの個数の制限-法</h3>

<p>
この文書は、
`SETTINGS_WEBTRANSPORT_MAX_SESSIONS$sp ~parameterを定義する
— それは、
単独の`~HTTP3接続$上で同時並行な`~WebTransport~session$の最大~個数を制限することを
~serverに許容する。
~clientは、
~serverからの `SETTINGS$ft ~parameter内に指示された個数より多い~sessionを~openしては`ナラナイ^2119。
~serverは、
~clientがこの上限を超過している~sessionを~openした場合でも，
当の接続を~closeしては`ナラナイ^2119
— ~WebTransport~protocolの非同期的な資質に因り、
~openな~sessionの個数についての~viewは，~clientと~serverとで整合でない【ときもある】ので。
代わりに，［
`~CONNECT~stream$のうち，自身が処理する用意がないもの
］すべてを `HTTP3$r にて定義される `H3_REQUEST_REJECTED$er 【！HTTP_REQUEST_REJECTED】状態sで`~reset$しなければ`ナラナイ^2119。
◎
This document defines a SETTINGS_WEBTRANSPORT_MAX_SESSIONS parameter that allows the server to limit the maximum number of concurrent WebTransport sessions on a single HTTP/3 connection. The client MUST NOT open more sessions than indicated in the server SETTINGS parameters. The server MUST NOT close the connection if the client opens sessions exceeding this limit, as the client and the server do not have a consistent view of how many sessions are open due to the asynchronous nature of the protocol; instead, it MUST reset all of the CONNECT streams it is not willing to process with the HTTP_REQUEST_REJECTED status defined in [HTTP3].
</p>

<p>
他の~HTTP要請と同じく，
`~WebTransport~session$たち, それらに対し送信される~dataは、
~flow制御の上限に向かって数えられる。
この文書は、［
各`~WebTransport~session$により消費される~flow制御~creditの量
］を［
異なる~sessionどうしで相対的に制限する
］ための［
端点~用の追加的な仕組み
］を導入しない。
しかしながら、
~serverが［
特定0の~session上の流入~要請たちの~rateを制限する
］よう望む場合，
代替な仕組みがある：
◎
Just like other HTTP requests, WebTransport sessions, and data sent on those sessions, are counted against flow control limits. This document does not introduce additional mechanisms for endpoints to limit the relative amount of flow control credit consumed by different WebTransport sessions, however servers that wish to limit the rate of incoming requests on any particular session have alternative mechanisms:
</p>
<ul>
	<li>
`HTTP3$r にて定義される~error~code `H3_REQUEST_REJECTED$er【！HTTP_REQUEST_REJECTED】 は、［
当の要請は，どの仕方でも処理されなかったこと
］を受信している~HTTP3~stackに対し指示する。
◎
The HTTP_REQUEST_REJECTED error code defined in [HTTP3] indicates to the receiving HTTP/3 stack that the request was not processed in any way.
</li>
	<li>
~HTTP状態s~code `429$st `RFC6585$r は、
当の要請は，~rate制限-法に因り却下されたことを指示する。
前項と違って、
この通達は，応用へ直に伝播される。
◎
HTTP status code 429 indicates that the request was rejected due to rate limiting [RFC6585]. Unlike the previous method, this signal is directly propagated to the application.
</li>
</ul>

		</section>
		<section id="prioritization">
<h3 title="Prioritization">3.6. 優先度化</h3>

<p>
各`~WebTransport~session$は、
拡張d `CONNECT$m を利用して起動される。
`RFC9218$r `§ 11＠~RFCx/rfc9218#section-11$ は，［
拡張-可能な優先度が`~CONNECT~stream$上に送信された~dataに どう適用できるか
］を述べるが、
~WebTransportは，［
要請と応答の関係において交換される~dataの種別
］を拡張する
— それには、
追加的な考慮点が要求される。
◎
WebTransport sessions are initiated using extended CONNECT. While Section 11 of [RFC9218] describes how extensible priorities can be applied to data sent on a CONNECT stream, WebTransport extends the types of data that are exchanged in relation to the request and response, which requires additional considerations.
</p>

<p>
~WebTransport `CONNECT$m 要請, それに対する応答は、
`Priority$h ~header `RFC9218$r を包含しても`ヨイ^2119。
~clientは、
`PRIORITY_UPDATE$ft ~frame `RFC9218$r を送信することにより，
優先度化し直しても`ヨイ^2119。
`RFC9218$r に対する拡張においては、［
~client, ~server
］は，
当の封入している【？】`~WebTransport~session$内に自身が送信するすべての~data
— `~capsule$,
`~WebTransport~stream$,
~WebTransport~datagram
を含む —
に［
`RFC9218$r `§ 9＠~RFCx/rfc9218#section-9$,
`RFC9218$r `§ 10＠~RFCx/rfc9218#section-10$
］による~schedule法の指導をどちらも適用することが`推奨される^2119。
~WebTransportは、
`~WebTransport~session$の中の［
~streamたち, ~datagramたち
］用に優先度を通達するための仕組みを何も供さない
— そのような仕組みは、
~WebTransportを利用している応用~protocolが定義し得る。
そのような仕組みは、
ある~sessionの中での~schedule法に限り影響し，
同じ`~HTTP3接続$上の他の~dataの~schedule法には影響しないことが`推奨される^2119。
◎
WebTransport CONNECT requests and responses MAY contain the Priority header field (Section 5 of [RFC9218]); clients MAY reprioritize by sending PRIORITY_UPDATE frames (Section 7 of [RFC9218]). In extension to [RFC9218], it is RECOMMENDED that clients and servers apply the scheduling guidance in both Section 9 of [RFC9218] and Section 10 of [RFC9218] for all data that they send in the enclosing WebTransport session, including Capsules, WebTransport streams and datagrams. WebTransport does not provide any priority signaling mechanism for streams and datagrams within a WebTransport session; such mechanisms can be defined by application protocols using WebTransport. It is RECOMMENDED that such mechanisms only affect scheduling within a session and not scheduling of other data on the same HTTP/3 connection.
</p>

<p>
`RFC9218$r `§ 8＠~RFCx/rfc9218#section-8$
にて与えられる［
~clientの優先度, ~serverの優先度
］を併合するための指導は、
`~WebTransport~session$にも適用される。
例えば，ある応答にて `Priority$h ~headerを受信した~clientは、
ある`~WebTransport~session$の優先度に関する自身の~viewを改めることもでき，
その結果として流出~dataの~schedule法を改めることもできる。
◎
The client/server priority merging guidance given in Section 8 of [RFC9218] also applies to WebTransport session. For example, a client that receives a response Priority header field could alter its view of a WebTransport session priority and alter the scheduling of outgoing data as a result.
</p>

<p>
端点は、
`~WebTransport~session$たちを優先度化する際に，［
それらが同じ`~HTTP3接続$上の他の~sessionや要請と どう相互作用するか
］について考慮する必要がある。
◎
Endpoints that prioritize WebTransport sessions need to consider how they interact with other sessions or requests on the same HTTP/3 connection.
</p>

		</section>
	</section>
	<section id="webtransport-features">
<h2 title="WebTransport Features">4. ~WebTransport特能</h2>

<p>
~HTTP3越しの~WebTransportは、
`OVERVIEW$r にて述べられた特能として，いずれかの端点により起動される［
`一方向~stream$,
`双方向~stream$,
~datagram
］を供する。
［
~HTTP3越しの~WebTransportと伴に利用するよう設計された~protocol
］の特能は、
これらに拘束される。
`~capsule~protocol$は、
~HTTP3越しの~WebTransportの実装の詳細であり，
~WebTransport特能ではない。
◎
WebTransport over HTTP/3 provides the following features described in [OVERVIEW]: unidirectional streams, bidirectional streams and datagrams, initiated by either endpoint. Protocols designed for use with WebTransport over HTTP/3 are constrained to these features. The Capsule Protocol is an implementation detail of WebTransport over HTTP/3 and is not a WebTransport feature.
</p>

<p>
`~session~ID$は、［
~stream, ~datagram
］たちを それらが属する`~WebTransport~session$ごとに逆多重化するために利用される。
伝送路~上では、
`~session~ID$は［
~QUIC `RFC9000$r にて述べられる`可変長な整数$用の~scheme
］を利用して符号化される。
◎
Session IDs are used to demultiplex streams and datagrams belonging to different WebTransport sessions. On the wire, session IDs are encoded using the QUIC variable length integer scheme described in [RFC9000].
</p>

<p>
~clientは、
`CONNECT$m 要請に対する応答を まだ受信してないときでも，楽観的に、
当の要請を送信した~session用に［
`一方向~stream$／`双方向~stream$
］を~openしても，~datagramを送信しても`ヨイ^2119。
~server側は、
`CONNECT$m 要請を受信したなら，［
~streamを~openする／~datagramを送信する
］ことがアリになる。
◎
The client MAY optimistically open unidirectional and bidirectional streams, as well as send datagrams, for a session that it has sent the CONNECT request for, even if it has not yet received the server's response to the request. On the server side, opening streams and sending datagrams is possible as soon as the CONNECT request has been received.
</p>

<p>
受信者は、
いつでも［
~clientが起動した`双方向~stream$用の妥当な~ID
］になり得ない`~session~ID$を受信したときは，
~error~code `H3_ID_ERROR$er で当の接続を~closeしなければ`ナラナイ^2119。
◎
If at any point a session ID is received that cannot a valid ID for a client-initiated bidirectional stream, the recipient MUST close the connection with an H3_ID_ERROR error code.
</p>

		<section id="unidirectional-streams">
<h3 title="Unidirectional streams">4.1. 一方向~stream</h3>

<p>
~WebTransport端点は、
`一方向~stream$を起動できる。
~HTTP3の`一方向~stream$の種別は、
`0x54^hex でなければ`ナラナイ^2119【！SHALL】。
~streamの本体は、
順に，次に挙げるものからなっていなければ`ナラナイ^2119【！SHALL】（ `図 1＠#fig-unidi$ ）
⇒＃
`可変長な整数$として符号化された~stream種別,
`可変長な整数$として符号化された`~session~ID$,
~streamの利用者が指定した~stream~data
◎
WebTransport endpoints can initiate unidirectional streams. The HTTP/3 unidirectional stream type SHALL be 0x54. The body of the stream SHALL be the stream type, followed by the session ID, encoded as a variable-length integer, followed by the user-specified stream data (Figure 1).
</p>

<figure id="fig-unidi">
<pre class="frame-diagram">
一方向~stream {
  ~stream種別 (i) = `0x54^hex,
  `~session~ID$ (i),
  ~stream本体 (..)
}
◎
Unidirectional Stream {
  Stream Type (i) = `0x54^hex,
  Session ID (i),
  Stream Body (..)
}
</pre>
<figcaption>
一方向~WebTransport~streamの形式
◎
Figure 1: Unidirectional WebTransport stream format
</figcaption></figure>

		</section>
		<section id="bidirectional-streams">
<h3 title="Bidirectional Streams">4.2. 双方向~stream</h3>

<p>
~clientが起動した`双方向~stream$は、
~HTTP3により，すべて要請~streamとして予約される
— それは、
各種~規則を伴う~HTTP3~frameたちが成す連列である。
`HTTP3$r
`§ ~HTTPの~message~frame法＠~HTTPv3#request-response$,
`§ 双方向~stream＠~HTTPv3#request-streams$
を見よ。
◎
All client-initiated bidirectional streams are reserved by HTTP/3 as request streams, which are a sequence of HTTP/3 frames with a variety of rules; see Sections 4.1 and 6.1 of [HTTP3].
</p>

<p>
~WebTransportは、［
代替な要請~stream規則を宣言して利用する
］ことを~clientに許容するよう，~HTTP3を拡張する。
~clientは、［
`~WebTransportの~support＠#establishing$を指示している設定群
］を受信したなら，［
当の~streamを成す最初の~byte列
］として［
`可変長な整数$として符号化された特別な通達~値
］を送信することにより［
当の~stream上の残りの~byte列がどう利用されるか
］を指示できる。
◎
WebTransport extends HTTP/3 to allow clients to declare and use alternative request stream rules. Once a client receives settings indicating WebTransport support (Section 3.1), it can send a special signal value, encoded as a variable-length integer, as the first bytes of the stream in order to indicate how the remaining bytes on the stream are used.
</p>

<p>
~WebTransportは、
~serverが起動したすべての`双方向~stream$用の規則を定義することにより，
~HTTP3を拡張する。
~serverは、［
`~WebTransportの~support＠#establishing$を指示している設定群
］を受信したなら，
`双方向~stream$を~openできる。
~serverは、［
当の~streamを成す最初の~byte列
］として［
`可変長な整数$として符号化された特別な通達~値
］を送信しなければ`ナラナイ^2119【！SHALL】
— それは、［
当の~stream上の残りの~byte列がどう利用されるか
］を指示する。
◎
WebTransport extends HTTP/3 by defining rules for all server-initiated bidirectional streams. Once a server receives settings indicating WebTransport support (Section 3.1), it can open a bidirectional stream and SHALL send a special signal value, encoded as a variable-length integer, as the first bytes of the stream in order to indicate how the remaining bytes on the stream are used.
</p>

<p>
［
~client, ~server
］が双方向~WebTransport~streamを~openするために利用する通達~値は、
`0x41^hex とする。
これには、
それに結付けられる［
`可変長な整数$として符号化された`~session~ID$
］が後続する。
残りは、
当の~streamを成す応用~payloadである
（ `図 2＠#fig-bidi-client$）。
◎
The signal value, 0x41, is used by clients and servers to open a bidirectional WebTransport stream. Following this is the associated session ID, encoded as a variable-length integer; the rest of the stream is the application payload of the WebTransport stream (Figure 2).
</p>

<figure id="fig-bidi-client">
<pre class="frame-diagram">
双方向~stream {
  通達~値 (i) = 0x41,
  `~session~ID$ (i),
  ~stream本体 (..)
}
◎
Bidirectional Stream {
  Signal Value (i) = 0x41,
  Session ID (i),
  Stream Body (..)
}
</pre>
<figcaption>
双方向~WebTransport~streamの形式
◎
Figure 2: Bidirectional WebTransport stream format
</figcaption></figure>

<p>
この文書は、
特別な通達~値 `0x41^hex を~frame種別
`WEBTRANSPORT_STREAM$ft
として予約する。
それは、
衝突を避けるため，~HTTP3~frame種別として登録されるが、
長さを欠如するので，適正な~HTTP3~frameではない。
`WEBTRANSPORT_STREAM$ft は，~HTTP3~frame構文の拡張であり、
~WebTransportを折衝している相手の端点は，それを~supportしなければ`ナラナイ^2119。
この拡張を実装する端点は、
追加的な~frame取扱い要件の~subjectにもなる。
端点は、
要請~streamを成す一番最初の~byte列~以外において，
~HTTP3~stream上に~frame種別 `WEBTRANSPORT_STREAM$ft を送信しては`ナラナイ^2119。
他の状況下で，この~frame種別を受信した場合、
`接続~error$( `H3_FRAME_ERROR$er )
として扱わなければ`ナラナイ^2119。
◎
This document reserves the special signal value 0x41 as a WEBTRANSPORT_STREAM frame type. While it is registered as an HTTP/3 frame type to avoid collisions, WEBTRANSPORT_STREAM is not a proper HTTP/3 frame, as it lacks length; it is an extension of HTTP/3 frame syntax that MUST be supported by any peer negotiating WebTransport. Endpoints that implement this extension are also subject to additional frame handling requirements. Endpoints MUST NOT send WEBTRANSPORT_STREAM as a frame type on HTTP/3 streams other than the very first bytes of a request stream. Receiving this frame type in any other circumstances MUST be treated as a connection error of type H3_FRAME_ERROR.
</p>


		</section>
		<section id="resetting-data-streams">
<h3 title="Resetting Data Streams">4.3. ~data~streamの~reset法</h3>

<p>
~WebTransport端点は、
~WebTransport~data~stream用に［
`RESET_STREAM$ft ／ `STOP_SENDING$ft
］~frameを送信してもよい。
それらの通達は、
当の~WebTransport実装により，応用へ伝播される。
◎
A WebTransport endpoint may send a RESET_STREAM or a STOP_SENDING frame for a WebTransport data stream. Those signals are propagated by the WebTransport implementation to the application.
</p>

<p>
~WebTransport応用は、
自身の演算~用に~error~codeを供さなければ`ナラナイ^2119【！SHALL】。
~WebTransportは，~error~code空間を~HTTP3と共有するので、
~stream用の~WebTransport応用~errorは、
無符号な 32 ~bit整数
— `0x00000000^hex 〜 `0xffffffff^hex —
に制限される。
~WebTransport実装は、
それらの~error~codeを `WEBTRANSPORT_APPLICATION_ERROR$er 用に予約された~error範囲の中へ対応付けなければ`ナラナイ^2119【！SHALL】
— ［
`0x00000000^hex は `0x52e4a40fa8db^hex,
`0xffffffff^hex は `0x52e5ac983162^hex
］に対応するよう。
この範囲の内側には、
`HTTP3$r `§ ~HTTP3~error~code＠~HTTPv3#http-error-codes$により予約-済みな符号点たち
{ `0x1f^hex ~MUL %N ~PLUS `0x21^hex ； %N は負でない整数 }
があることに注意
— これらの符号点は、
~error~codeたちを対応付けるときには，飛ばされる必要がある
（すなわち、
ある予約-済みな符号点を挟んで隣接な 2 個の~HTTP3~error符号点は，
2 個の隣接な~WebTransport応用~error符号点に対応付けられる）。
対応付け用の`疑似-~code例＠#fig-remap-errors$は：
◎
A WebTransport application SHALL provide an error code for those operations. Since WebTransport shares the error code space with HTTP/3, WebTransport application errors for streams are limited to an unsigned 32-bit integer, assuming values between 0x00000000 and 0xffffffff. WebTransport implementations SHALL remap those error codes into the error range reserved for WEBTRANSPORT_APPLICATION_ERROR, where 0x00000000 corresponds to 0x52e4a40fa8db, and 0xffffffff corresponds to 0x52e5ac983162. Note that there are code points inside that range of form "0x1f * N + 0x21" that are reserved by Section 8.1 of [HTTP3]; those have to be skipped when mapping the error codes (i.e. the two HTTP/3 error codepoints adjacent to a reserved codepoint would map to two adjacent WebTransport application error codepoints). An example pseudocode can be seen in Figure 3.
</p>

<figure id="fig-remap-errors">
<pre>
%first = 0x52e4a40fa8db
%last = 0x52e5ac983162

def webtransport_code_to_http_code(%n):
return %first + %n + floor(%n / 0x1e)

def http_code_to_webtransport_code(%h):
assert(%first &lt;= %h &lt;= %last)
assert((%h - 0x21) % 0x1f != 0)
%shifted = %h - %first
return %shifted - floor(%shifted / 0x1f)
</pre>
<figcaption>
~WebTransport応用~errorと~HTTP3~error~codeを相互に変換するための疑似-~code
◎
Figure 3: Pseudocode for converting between WebTransport application errors and HTTP/3 error codes
</figcaption></figure>

<p>
各~WebTransport~data~streamには、
当の~streamの始めにある~headerを通して`~WebTransport~session$が結付けられる
— ~streamを`~reset$すると、
その結果，その~dataは破棄され得る。
このことから、
~WebTransport応用~error~codeは，最善な労である
— ~WebTransport~stackは、
~reset~codeを~sessionに結付ける能力があるとは限らないので。
唯一の例外は、
所与の`~HTTP3接続$上に 1 個の~sessionしかなく，
~client↔~server間に中継者は無い状況に限られる。
◎
WebTransport data streams are associated with sessions through a header at the beginning of the stream; resetting a stream may result in that data being discarded. Because of that, WebTransport application error codes are best effort, as the WebTransport stack is not always capable of associating the reset code with a session. The only exception is the situation where there is only one session on a given HTTP/3 connection, and no intermediaries between the client and the server.
</p>

<p>
~WebTransport実装は、
既知な~sessionに結付けられた~stream用の~error~codeを当の~sessionを所有する応用へ回送しなければ`ナラナイ^2119【！SHALL】。
類似に，中継者は、
相手の端点から~resetを受信したときは，
対応する~error~codeで~streamを`~reset$しなければ`ナラナイ^2119【！SHALL】。
~WebTransport実装は、
所与の`~HTTP3接続$越しの~sessionを意図的に 1 個しか許容しない場合には，
その接続~上の唯一の~sessionを所有する応用へ~error~codeを
— ~WebTransport応用~error~codeに変換した上で —
回送しなければ`ナラナイ^2119【！SHALL】。
◎
WebTransport implementations SHALL forward the error code for a stream associated with a known session to the application that owns that session; similarly, the intermediaries SHALL reset the streams with corresponding error code when receiving a reset from the peer. If a WebTransport implementation intentionally allows only one session over a given HTTP/3 connection, it SHALL forward the error codes within WebTransport application error code range to the application that owns the only session on that connection.
</p>

		</section>
		<section id="datagrams">
<h3 title="Datagrams">4.4. ~datagram</h3>

<p>
~datagramは、
`~HTTP~datagram$ `HTTP-DATAGRAM$r を利用して送信できる。
~WebTransport~datagramの~payloadは、
`~HTTP~datagram$を成す `~HTTP~datagram~payload^i ~field内に改変されずに送信される。
それは、
`~quarter~stream~ID^i ~fieldの直後に後続することに注意
— この~fieldは、
当の~QUIC `DATAGRAM$ft ~frameの~payloadを成す始端にあり，
`~WebTransport~session$を確立した`~CONNECT~stream$を指す。
◎
Datagrams can be sent using HTTP Datagrams. The WebTransport datagram payload is sent unmodified in the "HTTP Datagram Payload" field of an HTTP Datagram (Section 2.1 of [HTTP-DATAGRAM]). Note that the payload field directly follows the Quarter Stream ID field, which is at the start of the QUIC DATAGRAM frame payload and refers to the CONNECT stream that established the WebTransport session.
</p>


		</section>
		<section id="buffering-incoming-streams-and-datagrams">
<h3 title="Buffering Incoming Streams and Datagrams">4.5. 流入~stream／~datagramの~buffer法</h3>

<p>
~clientは，
~HTTP3越しの~WebTransportにおいては、
自身の `SETTINGS$ft ~frameに加えて，複数個の［
~WebTransport `CONNECT$m 要請,
~WebTransport~data~stream,
~WebTransport~datagram
］を単独の~flightの中で一括して送信しても`ヨイ^2119。
それらは順序どおりに到着しないこともあるので、
`~WebTransport~server$は，［
~streamや~datagram
］を対応する~sessionを伴わずに受信する状況に置かれることもある。
類似に、
~clientは，~serverが起動した［
~stream／~datagram
］を［
~serverから `CONNECT$m 応答~headerを受信する前
］に受信することもある。
◎
In WebTransport over HTTP/3, the client MAY send its SETTINGS frame, as well as multiple WebTransport CONNECT requests, WebTransport data streams and WebTransport datagrams, all within a single flight. As those can arrive out of order, a WebTransport server could be put into a situation where it receives a stream or a datagram without a corresponding session. Similarly, a client may receive a server-initiated stream or a datagram before receiving the CONNECT response headers from the server.
</p>

<p>
この事例を取扱うため、
~WebTransport端点は，［
~stream／~datagram
］を［
ある確立された~sessionに結付けれるようになる
］まで~bufferする`ベキ^2119である。
資源の枯渇を避けるため、
端点は，~bufferされる［
~stream／~datagram
］の個数を制限しなければ`ナラナイ^2119。
~bufferされた~streamの個数が それを超過したときは、
ある~streamが，
~error~code `WEBTRANSPORT_BUFFERED_STREAM_REJECTED$er を伴う［
`RESET_STREAM$ft ／ `STOP_SENDING$ft
］を送信することにより~closeされなければ`ナラナイ^2119【！SHALL】。
~bufferされた~datagramの個数が それを超過したときは、
ある~datagramが落とされなければ`ナラナイ^2119【！SHALL】。
破棄する［
~stream／~datagram
］としてどれを選ぶかは、
実装に委ねられる。
◎
To handle this case, WebTransport endpoints SHOULD buffer streams and datagrams until those can be associated with an established session. To avoid resource exhaustion, the endpoints MUST limit the number of buffered streams and datagrams. When the number of buffered streams is exceeded, a stream SHALL be closed by sending a RESET_STREAM and/or STOP_SENDING with the WEBTRANSPORT_BUFFERED_STREAM_REJECTED error code. When the number of buffered datagrams is exceeded, a datagram SHALL be dropped. It is up to an implementation to choose what stream or datagram to discard.
</p>

		</section>
		<section id="interaction-with-http3-goaway-frame">
<h3 title="Interaction with HTTP/3 GOAWAY frame">4.6. ~HTTP3 `GOAWAY$ft ~frameとの相互作用</h3>

<p>
~HTTP3は、
上品な~shutdownの仕組みを定義する
（ `HTTP3$r `§ 接続の~shutdown＠~HTTPv3#connection-shutdown$）
— それは、［
自身が［
もはや新たな［
流入~要請／~push
］を受容しないことを指示する `GOAWAY$ft ~frameを送信する
］ことを双方の端点に許容する。
◎
HTTP/3 defines a graceful shutdown mechanism (Section 5.2 of [HTTP3]) that allows a peer to send a GOAWAY frame indicating that it will no longer accept any new incoming requests or pushes.
</p>

<p>
`GOAWAY$ft ~frameを受信した~clientは、
新たな`~WebTransport~session$用の `CONNECT$m 要請を起動し得ない
— 当の【何の？】~stream識別子が指示された`~stream~ID$以上の場合には。
◎
A client receiving GOAWAY cannot initiate CONNECT requests for new WebTransport sessions if the stream identifier is equal to or greater than the indicated stream ID.
</p>

<p>
~HTTP3 `GOAWAY$ft ~frameは、
すべての`~WebTransport~session$用に，
~shutdownを起動するための応用への通達でもある。
どちらの端点も、
`DRAIN_WEBTRANSPORT_SESSION$cps
（ `0x78ae^hex ）`~capsule$を送信して，
単独の`~WebTransport~session$を~shut-downできる。
◎
An HTTP/3 GOAWAY frame is also a signal to applications to initiate shutdown for all WebTransport sessions. To shut down a single WebTransport session, either endpoint can send a DRAIN_WEBTRANSPORT_SESSION (0x78ae) capsule.
</p>

<pre class="frame-diagram">
DRAIN_WEBTRANSPORT_SESSION ~capsule {
  種別 (i) = DRAIN_WEBTRANSPORT_SESSION,
  長さ (i) = 0
}
◎
DRAIN_WEBTRANSPORT_SESSION Capsule {
  Type (i) = DRAIN_WEBTRANSPORT_SESSION,
  Length (i) = 0
}
</pre>

<p>
端点は、［
`DRAIN_WEBTRANSPORT_SESSION$cps `~capsule$／
~HTTP3 `GOAWAY$ft ~frame
］を［
送信した／受信した
］（順不同）後でも，［
当の~sessionの利用を継続しても`ヨイ^2119／
当の~sessionで新たな~streamを~openしても`ヨイ^2119
］（順不同）。
通達は、
~WebTransportを利用している応用~用に意図される
— 応用には、
アリな限り，当の~sessionを上品に終了するよう試みることが期待される。
◎
After sending or receiving either a DRAIN_WEBTRANSPORT_SESSION capsule or a HTTP/3 GOAWAY frame, an endpoint MAY continue using the session and MAY open new streams. The signal is intended for the application using WebTransport, which is expected to attempt to gracefully terminate the session as soon as possible.
</p>

		</section>
	</section>
	<section id="session-termination">
<h2 title="Session Termination">5. ~sessionの終了n</h2>

<p>
~HTTP3越しの`~WebTransport~session$は、
次に挙げるいずれかが生じたとき，終了されたものと見なされる：
◎
A WebTransport session over HTTP/3 is considered terminated when either of the following conditions is met:
</p>
<ul>
	<li>
`~CONNECT~stream$が，どちらかの側で［
~cleanに／中途で
］~closeされた。
◎
the CONNECT stream is closed, either cleanly or abruptly, on either side; or
</li>
	<li>
`CLOSE_WEBTRANSPORT_SESSION$cps `~capsule$が［
送信された／受信された
］。
◎
a CLOSE_WEBTRANSPORT_SESSION capsule is either sent or received.
</li>
</ul>

<p>
端点は、
ある~sessionが終了したことを悟った際には，
次に従わなければ`ナラナイ^2119：
◎
Upon learning that the session has been terminated,＼
</p>
<ul>
	<li>
<p>
当の~sessionに結付けられたすべての~streamに対し：
</p>
		<ul>
			<li>
その送信-側を`~reset$する
— ~error~codeには `WEBTRANSPORT_SESSION_GONE$er を利用する。
</li>
			<li>
その受信-側の読取りを中止する。
</li>
		</ul>
<p>
（ `RFC9000$r `§ ~streamに対する演算＠~RFCx/rfc9000#stream-operations$
を見よ。）
</p>
◎
the endpoint MUST reset the send side and abort reading on the receive side of all of the streams associated with the session (see Section 2.4 of [RFC9000]) using the WEBTRANSPORT_SESSION_GONE error code;＼
</li>
	<li>
<p>
当の~sessionに対し：
</p>
		<ul>
			<li>
新たな~datagramを送信しない。
</li>
			<li>
新たな~streamを~openしない。
</li>
		</ul>
◎
it MUST NOT send any new datagrams or open any new streams.
</li>
</ul>

<p>
応用は、
~sessionを終了する際に詳細な~error~messageを伴わせるためとして，
種別 `CLOSE_WEBTRANSPORT_SESSION$cps （ `0x2843^hex ）の~HTTP`~capsule$ `HTTP-DATAGRAM$r を送信しても`ヨイ^2119。
この`~capsule$の形式は、
次に従わなければ`ナラナイ^2119【！SHALL】：
◎
To terminate a session with a detailed error message, an application MAY send an HTTP capsule [HTTP-DATAGRAM] of type CLOSE_WEBTRANSPORT_SESSION (0x2843). The format of the capsule SHALL be as follows:
</p>

<pre class="frame-diagram">
CLOSE_WEBTRANSPORT_SESSION ~capsule {
  種別 (i) = CLOSE_WEBTRANSPORT_SESSION,
  長さ (i),
  応用~error~code (32),
  応用~error~code~message (..8192),
}
◎
CLOSE_WEBTRANSPORT_SESSION Capsule {
  Type (i) = CLOSE_WEBTRANSPORT_SESSION,
  Length (i),
  Application Error Code (32),
  Application Error Message (..8192),
}
</pre>

<p>
`CLOSE_WEBTRANSPORT_SESSION$cps は、
次に挙げる~fieldを有する：
◎
CLOSE_WEBTRANSPORT_SESSION has the following fields:
</p>

<ul>
	<li>
`応用~error~code^i
⇒
32 ~bit~error~code
— 当の接続を~closeしている応用により供される。
◎
Application Error Code:
• A 32-bit error code provided by the application closing the connection.
</li>
	<li>
`応用~error~code~message^i
⇒
~UTF-8に符号化された~error~message文字列
— 当の接続を~closeしている応用により供される。
この~messageは、
当の`~capsule$を成す残りを占める
— その長さは、
1024 ~byteを超過しては`ナラナイ^2119。
◎
Application Error Message:
• A UTF-8 encoded error message string provided by the application closing the connection. The message takes up the remainder of the capsule, and its length MUST NOT exceed 1024 bytes.
</li>
</ul>

<p>
端点は、
`CLOSE_WEBTRANSPORT_SESSION$cps `~capsule$を送信したときは，
即時に `FIN^i を送信しなければ`ナラナイ^2119。
端点は、［
もはや`~CONNECT~stream$から読取らないことを指示する `STOP_SENDING$ft
］を送信しても`ヨイ^2119。
受信者は、
`FIN^i を受信した際には，当の~streamを~closeしなければ`ナラナイ^2119。
`CLOSE_WEBTRANSPORT_SESSION$cps `~capsule$を受信した後に`~CONNECT~stream$上に追加的な~stream~dataを受信した場合、
当の~streamは，~code `H3_MESSAGE_ERROR$er で`~reset$されなければ`ナラナイ^2119。
◎
An endpoint that sends a CLOSE_WEBTRANSPORT_SESSION capsule MUST immediately send a FIN. The endpoint MAY send a STOP_SENDING to indicate it is no longer reading from the CONNECT stream. The recipient MUST close the stream upon receiving a FIN. If any additional stream data is received on the CONNECT stream after receiving a CLOSE_WEBTRANSPORT_SESSION capsule, the stream MUST be reset with code H3_MESSAGE_ERROR.
</p>

<p>
ある`~CONNECT~stream$を~cleanに
— `CLOSE_WEBTRANSPORT_SESSION$cps `~capsule$を伴わずに —
終了することは、
それを［
~error~code 0, 空な~error文字列
］を伴う `CLOSE_WEBTRANSPORT_SESSION$cps `~capsule$で終了することと，
意味論的に等価でならなければ`ナラナイ^2119【！SHALL】。
◎
Cleanly terminating a CONNECT stream without a CLOSE_WEBTRANSPORT_SESSION capsule SHALL be semantically equivalent to terminating it with a CLOSE_WEBTRANSPORT_SESSION capsule that has an error code of 0 and an empty error string.
</p>

<p>
端点は，一部の局面では、
詳細な~close情報を伴う `CLOSE_WEBTRANSPORT_SESSION$cps を送信してから，
下層の~QUIC接続を即時に~closeするよう求めるかもしれない。
端点が両方を同時に行った場合、
相手の端点は `CLOSE_WEBTRANSPORT_SESSION$cps を受信する前に `CONNECTION_CLOSE$ft を受信することにもなり得る
— その場合、
前者に包含された応用~error~dataを決して受信しないことになる。
これを避けるため、
端点は，［
当の`~CONNECT~stream$上のすべての~dataが承認される
］まで待機してから `CONNECTION_CLOSE$ft を送信する`ベキ^2119である
— これは、
応用~close~metadataを送達する最善な労に基づく仕組みとして，
~QUIC `CONNECTION_CLOSE$ft の仕組みのそれに類似な `CLOSE_WEBTRANSPORT_SESSION$cps ~propを与える。
◎
In some scenarios, an endpoint might want to send a CLOSE_WEBTRANSPORT_SESSION with detailed close information and then immediately close the underlying QUIC connection. If the endpoint were to do both of those simultaneously, the peer could potentially receive the CONNECTION_CLOSE before receiving the CLOSE_WEBTRANSPORT_SESSION, thus never receiving the application error data contained in the latter. To avoid this, the endpoint SHOULD wait until all of the data on the CONNECT stream is acknowledged before sending the CONNECTION_CLOSE; this gives CLOSE_WEBTRANSPORT_SESSION properties similar to that of the QUIC CONNECTION_CLOSE mechanism as a best-effort mechanism of delivering application close metadata.
</p>

	</section>
	<section id="negotiating-the-draft-version">
<h2 title="Negotiating the Draft Version">6. 草案~versionの折衝-法</h2>

<p class="note">注記：
この節は、
~RFCとして公表する前に除去されることになる。
◎
[[RFC editor: please remove this section before publication.]]
</p>

<p>
~WebTransport~protocolの伝送路~形式を成す側面は、［
`SETTINGS_WEBTRANSPORT_MAX_SESSIONS$sp ~parameter用に利用される符号点
］を変更することにより折衝される。
そのことから、
~WebTransport端点は，~WebTransport流通を［
送信する／処理する
］前に相手の端点からの `SETTINGS$ft ~frameを待機しなければ`ナラナイ^2119。
双方の端点が複数の~versionを~supportするときは、
両者が~supportする最も近過去な~versionが選定される。
◎
The wire format aspects of the protocol are negotiated by changing the codepoint used for the SETTINGS_WEBTRANSPORT_MAX_SESSIONS parameter. Because of that, any WebTransport endpoint MUST wait for the peer's SETTINGS frame before sending or processing any WebTransport traffic. When multiple versions are supported by both of the peers, the most recent version supported by both is selected.
</p>

	</section>
	<section id="security-considerations">
<h2 title="Security Considerations">7. ~securityの考慮点</h2>

<p>
~HTTP3越しの~WebTransportは、
`OVERVIEW$r により~WebTransport~protocolに対し課される~security要件をすべて満たす。
したがって、
~clientが信用-済みとは限らない事例でも，
~client↔~server通信~用に~secureな~frameworkを供する。
◎
WebTransport over HTTP/3 satisfies all of the security requirements imposed by [OVERVIEW] on WebTransport protocols, thus providing a secure framework for client-server communication in cases when the client is potentially untrusted.
</p>

<p>
~HTTP3越しの~WebTransportには、
~HTTP3`設定$の利用を通した明示的な~opt-inが要求される
— これは、［
`~HTTP3~server$が それを明示的に~supportする
］こと確保することにより，潜在的な~protocol混同~攻撃を避ける。
加えて、
`Origin$h ~headerの利用も要求される
— それは、［
~Webに基づく~clientが信用-済みな生成元から出生してない場合に，~accessを否認する能
］を~serverに供する。
◎
WebTransport over HTTP/3 requires explicit opt-in through the use of an HTTP/3 setting; this avoids potential protocol confusion attacks by ensuring the HTTP/3 server explicitly supports it. It also requires the use of the Origin header, providing the server with the ability to deny access to Web-based clients that do not originate from a trusted origin.
</p>

<p>
~HTTP3越しに行く~HTTP流通と同じく、
~WebTransportは，流通を単独の接続の中で異なる生成元たちに~poolする。
異なる生成元は，異なる信用-~domainを含意するので、
実装は，［
同じ接続~上の異なる生成元に属する~transportどうしを敵対的になり得るものとして扱う
］必要がある。
潜在的な攻撃の一つとして、
資源~枯渇~攻撃がある
— 当の~transportを成すすべてが［
輻輳~制御~文脈, ~flow制御~文脈
］どちらも共有するので、
単独の~clientが それらの資源を積極的に利用し尽くすと，他の~transportを停滞させ得る。
したがって、
~UAは［
同じ接続の中の各~transportは、
制御される下で，資源を成す合理的な共有分を取得する
］ことを確保するための公平性~schemeを実装する`ベキ^2119である
— これは、［
~dataを送信するとき,
新たな~streamを~openするとき
］どちらにも適用される。
◎
Just like HTTP traffic going over HTTP/3, WebTransport pools traffic to different origins within a single connection. Different origins imply different trust domains, meaning that the implementations have to treat each transport as potentially hostile towards others on the same connection. One potential attack is a resource exhaustion attack: since all of the transports share both congestion control and flow control context, a single client aggressively using up those resources can cause other transports to stall. The user agent thus SHOULD implement a fairness scheme that ensures that each transport within connection gets a reasonable share of controlled resources; this applies both to sending data and to opening new streams.
</p>

<p>
~clientは、
いっときに多過ぎる`~WebTransport~session$を~openすることにより，
資源を枯渇するよう試みることもできる。
~clientが信用されない事例では、
~UAは，~clientが~openできる流出~sessionの個数を制限する`ベキ^2119である。
◎
A client could attempt to exhaust resources by opening too many WebTransport sessions at once. In cases when the client is untrusted, the user agent SHOULD limit the number of outgoing sessions the client can open.
</p>


	</section>
	<section id="iana-considerations">
<h2 title="IANA Considerations">8. ~IANA考慮点</h2>

		<section id="upgrade-token-registration">
<h3 title="Upgrade Token Registration">8.1. ~Upgrade~tokenの登録</h3>

<p>
`HTTP$r `§ ~Upgrade~token~registry＠~HTTPinfra#upgrade.token.registry$
により確立された
`~HTTP~Upgrade~token~registry＠~IANA-a/http-upgrade-tokens$cite
には、
以下に挙げる~entryが追加される。
◎
The following entry is added to the "Hypertext Transfer Protocol (HTTP) Upgrade Token Registry" registry established by Section 16.7 of [HTTP].
</p>

<p>
~label "`webtransport^c" は、
~WebTransport用の~protocolとして~HTTP3が利用されたことを識別する：
◎
The "webtransport" label identifies HTTP/3 used as a protocol for WebTransport:
</p>
<ul>
	<li>
値
⇒
`webtransport^c
◎
Value:
• webtransport
</li>
	<li>
記述
⇒
~HTTP3越しの~WebTransport
◎
Description:
• WebTransport over HTTP/3
</li>
	<li>
参照
⇒
この文書,
`I-D.ietf-webtrans-http2$r
◎
Reference:
• This document and [I-D.ietf-webtrans-http2]
</li>



		</ul></section>
		<section id="http3-settings-parameter-registration">
<h3 title="HTTP/3 SETTINGS Parameter Registration">8.2. ~HTTP3設定~parameterの登録</h3>

<p>
`HTTP3$r により確立された
`~HTTP3設定~registry＠~IANA-a/http3-parameters/http3-parameters.xhtml#http3-parameters-settings$cite
には、
以下に挙げる~entryが追加される。
◎
The following entry is added to the "HTTP/3 Settings" registry established by [HTTP3]:
</p>

<p>
`SETTINGS_WEBTRANSPORT_MAX_SESSIONS@sp
~parameterは、［
指定された~HTTP3端点は，~WebTransport能力がある
］ことを指示することに加え，~server用には［
受信する用意がある同時並行な~sessionの個数
］を指示する。
この~parameter用の既定の値は 0 とする
— それは、［
端点は`~WebTransport~session$を受信する用意はない
］ことを意味する。
◎
The SETTINGS_WEBTRANSPORT_MAX_SESSIONS parameter indicates that the specified HTTP/3 endpoint is WebTransport-capable and, for servers, the number of concurrent sessions it is willing to receive. The default value for the SETTINGS_WEBTRANSPORT_MAX_SESSIONS parameter is "0", meaning that the endpoint is not willing to receive any WebTransport sessions.
</p>

<ul>
	<li>
設定~名
⇒
`SETTINGS_WEBTRANSPORT_MAX_SESSIONS$sp
【！WEBTRANSPORT_MAX_SESSIONS】
◎
Setting Name:
• WEBTRANSPORT_MAX_SESSIONS
</li>
	<li>
値
⇒
`0xc671706a^hex
◎
Value:
• 0xc671706a
</li>
	<li>
既定
⇒
0
◎
Default:
• 0
</li>
	<li>
仕様
⇒
この文書
◎
Specification:
• This document
</li>
</ul>


		</section>
		<section id="frame-type-registration">
<h3 title="Frame Type Registration">8.3. ~frame種別の登録</h3>

<p>
`HTTP3$r により確立された
`~HTTP3~frame種別~registry＠~IANA-a/http3-parameters/http3-parameters.xhtml#http3-parameters-frame-types$cite
には、
以下に挙げる~entryが追加される。
◎
The following entry is added to the "HTTP/3 Frame Type" registry established by [HTTP3]:
</p>

<p>
`WEBTRANSPORT_STREAM@ft
~frameは、
~WebTransport~HTTP3拡張との衝突を避ける目的で，予約される：
◎
The WEBTRANSPORT_STREAM frame is reserved for the purpose of avoiding collision with WebTransport HTTP/3 extensions:
</p>
<ul>
	<li>
~code
⇒
`0x41^hex
◎
Code:
• 0x41
</li>
	<li>
~frame種別
⇒
`WEBTRANSPORT_STREAM$ft
◎
Frame Type:
• WEBTRANSPORT_STREAM
</li>
	<li>
仕様
⇒
この文書
◎
Specification:
• This document
</li>
</ul>


		</section>
		<section id="stream-type-registration">
<h3 title="Stream Type Registration">8.4. ~stream種別の登録</h3>

<p>
`HTTP3$r により確立された
`~HTTP3~stream種別~registry＠~IANA-a/http3-parameters/http3-parameters.xhtml#http3-parameters-stream-types$cite
には、
以下に挙げる~entryが追加される。
◎
The following entry is added to the "HTTP/3 Stream Type" registry established by [HTTP3]:
</p>

<p>
種別
`~WebTransport~stream@
は、［
`一方向~stream$が~WebTransportにより利用される
］ことを許容する：
◎
The "WebTransport stream" type allows unidirectional streams to be used by WebTransport:
</p>
<ul>
	<li>
~code
⇒
`0x54^hex
◎
Code:
• 0x54
</li>
	<li>
~stream種別
⇒
~WebTransport~stream
◎
Stream Type:
• WebTransport stream
</li>
	<li>
仕様
⇒
この文書
◎
Specification:
• This document
</li>
	<li>
送信者
⇒
`両方^i
◎
Sender:
• Both
</li>
</ul>


		</section>
		<section id="http3-error-code-registration">
<h3 title="HTTP/3 Error Code Registration">8.5. ~HTTP3~error~code 登録</h3>

<p>
`HTTP3$r により確立された
`~HTTP3~error~code~registry＠~IANA-a/http3-parameters/http3-parameters.xhtml#http3-parameters-error-codes$cite
には、
以下に挙げる~entryが追加される。
◎
The following entry is added to the "HTTP/3 Error Code" registry established by [HTTP3]:
</p>

<ul>
	<li>
名前
⇒
`WEBTRANSPORT_BUFFERED_STREAM_REJECTED@er
◎
Name:
• WEBTRANSPORT_BUFFERED_STREAM_REJECTED
</li>
	<li>
値
⇒
`0x3994bd84^hex
◎
Value:
• 0x3994bd84
</li>
	<li>
記述
⇒
~WebTransport~data~streamは、
それに結付けられた~sessionの欠如に因り，却下された
◎
Description:
• WebTransport data stream rejected due to lack of associated session.
</li>
	<li>
仕様
⇒
この文書
◎
Specification:
• This document.
</li>
</ul>

<ul>
	<li>
名前
⇒
`WEBTRANSPORT_SESSION_GONE@er
◎
Name:
• WEBTRANSPORT_SESSION_GONE
</li>
	<li>
値
⇒
`0x170d7b68^hex
◎
Value:
• 0x170d7b68
</li>
	<li>
記述
⇒
~WebTransport~data~streamは、
それに結付けられた`~WebTransport~session$が~closeされたため，中止された。
◎
Description:
• WebTransport data stream aborted because the associated WebTransport session has been closed.
</li>
	<li>
仕様
⇒
この文書
◎
Specification:
• This document.
</li>
</ul>

<p>
加えて，次に与える範囲の~entryが登録された：
◎
In addition, the following range of entries is registered:
</p>
<ul>
	<li>
名前
⇒
`WEBTRANSPORT_APPLICATION_ERROR@er
◎
Name:
• WEBTRANSPORT_APPLICATION_ERROR
</li>
	<li>
値
⇒
次を満たす整数 %符号点
⇒
［
%符号点 ~GTE `0x52e4a40fa8db^hex
］~AND［
%符号点 ~LTE `0x52e5ac983162^hex
］~AND［
%符号点 ~NIN { `0x1f^hex ~MUL %N ~PLUS `0x21^hex ； %N は負でない整数 }
］
◎
Value:
• 0x52e4a40fa8db to 0x52e5ac983162 inclusive, with the exception of the codepoints of form 0x1f * N + 0x21.
</li>
	<li>
記述
⇒
~WebTransport応用~error~code
◎
Description:
• WebTransport application error codes.
</li>
	<li>
仕様
⇒
この文書
◎
Specification:
• This document.
</li>
</ul>

		</section>
		<section id="capsule-types">
<h3 title="Capsule Types">8.6. ~capsule種別</h3>

<p>
`HTTP-DATAGRAM$r により確立された
`~HTTP~capsule種別~registry^cite
には、
以下に挙げる~entryが追加される。
◎
The following entries are added to the "HTTP Capsule Types" registry established by [HTTP-DATAGRAM]:
</p>

<p>
`CLOSE_WEBTRANSPORT_SESSION@cps
`~capsule$
◎
The CLOSE_WEBTRANSPORT_SESSION capsule.
</p>
<ul>
	<li>
値
⇒
`0x2843^hex
◎
Value:
• 0x2843
</li>
	<li>
~capsule種別
⇒
`CLOSE_WEBTRANSPORT_SESSION$cps
◎
Capsule Type:
• CLOSE_WEBTRANSPORT_SESSION
</li>
	<li>
位置付け
⇒
`恒久的^i
◎
Status:
• permanent
</li>
	<li>
仕様
⇒
この文書
◎
Specification:
• This document
</li>
	<li>
変更~制御者
⇒
~IETF
◎
Change Controller:
• IETF
</li>
	<li>
連絡先
⇒
~WebTransport~WG
<a href="mailto:webtransport@ietf.org">webtransport@ietf.org</a>
◎
Contact:
• WebTransport Working Group webtransport@ietf.org
</li>
	<li>
注記
⇒
なし
◎
Notes:
• None
</li>
</ul>

<p>
`DRAIN_WEBTRANSPORT_SESSION@cps
`~capsule$
◎:
• The DRAIN_WEBTRANSPORT_SESSION capsule.
</p>
<ul>
	<li>
値
⇒
`0x78ae^hex
◎
Value:
• 0x78ae
</li>
	<li>
~capsule種別
⇒
`DRAIN_WEBTRANSPORT_SESSION$cps
◎
Capsule Type:
• DRAIN_WEBTRANSPORT_SESSION
</li>
	<li>
位置付け
⇒
`暫定的^i
（この文書が認可されたなら、
`恒久的^i になる)
◎
Status:
• provisional (when this document is approved this will become permanent)
</li>
	<li>
仕様
⇒
この文書
◎
Specification:
• This document
</li>
	<li>
変更~制御者
⇒
~IETF
◎
Change Controller:
• IETF
</li>
	<li>
連絡先
⇒
~WebTransport~WG
<a href="mailto:webtransport@ietf.org">webtransport@ietf.org</a>
◎
Contact:
• WebTransport Working Group webtransport@ietf.org
</li>
	<li>
注記
⇒
なし
◎
Notes:
• None
</li>
</ul>

		</section>
	</section>
	<section id="changelog">
<h2 title="Appendix A. Changelog">付録 A. 変更~log</h2>

		<section id="changes-between-draft-versions-02-and-07">
<h3 title="A.1. Changes between draft versions 02 and 07">A.1. 草案~version 02 から 07 までの変更点</h3>

<p>
この~protocolを成す草案~version 02 から草案~version 07 までの互換でない変更点は：
◎
The following changes make the draft-02 and draft-07 versions of this protocol incompatible:
</p>
<ul>
	<li>
`SETTINGS_WEBTRANSPORT_MAX_SESSIONS$sp が要求される
（ `86$pull ）
— それは~version折衝~用に利用される。
（ `129$pull ）
◎
draft-07 requires SETTINGS_WEBTRANSPORT_MAX_SESSIONS (#86) and uses it for version negotiation (#129)
</li>
	<li>
`SETTINGS_ENABLE_CONNECT_PROTOCOL^sp を可能化することが明示的に要求される。
（ `93$pull ）
◎
draft-07 explicitly requires SETTINGS_ENABLE_CONNECT_PROTOCOL to be enabled (#93)
</li>
	<li>
`SETTINGS_H3_DATAGRAM$sp を可能化することが明示的に要求される。
（ `106$pull ）
◎
draft-07 explicitly requires SETTINGS_H3_DATAGRAM to be enabled (#106)
</li>
	<li>
`WEBTRANSPORT_STREAM$ft は~streamの始めに限り許容される。
◎
draft-07 only allows WEBTRANSPORT_STREAM at the beginning of the stream
</li>
</ul>

<p>
草案~version 07 には、
次に挙げる変更点も在り，
草案~version 02 実装にも安全に実装できる：
◎
The following changes that are present in draft-07 can be also implemented by a draft-02 implementation safely:
</p>
<ul>
	<li>
~stream~reset~error~code空間を 8 ~bitから 32 ~bitへ拡げた
（ `115$pull ）
◎
Expanding stream reset error code space from 8 to 32 bits (#115)
</li>
	<li>
`WEBTRANSPORT_SESSION_GONE$er ~error~code
（ `75$pull ）
◎
WEBTRANSPORT_SESSION_GONE error code (#75)
</li>
	<li>
~HTTP `GOAWAY$ft 用の取扱い
（ `76$pull ）
◎
Handling for HTTP GOAWAY (#76)
</li>
	<li>
`DRAIN_WEBTRANSPORT_SESSION$cps `~capsule$
（ `79$pull ）
◎
DRAIN_WEBTRANSPORT_SESSION capsule (#79)
</li>
	<li>
~redirectに自動的に追従することを許容しないようにした
（ `113$pull ）
◎
Disallowing following redirects automatically (#113)
</li>
</ul>

		</section>
	</section>
</main></div>
