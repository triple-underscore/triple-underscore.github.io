<!DOCTYPE html><html lang="ja"><head><meta charset="utf-8">
<title>Compositing and Blending Level 1 （日本語訳）</title>

<link rel="stylesheet" href="common.css" type="text/css" />
<link rel="stylesheet" href="common-css.css" type="text/css" />

<style type="text/css">

figure {
	background: white;
}

pre.formula {
	margin-left: 2em;
	padding: 0.5em;
	background: #EFE;
	font-family: sans-serif0, sans-serif;
	line-height: 1.6em;
}
.params {
	margin-left: 2em;
}

.comp-table {
	border-collapse:separate;
	margin-left: 2em;
}

.comp-box {
	position:relative;
	width: 120px;
	height: 120px;
	border: solid black 1px;
}

.comp-box > div {
	position: absolute;
	top: 0;
	left: 0;
}

.comp-source {
	width: 60%;
	height: 100%;
	background: rgb(104, 199, 232);
}

.comp-dest {
	width: 100%;
	height: 40%;
	background: rgb(255, 220, 0);
}

.comp-both {
	width: 60%;
	height: 40%;
}

.comp-box, .comp-negate {
	background: white;
	background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAGklEQVQYlWP4jwamTZuGghnooABdAB3QQQEAIlnXoZ5sWUwAAAAASUVORK5CYII=);
}

.compositing-sample {
	background: url(data:image/svg+xml;base64,PHN2Zw0KCXZlcnNpb249IjEuMSINCgl4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciDQoJd2lkdGg9IjE4cHgiIGhlaWdodD0iMThweCINCgl2aWV3Qm94PSItOSAtOSAxOCAxOCINCj4NCjxwYXRoIGZpbGw9IiNFMEUwRTAiIGQ9Ik0wLDAgaDkgdjkgaC05IHogaC05IHYtOSBoOSB6IiAvPg0KPC9zdmc+DQo=);
}


.mix-demo {
	display: inline-block;
	margin-left: 1em;
	width: 200px;
	height:200px;
	isolation: isolate;
	background: url(compositing/backdrop.png);
	background-repeat: repeat;
}
.mix-demo > img {
	width: 200px;
	height:200px;
}

#_dgm-blend_background_opacity {
	position: relative;
	height: 16em;
	min-width: 24em;
}
#_dgm-blend_background_opacity > div {
	position: absolute;
	width: 12em;
	height: 4em;
	left: 0.5em;
}
#_dgm-blend_background_opacity > div > div {
	position: absolute;
	width: 8em;
	height: 100%;
	left: 2em;
}
#_dgm-blend_background_opacity > div > span {
	position: absolute;
	left: 14em;
	line-height: 4em;
	white-space: nowrap;
}

.square-img0 {
	width:30vw;
	height:30vw;
	min-width: 200px;
	min-height: 200px;
}

</style>

<script src="common0.js" ></script>
<script src="common1.js" async></script>

<script>

//		original_url: 'http://dev.w3.org/fxtf/compositing-1/',

Util.ready = function(){
	var source_data = {
		collectParts: Util.collectParts,
		generate: expand
	};

	Util.switchWordsInit(source_data);

//	Util.del_j(); //checked 140220 spec
}

function expand(){
	var link_map = this.link_map;
	var class_map = {
		p: 'property', // prop
		css: 'css',
		v: 'value',
		t: 'type',
		P: 'production',
		e: 'element',
		a: 'attr',
	};
	var tag_map = {
		p: 'code',
		v: 'code',
		f: 'code',
		t: 'var',
		css: 'code',
		e: 'code',
		a: 'code',
		c: 'code',
		V: 'var',
	}
	return this.html.replace(
		/%[α\w]+|`(.*?)([$@^])(\w*)/g,
		create_html
	);


	function create_html(match, key, indicator, klass){
if(!indicator) {//%
	if(match.length === 3) {
		return '<var>' + match[1] + '</var><sub>' + match[2] + '</sub>'
	}
	return '<var>' + match.slice(1) + '</var>'
}

var text = key;
var href = '';
var classname = class_map[klass];
var tag = tag_map[klass];

switch(klass){
case 'r': // ref
	text = '[' + key + ']';
	href = '#biblio-' + key.toLowerCase();
	break;
case 'p': // property
	break;
case 'f': // 
	text = key +'()';
	break;
case 't': // typedef
	text = '&lt;' + key + '&gt;';
	break;
case 'P': // token
	break;
case 'm': // IDL member
	break;
case 'V': // variables
	break;
case 'dgm':
	return '<a id="_dgm-' + key + '">＊</a>'
default:
}


if(tag) {
	text = '<' + tag + (
		classname ? ' class="' + classname + '"' : ''
	) + '>' + text + '</' + tag + '>';
}


if(indicator !== '^'){
	href = link_map[klass ? (klass + '.' + key) : key] || href;
	if(!href){
		console.log(match); // check error
		return match;
	}

	switch(indicator){
	case '$':
		text = '<a href="' + href + '">' + text + '</a>';
		break;
	case '@':
		text = '<dfn id="' + href.slice(1) + '">' + text + '</dfn>';
		break;
	default:
		console.log(match);
		return match;
	}
}

return text;

	}
}
</script>

<script>
Util.DEFERRED.push(mixDemoInit);

function mixDemoInit(){

	E('_reset_mix_demo').addEventListener('click', function(event){
		reset();
	}, false);
	enable_reset(false);

	E('_dgm-mix-demo').addEventListener('dragover', function(event){
		event.preventDefault();// ページ遷移防止
	}, false);
	E('_dgm-mix-demo').addEventListener('drop', function(event){
		event.preventDefault();
		var file = event.dataTransfer.files[0];
		if(!file) return;
		if(file.type.toLowerCase().slice(0, 6) !== 'image/') return;
		var url = window.URL.createObjectURL(file);
		switch(event.target.tagName){
		case 'IMG': // source image
			loadSource(url, event.target);
			break;
		case 'SPAN': // backdrop
			loadBackdrop(url);
			break;
		}
	}, false);
	
	E('_dgm-mix-demo').lastElementChild.style.visibility = null;

	function enable_reset(t){
		var e = E('_reset_mix_demo');
		e.disabled = t ? false : true;
	}

	function loadSource(url, img){
		repeat('.mix-demo > img', function(e){
			e.src = url;
		});
		img.src = url;
		enable_reset(true);
	}

	function loadBackdrop(url){
		repeat('.mix-demo', function(e){
			e.style.background = 'url(' + url + ')';
		});
		enable_reset(true);
	}
	
	function reset(){
		repeat('.mix-demo', function(e){
			e.style.background = '';
			var img = e.firstElementChild;
			if(!img) img = e.previousElementSibling;
			if(img){
				img.src = 'compositing/composite-source.png';
			}
		});
		enable_reset(false);
	}
}
</script>



<script type="text/plain" id="_source_data">


●●options

spec_date:2015-01-13
trans_update:2016-08-26
page_state_key:CSS
original_url:https://www.w3.org/TR/compositing-1/
spec_status:CR
ref_id_prefix:biblio-
ref_id_lowercase:true
site_nav:paint,css
conformance:css
copyright:2015,use
trans_1st_pub:2014-04-05


●●original_id_map


●●link_map


t.blend-mode:#ltblendmodegt
t.isolation-mode:#isolated-propid
t.composite-mode:#compositemode

	t.blend-mode:#ltblendmodegt
	t.composite-mode:#compositemode
	t.isolation-mode:#isolated-propid

a.globalCompositeOperation:http://www.w3.org/TR/2dcontext/#dom-context-2d-globalcompositeoperation
	http://www.w3.org/TR/2dcontext2/#dom-context-2d-globalcompositeoperation
	http://www.w3.org/TR/2dcontext/#dom-context-2d-globalcompositeoperation


p.opacity:http://www.w3.org/TR/css3-color/#opacity
p.mask:SVG11/masking.html#MaskProperty
p.background-blend-mode:#propdef-background-blend-mode
p.mix-blend-mode:#propdef-mix-blend-mode
p.isolation:#propdef-isolation
p.background:~CSSBG#propdef-background
p.background-image:~CSSBG#propdef-background-image

	v.isolate:#_isolate
	●§
v.clear:#porterduffcompositingoperators_clear
v.copy:#porterduffcompositingoperators_src
v.destination:#porterduffcompositingoperators_dst
v.source-over:#porterduffcompositingoperators_srcover
v.destination-over:#porterduffcompositingoperators_dstover
v.source-in:#porterduffcompositingoperators_srcin
v.source-atop:#porterduffcompositingoperators_srcatop
v.destination-atop:#porterduffcompositingoperators_dstatop
v.destination-in:#porterduffcompositingoperators_dstin
v.source-out:#porterduffcompositingoperators_srcout
v.destination-out:#porterduffcompositingoperators_dstout
v.xor:#porterduffcompositingoperators_xor
v.lighter:#porterduffcompositingoperators_plus

	●§
v.normal:#valdef-blend-mode-normal
v.multiply:#valdef-blend-mode-multiply
v.screen:#valdef-blend-mode-screen
v.overlay:#valdef-blend-mode-overlay
v.darken:#valdef-blend-mode-darken
v.lighten:#valdef-blend-mode-lighten
v.color-dodge:#valdef-blend-mode-color-dodge
v.color-burn:#valdef-blend-mode-color-burn
v.hard-light:#valdef-blend-mode-hard-light
v.soft-light:#valdef-blend-mode-soft-light
v.difference:#valdef-blend-mode-difference
v.exclusion:#valdef-blend-mode-exclusion

v.hue:#valdef-blend-mode-hue
v.saturation:#valdef-blend-mode-saturation
v.color:#valdef-blend-mode-color
v.luminosity:#valdef-blend-mode-luminosity

	normal:#blendingnormal
	multiply:#blendingmultiply
	screen:#blendingscreen
	overlay:#blendingoverlay
	darken:#blendingdarken
	lighten:#blendinglighten
	color-dodge:#blendingcolordodge
	color-burn:#blendingcolorburn
	hard-light:#blendinghardlight
	soft-light:#blendingsoftlight
	difference:#blendingdifference
	exclusion:#blendingexclusion
	
	hue:#blendinghue
	saturation:#blendingsaturation
	color:#blendingcolor
	luminosity:#blendingluminosity

e.img:~HEimages#the-img-element
e.body:~HEsections#the-body-element




後景:#backdrop
~group後景:#groupbackdrop
初期後景:#initialbackdrop
	単純~alpha合成:http://www.w3.org/TR/css3-color/#alpha

	●§
混色:#blending
混色における~group隔離の効果:#isolationblending
~group合成の結合法則:#groupinvariance

隔離groupと各種~Porter-Duff~mode:#groupcompositing
~Porter-Duff合成:#advancedcompositing
単純~alpha合成:#simplealphacompositing

混色:#blending
変更点の節:#changes

隔離group:#isolatedgroups

	normal:#normal → <p id="normal">
HTML に特有の挙動:#csscompositingrules_CSS
SVG に特有の挙動:#csscompositingrules_SVG
	isolation:#img_isolation


	●CSS2
視覚整形~model:~CSS2VISUREN.html
包含塊:~CSS2VISUREN#containing-block
	v.inherit:~CASCADE#value-def-inherit
積層文脈:~CSS2VISUREN#x43
	https://drafts.csswg.org/css2/visuren.html#x44
	http://www.w3.org/TR/CSS2/zindex.html
	~CSS2VISUREN#z-index

	●CSS Backgrounds
	http://www.w3.org/TR/css3-background
	https://drafts.csswg.org/css-backgrounds-3
背景と~border:~CSSBG#placement
	http://www.w3.org/TR/css3-background/#the-background-image

	●SVG
	http://www.w3.org/TR/2011/REC-SVG11-20110816
	http://www.w3.org/TR/SVG/
	http://www.w3.org/TR/SVG11/
SVG 合成:SVG11/render.html#Introduction
	単純~alpha合成:SVG11/masking.html#SimpleAlphaBlending
~container要素:SVG11/intro.html#TermContainerElement
~graphics要素:SVG11/intro.html#TermGraphicsElement
~graphicsを参照する要素:SVG11/intro.html#TermGraphicsReferencingElement
	mask:SVG11/masking.html#Masking

	＊:http://www.w3.org/TR/2dcontext


●●words_table1


●●words_table

	●色／合成
source:
dest:
mode:::モード
filter:::フィルタ
masking:::マスキング
clipping:::クリッピング
obj:object::オブジェクト
monochrome:::モノクロ
color:::カラー
gradient:::グラデーション
scene:::シーン
spotlight:::スポットライト
channel:::チャンネル
buffer:::バッファ
alpha:::アルファ
group:::グループ
	~group分け:grouping:~

隔離group:isolated group:隔離 group:隔離グループ

後景:backdrop:~
後景色:backdrop color:~
後景上:backdrop 上:~
初期後景:initial backdrop:~
背後:behind:~
背景:background:~
alpha:::アルファ
隔離-:isolate:~
隔離:isolation:~
	隔離グループ:isolated group:~

層:layer:~
下層:underlying:~
重合する:overlap する:重なり合う
重合:overlapping:重ね合せ
重合しな:overlap しな:重なり合わな
	non-overlapping
	奥側／下端:bottom:~
	前面:top:~
単純:simple:~

矩形:rectangle:~

色:color:~
色相:hue:~
陰影:shadow:~
不透明:opaque:~
不透明度:opacity:~
contrast:::コントラスト
暗度:darkness:~
彩度:saturation:~
明度:lightness:~

黒色:black:~
単色:solid color:~
灰色:gray:~
白色:white:~
青色:blue:~
緑色:green:~
黄緑色:lime:~
赤色:red:~
空間:space:~
	色付け:coloring:~
	色彩強調:tinting:~
補色:complement:~

光度:luminosity:~
光輝:highlight:~
透明:transparent:~
透明度:transparency:~
拡散:diffused:~

明るい:light な:~
明るく:lighten:~
明るさ:as light:~
暗い:dark な:~
暗く:darken:~
暗さ:as dark:~
	より~dark:darker
輝かせ:brighten す:~

円:circle:~
幾何的:geometric:~
	幾何的に:geometry:~
生産-:produce:~
手法:method:~
	初期の:initial:~
	塗り:painting:~
	塗りつぶされ:filled:~
数学的:mathematical:~
再構成:reconstruct:~

	●演算
Porter-Duff:
演算子:operator:~
演算-:operate:~
演算:operation:~
	operating:~

合成-:composite::~
合成:compositing::~
	合成 公式／演算子演算
合成結果:resultant composite:composite 結果:~
混色-:blend:~
	混色-~mode
混色:blending:~
	混色 公式／関数
公式:formula:~
一般:general:~
	形:form:~
比率:fraction:~
比率項:fractional term:~
混合-:mix:~
混合:mixing:~
	混合~関数
	混合公式→混色公式
含有率:inclusion:~
	screening:~
	screen:~
	overlay:~
	source:~
	dest:~
	destination:~
反転-:invert:~
反転:inverse:~

交差-:intersect:~
交差域:area of intersection:~
画素:pixel:~
画素色:pixel color:~
部分画素:sub-pixel:~

減算:subtract:~
減量:reduce:~
乗算-:multiply:~
乗算済みの:premultiplied:~
乗算済み:premultiplied:~
	〜でない:non-premultiplied:~
等式:equation:~
被覆:coverage:~
被覆率:coverage:~
覆う:cover する:~
覆わな:cover しな:~

補助:auxiliary:~
関数:function:~
領域:area:~
区分:region:~
図形:shape:~
寄与-:contribute:~
寄与分:contribution:~
	寄与して:contributing:~
成分:component:~
	色~成分
成分別:separable:~
成分別の:separable な:~
	成分別でない:nonseparable:~

	結合法則:invariance:~
		invariant:~
	結合順序
	knockout:~
	重み:weight:~
	重みで:weighting:~
面積:area:~
	点線:dotted line:~
	照らし:shining:~
加重平均:weighted average:~
投影:project:~
実用的:practical:~
調整:modulate:~
最大:maximum:~
最小:minimum:~
top-level:top level::トップレベル
部分的:partial:~
代数:algebra:~
値:value:~
設定-:set:~
再設定-:reset:~
出力:output:~
割合:percentage:~
切詰めら:clamp さ:切り詰めら
加算-:add:~
最終的な:final:~
全-:full に:~
全部的:full:~
	全体:full
	中間処理:intermediate
	中間段階:gradations


	●CSS／SVG
stylesheet:style sheet::スタイルシート
prop:property::プロパティ
略式:shorthand:~
keyword:::キーワード
style:::スタイル
page:::ページ
screen:::スクリーン
container:::コンテナ
graphics:::グラフィックス
canvas:::キャンバス

視覚整形:visual formatting:~
発話:speech::~:スピーチ
包含塊:containing block:包含 block:包含ブロック
animation:::アニメーション
位置:position:~
size:::サイズ
使用値:used value:~
初期値:initial value:~
算出値:computed value:~
指定値:specified value:~
継承-:inherit:~
媒体:media:~
適用対象:applies to:~
内容:content:~
描画-:render:~
描画:rendering:~
文脈:context:~
離散的:discrete:~
確立:establish:~
積層文脈:stacking context:~
構文:syntax:~
百分率:percentage:~

算出-:compute:~
要素:element:~
規則:rule:~
	値型:type:~
comma:::カンマ
区切りの:-separated:~
属性:attribute:~

視覚的:visual:~
文書:document:~
文書片:document fragment:~
変形:transform:~
	座標系変換:transformation:~


画像:image:~
	先祖:ancestor:~

	●仕様
version:::バージョン
browser:::ブラウザ
module:::モジュール
model:::モデル
markup:::マークアップ
risk:::リスク
level:::レベル
approach:::アプローチ
algo:algorithm::アルゴリズム
test:::テスト
一式:suite::~:スイート
報告:report:~::レポート
実装-:implement:~
実装:implementation:~
標準:standard:~
特色機能:feature:~
課題:issue:~
仕様:spec:~
	開発:develop:~
相互作用:interaction:~
相互作用-:interact:やりとり
security:::セキュリティ
情報:information:~
攻撃者:attacker:~
保護-:protect:~
計時攻撃:timing attack:~
	仕掛ける:mount:~
時間:time:~
可読性:readability:~
実施:practice:~
制御:control:~
同義語:synonymous:~
変更点:changes:~
定義-:define:~
定義:definition:~
影響-:affect:~
意図:intent:~
指定-:specify:~
	指定-法:specifying
決定-:determine:~
知識:knowledge:~
複雑:complex:~
要約:abstract:~
記述:description:~
適用-:apply:~
受容-:accept:~
効果:effect:~
事例:case:~
挙動:behavior:ふるまい
含意-:imply:~
	対応
性質:property:~
意味-:mean:~
意味:meaning:~
有用:useful:~
概して:typical に:~
確保-:ensure:~
築かれ:build され:~
見なさ:consider さ:~
述べた:describe した:~
述べる:describe する:~
追加の:additional:~
通例:usual:~
通常の:normal な:~
遂行-:perform:~
重要:important:~

用語:term:~
	項:term:~
特有の:specific な:~
草案:draft:~
	昇格基準
最終草案:Last Call Working draft:~
編集者草案:Editor’s Draft:~

	規範的でない:non-normative
規範的:normative:~
依存-:depend:~
	依存:dependent
	依存しない:independent
高度な:advanced:~
強化:enhance:~
拡張-:extend:~
	~~拡張-:expand:~

明確化:clarify:~
明示的:explicit:~
概念的:conceptual:~
基本的:basic:~
手続き:steps:~
組入れら:incorporate さ:組み入れら
考慮する:consider:考慮に入れる
段落:paragraph:~
相違:difference:~
効率的:efficient:~
開発-:develop:~
勧告候補:Candidate Recommendation:~

	~~提供-:offer
	~MUST:shall
	〜に則って:according
	〜に基づく:based
	〜に注意。:note
	〜に関わらず:regardless
	〜の代わりに:instead
	なければならない:must
	べきである:should
	大まかな:rough
	必要なだけ:enough
	捉える:seen
	用いて／利用して:using
	画期的な:landmark
	簡単にする:simplicity
	表され:express
	要する:entail
	調べら:examine
	調査-:study
	例:example
	例えば
	不可
	不要な
	仕事を-
	仕掛ける
	仕方
	公開

	●未分類
	source:::ソース
access:::アクセス
code:::コード
comment:::コメント
file:::ファイル
graphic:::グラフィック
	graphic的:graphical:~
item:::アイテム
level:::レベル
link:::リンク
list:::リスト
markup:::マークアップ
tag:::タグ
text:::テキスト
zero:::ゼロ
zero:::ゼロ
	graphic的:graphical:~
	graphic演算:graphical operations:~
	詳細／詳細に:detail:~


作成-:create:~
	作成:creation:~
保全-:preserve:~
分割-:divide:~
除去-:remove:~
包含-:contain:~
動作-:act:~
参照-:reference:~
反映-:reflect:~
合致-:match:~

名前:name:~
変化-:change:~
変換-:convert:~
変更-:change:~
改変-:modify:~
外側:outside:~

形成-:form:~
既定:default:~
格納-:store:~
空:empty:~

絵図:artwork:~
置換-:replace:~
表現-:represent:~
表現:representation:~
表示-:display:~
解決-:resolve:~
計算-:calculate:~
計算:calculation:~
	calculating:~
選択:select:~
	selection:~
順序:order:~
逆算-:reverse:~
構築-:construct:~
超過-:exceed:~

併合-:merge:~
内側:inside:~
同時:simultaneous:~
推測-:infer:~

段階:step:~
純粋:pure:~
組合せ:combination:~
組合わさ:combine さ:組み合わさ
組合わす:combine する:組み合わせる
追加-:add:~
透過-:show through:~
埋込まれ:embed され:埋め込まれ
選択肢:option:~

	combining
	instance:
	refer
	~alongside
	~~in~place~with:
	~~現れ:realized
	〜からなる:consists
	〜に向けて:toward
	〜分:amount
	きつく:harsh
	しかしながら:however
	せずに，:as opposed to
	なうように:such a way
	より低い:lower
	より小さく:smaller
	より長い:	~longer
	スライド写真:photographic slides
	不変なまま:unchanged
	与え:give
	与えられ:given
	中央:middle
	以前の:previous
	作る
	保ち続ける:retain
	個々:individual
	個々の／地点ごとに:particular
	個数:number
	切り下げ:rounded down
	利用-:use
	全体／のみ:complete
	別々に:separately
	加えて，:additionally
	可能な:possible
	右下隅:bottom right corner
	合計の:total
	合計／和:sum
	同様の:similar
	含まれ／含む／含んで:include／including
	図:figure
	地点:point
	地面と~~空:land and sky
	対応して:corresponding
	少なくとも:at least
	属する:belongs
	形:form
	従う:follow
	得られ:extract
	戻す:back
	指す:points to
	挙げ:list
	現れない:No 〜 enable
	生じ:occur
	異なる:different
	示す:show
	紙飛行機:airplane
	結果:result
	結果に現れる:present
	結果の:resultant
	繰り返し:repeating
	繰り返して:repeat して
	閉区間:inclusive
	強制:force
	成分ごとに個別に扱わずに:separable ones that look at each component individually
	範囲:~
	substitute置き換えた

	●指示語
自前の:own:~
現在の:current:~
元の:original:~
単独の:single:~
新たな:new:~

	同じ:same
	左:left
	常に:always
	後続の:subsequent
	最も:most
	次の:next
	次の:the following
	残る:remaining
	種々の:various
	章:chapter
	節:section
	非:non
	2 個の:two
	前半部分:first part
	後半部分:second part
	〜の後に:after
	〜の間:during
	〜まで:until
	いくつかの:several
	この:this
	すでに:already
	すべての:all
	自身:themselves
	もの:ones
	一定の:certain
	一定に
	一部分:aspect
	部分:part
	一部／に属する:part of
	上:above
	更に
	一つ
	一式と
	一段階にまとめて
	一連の
	上述
	下
	両方
	両者
	他
	他から
	他の
	他のすべての
	他所では
	代わり
	以上の
	以下
	以下に
	以外の
	仮の
	任意:any
	伴い
	伴う
	伴に
	何も
	何らかの
	個の
	元
	元の
	先
	先に
	部分
	残る
	更に
	最初
	最終的
	所
	左
	左側
	場合
	場所
	前者の
	全く
	全体
	内の
	図右
	図左
	後
	後続-
	後者
	非

	●他
	中
	似る
	位置付け
	値型
	備えて
	入った
	入る
	全幅
	全高
	共通
	冒頭
	処理
	出来上がる
	分け
	利用中の
	加えられ
	加法
	区切り
	単に
	収まる
	取り
	取得-
	各
	各種
	変数

	注記:Note
	直前までの:up to but not including
	網羅-:all possible
	論文:paper
	逆〜:back
	~~過程

	合成元
	合成先
	周辺部
	呼ばれ
	呼ぶ
	和
	図式
	地点
	基に
	何も変わらない:no changes
	多い
	大まか
	奥から
	奥側
	委譲
	定める
	対-
	小さく
	年
	序論:introduction
	式
	弱くなる
	張っている
	形状:geometry
	従って
	従わな
	得られ
	得る
	微小領域
	忠実
	性質
	想定-
	成す
	成立-
	戻す
	手引き
	扱い
	扱わず
	拡縮-:scale:~
	括弧
	持-
	捉え
	描かれ
	描く
	数に
	数値の
	敷き詰め
	方
	方法
	日
	日付
	時点
	更新-
	月
	本質的
	概念
	概要
	様
	様子
	機能
	次元
	次元的
	段階
	沿わな
	渡る
	満た-
	満たな
	無い
	特殊な
	現れ
	用い
	略記-
	的
	示-
	種
	第
	置いた
	置き
	置く
	考え
	者
	自明な
	行う
	行わな
	表-
	表す
	表示
	補完-
	複数
	要-
	見よ
	見られ
	見込み
	解り
	解釈-
	言及-
	記-
	記す
	記号
	訳
	語
	語感
	読む
	赤く
	込まれ
	返-
	返しの
	逆で
	通-
	通り
	選ばれ
	長い
	長く
	長方形
	開示-
	間
	関-
	関連-
	限り
	際に
	難く
	項についての
	順に


●●ref_normative
[2dcontext2]
    Rik Cabanier; et al. HTML Canvas 2D Context, Level 2. 28 August 2014. WD. URL: http://www.w3.org/TR/2dcontext2/
[CSS21]
    Bert Bos; et al. Cascading Style Sheets Level 2 Revision 1 (CSS 2.1) Specification. 7 June 2011. W3C Recommendation. URL: http://www.w3.org/TR/2011/REC-CSS2-20110607
[CSS3BG]
    Bert Bos; Elika J. Etemad; Brad Kemper. CSS Backgrounds and Borders Module Level 3. 24 July 2012. W3C Candidate Recommendation. (Work in progress.) URL: http://www.w3.org/TR/2012/CR-css3-background-20120724/
[CSS3COLOR]
    Tantek Çelik; Chris Lilley; L. David Baron. CSS Color Module Level 3. 7 June 2011. W3C Recommendation. URL: http://www.w3.org/TR/2011/REC-css3-color-20110607
[SVG11]
    Erik Dahlström; et al. Scalable Vector Graphics (SVG) 1.1 (Second Edition). 16 August 2011. REC. URL: http://www.w3.org/TR/SVG11/
[rfc2119]
    S. Bradner. Key words for use in RFCs to Indicate Requirement Levels. March 1997. Best Current Practice. URL: http://www.ietf.org/rfc/rfc2119.txt


●●ref_informative
[PORTERDUFF]
    Thomas Porter; Tom Duff. Compositing digital images. July 1984. ISSN 0097-8930


●●trans_metadata
<p>
~THIS_PAGEは、 W3C により
勧告候補として公開された
<a href="~SPEC_URL">Compositing and Blending Level 1</a>
を日本語に翻訳したものです。
~PUB
</p>


●●spec_metadata

このバージョン
	http://www.w3.org/TR/2015/CR-compositing-1-20150426/

最新 発行バージョン
	http://www.w3.org/TR/compositing-1/

編集者草案
	http://dev.w3.org/fxtf/compositing-1/

以前のバージョン
	http://www.w3.org/TR/2014/WD-compositing-1-20140220/

フィードバック
	<span><a href="mailto:public-fx@w3.org?subject=%5Bcompositing%5D%20feedback">public-fx@w3.org</a> with subject line “<kbd>[compositing] <var>… message topic …</var></kbd>” (<a href="https://lists.w3.org/Archives/Public/public-fx/" rel="discussion">archives</a>)</span>

テスト一式
	http://test.csswg.org/suites/compositing-1_dev/nightly-unstable/

編集
	<a href="mailto:cabanier@adobe.com">Rik Cabanier</a> (Adobe Systems Inc.)
	<a href="mailto:Nikos.Andronikos@cisra.canon.com.au">Nikos Andronikos</a> (Canon Information Systems Research Australia)


</script>

</head>

<body>

<!--%resource pool -->
<div id="_persisted_parts" hidden>

<div id="_dgm-ducky_normal"><img
	src="compositing/ducky_normal.png"
	class="square-img0"
	alt="example of an image of duck with the lime color of the document"
></div>


<div id="_dgm-ducky_multiply"><img
	src="compositing/ducky_multiply.png"
	class="square-img0"
	alt="example of an image of duck blending with the lime color of the document"
></div>


<!-- 
<div id="_dgm-ducky_normal1"
	style="display:inline-block; background:lime; width:30%;"><img
	src="compositing/ducky_normal.png"
	style="width: 100%; mix-blend-mode: multiply;"
></div>
-->


<div id="_dgm-screen_example"><img
	src="data:image/svg+xml;base64,PHN2Zw0KCXZlcnNpb249IjEuMSINCgl4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciDQoJd2lkdGg9IjIwMHB4IiBoZWlnaHQ9IjIwMHB4Ig0KCXZpZXdCb3g9Ii0xMDAgLTEwMCAyMDAgMjAwIg0KPg0KDQo8Y2lyY2xlIGZpbGw9IiNGRjAwMDAiDQoJY3g9Ii0zMCIgY3k9Ii0xNy4zMiIgcj0iNjAiIC8+DQo8Y2lyY2xlIGZpbGw9IiMwMEZGMDAiDQoJY3g9IjMwIiBjeT0iLTE3LjMyIiByPSI2MCIgLz4NCjxjaXJjbGUgZmlsbD0iIzAwMDBGRiINCgljeD0iMCIgY3k9IjM0LjY0IiByPSI2MCIgLz4NCg0KPHBhdGggZmlsbD0iI0ZGRkYwMCINCglkPSJNMCwtNjkuMjgNCkE2MCw2MCAwLDAsMSAwLDM0LjY0DQpBNjAsNjAgMCwwLDEgMCwtNjkuMjgNCnoiIC8+DQo8cGF0aCBmaWxsPSIjMDBGRkZGIg0KCWQ9Ik02MCwzNC42NA0KQTYwLDYwIDAsMCwxIC0zMCwtMTcuMzINCkE2MCw2MCAwLDAsMSA2MCwzNC42NA0KeiIgLz4NCjxwYXRoIGZpbGw9IiNGRjAwRkYiDQoJZD0iTS02MCwzNC42NA0KQTYwLDYwIDAsMCwxIDMwLC0xNy4zMg0KQTYwLDYwIDAsMCwxIC02MCwzNC42NA0KeiIgLz4NCjxwYXRoIGZpbGw9IiNGRkZGRkYiDQoJZD0iTTAsMzQuNjQNCkE2MCw2MCAwLDAsMSAtMzAsLTE3LjMyDQpBNjAsNjAgMCwwLDEgMzAsLTE3LjMyDQpBNjAsNjAgMCwwLDEgMCwzNC42NA0KeiIgLz4NCg0KPC9zdmc+DQo="
	class="square-img0"
	alt="example of 3 circles blending with a screen blend mode"
></div>

<div id="_dgm-ducky_difference"><img
	src="compositing/ducky_difference.png"
	class="square-img0"
	alt="example of an image of duck blending with the lime color of the document"
></div>

<div id="_dgm-overlay_text"><img
	src="compositing/overlay_text.png"
	style="width:50vw; min-width:300px;"
	alt="example of text that has an overlay blend on top of a texture"
></div>

<div id="_dgm-ducky_background_blend"><img
	src="compositing/ducky_background_blend.png"
	class="square-img0"
	alt="example of div that has an image of a duck and a gradient that is blending"
></div>

<div id="_dgm-simple_box"><img
	class="compositing-sample"
	src="compositing/simple_box.svg"
	alt="Simple box showing alpha compositing"
></div>

<div id="_dgm-two_box"><img
	class="compositing-sample"
	src="compositing/two_box.svg"
	alt="simple shape"
></div>

<div id="_dgm-two_box_transparency"><img
	class="compositing-sample"
	src="compositing/two_box_transparency.svg"
	alt="interaction of a solid box with a transparent box on top"
></div>

<div id="_dgm-two_box_transparency_both"><img
	class="compositing-sample"
	src="compositing/two_box_transparency_both.svg"
	alt="interaction of 2 transparent boxes"
></div>

<div id="_dgm-simple_backdrop"><img
	class="compositing-sample"
	src="compositing/simple_backdrop.svg"
	alt="example of a simple backdrop calculation"
></div>

<div id="_dgm-simple_backdrop_alpha"><img
	class="compositing-sample"
	src="compositing/simple_backdrop_alpha.svg"
	alt="example of a backdrop with alpha"
></div>

<!-- 
<div id="_dgm-PD_regions"><img
	alt="overview of the regions affected by porter duff"
	src="compositing/PD_regions.svg"></div>
-->

<div id="_dgm-blend_background_opacity">

<div style="top:0; height:100%; background:transparent"
><div style="background:#FF0000"></div></div>
<div style="top:0.5em; background:#00FF00"
><div style="background:#FFFF00"></div><span>RGB(0, 1, 0)</span></div>
<div style="top:5.5em; background:#7FFF7F"
><div style="background:#FF8000"></div><span>RGB(0, 1, 0, .5)</span></div>
<div style="top:10.5em; background:#E5FFE5"
><div style="background:#FF1A00"></div><span>RGB(0, 1, 0, .1)</span></div>
</div>

<!-- 
<div id="_dgm-blend_background_opacity"><img
	src="compositing/blend_background_opacity.svg"
	alt="example of blending with opacity"
></div>
<div id="_dgm-composite-source"><img
	src="compositing/composite-source.png"
	width="200"
	height="200"
></div>
-->

<div id="_dgm-mix-demo" class="trans-note">
<figure><figcaption>
以下の例に利用される source 画像（左）と後景
<input type="button" value="リセット" id="_reset_mix_demo" />
</figcaption>
<img
	src="compositing/composite-source.png"
	width="200"
	height="200"
>
<span class="mix-demo"></span>
</figure>

<p style="visibility: hidden;">
上の画像 領域に画像をドラッグすると、以下の例のブラウザ表示を変更できる。<small>source （左）にドロップした画像は収まるように拡縮され，後景（右）にドロップした画像は拡縮されずに敷き詰められる。</small>
</p>

</div>


<div id="_dgm-normal"><img
	src="compositing/normal.png"
	alt="example of normal blending"
><span class="mix-demo"><img
	src="compositing/composite-source.png"
	style="mix-blend-mode: normal;"
	alt=""
></span></div>

<div id="_dgm-multiply"><img
	src="compositing/multiply.png"
	alt="example of multiply blending"
><span class="mix-demo"><img
	src="compositing/composite-source.png"
	style="mix-blend-mode: multiply;"
	alt=""
></span></div>

<div id="_dgm-screen"><img
	src="compositing/screen.png"
	alt="example of screen blending"
><span class="mix-demo"><img
	src="compositing/composite-source.png"
	style="mix-blend-mode: screen;"
	alt=""
></span></div>

<div id="_dgm-overlay"><img
	src="compositing/overlay.png"
	alt="example of overlay blending"
><span class="mix-demo"><img
	src="compositing/composite-source.png"
	style="mix-blend-mode: overlay;"
	alt=""
></span></div>

<div id="_dgm-darken"><img
	src="compositing/darken.png"
	alt="example of darken blending"
><span class="mix-demo"><img
	src="compositing/composite-source.png"
	style="mix-blend-mode: darken;"
	alt=""
></span></div>

<div id="_dgm-lighten"><img
	src="compositing/lighten.png"
	alt="example of lighten blending"
><span class="mix-demo"><img
	src="compositing/composite-source.png"
	style="mix-blend-mode: lighten;"
	alt=""
></span></div>

<div id="_dgm-color-dodge"><img
	src="compositing/colordodge.png"
	alt="example of color dodge blending"
><span class="mix-demo"><img
	src="compositing/composite-source.png"
	style="mix-blend-mode: color-dodge;"
	alt=""
></span></div>

<div id="_dgm-color-burn"><img
	src="compositing/colorburn.png"
	alt="example of color burn blending"
><span class="mix-demo"><img
	src="compositing/composite-source.png"
	style="mix-blend-mode: color-burn;"
	alt=""
></span></div>

<div id="_dgm-hard-light"><img
	src="compositing/hardlight.png"
	alt="example of hard light blending"
><span class="mix-demo"><img
	src="compositing/composite-source.png"
	style="mix-blend-mode: hard-light;"
	alt=""
></span></div>

<div id="_dgm-soft-light"><img
	src="compositing/softlight.png"
	alt="example of soft light blending"
><span class="mix-demo"><img
	src="compositing/composite-source.png"
	style="mix-blend-mode: soft-light;"
	alt=""
></span></div>

<div id="_dgm-difference"><img
	src="compositing/difference.png"
	alt="example of difference blending"
><span class="mix-demo"><img
	src="compositing/composite-source.png"
	style="mix-blend-mode: difference;"
	alt=""
></span></div>

<div id="_dgm-exclusion"><img
	src="compositing/exclusion.png"
	alt="example of exclusion blending"
><span class="mix-demo"><img
	src="compositing/composite-source.png"
	style="mix-blend-mode: exclusion;"
	alt=""
></span></div>

<div id="_dgm-hue"><img
	src="compositing/hue.png"
	alt="example of hue blending"
><span class="mix-demo"><img
	src="compositing/composite-source.png"
	style="mix-blend-mode: hue;"
	alt=""
></span></div>

<div id="_dgm-saturation"><img
	src="compositing/saturation.png"
	alt="example of saturation blending"
><span class="mix-demo"><img
	src="compositing/composite-source.png"
	style="mix-blend-mode: saturation;"
	alt=""
></span></div>

<div id="_dgm-color"><img
	src="compositing/color.png"
	alt="example of color blending"
><span class="mix-demo"><img
	src="compositing/composite-source.png"
	style="mix-blend-mode: color;"
	alt=""
></span></div>

<div id="_dgm-luminosity"><img
	src="compositing/luminosity.png"
	alt="example of luminosity blending"
><span class="mix-demo"><img
	src="compositing/composite-source.png"
	style="mix-blend-mode: luminosity;"
	alt=""
></span></div>



<div id="_dgm-isolate_blend_example"><img
	src="compositing/isolate_blend_example.png"
	alt="example of isolated group blending"
></div>

</div>

<header>

	<hgroup>
<h1 id="title">色の合成と混色 — Compositing and Blending Level 1</h1>
	</hgroup>

</header>



<div id="MAIN" style="display:none;">

	<section id="abstract">
<h2 title="Abstract">要約</h2>

<p>
Compositing （合成）は、異なるいくつかの要素の図形を単独の画像の中に組合わす方法を述べる。
合成には種々の~approachをとり得る。
SVG と CSS の以前の~versionでは、
<a href="SVG11/masking.html#SimpleAlphaBlending">単純~alpha合成</a>
`SVG11$r
が利用されていた。
この~modelでは、それぞれの要素は、自前の~bufferに描画された上で，
~Porter-Duff `source-over$v 演算子を用いて `後景$に併合されていた。
この仕様は、次を~~提供することにより，この単純~alpha合成~modelを~~拡張し、新たな合成~modelを定義する：
◎
Compositing describes how shapes of different elements are combined into a single image. There are various possible approaches for compositing. Previous versions of SVG and CSS used Simple Alpha Compositing. In this model, each element is rendered into its own buffer and is then merged with its backdrop using the Porter Duff source-over operator. This specification will define a new compositing model that expands upon the Simple Alpha Compositing model by offering:
</p>

<ul>
	<li>
追加の~Porter-Duff合成~演算子
◎
additional Porter Duff compositing operators
</li>
	<li>
図形が重合する領域で色を混合する方法を制御できるようにする，より高度な混色（ blending ）~mode
◎
advanced blending modes which allow control of how colors mix in the areas where shapes overlap
</li>
	<li>
合成~group
◎
compositing groups
</li>
</ul>

<p>
加えて，この仕様は、混色と~group隔離のための CSS ~prop, および［
`2DCONTEXT2$r
にて定義される
`globalCompositeOperation$a
属性の~prop
］を定義する。
◎
In addition, this specification will define CSS properties for blending and group isolation and the properties of the ‘globalcompositeoperation’ attribute as defined in [2DCONTEXT2].
</p>

	</section>
	<section id="status">
<h2 title="Status of this document">この文書の位置付け</h2>

<p>
<em>これは編集者草案の公開の複製です…</em>
【以下，この節の他の内容は <a href="css-common-ja.html#status">CSS 日本語訳 共通ページ</a>に委譲。】
</p>

<p>
Compositing and Blending Level 1 のための
~test一式と実装~報告
は，勧告候補の段階にて開発-中にあり、
2015 年 8 月 17 日までに出来上がる見込みです。
詳細は
“<a href="#cr-exit-criteria">勧告候補からの昇格基準</a>”
に。
◎
A test suite and implementation report for Compositing and Blending Level 1 will be developed during the Candidate Recommendation phase, which will last a minimum of six months, and at least until 17 August 2014. See the section “CR exit criteria” for more details.
</p>

	</section>

<main id="MAIN0">

	<section id="introduction">
<h2 title="Introduction">1. 序論</h2>

~INFORMATIVE

<p>
この文書の前半部分では、
CSS における合成を制御するための各種~propについて述べる。
後半部分では、~Porter-Duff合成, および混色の，~algoについて述べる。
◎
The first part of this document describes the properties used to control the compositing in CSS. The second part will describe the algorithms of Porter Duff compositing and blending.
</p>

	</section>
	<section id="reading-this-document">
<h2 title="Reading This Document">2. この文書を読むにあたって</h2>

<p>
他から指定されない限り、この文書の各~節は規範的とする。
◎
Each section of this document is normative unless otherwise specified.
</p>

		<section id="module-interactions">
<h3 title="Module interactions">2.1. ~module間の相互作用</h3>

<p>
この仕様は、一連の CSS  ~propを定義する。
それらは，それらが適用される要素の視覚的な描画に影響する。
これらの効果は、要素が
`CSS21$r
による`視覚整形~model$に則って~sizeされ, 位置された後に，適用される。
これらの~propの一部の値による結果，`包含塊$や`積層文脈$が作成される場合がある。
◎
This specification defines a set of CSS properties that affect the visual rendering of elements to which those properties are applied; these effects are applied after elements have been sized and positioned according to the Visual formatting model from [CSS21]. Some values of these properties result in the creation of a containing block, and/or the creation of a stacking context.
</p>

<p>
`background-blend-mode$p
~propは、 `CSS3BG$r
にて<a href="~CSSBG#placement">定義される~prop</a>を基に，築かれている。
◎
The background-blend-mode property also builds upon the properties defined in the CSS Backgrounds and Borders module [CSS3BG].
</p>

<p>
この仕様は、
`SVG11$r にて指定される
<a href="SVG11/masking.html#SimpleAlphaBlending">単純~alpha合成</a>
と
`CSS3COLOR$r による
<a href="http://www.w3.org/TR/css3-color/#alpha">単純~alpha合成</a>
の規則も強化する。
◎
This specification also enhances the rules as specified in Section 14.2 Simple alpha compositing of [SVG11] and simple alpha compositing of [CSS3COLOR].
</p>

<p>
この~moduleは、 `2DCONTEXT2$r にて定義される
`globalCompositeOperation$a も拡張する。
◎
This module also extends the ‘globalcompositeoperation’ as defined in [2DCONTEXT2].
</p>

		</section>
		<section id="values">
<h3 title="Values">2.2. 値</h3>

<p class="trans-note">【
この節の内容は
<a href="css-common-ja.html#values" >CSS 日本語訳 共通~page</a>
に委譲
】</p>

		</section>
	</section>
	<section id="csscompositingandblending">
<h2 title="Specifying Blending in CSS">3. CSS における混色の指定-法</h2>

		<section id="compositingandblendingorder">
<h3 title="Order of graphical operations">3.1. ~graphic演算の順序</h3>

<p>
合成~modelは `SVG 合成$~model `SVG11$r に従わなければならない：
~filterがあれば，それを最初に適用した後、~clipping, ~masking, 混色, 合成を適用する。
◎
The compositing model must follow the SVG compositing model [SVG11]: first any filter effect is applied, then any clipping, masking, blending and compositing.
</p>

		</section>
		<section id="csscompositingrules_CSS">
<h3 title="Behavior specific to HTML">3.2. HTML に特有の挙動</h3>

<p>
CSS における，`積層文脈$を作成するもの
【<a href="https://developer.mozilla.org/en-US/docs/Web/Guide/CSS/Understanding_z_index/The_stacking_context" >参考</a>】
すべては、`隔離group$と見なされなければならない。
HTML 要素~自身は、~groupを作成するべきでない。
◎
Everything in CSS that creates a stacking context must be considered an ‘isolated’ group. HTML elements themselves should not create groups.
</p>

<p>
混色が適用されている要素は、その要素が属する`積層文脈$
`CSS21$r
の，下層の内容すべてと伴に混色されなければならない。
◎
An element that has blending applied, must blend with all the underlying content of the stacking context [CSS21] that that element belongs to.
</p>

		</section>
		<section id="csscompositingrules_SVG">
<h3 title="Behavior specific to SVG">3.3. SVG に特有の挙動</h3>

<p>
既定では、どの要素も，非 `隔離group$を作成しなければならない。
◎
By default, every element must create a non-isolated group.
</p>

<!-- SVG has the following <a href="http://www.w3.org/TR/SVG11/render.html#Introduction">compositing model</a>: first any filter effect is applied, then any clipping, masking,  blending and compositing -->

<p>
しかしながら， SVG の一定の演算では、`隔離group$が作成されることになる。
次のいずれかの特色機能が利用されている場合、その~groupは，隔離されなければならない：
◎
However, certain operations in SVG will create isolated groups. If one of the following features is used, the group must become isolated:
</p>

<ul>
	<li>
不透明度
◎
opacity
</li>
	<li>
~filter
◎
filters
</li>
	<li>
<p>
3 次元的な変形（ transforms, 座標系変換）
（ 2 次元的な変形は、隔離を生じさせてはならない）。
◎
3D transforms (2D transforms must NOT cause isolation)
</p>

<p class="trans-note">【
元々の SVG 1.1 仕様は， 3 次元の座標系変換のための機能を備えていないが、
<a href="~TRANSFORM2#svg-three-dimensional-functions" >CSS Transform 仕様により拡張されている</a>。
】</p>
	</li>
	<li>
混色
◎
blending
</li>
	<li>
~masking
◎
masking
</li>
</ul>

		</section>
		<section id="csskeywords">
<h3 title="CSS Properties">3.4. 各種 CSS ~prop</h3>

			<section id="mix-blend-mode">
<h4 title="The mix-blend-mode property">3.4.1. `mix-blend-mode^p ~prop</h4>

<p>
混色-~modeは、色を後景に混合する際に利用されなければならない公式を定義する。
この挙動は、`混色$の節にて詳細に述べる。
◎
The blend mode defines the formula that must be used to mix the colors with the backdrop. This behavior is described in more detail in Blending.
</p>




◎名 `mix-blend-mode@p
◎値 `blend-mode$t
◎初 `normal$v
◎適 
すべての要素。
SVG においては、
`~container要素$,
`~graphics要素$,
`~graphicsを参照する要素$。
`SVG11$r
◎
All elements. In SVG, it applies to container elements, graphics elements and graphics referencing elements. [SVG11]
◎継 されない
◎百 受容しない
◎媒 視覚的
◎算 指定値<!-- as specified -->
◎ア 離散的
◎表終

<p>
`blend-mode$t
値型の構文は次で与えられる：
◎
The syntax of the property of &lt;blend-mode&gt; is given with:
</p>

<pre class="blendmode">
`blend-mode@t
  = `normal$v
  | `multiply$v
  | `screen$v
  | `overlay$v
  | `darken$v
  | `lighten$v
  | `color-dodge$v
  | `color-burn$v
  | `hard-light$v
  | `soft-light$v
  | `difference$v
  | `exclusion$v
  | `hue$v
  | `saturation$v
  | `color$v
  | `luminosity$v
</pre>

<p class="note">注記：
`normal$v
以外の混色-~modeが要素に適用されるときは、新たな`積層文脈$
`CSS21$r
が確立されなければならない。
この~groupは、その要素を包含する`積層文脈$
と伴に混色され, 合成されなければならない。
◎
Note: Applying a blendmode other than normal to the element must establish a new stacking context [CSS21]. This group must then be blended and composited with the stacking context that contains the element.
</p>

<div class="example">
<p>
次の~markupと~style規則が与えられたなら：
◎
Given the following sample markup:
</p>

<pre class="lang-html">
&lt;body&gt;
   &lt;img src="ducky.png"/&gt;
&lt;/body&gt;
</pre>

<p>◎
And the following style rule:
</p>

<pre class="lang-css">
body { background-color: lime; }
</pre>

<p>
次の結果が生産されることになる：
◎
... will produce the following result:
</p>

<figure>`ducky_normal^dgm
<figcaption>
黄緑色（ `lime^v ）の後景上の，部分的に透明な画像
◎
Partially transparent image on a lime backdrop
</figcaption></figure>

<p>
~style規則を，混色を含むように変更したとするとき：
◎
If we change the style rule to include blending:
</p>

<pre class="lang-css">
body { background-color: lime; }
img { `mix-blend-mode$p: `multiply$v; }
</pre>

<p>
`body$e 要素の黄緑色 背景と混色された画像が出力されることになる。
◎
... the output will be the image blending with the lime background of the &lt;body&gt; element.
</p>

<figure>`ducky_multiply^dgm
<figcaption>
黄緑色の後景上の，透明な画像の混色
◎
Blending of a transparent image on a lime backdrop.
</figcaption></figure>

<!-- 
<figure>ducky_normal1^dgm
<figcaption>
（利用中の~browserによる表示）
</figcaption></figure>
 -->

</div>

	<div class="example">
<p>
次の SVG ~codeと~style規則が与えられたなら：
◎
Given the following svg code:
</p>

<pre class="lang-html">
&lt;svg&gt;
  &lt;circle cx="40" cy="40" r="40" fill="red"/&gt;
  &lt;circle cx="80" cy="40" r="40" fill="lime"/&gt;
  &lt;circle cx="60" cy="80" r="40" fill="blue"/&gt;
&lt;/svg&gt;
</pre>

<p>◎
And the following style rule:
</p>

<pre class="lang-css">
circle { `mix-blend-mode$p: `screen$v; }
</pre>

<p>
３個の円が混色されて出力される。
各 円は，奥から前面にかけて描画され、要素が重合する所では，混色-~modeにより色が変化する。
◎
... the output will be blending of the 3 circles. Each circle is rendered from bottom to top. Where the elements overlap, the blend mode produces a change in color.
</p>

<figure>`screen_example^dgm
<figcaption>
`screen$v 混色-~modeで混色された３個の円
◎
Example of 3 circles blending with a screen blend mode
</figcaption></figure>
  </div>

	<div class="example">
<p>
次の~stylesheetと文書片において：
◎
In the following style sheet and document fragment:
</p>

<pre class="lang-css">
body { background-color: lime; }
div { background-color: red; width: 200px; opacity: .95}
img { `mix-blend-mode$p: `difference$v; }
</pre>
<pre class="lang-html">
&lt;body&gt;
  &lt;div&gt;
     &lt;img src="ducky.png"/&gt;
  &lt;/div&gt;
&lt;/body&gt;
</pre>

<p>
`div^e 要素~上の `opacity$p は、新たな`積層文脈$を作成する。
これにより，新たな~groupが作成され、画像は `body$e の色とは混色されなくなる。
◎
... the opacity on the &lt;div&gt; element is causing the creation of a stacking context. This causes the creation of a new group so the image doesn’t blend with the color of the &lt;body&gt;.
</p>

<figure>`ducky_difference^dgm
<figcaption>
積層文脈の中での混色の例
【左側の赤色~領域が `div^e の範囲。元の画像の周辺部は透明。】
◎
Example of blending within a stacking context.
</figcaption></figure>

<p>
画像が黄緑色とは混色されなくなる様子に注意。
◎
Note how the image is not blending with the lime color.
</p></div>

	<div class="example">
<p>
次の~markupと~style規則が与えられたなら：
◎
Given the following sample markup:
</p>

<pre class="lang-html">
&lt;body&gt;
   &lt;div&gt;
     &lt;p&gt;`overlay$v blending on text&lt;/p&gt;
   &lt;/div&gt;
&lt;/body&gt;
</pre>

<p>◎
And the following style rule:
</p>

<pre class="lang-css">
div { background-image: url('texture.png'); }
@font-face {
  font-family: "Mythos Std";
  src: url("http://myfontvendor.com/mythos.otf");
}
p {
  `mix-blend-mode$p: `overlay$v;
  font-family: "Mythos Std" 
}
</pre>


<figure>`overlay_text^dgm
<figcaption>
画像~上に `overlay$v 混色される~text。
◎
Text with a blend overlay on top of an image.
</figcaption></figure>
  </div>


			</section>
			<section id="isolation">
<h4 title="The isolation property">3.4.2. `isolation^p ~prop</h4>

<p>
SVG においては、これは，要素が隔離されるかどうかを定める。
CSS においては、
`isolation$p の値を `isolate^v にすることは，要素を`積層文脈$にすることを意味する。
◎
In SVG, this defines whether an element is isolated or not.
For CSS, setting isolation to isolate will turn the element into a stacking context.
</p>

<p>
要素に対する `isolation$p の既定の値は，隔離されないことを含意する
`auto^v をとる。
しかしながら，積層文脈 `CSS21$r を作成させるような演算については、~groupは隔離されなければならない。
これらの演算については、
<a href="#csscompositingrules_CSS">HTML に特有の挙動</a>
と
<a href="#csscompositingrules_SVG">SVG に特有の挙動</a>
にて述べる。
◎
By default, elements use the auto keyword which implies that they are not isolated. However operations that cause the creation of stacking context [CSS21] must cause a group to be isolated. These operations are described in 'behavior specific to HTML' and 'behavior specific to SVG'.
</p>

◎名 `isolation@p
◎値 `isolation-mode$t
◎初 `auto^v
◎適
すべての要素。
SVG においては、
`~container要素$,
`~graphics要素$,
`~graphicsを参照する要素$。
`SVG11$r
◎
All elements. In SVG, it applies to container elements, graphics elements and graphics referencing elements. [SVG11]
◎継 されない
◎百 受容しない
◎媒 視覚的
◎算 指定値
◎ア 離散的
◎表終

<p>
`isolation-mode$t
値型の構文は次で与えられる：
◎
The syntax of the property of &lt;isolation-mode&gt; is given with:
</p>

<pre class="isolated">
`isolation-mode@t = `auto^v | `isolate^v
</pre>

<p id="img_isolation">
CSS においては、背景 画像や
`img$e の内容は、常に，`隔離group$の中に描画されなければならない。
例えば， `img$e ~tagを通して SVG ~fileへ~linkを張っている場合、
SVG の絵図は，内容の後景とは混色されないことになる。
◎
In CSS, a background image or the content of an img must always be rendered into an isolated group. For instance, if you link to an SVG file through the img tag, the artwork of that SVG will not blend with the backdrop of the content.
</p>

<p>
SVG における `mask$p は、常に，`隔離group$を作成する。
◎
In SVG, mask always creates an isolated group.
</p>


			</section>
			<section id="background-blend-mode">
<h4 title="The background-blend-mode property">3.4.3. `background-blend-mode^p ~prop</h4>

<p>
各 背景~層†の混色 ~modeを定義する。
◎
Defines the blending mode of each background layer.
</p>

<p class="trans-note">【†
`background$p ~propにより指定される（画像などによる）背景
】</p>

<p>
各 背景~層は、［
その層より下層にある［
要素の他の背景~層
］と要素の背景~色
］と混色されなければならない。
背景~層は、要素の背後の内容と混色されてはならない。
代わりに，`隔離group$の中に描画されているかのように動作しなければならない。
<!-- ＊
背後の — 概ね，要素の先祖の内容？
 -->
◎
Each background layer must blend with the element’s background layer that is below it and the element’s background color. Background layers must not blend with the content that is behind the element, instead they must act as if they are rendered into an isolated group.
</p>

<p>
`background-blend-mode$p
~propの記述は次に従う：
◎
The description of the background-blend-mode property is as follows:
</p>

◎名 `background-blend-mode@p
◎値 `blend-mode$t#
◎初 `normal$v
◎適 
すべての HTML 要素
◎
All HTML elements
◎継 されない
◎百 受容しない
◎媒 視覚的
◎算 指定値
◎ア 離散的
◎表終

<p>
`background-blend-mode$p
~listは、
`background-image$p
`CSS3BG$r
と同じ順序で適用されなければならない。
すなわち、~listの最初の要素が、現在の前面~層に適用されることになる。
~propに与えられた~comma区切りの値の個数が，層~数に満たない場合、
UA は，~listの値を必要なだけ繰り返して, その使用値を計算しなければならない。
◎
The background-blend-mode list must be applied in the same order as background-image [CSS3BG]. This means that the first element in the list will apply to the layer that is on top. If a property doesn’t have enough comma-separated values to match the number of layers, the UA must calculate its used value by repeating the list of values until there are enough.
</p>

<p>
`background$p 略式~prop `CSS3BG$r が利用されたときには、当の要素に対する
`background-blend-mode$p ~propは，その初期値に再設定されなければならない。
◎
If the background [CSS3BG] shorthand is used, the background-blend-mode property for that element must be reset to its initial value.
</p>

<div class="example">
<p>
次の~markupと~style規則が与えられたなら：
◎
Given the following sample markup:
</p>

<pre class="lang-html">
&lt;body&gt;
   &lt;div&gt;&lt;/div&gt;
&lt;/body&gt;
</pre>

<p>◎
And the following style rule:
</p>

<pre class="lang-css">
body { background-color: lime; }
div { 
  width: 200px;
  height: 200px;
  background-size: 200px 200px;
  background-repeat:no-repeat;
  background-image:
      linear-gradient(to right, #000000 0%,#ffffff 100%),
      url('ducky.png');
  `background-blend-mode$p: difference, normal;
}
</pre>

<figure>`ducky_background_blend^dgm
<figcaption>
2 つの背景 画像の混色。
◎
Blending of 2 background images.
</figcaption></figure>

<p>
~gradient（ `linear-gradient^v ）は、 `body$e の色とは混色 されないことに注意。
それは元の色を保ち続ける。
◎
Note that the gradient is not blending with the color of body. Instead it retains its original color.
</p>

<p class="trans-note">【
この~code例の <samp>ducky.png</samp> と~gradientの順序は逆であろう（~gradientの方が前面になっている）。
この混色-~modeでは、結果は同じになるが。
】</p>

</div>


			</section>
		</section>
	</section>
	<section id="canvascompositingandblending">
<h2 title="Specifying Compositing and Blending in Canvas 2D">4. Canvas 2D における合成と混色の指定-法</h2>

<p>
<a href="http://www.w3.org/TR/2dcontext">canvas 2d</a>
（ 2 次元~canvas）文脈は、現在の［ 合成と混色 ］の演算子を設定する
`globalCompositeOperation$a 属性を定義する。
◎
The canvas 2d context defines the ‘globalCompositeOperation’ attribute that is used to set the current compositing and blending operator.
</p>

<p>
この~propは次の値をとる：
◎
This property takes the following value:
</p>

◎名 `globalCompositeOperation$a
◎値 `blend-mode$t | `composite-mode$t
◎初 `source-over$v
◎表終

<p>
`composite-mode$t 値型の構文は次で与えられる：
◎
The syntax of the property of &lt;composite-mode&gt; is given with:
</p>

<pre class="composite">
`composite-mode@t
  = `clear$v
  | `copy$v
  | `source-over$v
  | `destination-over$v
  | `source-in$v
  | `destination-in$v
  | `source-out$v
  | `destination-out$v
  | `source-atop$v
  | `destination-atop$v
  | `xor$v
  | `lighter$v
</pre>

	</section>
	<section id="whatiscompositing">
<h2 title="Introduction to compositing">5. 合成の概要</h2>

<p>
合成（ compositing ）とは、~graphic要素を，その後景に組合わすことである。
◎
Compositing is the combining of a graphic element with its backdrop.
</p>

<p>
この仕様に述べる~modelにおける合成の演算は、 2 つの手続き
`混色$と `~Porter-Duff合成$
からなる。
混色の段階は、~graphic要素の色と後景の色とが，どう相互作用するかを決定する。
◎
In the model described in this specification there are two steps to the overall compositing operation - Porter-Duff compositing and blending. The blending step determines how the colors from the graphic element and the backdrop interact.
</p>

<p>
概して、混色の段階が先に遂行され，~Porter-Duff合成の段階が後続する。
混色の段階においては、要素と`後景$を混合した結果の色が計算される。
~graphic要素の色は、この結果の色に置換される。
しかる後、~graphic要素は，指定された合成~演算子を用いて`後景$に合成される。
◎
Typically, the blending step is performed first, followed by the Porter-Duff compositing step. In the blending step, the resultant color from the mix of the element and the the backdrop is calculated. The graphic element’s color is replaced with this resultant color. The graphic element is then composited with the backdrop using the specified compositing operator.
</p>

<p class="note">注記：
図形は、数学的な記述により定義される。
個々の地点は、図形の内側に入るか入らないかのいずれかになる。
中間段階は無い。
◎
Shape is defined by the mathematical description of the shape. A particular point is either inside the shape or it is not. There are no gradations.
</p>

<p class="note">注記：
~alpha値で表される不透明度は、それぞれの地点ごとに色~値と伴に格納される。
~alpha値の範囲は 0 〜 1 の閉区間である。
値 0 は、図形のその地点に対する画素の被覆率が~zeroであり，透明であることを意味する。
すなわち、幾何的にその地点の画素に重合しないので，その地点の色への寄与分が無いことを意味する。
値 1 は、画素が全-不透明であり，形状が画素~全体に重合することを意味する。
◎
Note: Opacity is described using an alpha value, stored alongside the color value for each particular point. The alpha value is between 0 and 1, inclusive. A value of 0 means that the pixel has no coverage at that point, and is therefore transparent; i.e. there is no color contribution from any geometry because the geometry does not overlap this pixel. A value of 1 means that the pixel is fully opaque; the geometry completely overlaps the pixel.
</p>

		<section id="simplealphacompositing">
<h3 title="Simple alpha compositing">5.1. 単純~alpha合成</h3>

<!-- 
Cs = (1 − αb) × Cs + αb × B(Cb, Cs)
	B(Cb, Cs) = Cs
   = (1 − αb) × Cs + αb × Cs
   = Cs // そのまま

Co = αs × Fa × Cs + αb × Fb × Cb
	Fa = 1; Fb = 1 − αs // source over
   = αs × Cs + αb × (1 − αs) × Cb
   = αs Cs + cb − αs cb
   = αs Cs + cb(1 − αs)

 -->
<p>
単純~alpha合成の公式は，次で与えられる：
◎
The formula for simple alpha compositing is
</p>

<pre class="formula">
%co = %Cs × %αs + %Cb × %αb × ( 1 − %αs )
</pre>

<p>
各種~変数は：
◎
Where
</p>

<table class="params"><tbody>

<tr><th>%co
<td>合成-後の，乗算済みの画素 値 
◎
co: the premultiplied pixel value after compositing

<tr><th>%Cs
<td>合成される~source~graphic要素（以下，単に “~source” と記す）の色~値
◎
Cs: the color value of the source graphic element being composited

<tr><th>%αs
<td>~sourceの~alpha値
◎
αs: the alpha value of the source graphic element being composited

<tr><th>%Cb
<td>`後景$の色~値
◎
Cb: the color value of the backdrop

<tr><th>%αb
<td>`後景$の~alpha値
◎
αb: the alpha value of the backdrop

</tbody></table>

<p class="note">注記：
すべての値は 0 〜 1 の閉区間に入る。
◎
Note: All values are between 0 and 1 inclusive.
</p>

<p class="trans-note">【
明示的に言及されていないので，解り難くなっているが、単純~alpha合成は，
<a href="#whatiscompositing" >合成の概要</a>
の冒頭に述べた一般の場合において、混色の段階が自明なものにされ（結果は，~sourceの色そのまま），~Porter-Duff合成が `source-over$v にされた、特殊な場合になる。
すなわち、この節に示されている単純~alpha合成の公式の中の %Cs は，`混色$の段階の結果をそのまま表している。
】</p>

<p>
合成-後の画素 値（ %co ）は、~sourceからの寄与分
[ %Cs × %αs ]
と, 後景からの寄与分
[ %Cb × %αb × ( 1 − %αs ) ]
を加算して与えられる。
色の寄与分を決定するため、~sourceも後景も、その色~値が，それぞれの~alphaで乗算される。
~alpha ~zeroは，色の寄与分がないことを意味し、部分的な~alphaは，その割合の色が寄与することを意味する。
後景の寄与分は、~sourceの不透明度に基づいて更に減量される：
概念的には、後景のうち [ 1 − %αs ] の割合が~sourceを透過することを意味する —
すなわち、~sourceが全-不透明（ %αs ＝ 1 ）ならば，後景は透過しなくなる。
◎
The pixel value after compositing (co) is given by adding the contributions from the source graphic element [Cs x αs] and the backdrop [Cb x αb x (1 - αs)]. For both the graphic element and the backdrop, the color values are multiplied by the alpha to determine the amount of color that contributes. With zero alpha meaning that the color does not contribute and partial alpha means that some percentage of the color contributes. The contribution of the backdrop is further reduced based on the opacity of the graphic element. Conceptually, (1 - αs) of the backdrop shows through the graphic element, meaning that if the graphic element is fully opaque (αs=1) then no backdrop shows through.
</p>

<p>
上に挙げられた単純~alpha合成の公式は、［
後景と~source
］の色を，それぞれの~alphaによる重みで加重平均をとって得られる色を与える。
結果の合成~alpha値は、単純に，合成される一連の要素が寄与する~alphaの合計になる。
結果の合成~alphaの公式は：
◎
The simple alpha compositing formula listed above gives a resultant color which is the result of the weighted average of the backdrop color and graphic element color, with the weighting determined by the backdrop and graphic element alphas. The resultant alpha value of the composite is simply the sum of the contributed alpha of the composited elements. The formula for the resultant alpha of the composite is
</p>

<pre class="formula">
%αo = %αs + %αb × ( 1 − %αs )
</pre>

<!-- 
αo = αs1 + αb (1 - αs1) = 1 - (1 - αb) (1 - αs1)
1 - αo = (1 - αb) (1 - αs1)

	Ti = 1 - αs[i]; i = 1, 2, ...
	T0 = 1 - αb
	αi = i-th αo; i = 1, 2, ...
	α0 = αb = 1 - T0

1 - αi = (1 - α[i-1]) Ti
	TOi = 1 - αi
TOi = TO[i-1] Ti

TO1 = TO0 T1 = T0 T1
TO2 = TO1 T2 = T0 T1 T2
...
TOi = T0 T1 T2 ... Ti
	結果の透明度 = 各 透明度すべての積

-->
<p>◎
Where
</p>

<table class="params"><tbody>

<tr><th>%αo
<td>合成~alpha値
◎
αo: the alpha value of the composite

<tr><th>%αs
<td>~sourceの~alpha値
◎
αs: the alpha value of the graphic element being composited

<tr><th>%αb
<td>`後景$の~alpha値
◎
αb: the alpha value of the backdrop

</tbody></table>


<div class="note">
<p>
色と不透明度は、乗算済みの値を格納した方がより効率的になることが多い。
乗算済みの値は，次で与えられる：
◎
Often, it can be more efficient to store a pre-multiplied value for the color and opacity. The pre-multiplied value is given by
</p>

<pre class="formula">
%cs = %Cs × %αs
</pre>

<p>◎
with
</p>

<table class="params"><tbody>
<tr><th>%cs
<td>乗算済みの値
◎
cs: the pre-multiplied value

<tr><th>%Cs
<td>色~値
◎
Cs: the color value

<tr><th>%αs
<td>~alpha値
◎
αs: the alpha value

</tbody></table>


<p>
したがって，乗算済みの値を用いる単純~alpha合成の公式は次の様になる：
◎
Thus the formula for simple alpha compositing using pre-multiplied values becomes
</p>

<pre class="formula">
%co = %cs + %cb × ( 1 − %αs )
</pre>

<p>
非 乗算済みでない色~成分は、乗算済みの値から，公式を逆算して得られる：
◎
To extract the color component of a pre-multiplied value, the formula is reversed:
</p>

<pre class="formula">
%Co = %co ÷ %αo
</pre>
  </div>


			<section id="simplealphacompositingexamples">
<h4 title="Examples of simple alpha compositing">5.1.1. 単純~alpha合成の例</h4>

<div class="example">

<figure>`simple_box^dgm
</figure>

<p>
ここでは，最も基本的な事例を述べる。
単色（ α = 1 ）で塗りつぶされた 1 個の図形からなる。
図形は、空の背景に合成される。
空の背景は、合成結果に効果を持たない。
◎
This describes the most basic case. It consists of 1 shape that is filled with a solid color (α = 1). The shape is composited with an empty background. The empty background has no effect on the resultant composite.
</p>

<pre class="formula">
%Cs = RGB(1, 0, 0)
%αs = 1
%Cb = RGB(0, 0, 0)
%αb = 0

%co = %Cs × %αs + %Cb × %αb × ( 1 − %αs )
   = RGB(1, 0, 0) × 1 + RGB(0, 0, 0) × 0 × ( 1 − 1 )
   = RGB(1, 0, 0)
</pre>
  </div>

	<div class="example">
<figure>`two_box^dgm
</figure>

<p>
次は，より複雑な例。
透明度は無いが、2 個の図形が交差している。
◎
This is a more complex example. There is no transparency, but the 2 shapes intersect.
</p>

<p>
交差域に合成~公式を適用すると：
◎
Applying the compositing formula in the area of intersection, gives:
</p>

<pre class="formula">
%Cs = RGB(0, 0, 1)
%αs = 1
%Cb = RGB(1, 0, 0)
%αb = 1

%co = %Cs × %αs + %Cb × %αb × ( 1 − %αs )
   = RGB(0, 0, 1) × 1 + RGB(1, 0, 0) × 1 × ( 1 − 1 )
   = RGB(0, 0, 1)
</pre>

<p>
合成結果の~alphaを計算する：
◎
Calculating the alpha of the resultant composite
</p>

<pre class="formula">
%αo = %αs + %αb × ( 1 − %αs )
   = 1 + 1 × ( 1 − 1 )
   = 1
</pre>

<p>
合成結果の色~成分を計算する：
◎
Calculating the color component of the resultant composite
</p>

<pre class="formula">
%Co = %co ÷ %αo
   = RGB(0, 0, 1) ÷ 1
   = RGB(0, 0, 1)
</pre>
  </div>

	<div class="example">
<figure>`two_box_transparency^dgm
</figure>

<p>
図形はいくらかの透明度を持つが，`後景$は全-不透明。
◎
This is an example where the shape has some transparency, but the backdrop is fully opaque.
</p>

<p>
交差域に合成~公式を適用すると：
◎
Applying the compositing formula in the area of intersection, gives:
</p>

<pre class="formula">
%Cs = RGB(0, 0, 1)
%αs = 0.5
%Cb = RGB(1, 0, 0)
%αb = 1

%co = %Cs × %αs + %Cb × %αb × ( 1 − %αs )
   = RGB(0, 0, 1) × 0.5 + RGB(1, 0, 0) × 1 × ( 1 − 0.5 )
   = RGB(0, 0, 1) × 0.5 + RGB(1, 0, 0) × 0.5
   = RGB(0.5, 0, 0.5)
</pre>

<p>
合成結果の~alphaを計算する：
◎
Calculating the alpha of the resultant composite
</p>

<pre class="formula">
%αo = %αs + %αb × ( 1 − %αs )
   = 0.5 + 1 × ( 1 − 0.5 )
   = 1
</pre>

<p>
合成結果の色~成分を計算する：
◎
Calculating the color component of the resultant composite
</p>

<pre class="formula">
%Co = %co ÷ %αo
   = RGB(0.5, 0, 0.5) ÷ 1
   = RGB(0.5, 0, 0.5)
</pre>

  </div>

	<div class="example">

<p>
図形と`後景$の両者とも透明な例：
</p>

<figure>`two_box_transparency_both^dgm
</figure>

<p>◎
Figure 4 shows an example where both the shape and the backdrop are transparent.
</p>

<p>
交差域に合成~公式を適用すると：
◎
Applying the compositing formula in the area of intersection, gives:
</p>

<pre class="formula">
%Cs = RGB(0, 0, 1)
%αs = 0.5
%Cb = RGB(1, 0, 0)
%αb = 0.5

%co = %Cs × %αs + %Cb × %αb × ( 1 − %αs )
   = RGB(0, 0, 1) × 0.5 + RGB(1, 0, 0) × 0.5 × ( 1 − 0.5 )
   = RGB(0, 0, 1) × 0.5 + RGB(1, 0, 0) × 0.25
   = RGB(0.25, 0, 0.5)
</pre>

<p>
合成結果の~alphaを計算する：
◎
Calculating the alpha of the resultant composite
</p>

<pre class="formula">
%αo = %αs + %αb × ( 1 − %αs )
   = 0.5 + 0.5 × ( 1 − 0.5 )
   = 0.75
</pre>

<p>
合成結果の色~成分を計算する：
◎
Calculating the color component of the resultant composite
</p>

<pre class="formula">
%Co = %co ÷ %αo
   = RGB(0.25, 0, 0.5) ÷ 0.75
   = RGB(0.33, 0, 0.66)
</pre>

	</div>


			</section>
		</section>
	</section>
	<section id="generalformula">
<h2 title="General Formula for Compositing and Blending">6. 合成と混色の一般~公式</h2>

<p>
合成と混色のための一般~公式は、この 2 つの手続きにおいて，合成~演算子と混色~関数を選択できるようにする。
これらの関数の中で利用される項についての詳細は、次~節にて述べる。
◎
The general formula for compositing and blending which allows for selection of the compositing operator and blending function comprises two steps. The terms used in these functions will be described in detail in the following sections.
</p>

<p>
混色-時に適用される公式：
◎
Apply the blend in place
</p>

<pre class="formula">
%Cs = ( 1 − %αb ) × %Cs + %αb × B( %Cb, %Cs )
</pre>

<p>
合成-時に適用される公式：
◎
Composite
</p>

<pre class="formula">
%Co = %αs × %Fa × %Cs + %αb × %Fb × %Cb
</pre>

<p>◎
Where:
</p>

<table class="params"><tbody>

<tr><th>%Cs
<td>~source色
◎
Cs: is the source color

<tr><th>%Cb
<td>後景色
◎
Cb: is the backdrop color

<tr><th>%αs
<td>~source~alpha
◎
αs: is the source alpha

<tr><th>%αb
<td>後景~alpha
◎
αb: is the backdrop alpha

<tr><th>B( %Cb, %Cs )
<td>混合~関数
◎
B(Cb, Cs): is the mixing function

<tr><th>%Fa, %Fb
<td>利用する~Porter-Duff演算子にて定義される
◎
Fa: is defined by the Porter Duff operator in use

◎
Fb: is defined by the Porter Duff operator in use

</tbody></table>



	</section>
	<section id="backdropCalc">
<h2 title="Backdrop calculation">7. 後景の計算</h2>

<p>
`後景@
（ backdrop ）とは、要素の背後の内容であり，要素の合成 <em >先</em>（ destination ）になる。
これは、後景が，以前のすべての要素の合成による結果であることを意味する。
◎
The backdrop is the content behind the element and is what the element is composited with. This means that the backdrop is the result of compositing all previous elements.
</p>

<p class="trans-note">【
後景 — 背景（ background ）と語感が似るが，処理~modelにおける取り扱いが異なる — 背景は “要素の一部” であり，合成 <em >元</em>（ ~source ）になる。
】</p>

		<section id="backdropexamples">
<h3 title="Examples of backdrop calculation">7.1. 後景の計算~例</h3>

	<div class="example">
<figure>`simple_backdrop^dgm
</figure>

<p>
この例には 2 個の単純な図形がある。
青色の図形に対する後景は、赤色 図形の右下隅の部分を含んでいる。
点線は、青色 図形を合成する際に調べられる領域を示す。
◎
This example has 2 simple shapes. The backdrop for the blue shape includes the bottom right corner of the red shape . The dotted line shows the area that is examined during compositing of the blue shape.
</p></div>

	<div class="example">
<figure>`simple_backdrop_alpha^dgm
</figure>

<p>
後景の中の図形は~alpha値を持つ。
この後景の図形の~alpha値は，後景が計算される間 保全される。
◎
The shape in the backdrop has an alpha value. The alpha value of the backdrop shape is preserved when the backdrop is calculated.
</p></div>


		</section>
	</section>
	<section id="groups">
<h2 title="Compositing Groups">8. 合成~group</h2>

<p>
合成~group（ compositing group ）により、合成と後景との相互作用を制御できるようになる。
~groupは、~group内の合成 効果と, すでに~sceneにある内容（後景）とがどう相互作用するかを指定するために利用できる。
◎
Compositing groups allow more control over the interaction of compositing with the backdrop. Groups can be used to specify how a compositing effect within a group will interact with the content that is already in the scene (the backdrop).
</p>

<p>
合成~groupは、任意~個数の要素からなり得る。
また、他の合成~groupを包含し得る。
◎
Compositing groups may be made up of any number of elements, and may contain other compositing groups.
</p>

<p>
既定の~propを伴う合成~groupは、~group化されないときと視覚的な相違が生じては~MUST_NOT。
`~group合成の結合法則$を見よ。
◎
The default properties of a compositing group shall cause no visual difference compared to having no group. See Group Invariance.
</p>

<p>
合成~groupは、先ず，要素の~groupを`初期後景$上に合成して描画される。
その結果は、色と~alphaの情報を包含する単独の要素になる。
次に，この要素が`~group後景$上に合成される。
この手続きは、［
結果の`~group後景$が，最終的な合成-結果に寄与する単独の部分になる
］ことを確保し~MUST。
◎
A compositing group is rendered by first compositing the elements of the group onto the initial backdrop. The result of this is a single element containing color and alpha information. This element is then composited onto the group backdrop. Steps shall be taken to ensure the group backdrop makes only a single contribution to the final composite.
</p>

<dl>
	<dt id="initialbackdrop" title="initial backdrop">初期後景</dt>
	<dd>
初期後景が、~groupの最初の要素の合成に利用される後景である。
これは、［
非 `隔離group$に対しては，それに対する`~group後景$
］, ［
`隔離group$に対しては，全-透明な後景
］と同じになる。
◎
The initial backdrop is the backdrop used for compositing the group’s first element. This will be the same as the group backdrop in a non-isolated group, or a fully transparent backdrop for an isolated group.
</dd>

	<dt id="groupbackdrop" title="group backdrop">~group後景</dt>
	<dd>
【~groupに対する】
~group後景とは、［［
~groupの最初の要素
］の直前までの，すべての要素
］による，合成の結果である。
◎
The group backdrop is the result of compositing all elements up to but not including the first element in the group.
</dd>
</dl>

		<section id="groupinvariance">
<h3 title="Group invariance">8.1. ~group合成の結合法則</h3>

<p>
`単純~alpha合成$の重要な性質として、その演算が，結合法則を満たすことが挙げられる
【†】
。
この挙動は、この仕様の中で述べるより複雑な~modelにおいても保全される。
既定の属性により ~group分けが追加されたり, 除去されても、視覚的な相違が示されては~MUST_NOT（次の式の "+" は合成~演算を表す）：
◎
An important property of simple alpha compositing is its group invariance. This behavior is preserved in the more complex model described in this specification. Adding or removing grouping with default attributes shall not show visual differences.
</p>

<pre class="formula">
`source-over^v: A + B + C = A + (B + C) = (A + B) + C
</pre>

<div >
<p>
この結合法則は、~groupに次の属性が追加された場合，成立しなくなり得る：
</p>

<ul ><li>隔離【 `isolation$p: `isolate^v 】
</li><li>`normal$v 以外の混色-~mode【 `mix-blend-mode$p 】
</li><li>`source-over$v 以外の~Porter-Duff合成~演算子
</li></ul>

◎
When adding attributes to the group such as isolate, blending modes other than normal or Porter Duff compositing operators other than source-over, groups may no longer be invariant.
</div>

<div class="trans-note">
<p >【
† 結合法則 —
原文には “group invariance” としか記されていないが、おそらく，合成~演算に関する
`<a href="https://ja.wikipedia.org/wiki/%E7%B5%90%E5%90%88%E6%B3%95%E5%89%87">結合法則</a>^_
を意味するものと解釈して記述を補完している（
<a href="https://dbaron.org/log/20130306-compositing-blending" >参考</a>
）。
（ “group invariance” ＝ どのように “~group分け” しても結果は “不変” ）
</p>

<p>
この仕様に現れる語 “（合成）~group” とは、合成~演算の結合順序を表現するための概念と考えられる。
例えば、層 A 上に層 B, C, D を順に合成することを考える。
このとき、合成~演算を記号 + で表すならば、合成結果を得る過程には：
</p>

<ul><li>((A + B) + C) + D
</li><li>A + (B + (C + D))
</li><li>A + ((B + C) + D)
</li></ul>

<p>
その他，種々の方法があり、演算が結合法則を満たさなければ，結果は異なり得る。
そのため、式の括弧をどのように与えるかを定義する必要があり、それが “~group” と呼ばれているものにあたると見られる。
】</p>
</div>

		</section>
		<section id="isolatedgroups">
<h3 title="Isolated Groups">8.2. 隔離group</h3>

<p>
隔離group（ isolated group ）における`初期後景$は、全-透明な黒色にされ~MUST。
◎
In an isolated group, the initial backdrop shall be black and fully transparent.
</p>

<p>
この場合の`初期後景$は、`~group後景$と異なる。
`~group後景$との相互作用が生じるのは、~groupに算出された［
色, 図形, ~alpha
］が それと合成されるときに限られ~MUST。
◎
In this instance, the initial backdrop is different than the group backdrop. The only interaction with the group backdrop shall occur when the group’s computed color, shape and alpha are composited with it.
</p>

<p>
合成における`隔離group$の効果については、
<a href="#groupcompositing">隔離groupと各種~Porter-Duff~mode</a>
を見よ。
混色における`隔離group$の効果については、
<a href="#isolationblending">混色における~group隔離の効果</a>
を見よ。
◎
See ‘Isolated groups and Porter Duff modes’ for a description of the effect of isolated groups on compositing. See ‘Effect of group isolation on blending’ for a description of the effect of isolated groups on blending.
</p>

		</section>
		<section id="pagebackdrop">
<h3 title="The Page Group">8.3. ~page~group</h3>

<p>
~page~groupが，~top-levelの~groupである。
他のすべての要素と~groupは、この~groupの中に合成される。
~page~groupは`隔離group$である。
◎
The top level group is the page group. All other elements and groups are composited into this group. The page group is an isolated group.
</p>

<p>
~page~groupは、不透明度 100% の白色による後景色と合成される
◎
The page group is composited with a backdrop color of white with 100% opacity.
</p>

		</section>
	</section>
	<section id="advancedcompositing">
<h2 title="Advanced compositing features">9. 高度な合成 特色機能</h2>

<p>
`単純~alpha合成$は、
`source-over$v ~Porter-Duff合成~演算子を利用する。
◎
Simple alpha compositing uses the source-over Porter Duff compositing operator.
</p>

<p>
~Porter-Duff合成は、画素
【概念的な微小領域】
の最終的な色に寄与し得る，その画素の中の 2 つの図形（ source と destination 
【合成元と合成先 —  後者は長いので以下 “~dest” と略記する】
）による~modelに基づく。
画素は、4 つの部分画素の区分に分割される。
各 区分は，~sourceと~destの可能な組合せを表現する。
`PORTERDUFF$r
◎
Porter Duff compositing is based on a model of a pixel in which two shapes (source and destination) may contribute to the final color of the pixel. The pixel is divided into 4 sub-pixel regions and each region represents a possible combination of source and destination. [PORTERDUFF]
</p>

<p>
４つの区分とは：
◎
The four regions are:
</p>

<dl>
	<dt title="Source Only">~sourceのみ</dt>
	<dd>
~sourceのみが画素色に寄与する区分
◎
Where only the source contributes to the pixel color
</dd>

	<dt title="Destination only">~destのみ</dt>
	<dd>
~destのみが画素色に寄与する区分
◎
where only the destination contributes to the pixel color
</dd>

	<dt title="Both">両者の組合せ</dt>
	<dd>
画素色が~sourceと~destの両者による組合せから定義され得る区分。
◎
Source and Destination – where both the source and destination may combine to define the pixel color
</dd>

	<dt title="None">なし</dt>
	<dd>
~sourceも~destも最終的な画素色に寄与しない区分。
◎
No source or Destination – where neither make a contribution to the final pixel color
</dd>

</dl>

<p class="note">注記：
~destは、後景の同義語である。
この節で利用される語 dest（ destination ）は、~Porter-Duff合成について述べるときの標準の語と見なされる。
加えて、合成~演算子の名前には <code>destination</code> が利用される。
◎
Note: Destination is synonymous with backdrop. The term destination is used in this section as this is considered the standard when working with Porter Duff compositing. Additionally, the compositing operators use destination in their names.
</p>

<figure>
<!-- PD_regions^dgm -->
<div class="comp-box" style="width: 300px; height: 300px; text-align:center;">
<div class="comp-dest" style="width:40%; left:60%;">~destのみ</div>
<div class="comp-source" style="height: 60%; top: 40%;">~sourceのみ</div>
<div class="comp-both" style="background: rgb(156, 201, 180);">両者の組合せ</div>
<div class="comp-both" style="width:40%; height: 60%; left:60%; top: 40%; ">両方なし</div>
</div>
</figure>

<p>
各 区分からの最終的な画素色への寄与分は、その画素における図形の被覆率と, 利用する演算子により定義される。
被覆率は、~alpha（ α ）を通して指定される
— α = 1 は全て覆うことに対応し，
α = 0 は全く覆わないことに対応する。
すなわち、画素の各 区分の面積は，画素に寄与している各 図形の被覆率に依存する。
各 区分の面積は、
【画素の面積を 1 として】
次の等式により計算できる：
◎
The contribution from each region to the final pixel color is defined by the coverage of the shape at that pixel, and the operator in use. Coverage is specified in terms of alpha. Full alpha (1) implies full coverage, while zero alpha (0) implies no coverage. This means that the area of each region within the sub-pixel is dependent on the coverage of each shape contributing to the pixel. The area of each region can be calculated with the following equations:
</p>

<div>

<figure>
<table>
<caption>
%αs = ~sourceの被覆率,
%αb = ~destの被覆率
</caption>
<thead style="background: #DDF"><tr><th>区分
<th>被覆率
<th>計算例（ %αs = 0.6,  %αb = 0.4 ）
</thead>

<tbody>
<tr><th title="Both">両者の組合せ
<td>%αs × %αb
<td>0.6 × 0.4 = 0.24

<tr><th title="Source only">~sourceのみ
<td>%αs × ( 1 − %αb )
<td>0.6 × ( 1 − 0.4 ) = 0.36

<tr><th title="Destination only">~destのみ
<td>%αb × ( 1 − %αs )
<td>0.4 × ( 1 − 0.6 ) = 0.16

<tr><th title="None">なし
<td style="padding-right: 2em;">( 1 − %αs ) × ( 1 − %αb )
<td>( 1 − 0.6 ) × ( 1 − 0.4 ) = 0.24

</tbody></table>

<figcaption>
（この計算例の被覆率は、上の図式に示された~sourceと~destの被覆率に等しくなるように選ばれている）
</figcaption></figure>


	<div lang="en">
<!-- 
上の図の~sourceと~destは，いずれも被覆率 0.5 を表現している：
 -->
<p>
The figure above represents coverage of 0.5 for both source and destination.
</p>

<pre lang="en">
Both = 0.5 × 0.5 = 0.25 
Source Only = 0.5 (1 − 0.5) = 0.25
Destination Only = 0.5(1 − 0.5) = 0.25
None = (1 − 0.5)(1 − 0.5) = 0.25
</pre>

<p>
Therefore, the coverage of each region is 0.25 in this example.
</p>
	</div>
</div>

<p class="trans-note">【
上の図式, および以下の節で述べる各種 演算子にて示される図式は、 1 画素の被覆率としても，あるいは図に示された通りの（不透明な） 2 枚の~graphic（全高または全幅が全体に渡る長方形）の重合として捉えることもできる（上の図の “両者の組合せ” の色は仮の色であり，演算子に依存する）。
前者の捉え方をより忠実に反映させるため、この訳では，原文の図式を改変している。
】</p>


		<section id="porterduffcompositingoperators">
<h3 title="The Porter Duff Compositing Operators">9.1. ~Porter-Duff合成~演算子</h3>

<p>
合成の代数は、
Lucasfilm で仕事をしていた Thomas Porter と Tom Duff による，画期的な論文にて定義され、 12 個の “~Porter-Duff” 演算子が開発された。
これらの演算子は、［［
~alpha, あるいは画素 被覆率
］［
~channel／値
］を持つ~graphic的~obj
］の重合から形成される，４つの部分画素 区分における混合の結果を制御する。
演算子には、４つの区分による実用的な組合せすべてが利用されている。
◎
The landmark paper by Thomas Porter and Tom Duff, who worked for Lucasfilm, defined the algebra of compositing and developed the twelve "Porter Duff" operators. These operators control the results of mixing the four sub-pixel regions formed by the overlapping of graphical objects that have an alpha or pixel coverage channel/value. The operators use all practical combinations of the four regions.
</p>

<p>
12 個の基本的な~Porter-Duff演算子は、~sourceと~destの可能な組合せすべてを網羅する。
◎
There are 12 basic Porter Duff operators, satisfying all possible combinations of source and destination.
</p>

<p>
各 演算子を幾何的に表現するなら、各 図形からの寄与分は，出力に対する図形の合計の被覆率として捉えられる。
例えば， `source-over$v においては、~sourceが寄与し得る比率は 全体（ 1.0 ）であり,
~destの寄与し得る比率は 残る ( 1 − %αs ) になる。<!-- ＊残る？ -->
これには、画素の最終的な被覆率のための等式を与えるため，~sourceと~destの被覆率により改変される。
◎
From the geometric representation of each operator, the contribution of each shape can be seen to be expressed as a fraction of the total coverage of the output. For example, in source over, the possible contribution of source is full (1) and the possible contribution of destination is whatever is remaining (1 – αs). This is modified by the coverage of source and destination to give the equation for the final coverage of the pixel:
</p>

<pre class="formula">
%αo = %αs × 1 + %αb × ( 1 − %αs )
</pre>

<p>
それぞれの演算子は、比率項
%Fa （この例では 1 ）と
%Fb （この例では 1 − %αs ）を定義し，最終的な画素 値に寄与し得る 図形の被覆率を指定する。
被覆率のための等式の一般~形は：
◎
The fractional terms Fa (1 in this example) and Fb (1 – αs in this example) are defined for each operator and specify the fraction of the shapes that may contribute to the final pixel value. The general form of the equation for coverage is:
</p>

<pre class="formula">
%αs × %Fa + %αb × %Fb
</pre>

<p>
色も組入れられた一般の~Porter-Duff等式は：
◎
and incorporating color gives the general Porter Duff equation
</p>

<pre class="formula">
%co = %αs × %Fa × %Cs + %αb × %Fb × %Cb
</pre>

<p>◎
Where:
</p>

<table class="params"><tbody>

<tr><th>%co
<td>出力~alphaにより乗算済みにされた，出力 色（ 0 ≤ %co ≤ 1 ）。
◎
co is the output color pre-multiplied with the output alpha [0 &lt;= co &lt;= 1]

<tr><th>%Fa
<td>
演算子により定義され、（~alphaにより乗算されていない）~source色 %Cs の含有率を制御する。
%αs は~source %Fa の被覆率を与える。
◎
αs is the coverage of the source Fa is defined by the operator and controls inclusion of the source Cs is the color of the source (not multiplied by alpha)

<tr><th>%Fb
<td>
演算子により定義され、（~alphaにより乗算されていない）~dest色 %Cb の含有率を制御する。
%αb は~dest %Fb の被覆率を与える。
◎
αb is the coverage of the destination Fb is defined by the operator and controls inclusion of the destination Cb is the color of the destination (not multiplied by alpha)

</tbody></table>


			<section id="porterduffcompositingoperators_clear">
<h4 title="Clear">9.1.1. `clear^v</h4>

<p>
どの区分も，結果に現れない。
◎
No regions are enabled.
</p>

<!-- 
<figure><img
	alt="example of porter duff clear"
	src="compositing/PD_clr.svg"
></figure>
 -->

<!-- 
<figure><img\s+alt="([^"]+)"\s+src="([^"]+)"\s*></figure>
<a href="$2" title="$1">元画像</a>
 -->

<table class="comp-table">
<thead><tr><td>~source<td>dest<td>結果</thead>
<tbody><tr><td><div class="comp-box">
<div class="comp-source"></div>
</div><td><div class="comp-box">
<div class="comp-dest"></div>
</div><td><div class="comp-box">
</div></tbody></table>

<pre class="formula">
%Fa = 0 ; %Fb = 0
%co = 0
%αo = 0
</pre>


			</section>
			<section id="porterduffcompositingoperators_src">
<h4 title="Copy">9.1.2. `copy^v</h4>

<p>
~sourceのみが，結果に現れる。
◎
Only the source will be present.
</p>

<!-- 
<figure><img
	alt="example of porter duff copy"
	src="compositing/PD_src.svg"
></figure>
 -->

<table class="comp-table">
<thead><tr><th>~source<th>~dest<th>結果</thead>
<tbody><tr><td><div class="comp-box">
<div class="comp-source"></div>
</div><td><div class="comp-box">
<div class="comp-dest"></div>
</div><td><div class="comp-box">
<div class="comp-source"></div>
</div></tbody></table>

<pre class="formula">
%Fa = 1 ; %Fb = 0
%co = %αs × %Cs
%αo = %αs
</pre>


			</section>
			<section id="porterduffcompositingoperators_dst">
<h4 title="Destination">9.1.3. `destination^v</h4>

<p>
~destのみが，結果に現れる。
◎
Only the destination will be present.
</p>

<!-- 
<figure><img
	alt="example of porter duff destination"
	src="compositing/PD_dst.svg"
></figure>
 -->

<table class="comp-table">
<thead><tr><th>~source<th>~dest<th>結果</thead>
<tbody><tr><td><div class="comp-box">
<div class="comp-source"></div>
</div><td><div class="comp-box">
<div class="comp-dest"></div>
</div><td><div class="comp-box">
<div class="comp-dest"></div>
</div></tbody></table>

<pre class="formula">
%Fa = 0 ; %Fb = 1
%co = %αb × %Cb
%αo = %αb
</pre>


			</section>
			<section id="porterduffcompositingoperators_srcover">
<h4 title="Source Over">9.1.4. `source-over^v</h4>

<p>
~destの上に~sourceを置いたものが，結果に現れる。
◎
Source is placed over the destination.
</p>

<!-- 
<figure><img
	alt="example of porter duff source over"
	src="compositing/PD_src-over.svg"
></figure>
 -->

<table class="comp-table">
<thead><tr><th>~source<th>~dest<th>結果</thead>
<tbody><tr><td><div class="comp-box">
<div class="comp-source"></div>
</div><td><div class="comp-box">
<div class="comp-dest"></div>
</div><td><div class="comp-box">
<div class="comp-dest"></div>
<div class="comp-source"></div>
</div></tbody></table>

<pre class="formula">
%Fa = 1 ; %Fb = 1 − %αs
%co = %αs × %Cs + %αb × %Cb × ( 1 − %αs )
%αo = %αs + %αb × ( 1 − %αs )
</pre>


			</section>
			<section id="porterduffcompositingoperators_dstover">
<h4 title="Destination Over">9.1.5. `destination-over^v</h4>

<p>
~sourceの上に~destが置いたものが，結果に現れる。
◎
Destination is placed over the source.
</p>

<!-- 
<figure><img
	alt="example of porter duff destination over"
	src="compositing/PD_dst-over.svg"
></figure>
 -->

<table class="comp-table">
<thead><tr><th>~source<th>~dest<th>結果</thead>
<tbody><tr><td><div class="comp-box">
<div class="comp-source"></div>
</div><td><div class="comp-box">
<div class="comp-dest"></div>
</div><td><div class="comp-box">
<div class="comp-source"></div>
<div class="comp-dest"></div>
</div></tbody></table>

<pre class="formula">
%Fa = 1 − %αb ; %Fb = 1
%co = %αs × %Cs × ( 1 − %αb ) + %αb × %Cb
%αo = %αs × ( 1 − %αb ) + %αb
</pre>


			</section>
			<section id="porterduffcompositingoperators_srcin">
<h4 title="Source In">9.1.6. `source-in^v</h4>

<p>
~sourceの中の~destに重合する部分のみが，結果に現れる。
◎
The source that overlaps the destination, replaces the destination.
</p>

<!-- 
<figure><img
	alt="example of porter duff source in"
	src="compositing/PD_src-in.svg"
></figure>
 -->

<table class="comp-table">
<thead><tr><th>~source<th>~dest<th>結果</thead>
<tbody><tr><td><div class="comp-box">
<div class="comp-source"></div>
</div><td><div class="comp-box">
<div class="comp-dest"></div>
</div><td><div class="comp-box">
<div class="comp-both comp-source"></div>
</div></tbody></table>

<pre class="formula">
%Fa = %αb ; %Fb = 0
%co = %αs × %Cs × %αb
%αo = %αs × %αb
</pre>


			</section>
			<section id="porterduffcompositingoperators_dstin">
<h4 title="Destination In">9.1.7. `destination-in^v</h4>

<p>
~destの中の~sourceに重合する部分のみが，結果に現れる。
◎
Destination which overlaps the source, replaces the source.
</p>

<!-- 
<figure><img
	alt="example of porter duff destination in "
	src="compositing/PD_dst-in.svg"
></figure>
 -->

<table class="comp-table">
<thead><tr><th>~source<th>~dest<th>結果</thead>
<tbody><tr><td><div class="comp-box">
<div class="comp-source"></div>
</div><td><div class="comp-box">
<div class="comp-dest"></div>
</div><td><div class="comp-box">
<div class="comp-both comp-dest"></div>
</div></tbody></table>

<pre class="formula">
%Fa = 0 ; %Fb = %αs
%co = %αb × %Cb × %αs 
%αo = %αb × %αs
</pre>


			</section>
			<section id="porterduffcompositingoperators_srcout">
<h4 title="Source Out">9.1.8. `source-out^v</h4>

<p>
~sourceの中の~destに重合しない部分のみが，結果に現れる。
◎
Source is placed, where it falls outside of the destination.
</p>

<!-- 
<figure><img
	alt="example of porter duff source out"
	src="compositing/PD_src-out.svg"
></figure>
 -->

<table class="comp-table">
<thead><tr><th>~source<th>~dest<th>結果</thead>
<tbody><tr><td><div class="comp-box">
<div class="comp-source"></div>
</div><td><div class="comp-box">
<div class="comp-dest"></div>
</div><td><div class="comp-box">
<div class="comp-source"></div>
<div class="comp-dest comp-negate"></div>
</div></tbody></table>

<pre class="formula">
%Fa = 1 − %αb ; %Fb = 0
%co = %αs × %Cs × ( 1 − %αb )
%αo = %αs × ( 1 − %αb )
</pre>


			</section>
			<section id="porterduffcompositingoperators_dstout">
<h4 title="Destination Out">9.1.9. `destination-out^v</h4>

<p>
~destの中の~sourceに重合しない部分のみが，結果に現れる。
◎
Destination is placed, where it falls outside of the source.
</p>

<!-- 
<figure><img
	alt="example of porter duff destination out"
	src="compositing/PD_dst-out.svg"
></figure>
 -->

<table class="comp-table">
<thead><tr><th>~source<th>~dest<th>結果</thead>
<tbody><tr><td><div class="comp-box">
<div class="comp-source"></div>
</div><td><div class="comp-box">
<div class="comp-dest"></div>
</div><td><div class="comp-box">
<div class="comp-dest"></div>
<div class="comp-source comp-negate"></div>
</div></tbody></table>

<pre class="formula">
%Fa = 0 ; %Fb = 1 − %αs
%co = %αb × %Cb × ( 1 − %αs )
%αo = %αb × ( 1 − %αs )
</pre>


			</section>
			<section id="porterduffcompositingoperators_srcatop">
<h4 title="Source Atop">9.1.10. `source-atop^v</h4>

<p>
~sourceの中の~destに重合する部分と, ~destの他の部分が，結果に現れる。
◎
Source which overlaps the destination, replaces the destination. Destination is placed elsewhere.
</p>

<!-- 
<figure><img
	alt="example of porter duff source atop"
	src="compositing/PD_src-atop.svg"
></figure>
 -->

<table class="comp-table">
<thead><tr><th>~source<th>~dest<th>結果</thead>
<tbody><tr><td><div class="comp-box">
<div class="comp-source"></div>
</div><td><div class="comp-box">
<div class="comp-dest"></div>
</div><td><div class="comp-box">
<div class="comp-dest"></div>
<div class="comp-both comp-source"></div>
</div></tbody></table>

<pre class="formula">
%Fa = %αb ; %Fb = 1 − %αs
%co = %αs × %Cs × %αb + %αb × %Cb × ( 1 − %αs )
%αo = %αs × %αb + %αb × ( 1 − %αs )
</pre>


			</section>
			<section id="porterduffcompositingoperators_dstatop">
<h4 title="Destination Atop">9.1.11. `destination-atop^v</h4>

<p>
~destの中の~sourceに重合する部分と, ~sourceの他の部分が，結果に現れる。
◎
Destination which overlaps the source replaces the source. Source is placed elsewhere.
</p>

<!-- 
<figure><img
	alt="example of porter duff destination atop"
	src="compositing/PD_dst-atop.svg"
></figure>
 -->

<table class="comp-table">
<thead><tr><th>~source<th>~dest<th>結果</thead>
<tbody><tr><td><div class="comp-box">
<div class="comp-source"></div>
</div><td><div class="comp-box">
<div class="comp-dest"></div>
</div><td><div class="comp-box">
<div class="comp-source"></div>
<div class="comp-both comp-dest"></div>
</div></tbody></table>

<pre class="formula">
%Fa = 1 − %αb ; %Fb = %αs
%co = %αs × %Cs × ( 1 − %αb ) + %αb × %Cb × %αs
%αo = %αs × ( 1 − %αb ) + %αb × %αs
</pre>


			</section>
			<section id="porterduffcompositingoperators_xor">
<h4 title="XOR">9.1.12. `xor^v</h4>

<p>
~sourceと~destの重合しない部分が 組合わされて，結果に現れる。
◎
The non-overlapping regions of source and destination are combined.
</p>

<!-- 
<figure><img
	alt="example of porter duff xor"
	src="compositing/PD_xor.svg"
></figure>
 -->

<table class="comp-table">
<thead><tr><th>~source<th>~dest<th>結果</thead>
<tbody><tr><td><div class="comp-box">
<div class="comp-source"></div>
</div><td><div class="comp-box">
<div class="comp-dest"></div>
</div><td><div class="comp-box">
<div class="comp-dest"></div>
<div class="comp-source"></div>
<div class="comp-both comp-negate"></div>
</div></tbody></table>

<pre class="formula">
%Fa = 1 − %αb ; %Fb = 1 − %αs
%co = %αs × %Cs × ( 1 − %αb ) + %αb × %Cb × ( 1 − %αs )
%αo = %αs × ( 1 − %αb ) + %αb × ( 1 − %αs )
</pre>


			</section>
			<section id="porterduffcompositingoperators_plus">
<h4 title="Lighter">9.1.13. `lighter^v</h4>

<p>
~sourceと~destの和が，結果に現れる。
~Porter-Duff論文 `PORTERDUFF$r では， “plus” 演算子として定義されている。
◎
Display the sum of the source image and destination image. It is defined in the Porter Duff paper as the plus operator [PORTERDUFF].
</p>

<pre class="formula">
%Fa = 1 ; %Fb = 1
%co = %αs × %Cs + %αb × %Cb ;
%αo = %αs + %αb
</pre>


			</section>
		</section>
		<section id="groupcompositing">
<h3 title="Group compositing behavior with Porter Duff modes">9.2. 各種~Porter-Duff~modeにおける~group合成の挙動</h3>
<!--
id="groupcompositingisolation"
-->

<p>
`隔離group$の中の要素を合成するとき、要素が合成される`初期後景$は，透明な黒色にされる。
~groupの中の最も奥側の要素が，後景に依存する~Porter-Duff合成~演算子 —
`destination$v,
`source-in$v,
`destination-in$v,
`destination-out$v,
`source-atop$v
など
— を利用している場合、合成した結果は空になる。
~group内の後続の要素は、最初の合成結果に合成される。
<!-- ＊ 順次，累積的に？  -->
◎
When compositing the elements within an isolated group, the elements are composited over a transparent black initial backdrop. If the bottom element in the group uses a Porter Duff compositing operator which is dependent on the backdrop, such as destination, source-in, destination-in, destination-out or source-atop, then the result of the composite will be empty. Subsequent elements within the group are composited with the result of the first composite.
</p>

		</section>
	</section>
	<section id="blending">
<h2 title="Blending">10. 混色</h2>

<p>
混色（ blending ）は、合成~~過程の一部分を成すものであり，~source要素と`後景$とが重合する所における色の混合を計算する。
概念的には、~source要素の色が 後景と混色された上で、結果の，色が改変された ~source要素が 後景に合成される。
実施においては，これは一~段階にまとめて遂行されるのが通例である。
混色の計算では、乗算済みの色~値が利用されてはならない。
◎
Blending is the aspect of compositing that calculates the mixing of colors where the source element and backdrop overlap. Conceptually, the colors in the source element are blended in place with the backdrop. After blending, the modified source element is composited with the backdrop. In practice, this is usually all performed in one step. The blending calculations must not use pre-multiplied color values.
</p>

<p class="trans-note">【
すなわち，以下に見られるように、混色の本質的な部分を成す混色~関数 B() には，~alpha（不透明度）は関わらない。
】</p>

<p>
“混合” の公式は、次で定義される：
◎
The "mixing" formula is defined as:
</p>

<pre class="formula">
%Cm = B( %Cb, %Cs )
</pre>

<p>◎
with:
</p>

<table class="params"><tbody>

<tr><th>%Cm
<td>混色した結果の色
◎
Cm: the result color after blending

<tr><th>B
<td>混色を行う公式
◎
B: the formula that does the blending

<tr><th>%Cb
<td>`後景$色
◎
Cb: the backdrop color

<tr><th>%Cs
<td>~source色
◎
Cs: the source color

</tbody></table>

<p>
混色~公式の結果は、色の範囲の最小／最大~値で切詰められなければならない。
◎
The result of the mixing formula must be clamped to the minimum and maximum values of the color range.
</p>

<p>
混合~関数の結果は、後景~alphaにより調整される。
後景が全-不透明ならば、混合~関数の結果がそのまま表示に現れる。
後景に透明度がある場合、最終的な結果は，後景~alphaで制御される重みによる， ~source色と, 混合された色との加重平均になる。
すなわち、結果の色~値は次の様になる：
◎
The result of the mixing function is modulated by the backdrop alpha. A fully opaque backdrop allows the mixing function to be fully realized. A transparent backdrop will cause the final result to be a weighted average between the source color and mixed color with the weight controlled by the backdrop alpha. The value of the new color becomes:
</p>

<pre class="formula">
%Cr = ( 1 − %αb ) × %Cs + %αb × B( %Cb, %Cs )
</pre>

<p>◎
with:
</p>

<table class="params"><tbody>

<tr><th>%Cr
<td>結果の色
◎
Cr: the result color

<tr><th>B
<td>混色を行う公式
◎
B: the formula that does the blending

<tr><th>%Cs
<td>~source色
◎
Cs: the source color

<tr><th>%Cb
<td>`後景$色
◎
Cb: the backdrop color

<tr><th>%αb
<td>`後景$~alpha
◎
αb: the backdrop alpha

</tbody></table>


	<div class="example">

<figure>`blend_background_opacity^dgm

<figcaption>
不透明度が異なるいくつかの緑色 矩形の上に赤色の矩形を置く混色 ~modeの例。
`後景$の不透明度がより小さくなるに伴い，前面に塗られる矩形はより赤くなる。
◎
This example has a red rectangle with a blending mode that is placed on top of a set of green rectangles that have different levels of opacity.
◎
Note how the top rectangle shifts more toward red as the opacity of the backdrop gets smaller.

</figcaption></figure>

</div>


<p class="note">注記：
~sourceと後景が交差する領域における色~値は，次の公式で与えられ、指定された~Porter-Duff合成~公式により合成される。
単純~alpha混色の場合の公式は次の様になる：
◎
Note: The following formula gives the color value in the area where the source and backdrop intersects and then composites with the specified Porter Duff compositing formula. For simple alpha blending, the formula thus becomes:
</p>

<p>
`単純~alpha合成$の公式：
◎
simple alpha compositing:
</p>

<pre class="formula">
%co = %cs + %cb × ( 1 − %αs )
</pre>

<p>
乗算済みでない値による公式は：
◎
written as non-premultiplied:
</p>

<pre class="formula">
%αo × %Co = %αs × %Cs + ( 1 − %αs ) × %αb × %Cb
</pre>

<p>
%Cs を混色による結果
【 上述の Cr 】
に置き換えた
【一般の混色-~modeの場合の】
結果は：
◎
now substitute the result of blending for Cs:
</p>

<pre class="formula">
%αo × %Co = %αs × (( 1 − %αb ) × %Cs + %αb × B( %Cb, %Cs )) + ( 1 − %αs ) × %αb × %Cb
        = %αs × ( 1 − %αb ) × %Cs + %αs × %αb × B( %Cb, %Cs ) + ( 1 − %αs ) × %αb × %Cb
</pre>


		<section id="blendingseparable">
<h3 title="Separable blend modes">10.1. 成分別の混色-~mode</h3>

<p>
結果の各 色~成分が，`後景$と~sourceの対応する色~成分のみから決定される場合
— すなわち，混色~公式が，対応する成分ごとに<strong>別々に</strong>適用される場合 —
その混色-~modeを，成分別と呼ぶ。
◎
A blend mode is termed separable if each component of the result color is completely determined by the corresponding components of the constituent backdrop and source colors — that is, if the mixing formula is applied separately to each set of corresponding components.
</p>

<p>
以下に挙げる各種 混色-~modeは、混色~公式 B( %Cb, %Cs ) を，各 色~成分ごとに適用することになる。
簡単にするため、この節のすべての例では， `source-over$v 合成を利用する。
◎
Each of the following blend modes will apply the blending function B(Cb, Cs) on each of the color components. For simplicity, all the examples in this chapter use source-over compositing.
</p>

`mix-demo^dgm




			<section id="blendingnormal">
<h4 id="valdef-blend-mode-normal" title="normal blend mode">10.1.1. `normal^v 混色-~mode</h4>

<p id="normal">
これが、いかなる混色も行わないことを指定する，既定の値である。
混色~公式は、単純に~source色を選択する。
◎
This is the default attribute which specifies no blending. The blending formula simply selects the source color.
</p>


<pre class="formula">
B( %Cb, %Cs ) = %Cs
</pre>

<figure>`normal^dgm
<figcaption>
想定される描画（左）と利用中の~browserによる表示
</figcaption></figure>


			</section>
			<section id="blendingmultiply">
<h4 id="valdef-blend-mode-multiply" title="multiply blend mode">10.1.2. `multiply^v 混色-~mode</h4>

<p>
~source色と~dest色を乗算する。
◎
The source color is multiplied by the destination color and replaces the destination.
</p>

<p>
結果の色は、どの場所でも，~sourceか~destの暗い方 以下の暗さになる。
どの色も，黒色と `multiply$v した結果は、黒色になる。
どの色も，白色と `multiply$v した結果は、元の色のままになる。
◎
The resultant color is always at least as dark as either the source or destination color. Multiplying any color with black results in black. Multiplying any color with white preserves the original color.
</p>

<pre class="formula">
B( %Cb, %Cs ) = %Cb × %Cs
</pre>

<figure>`multiply^dgm
<figcaption>
想定される描画（左）と利用中の~browserによる表示
</figcaption></figure>


			</section>
			<section id="blendingscreen">
<h4 id="valdef-blend-mode-screen" title="screen blend mode">10.1.3. `screen^v 混色-~mode</h4>

<p>
`後景$色の補色と~source色の補色を乗算した結果の補色をとる。
【補色 — 明度も反転された補色】
◎
Multiplies the complements of the backdrop and source color values, then complements the result.
</p>

<p>
結果の色は、どの場所でも，~sourceか~destの明るい方 以上の明るさになる。
どの色も，白色と `screen$v した結果は白色になる。
どの色も，黒色と `screen$v した結果は元の色のままになる。
その効果は、複数のスライド写真を同じ screen 上に同時に投影したときと同様になる。
◎
The result color is always at least as light as either of the two constituent colors. Screening any color with white produces white; screening with black leaves the original color unchanged. The effect is similar to projecting multiple photographic slides simultaneously onto a single screen.
</p>

<pre class="formula">
B( %Cb, %Cs ) = 1 − ( 1 − %Cb ) × ( 1 − %Cs )
          = %Cb + %Cs − ( %Cb × %Cs )
</pre>

<figure>`screen^dgm
<figcaption>
想定される描画（左）と利用中の~browserによる表示
</figcaption></figure>


			</section>
			<section id="blendingoverlay">
<h4 id="valdef-blend-mode-overlay" title="overlay blend mode">10.1.4. `overlay^v 混色-~mode</h4>

<p>
`後景$の色~値に依存して， `multiply$v するか または `screen$v する
◎
Multiplies or screens the colors, depending on the backdrop color value.
</p>

<p>
~source色を，その光輝と陰影を保全しつつ，
`後景$に overlay する。
`後景$色は置換されないが、`後景$の明度または暗度が反映されるように，~source色と混合される。
◎
Source colors overlay the backdrop while preserving its highlights and shadows. The backdrop color is not replaced but is mixed with the source color to reflect the lightness or darkness of the backdrop.
</p>

<pre class="formula">
B( %Cb, %Cs ) = HardLight( %Cs, %Cb )
</pre>

<p>
`overlay$v は、 `hard-light$v 混色-~modeの反転である。
その公式については， `hard-light$v の定義を見よ。
◎
Overlay is the inverse of the hard-light blend mode. See the definition of hard-light for the formula.
</p>

<figure>`overlay^dgm
<figcaption>
想定される描画（左）と利用中の~browserによる表示
</figcaption></figure>


			</section>
			<section id="blendingdarken">
<h4 id="valdef-blend-mode-darken" title="darken blend mode">10.1.5. `darken^v 混色-~mode</h4>

<p>
`後景$と~source色のより暗い方を選択する。
◎
Selects the darker of the backdrop and source colors.
</p>

<p>
`後景$は、~sourceがより暗い所では~sourceに置換され，他所では不変なままにされる。
◎
The backdrop is replaced with the source where the source is darker; otherwise, it is left unchanged.
</p>

<pre class="formula">
B( %Cb, %Cs ) = min( %Cb, %Cs )
</pre>

<figure>`darken^dgm
<figcaption>
想定される描画（左）と利用中の~browserによる表示
</figcaption></figure>


			</section>
			<section id="blendinglighten">
<h4 id="valdef-blend-mode-lighten" title="lighten blend mode">10.1.6. `lighten^v 混色-~mode</h4>

<p>
`後景$と~source色の，より明るい方を選択する。
◎
Selects the lighter of the backdrop and source colors.
</p>

<p>
`後景$は、~sourceがより明るい所では~sourceに置換され，他所では不変なままにされる。
◎
The backdrop is replaced with the source where the source is lighter; otherwise, it is left unchanged.
</p>

<pre class="formula">
B( %Cb, %Cs ) = max( %Cb, %Cs )
</pre>


<p class="note">注記：
結果が
【色の】
範囲を超過する所では，切り下げられなければならない。
◎
Note: The result must be rounded down if it exceeds the range.
</p>

<figure>`lighten^dgm
<figcaption>
想定される描画（左）と利用中の~browserによる表示
</figcaption></figure>


			</section>
			<section id="blendingcolordodge">
<h4 id="valdef-blend-mode-color-dodge" title="color-dodge blend mode">10.1.7. `color-dodge^v 混色-~mode</h4>

<p>
~source色を反映するように，`後景$色を輝かせる。
黒色による塗りでは，何も変わらない。
◎
Brightens the backdrop color to reflect the source color. Painting with black produces no changes.
</p>

<pre class="formula">
if( %Cb == 0)
    B( %Cb, %Cs ) = 0
else if( %Cs == 1)
    B( %Cb, %Cs ) = 1
else
    B( %Cb, %Cs ) = min( 1, %Cb ÷ ( 1 − %Cs ))
</pre>

<figure>`color-dodge^dgm
<figcaption>
想定される描画（左）と利用中の~browserによる表示
</figcaption></figure>


			</section>
			<section id="blendingcolorburn">
<h4 id="valdef-blend-mode-color-burn" title="color-burn blend mode">10.1.8. `color-burn^v 混色-~mode</h4>

<p>
~source色を反映するように`後景$色を暗くさせる。
白色による塗りでは，何も変わらない。
◎
Darkens the backdrop color to reflect the source color. Painting with white produces no change.
</p>

<pre class="formula">
if( %Cb == 1)
    B( %Cb, %Cs ) = 1
else if( %Cs == 0)
    B( %Cb, %Cs ) = 0
else
    B( %Cb, %Cs ) = 1 − min( 1, ( 1 − %Cb ) ÷ %Cs )
</pre>

<figure>`color-burn^dgm
<figcaption>
想定される描画（左）と利用中の~browserによる表示
</figcaption></figure>


			</section>
			<section id="blendinghardlight">
<h4 id="valdef-blend-mode-hard-light" title="hard-light blend mode">10.1.9. `hard-light^v 混色-~mode</h4>

<p>
~source色~値に依存して，色を乗算するか または `screen$v する。
その効果は、`後景$上に~spotlightをきつく照らしたときと同様になる。
◎
Multiplies or screens the colors, depending on the source color value. The effect is similar to shining a harsh spotlight on the backdrop.
</p>

<pre class="formula">
if( %Cs ≤ 0.5)
    B( %Cb, %Cs ) = Multiply( %Cb, 2 × %Cs )
else
    B( %Cb, %Cs ) = Screen( %Cb, 2 × %Cs − 1)
</pre>

<!--
B(Cb, Cs) = Cb + m (2 Cs - 1)

	m = (Cs <= 0.5) ? Cb : (1 - Cb)
-->

<p>
公式については `multiply$v と `screen$v の定義を見よ。
◎
See the definition of multiply and screen for their formulas.
</p>

<figure>`hard-light^dgm
<figcaption>
想定される描画（左）と利用中の~browserによる表示
</figcaption></figure>


			</section>
			<section id="blendingsoftlight">
<h4 id="valdef-blend-mode-soft-light" title="soft-light blend mode">10.1.10. `soft-light^v 混色-~mode</h4>

<p>
~source色~値に依存して，色を暗くさせるか明るくさせる。
その効果は、`後景$上に拡散~spotlightを照らしたときと同様になる。
◎
Darkens or lightens the colors, depending on the source color value. The effect is similar to shining a diffused spotlight on the backdrop.
</p>

<pre class="formula">
if( %Cs ≤ 0.5)
    B( %Cb, %Cs ) = %Cb − ( 1 − 2 × %Cs ) × %Cb × ( 1 − %Cb )
else
    B( %Cb, %Cs ) = %Cb + ( 2 × %Cs − 1 ) × ( D( %Cb ) − %Cb )
    ここで
    if( %Cb ≤ 0.25)
        D( %Cb ) = (( 16 × %Cb − 12 ) × %Cb + 4 ) × %Cb
    else
        D( %Cb ) = sqrt( %Cb )
</pre>

<figure>`soft-light^dgm
<figcaption>
想定される描画（左）と利用中の~browserによる表示
</figcaption></figure>


			</section>
			<section id="blendingdifference">
<h4 id="valdef-blend-mode-difference" title="difference blend mode">10.1.11. `difference^v 混色-~mode</h4>

<p>
2 つの色の，より明るい方の色からより暗い方の色を減算する。
◎
Subtracts the darker of the two constituent colors from the lighter color.
</p>

<p>
白色による塗りは，`後景$色を反転させる。
黒色による塗りでは，何も変わらない。
◎
Painting with white inverts the backdrop color; painting with black produces no change.
</p>

<pre class="formula">
B( %Cb, %Cs ) = abs( %Cb − %Cs )
</pre>

<figure>`difference^dgm
<figcaption>
想定される描画（左）と利用中の~browserによる表示
</figcaption></figure>


			</section>
			<section id="blendingexclusion">
<h4 id="valdef-blend-mode-exclusion" title="exclusion blend mode">10.1.12. `exclusion^v 混色-~mode</h4>

<p>
`difference$v ~modeと同様の効果を生産するが、~contrastは弱くなる。
白色による塗りでは，`後景$色を反転させる。
黒色による塗りでは，何も変わらない。
◎
Produces an effect similar to that of the Difference mode but lower in contrast. Painting with white inverts the backdrop color; painting with black produces no change
</p>

<pre class="formula">
B( %Cb, %Cs ) = %Cb + %Cs − 2 × %Cb × %Cs
</pre>

<figure>`exclusion^dgm
<figcaption>
想定される描画（左）と利用中の~browserによる表示
</figcaption></figure>


			</section>
		</section>
		<section id="blendingnonseparable">
<h3 title="Non-separable blend modes">10.2. 成分別でない混色-~mode</h3>

<p>
成分別でない混色-~modeでは、成分ごとに個別に扱わずに，すべての色~成分の組合せを考慮する。
これらすべての混色-~modeは、概念的には，次の手続きを要する：
◎
Nonseparable blend modes consider all color components in combination as opposed to the separable ones that look at each component individually. All of these blend modes conceptually entail the following steps:
</p>

<ol>
	<li>
`後景$と~source色を，混色の色~空間から中間処理のための［
色相, 彩度, 光度
］による表現に変換する。
◎
Convert the backdrop and source colors from the blending color space to an intermediate hue-saturation-luminosity representation.
</li>
	<li>
`後景$と~sourceの色から選択される［
色相, 彩度, 光度
］成分の何らかの組合せを基に，新たな色を作る。
◎
Create a new color from some combination of hue, saturation, and luminosity components selected from the backdrop and source colors.
</li>
	<li>
その結果を逆~変換して元の色~空間に戻す。
◎
Convert the result back to the original color space.
</li>
</ol>

<p>
成分別でない混色-~modeの公式では、いくつかの補助~関数を用いる：
◎
The nonseparable blend mode formulas make use of several auxiliary functions:
</p>

<pre class="formula">
Lum( %C ) := 0.3 × %C.red + 0.59 × %C.green + 0.11 × %C.blue
Max( %C ) := max( %C.red, %C.green, %C.blue )
Min( %C ) := min( %C.red, %C.green, %C.blue )

ClipColor( %C ) {
    %L = Lum( %C )
    %max := Max( %C )
    %min := Min( %C )
    if( %min &lt; 0 )
        %C.red   = %L + ( %C.red   − %L ) × %L ÷ ( %L − %min )
        %C.green = %L + ( %C.green − %L ) × %L ÷ ( %L − %min )
        %C.blue  = %L + ( %C.blue  − %L ) × %L ÷ ( %L − %min )

    if( %max &gt; 1 )
        %C.red   = %L + ( %C.red   − %L ) × ( 1 − %L ) ÷ ( %max − %L )
        %C.green = %L + ( %C.green − %L ) × ( 1 − %L ) ÷ ( %max − %L )
        %C.blue  = %L + ( %C.blue  − %L ) × ( 1 − %L ) ÷ ( %max − %L )

    return %C
}

SetLum( %C, %l ) {
    %d = %l − Lum( %C )
    %C.red   += %d
    %C.green += %d
    %C.blue  += %d
    return ClipColor( %C )
}

Sat( %C ) := Max( %C ) − Min( %C )
</pre>
<!-- 
L = min
0.3 R + 0.59 G + 0.11 B == R
0.59 G + 0.11 B == 0.7R < 0


Lum(C) = 0.3 x Cred + 0.59 x Cgreen + 0.11 x Cblue

ClipColor(C)
	L = Lum(C)
	n = min(Cred, Cgreen, Cblue)
	x = max(Cred, Cgreen, Cblue)
	if(n < 0)
		C = L + (((C - L) * L) / (L - n))

	if(x > 1)
		C = L + (((C - L) * (1 - L)) / (x - L))

	return C

SetLum(C, l)
	d = l - Lum(C)
	Cred = Cred + d
	Cgreen = Cgreen + d
	Cblue = Cblue + d
	return ClipColor(C)

Sat(C) = max(Cred, Cgreen, Cblue) - min(Cred, Cgreen, Cblue)

-->


<p>
次の関数の［
.min, .mid, .max
］は、それぞれ，関数に入った時点で値が［
最小, 中央, 最大
］の異なる色~成分を指すとする。
◎
The subscripts min, mid, and max in the next function refer to the color components having the minimum, middle, and maximum values upon entry to the function.
</p>

<pre class="formula">
SetSat( %C, %s ) {
    if( %C.max &gt; %C.min )
        %C.mid = (( %C.mid − %C.min ) ÷ ( %C.max − %C.min )) × %s
        %C.max = %s
    else
        %C.mid = %C.max = 0
    %C.min = 0
    return %C
}
</pre>


			<section id="blendinghue">
<h4 id="valdef-blend-mode-hue" title="hue blend mode">10.2.1. `hue^v 混色-~mode</h4>

<p>
~source色の色相, `後景$色の彩度と光度を伴う色を作る。
◎
Creates a color with the hue of the source color and the saturation and luminosity of the backdrop color.
</p>

<pre class="formula">
B( %Cb, %Cs ) = SetLum(SetSat( %Cs, Sat( %Cb )), Lum( %Cb ))
</pre>

<figure>`hue^dgm
<figcaption>
想定される描画（左）と利用中の~browserによる表示
</figcaption></figure>


			</section>
			<section id="blendingsaturation">
<h4 id="valdef-blend-mode-saturation" title="saturation blend mode">10.2.2. `saturation^v 混色-~mode</h4>

<p>
~source色の彩度, `後景$色の色相と光度を伴う色を作る。
この~modeによる，`後景$の中の純粋な灰色（彩度なし）領域に対する塗りでは、何も変わらない。
◎
Creates a color with the saturation of the source color and the hue and luminosity of the backdrop color. Painting with this mode in an area of the backdrop that is a pure gray (no saturation) produces no change.
</p>

<pre class="formula">
B( %Cb, %Cs ) = SetLum(SetSat( %Cb, Sat( %Cs )), Lum( %Cb ))
</pre>

<figure>`saturation^dgm
<figcaption>
想定される描画（左）と利用中の~browserによる表示
</figcaption></figure>


			</section>
			<section id="blendingcolor">
<h4 id="valdef-blend-mode-color" title="color blend mode">10.2.3. `color^v 混色-~mode</h4>

<p>
~source色の色相と彩度, `後景$色の光度を伴う色を作る。
これは、`後景$の灰色~levelを保全し，~monochrome画像の色付けや, ~color画像の色彩強調（ tinting ）に有用になる。
◎
Creates a color with the hue and saturation of the source color and the luminosity of the backdrop color. This preserves the gray levels of the backdrop and is useful for coloring monochrome images or tinting color images.
</p>

<pre class="formula">
B( %Cb, %Cs ) = SetLum( %Cs, Lum( %Cb ))
</pre>

<figure>`color^dgm
<figcaption>
想定される描画（左）と利用中の~browserによる表示
</figcaption></figure>


			</section>
			<section id="blendingluminosity">
<h4 id="valdef-blend-mode-luminosity" title="luminosity blend mode">10.2.4. `luminosity^v 混色-~mode</h4>

<p>
~source色の光度，および`後景$色の色相と彩度を伴う色を作る。
これは、 `color$v ~modeの反転 効果を生産する。
◎
Creates a color with the luminosity of the source color and the hue and saturation of the backdrop color. This produces an inverse effect to that of the Color mode.
</p>

<pre class="formula">
B( %Cb, %Cs ) = SetLum( %Cb, Lum( %Cs ))
</pre>

<figure>`luminosity^dgm
<figcaption>
想定される描画（左）と利用中の~browserによる表示
</figcaption></figure>

			</section>
		</section>
		<section id="isolationblending">
<h3 title="Effect of group isolation on blending">10.3. 混色における~group隔離の効果</h3>


<div class="example">
<p>
次の例では，図左の紙飛行機を構築するために利用されている要素は 通常の~group,
図右の紙飛行機は`隔離group$に属し、いずれも，混色-~modeは
`multiply$v
に設定されているとする。
◎
Note: In the following example, the elements used to construct the paper airplane are within a group. Each of these elements has their blend mode set to multiply.
◎
The airplane on the left is a normal group, the airplane on the right is an isolated group.
</p>

<p>
図右の`隔離group$においては、~group内の要素は，空（から）の`初期後景$上に合成されるので、図の地面と~~空（そら）が描かれた後景（以下 %B と記す）とは乗算されない。
図左の通常の~groupにおいては、~group内の要素は，
<!-- ＊ 個別的ではなく ~group一体として？ -->
%B 上に合成されるので、 %B で乗算される。
両者とも，~group合成の結果は、
`mix-blend-mode$p に `normal$v
（~groupに適用される既定の `mix-blend-mode$p ）を用いて，%B 上に合成される。
◎
In the isolated group, the elements within the group are composited onto an empty initial backdrop, this stops the elements within the group multiplying with the backdrop. In the normal group, the elements within the group are composited onto the initial backdrop containing the land and sky. Therefore the elements of the airplane multiply with the land and sky. In both instances, the result of the group composite is composited onto the land and sky using the normal mix-blend-mode (the default mix-blend-mode applied to the group).
</p>

<figure>`isolate_blend_example^dgm</figure>


</div>


		</section>
	</section>
	<section id="security">
<h2 title="Security issues with compositing and blending">11. 合成と混色に伴う~security上の課題</h2>

<p>
混色と合成の演算にかかる時間は、~sourceと~destの画素に依存しないことが重要である。
画素の値に関わらず、演算にかかる時間は一定になるように実装されなければならない。
◎
It is important that the timing to the blending and compositing operations is independent of the source and destination pixel. Operations must be implemented in such a way that they always take the same amount of time regardless of the pixel values.
</p>

<div class="note">
<p>
この規則に沿わない場合、攻撃者が情報を推測したり, 計時攻撃を仕掛けることが可能になる。
◎
If this rule is not followed, an attacker could infer information and mount a timing attack.
</p>

<p>
計時攻撃は、演算にかかる時間を調査して，保護されている内容についての情報を取得する手法である。
例えば、赤色の画素を描く時間が緑色の画素より長くかかるとき、要素の内容への~accessを要することなく，描画された要素の大まかな画像を再構成し得る。
◎
A timing attack is a method of obtaining information about content that is otherwise protected, based on studying the amount of time it takes for an operation to occur. If, for example, red pixels took longer to draw than green pixels, one might be able to reconstruct a rough image of the element being rendered, without ever having access to the content of the element.
</p>

</div>


	</section>


	<section id="changes">
<h2 title="Changes">12. 変更点</h2>

<p>
<a href="http://www.w3.org/TR/2014/CR-compositing-1-20140220/">2014 年 2 月 20 日付 勧告候補</a>
から、次の変更が加えられた：
◎
The following changes were made relative to the Candidate Recommendation of 20 February 2014:
</p>

<ul>
	<li>
<code>img</code> 要素で埋込まれた SVG 画像に対する，
`isolation$p の強制は、~risk下でなくなった。
◎
force isolation of SVG images embedded as &lt;img&gt; no longer at risk
</li>
	<li>
`composite-mode$t から `destination$v の選択肢を除去した。
◎
removed destination as an option for &lt;composite-mode&gt;
</li>
</ul>


<p>
<a href="http://www.w3.org/TR/2013/WD-compositing-1-20131010/">2014 年 1 月 7 日付 最終草案</a>
から、次の変更が加えられた：
◎
The following changes were made relative to the Last Call Working draft of 7 January 2014:
</p>

<ul>
	<li>
不要な参照文献を除去した。
◎
unneeded normative and informative references were removed
</li>
</ul>

<p>
<a href="http://www.w3.org/TR/2013/WD-compositing-1-20131010/">2013 年 10 月 10 日付 最終草案</a>
から、次の変更が加えられた：
◎
The following changes were made relative to the Last Call Working draft of 10 October 2013:
</p>


<ul>
	<li>
knockout を、規範的でない節から除去した。
◎
knockout was removed from the non-normative section
</li>
	<li>
SVG についての段落を，単純~alpha合成から除去した
◎
removed paragraph on SVG from simple alpha compositing
</li>
	<li>
CSS を含むように要約を更新し，意図を明確化した。
◎
updated abstract to include CSS and clarify intent
</li>
	<li>
clip-to-self とその参照文献を除去した。
◎
removed clip-to-self and its references
</li>
	<li>
5-10 節を規範的に変更。 
それらの節の注記／例を明確化した。
◎
Changed section 5-10 to be normative + clarified notes/examples in those sections
</li>
</ul>

<p>
<a href="http://www.w3.org/TR/2013/WD-compositing-1-20130625/">2013-06-25 草案</a>
から、次の変更が加えられた：
◎
The following changes were made relative to the Working Draft of 2013-06-25:
</p>

<ul>
	<li>
SVG において`隔離group$を作成する演算子の一つ， clipping を、除去した。
◎
clipping was removed as one of the operators that creates an isolated group in SVG
</li>
	<li>
`background-blend-mode$p を，他の `background-*^p 構文における繰り返しの挙動と合致するように変更。
◎
background-blend-mode was changed so it matches repeating behavior of other background syntaxes.
</li>
	<li>
`mix-composite^p ~propを除去した。
◎
The mix-composite property was removed
</li>
	<li>
すべての open 課題は，解決された。
◎
all open issues were resolved
</li>
</ul>

	</section>

</main></div><!-- MAIN -->
