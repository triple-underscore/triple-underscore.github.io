<!DOCTYPE html><html lang="ja"><head><meta charset="utf-8">
<title>Compositing and Blending Module Level 1 （日本語訳）</title>

<link rel="stylesheet" href="common.css" type="text/css">
<link rel="stylesheet" href="common-css.css" type="text/css">
<style>

figure {
	background: var(--W-color);
}

pre.formula {
	margin-left: 2em;
	padding: 0.5em;
	background: var(--C-bg);
	font-family: sans-serif0, sans-serif;
	line-height: 1.6em;
}

.params {
	margin-left: 2em;
}

.comp-table {
	border-collapse:separate;
	margin-left: 2em;
}

.comp-box {
	position:relative;
	width: 120px;
	height: 120px;
	border: thin solid var(--K-color);
}

.comp-box > div {
	position: absolute;
	top: 0;
	left: 0;
}

.comp-source {
	width: 60%;
	height: 100%;
	background: rgb(104, 199, 232);
}

.comp-dest {
	width: 100%;
	height: 40%;
	background: rgb(255, 220, 0);
}

.comp-both {
	width: 60%;
	height: 40%;
}

.comp-box, .comp-negate {
	background: white;
	background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAgAAAAICAYAAADED76LAAAAGklEQVQYlWP4jwamTZuGghnooABdAB3QQQEAIlnXoZ5sWUwAAAAASUVORK5CYII=);
}

.compositing-sample {
	background: url(data:image/svg+xml;base64,PHN2Zw0KCXZlcnNpb249IjEuMSINCgl4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciDQoJd2lkdGg9IjE4cHgiIGhlaWdodD0iMThweCINCgl2aWV3Qm94PSItOSAtOSAxOCAxOCINCj4NCjxwYXRoIGZpbGw9IiNGRkZGRkYiIGQ9Ik0wLDAgaDkgdi05IGgtOSB6IGgtOSB2OSBoOSB6IiAvPg0KPHBhdGggZmlsbD0iI0UwRTBFMCIgZD0iTTAsMCBoOSB2OSBoLTkgeiBoLTkgdi05IGg5IHoiIC8+DQo8L3N2Zz4NCg==);
}


.mix-demo {
	display: inline-block;
	margin-left: 1em;
	width: 200px;
	height:200px;
	isolation: isolate;
	background: url(compositing/backdrop.png);
	background-repeat: repeat;
}
.mix-demo > img {
	width: 200px;
	height:200px;
}

#_dgm-blend_background_opacity {
	position: relative;
	height: 16em;
	min-width: 24em;
}
#_dgm-blend_background_opacity > div {
	position: absolute;
	width: 12em;
	height: 4em;
	left: 0.5em;
}
#_dgm-blend_background_opacity > div > div {
	position: absolute;
	width: 8em;
	height: 100%;
	left: 2em;
}
#_dgm-blend_background_opacity > div > span {
	position: absolute;
	left: 14em;
	line-height: 4em;
	white-space: nowrap;
}

</style>

<script src="common0.js"></script>
<script src="common1.js" async></script>

<script>

Util.ready = function(){
	const source_data = {
		generate: expand
	};
	source_data.collectParts = (parts) => {
		[
'simple_box',
'two_box',
'two_box_transparency',
'two_box_transparency_both',
'simple_backdrop',
'simple_backdrop_alpha'
		].forEach( (id) => {
			e = parts['_dgm-' + id];
			if(e) {
				e.className = 'compositing-sample';
			}
		})
	};

	Util.switchWordsInit(source_data);
}

function expand(){
	const class_map = this.class_map;
	const tag_map = this.tag_map;
	const link_map = this.link_map;

	return this.html.replace(
		/%[α\w]+|`(.*?)([$@^])(\w*)/g,
		create_html
	);


	function create_html(match, key, indicator, klass){
if(!indicator) {//%
	if(match.length === 3) {
		return `<var>${match[1]}</var><sub>${match[2]}</sub>`;
	}
	return `<var>${match.slice(1)}</var>`;
}

let href = '';
let href1 = '';
{
	const n = key.indexOf('＠');
	if(n > 0) {
		href1 = key.slice(n + 1);
		key = key.slice(0, n);
	}
}
let text = key;

switch(klass){
case 'r':
	text = `[${key}]`;
	href = `#biblio-${key.toLowerCase()}`;
	break;
case 'p':
	break;
case 'tp': // property value type
	text = `&lt;'<code class="property">${key}</code>'&gt;`;
	href = link_map[`p.${key}`];
	break;
case 'f':
	text = `${key}()`;
	break;
case 't':
	text = `&lt;${key}&gt;`;
	break;
case 'sec':
	text = `§ ${key}`;
	klass = '';
	break;
case 'en':
	return `<span lang="en">${key}</span>`;
	break;
case 'dgm':
	return `<a id="_dgm-${key}">＊</a>`;
case 'xCode':
	return `<a id="_ex-html-${key}">＊</a>`;
	break;
default:
}

let tag = tag_map[klass];
if(tag) {
	let classname = class_map[klass];
	classname = classname ? ` class="${classname}"` : '';
	text = `<${tag}${classname}>${text}</${tag}>`;
}

if(indicator !== '^'){
	href = href1 || link_map[ klass ? `${klass}.${key}` : key ] || href;
	if(!href){
		console.log(match); // check error
		return match;
	}

	switch(indicator){
	case '$':
		text = `<a href="${href}">${text}</a>`;
		break;
	case '@':
		text = `<dfn id="${href.slice(1)}">${text}</dfn>`;
		break;
	default:
		console.log(match);
		return match;
	}
}

return text;

	}
}
</script>

<script>
Util.DEFERRED.push(mixDemoInit);

function mixDemoInit(){

	E('_reset_mix_demo').addEventListener('click', function(event){
		reset();
	}, false);
	enable_reset(false);

	E('_dgm-mix-demo').addEventListener('dragover', function(event){
		event.preventDefault();// ページ遷移防止
	}, false);
	E('_dgm-mix-demo').addEventListener('drop', function(event){
		event.preventDefault();
		const file = event.dataTransfer.files[0];
		if(!file) return;
		if(file.type.toLowerCase().slice(0, 6) !== 'image/') return;
		const url = window.URL.createObjectURL(file);
		switch(event.target.tagName){
		case 'IMG': // source image
			loadSource(url, event.target);
			break;
		case 'SPAN': // backdrop
			loadBackdrop(url);
			break;
		}
	}, false);
	
	E('_dgm-mix-demo').lastElementChild.style.visibility = null;

	function enable_reset(t){
		const e = E('_reset_mix_demo');
		e.disabled = t ? false : true;
	}

	function loadSource(url, img){
		repeat('.mix-demo > img', function(e){
			e.src = url;
		});
		img.src = url;
		enable_reset(true);
	}

	function loadBackdrop(url){
		repeat('.mix-demo', function(e){
			e.style.background = 'url(' + url + ')';
		});
		enable_reset(true);
	}
	
	function reset(){
		repeat('.mix-demo', function(e){
			e.style.background = '';
			const img = e.firstElementChild || e.previousElementSibling;
			if(img){
				img.src = 'compositing/composite-source.png';
			}
		});
		enable_reset(false);
	}
}
</script>



<script type="text/plain" id="_source_data">


●●options

spec_title:Compositing and Blending Module Level 1
spec_date:2025-12-03
trans_update:2024-04-26
source_checked:240321
page_state_key:CSS
original_url:https://drafts.csswg.org/compositing-1/
spec_status:ED
ref_id_prefix:biblio-
ref_id_lowercase:true
site_nav:paint,css
conformance:css
copyright:2025,permissive
trans_1st_pub:2014-04-05

●●class_map
p:property
css:css
v:value
t:type
tp:type
P:production
e:element
a:attr

●●tag_map
p:code
v:code
f:code
t:var
tp:var
css:code
e:code
a:code
m:code
c:code

●●original_urls
porterduffcompositingoperators_plus_darker:https://drafts.csswg.org/compositing-2/
porterduffcompositingoperators_plus_lighter:https://drafts.csswg.org/compositing-2/

●●original_id_map

clear:
copy:
destination:
source-over:
destination-over:
source-in:
destination-in:
source-out:
destination-out:
source-atop:
destination-atop:
xor:
lighter:
plus-darker:
plus-lighter:


●●mdn_urls
propdef-background-blend-mode:CSS/background-blend-mode
propdef-isolation:CSS/isolation
propdef-mix-blend-mode:CSS/mix-blend-mode

●●link_map


t.blend-mode:#ltblendmodegt
t.isolation-mode:#isolated-propid
t.composite-mode:#compositemode

	t.blend-mode:#ltblendmodegt
	t.composite-mode:#compositemode
	t.isolation-mode:#isolated-propid

m.globalCompositeOperation:~HEcanvas#dom-context-2d-globalcompositeoperation

	~TR/2dcontext2/#dom-context-2d-globalcompositeoperation



p.background-blend-mode:#propdef-background-blend-mode
p.isolation:#propdef-isolation
p.mix-blend-mode:#propdef-mix-blend-mode

p.opacity:~CSSCOLOR#propdef-opacity
p.mask:~MASKING1#propdef-mask
p.background:~CSSBG#propdef-background
p.background-image:~CSSBG#propdef-background-image

	v.isolate:#_isolate

v.destination:#destination
v.clear:#clear
v.copy:#copy
v.source-over:#source-over
v.destination-over:#destination-over
v.source-in:#source-in
v.destination-in:#destination-in
v.source-out:#source-out
v.destination-out:#destination-out
v.source-atop:#source-atop
v.destination-atop:#destination-atop
v.xor:#xor
v.lighter:#lighter
v.plus-darker:#plus-darker
v.plus-lighter:#plus-lighter


	●§
v.normal:#valdef-blend-mode-normal
v.multiply:#valdef-blend-mode-multiply
v.screen:#valdef-blend-mode-screen
v.overlay:#valdef-blend-mode-overlay
v.darken:#valdef-blend-mode-darken
v.lighten:#valdef-blend-mode-lighten
v.color-dodge:#valdef-blend-mode-color-dodge
v.color-burn:#valdef-blend-mode-color-burn
v.hard-light:#valdef-blend-mode-hard-light
v.soft-light:#valdef-blend-mode-soft-light
v.difference:#valdef-blend-mode-difference
v.exclusion:#valdef-blend-mode-exclusion

v.hue:#valdef-blend-mode-hue
v.saturation:#valdef-blend-mode-saturation
v.color:#valdef-blend-mode-color
v.luminosity:#valdef-blend-mode-luminosity

	normal:#blendingnormal
	multiply:#blendingmultiply
	screen:#blendingscreen
	overlay:#blendingoverlay
	darken:#blendingdarken
	lighten:#blendinglighten
	color-dodge:#blendingcolordodge
	color-burn:#blendingcolorburn
	hard-light:#blendinghardlight
	soft-light:#blendingsoftlight
	difference:#blendingdifference
	exclusion:#blendingexclusion
	
	hue:#blendinghue
	saturation:#blendingsaturation
	color:#blendingcolor
	luminosity:#blendingluminosity

e.img:~HEimages#the-img-element
e.body:~HEsections#the-body-element

後景:#backdrop
~group後景:#groupbackdrop
初期~後景:#initialbackdrop

	●§
混色-法:#blending
~group隔離による混色-法に対する効果:#isolationblending
~group不変性:#groupinvariance
~Porter-Duff組成-法:#advancedcompositing
単純~alpha組成-法:#simplealphacompositing
隔離d~group:#isolatedgroups
根~要素~group:#pagebackdrop
根~group:#rootgroup

	隔離d~groupと各種~Porter-Duff~mode:#groupcompositing
	~HTMLに特有な挙動:#csscompositingrules_CSS
	~SVGに特有な挙動:#csscompositingrules_SVG
	組成-法の序論:#whatiscompositing

~level 2:#biblio-compositing-2

	normal:#normal → <p id="normal">
	isolation:#img_isolation

	●用語（CSS

透明な黒:~CSSCOLOR#transparent-black
暗な色~scheme:~CSSCOLORADJUST#dark-color-scheme

包含塊:~CSSDISP#containing-block
根~要素:~CSSDISP#root-element

積層~文脈:~CSS2J#stacking-context

~canvas表面:~CSSBG#canvas-surface
~canvas背景:~CSSBG#canvas-background

	●用語（外部

文書~要素:~DOM4#document-element

~SVG組成~model:~SVGrender#Introduction
	:~SVG11/render.html#Introduction
容器~要素:~SVGstruct#TermContainerElement
	:~SVG11/intro.html#TermContainerElement
~graphics要素:~SVGstruct#TermGraphicsElement
	:~SVG11/intro.html#TermGraphicsElement
~graphicを参照する要素:~SVGstruct#TermGraphicsReferencingElement
	:~SVG11/intro.html#TermGraphicsReferencingElement
	＠~SVG11/masking.html#SimpleAlphaBlending
	＠~TR/css3-color/#alpha

	＠~HEcanvas#2dcontext

●●words_table1


●●words_table

	●色／組成
dest:
	dest:destination
source:
mask::::マスク
	~mask法:masking
切抜き:clipping::切り抜き
	切抜き~path:clip-path
monochrome::::モノクロ
color::::カラー
gradient:
scene::::シーン
spotlight::::スポットライト
alpha:::アルファ
	~group分け:grouping

後景:backdrop::~
背後:behind::~
alpha:::アルファ
隔離d:isolated::隔離
	隔離d~group:isolated group
	隔離d~group:isolating group
重合する:overlapする:重なり合う
重合ng:overlapping:重ね合せ
重合しな:overlapしな:重なり合わな
	重合しない:non-overlapping
	重合しない:fall outside

	単純にする:simplicity
矩形:rectangle:~
	色~付け:coloring
ベタ:solid:~
色相:hue::~
陰影:shadow::~
不透明度:opacity::~
contrast::::コントラスト
暗度:darkness::~
彩度:saturation::~
明度:lightness::~
補色:complement::~

黒:black::~
黒色:black:~
灰色:gray:~
白色:white:~
青色:blue:~
緑色:green:~
黄緑色:lime:~
赤色:red:~

光度:luminosity::~
光輝:highlight::~
透明度:transparency::~
拡散:diffused::~

明な:lightな::明るい
明化-:lighten::明るく
明るさ:lightさ::~
暗な:darkな::暗い
暗化-:darken::暗く
暗さ:darkさ::~
	より暗な:darker
輝かせ:brightenす::~

円:circle:~
幾何的:geometric:~
塗っ:paintし::~
塗られ:paintされ::~
埋めら:fillさ:~
	~~下地になる:is below
数学的:mathematical:~
cross-fade::::クロスフェード
表面:surface::~

	●演算
Porter-Duff:
演算子:operator::~
組成-:composite::~
	組成-法:compositing
	組成-元
	組成-先
組成:compositing::~
	組成 公式／演算子演算
	組成した結果:resultant composite
混色-:blend::~
	混色-法:blending
混色:blending::~
	混色-~mode
	混色 公式／関数
公式:formula:~
割合分:fraction:~
	割合分:fractional term
混合-:mix::~
混合:mixing::~
	混合~関数
	混合~公式→混色~公式
含有率:inclusion::~
交差域:intersection が成す area::~
	area of intersection
面積:area:~
区域:area:~
図形:shape:~
被覆率:coverage::~
覆う:coverする::~
覆わな:coverしな::~
割合:percentage:~
寄与-:contribute:~
寄与分:contribution:~

反転-:invert::~
反転:inverse::~
補助:auxiliary:~

代数:algebra:~
乗算済み:premultiplied::~
加重平均:weighted average:~
切詰める:clampする:切り詰める
減量-:reduce:~
等式:equation:~
成分別:separable:~
成分別の:separableな:~
不変性:invariance:~
投影-:project:~
変調-:modulate:~

	色~成分
	結合法則:
	結合順序:
	combining
	top-level:top level
	^en:knockout
	中間処理:intermediate
	中間段階:gradations
	-:screening
	^v:screen
	^v:overlay

	●CSS／SVG
	-:keyword
graphics::::グラフィックス
積層:stacking::~
	構文:The syntax of the property of
変形:transform::~
	座標系変換:transformation

	●保安
仕掛ける:mountする:~
推定-:infer:~
	調査-:study
	大まかな:rough

	●仕様
同義語:synonymous:~
特質:property:~:::プロパティ
通例:usual:~
最終草案:Last Call Working draft:~
素朴:naive:~
先進的:advanced:~
強化:enhance:~
拡張p-:expand:拡張
参照文献:reference:~

	画期的な:landmark
	不可
	不要な:unneeded
	論文:paper
	様子:how
	モノトスル:shall
	ナラナイ:shall not
	依存:dependent
	必要なだけ:enough
	捉える:seen
	-:express
	要する:entail
	調べら:examine
	公開
	似る
	網羅-:satisfying
	呼ぶ:termed
	雑多な:assorted
	~~転換-:turn into
	扱い:-
	満たす
	満たさ
	要-
	読む
	記-
	記す

	●未分類
絵図:artwork:~
分割0:divide:分割
選択-:select:~
逆算-:reverse:~
再構築-:reconstruct:~
超過-:exceed:~
併合-:merge:~
維持-:retain:~
透過-:show through:~
繰返しの:repeating:繰り返しの
繰返して:repeat して:繰り返して
代用-:substitute::~
最外縁:outermost:~
2D:
3D:
Canvas:
	Canvas ~API用の`~2D文脈$:canvas 2d
記号:symbol:~
最終的な:final:~
全-:fullに:~

	同時に:simultaneous
	~graphicな:graphical
	instance:
	refer
	~alongside
	~in place with
	〜分:amount
	きつく:harsh
	せずに，:as opposed to
	より低い:lower
	弱まる:lower
	より小さく:smaller
	スライド写真:photographic slides
	全体／のみ:complete
	別々に:separately
	右下隅:bottom right corner
	合計の:total
	合計／和:sum
	図:figure
	地点:point
	地点ごとに:particular
	地面と~~空:land and sky
	紙飛行機:airplane
	閉区間:inclusive
	成分ごとに個別に~~扱わずに:separable ones that look at each component individually

	切り下げ:rounded down
	属する:belongs
	得られ:extract
	戻す:back
	指す:points to
	不変なまま:unchanged
	現れない:No 〜 enable
	得られ
	得る
	持-
	描かれ:-
	描く:draw
	満たな
	~~現れ:realized
	現れ
	示-
	置いた
	置き
	置く
	行う
	行わな
	表-
	表す
	戻す
	-:present
	結果に現れる:present／placed
	アヒル:duck
	互いに重なる:on top of each other
	およそ:roughly
	層-化:layer
	中間点:half-way
	全体:full
	全:100%
	左:left
	次の:next
	残る:remaining
	種々の:various
	章:chapter
	前半部分:first part
	後半部分:second part
	一定になる:the same amount
	部分:part
	一部／に属する:part of
	~~中央:middle
	以前の:previous
	地点ごとに:particular
	個数:number
	からなる:consists
	下
	更に
	一つ
	一~段にまとめて:in one step
	一群の:set of
	上述
	他所では:otherwise
	~~仮の
	任意:any
	元
	先
	部分
	更に
	所
	左
	左側
	場合
	場所
	全く
	図右
	図左
	後続-
	後者
	取得-
	入った
	入る
	処理
	単に
	変数
	直前までの:up to but not including
	逆〜:back
	基に
	何も変わらない:no changes
	多い
	奥から
	奥側
	対-
	小さく
	年 月 日
	式:-
	張って:-
	~~形状:geometry
	括弧:-
	数に
	方法
	時点
	様
	渡る
	無い
	語
	成す
	長い
	長く
	関-
	項についての
	順に

	●訳注
	共通
	表示
	逆で
	通り
	選ばれ
	捉え
	冒頭
	全幅
	全高
	収まる
	周辺部
	図式
	利用中の
	移譲
	微小域
	敷き詰め
	本質的
	概念
	考え
	記号
	長方形
	特殊な
	略記-
	見られ
	解り難く
	言及-
	訳
	語感
	自明な
	忠実
	想定-

●●images
＠compositing/
ducky_normal｜height:15rem;｜＝example of an image of duck with the lime color of the document｜.png
ducky_multiply｜height:15rem｜＝example of an image of duck blending with the lime color of the document｜.png
screen_example｜height:15rem;｜＝example of 3 circles blending with a screen blend mode｜.svg
ducky_difference｜height:15rem;｜＝example of an image of duck blending with the lime color of the document｜.png
overlay_text｜height:295px;｜＝example of text that has an overlay blend on top of a texture｜.png
ducky_background_blend｜height:15rem;｜｜.png
simple_box｜height:137px｜｜.svg
two_box｜height:250px｜｜.svg
two_box_transparency｜height:250px｜｜.svg
two_box_transparency_both｜height:px｜｜.svg
simple_backdrop｜height:250px｜｜.svg
simple_backdrop_alpha｜height:300px｜｜.svg
isolate_blend_example｜height:200px｜｜.png

●●html_code_list
■mix-blend-mode-1
<body>
   <img src="ducky.png"/>
</body>

■mix-blend-mode-2
<svg>
  <circle cx="40" cy="40" r="40" fill="red"/>
  <circle cx="80" cy="40" r="40" fill="lime"/>
  <circle cx="60" cy="80" r="40" fill="blue"/>
</svg>

■mix-blend-mode-3
<body>
  <div>
     <img src="ducky.png"/>
  </div>
</body>

■mix-blend-mode-4
<body>
   <div>
     <p>overlay blending on text</p>
   </div>
</body>

■background-blend-mode-1
<body>
   <div></div>
</body>

■plus-lighter-1
<div class="container">
  <div class="from"></div>
  <div class="to"></div>
</div>

●●ref_key_map
CSS3BG:CSSBACKGROUNDS3

●●ref_normative

[CSS-COLOR-4]
    Chris Lilley; Tab Atkins Jr.; Lea Verou. ＜CSS Color Module Level 4＞. URL: https://drafts.csswg.org/css-color-4/
[CSS-MASKING-1]
    Dirk Schulze; Brian Birtles; Tab Atkins Jr.. ＜CSS Masking Module Level 1＞. URL: https://drafts.csswg.org/css-masking-1/
[CSS-VALUES-4]
    Tab Atkins Jr.; Elika Etemad. ＜CSS Values and Units Module Level 4＞. URL: https://drafts.csswg.org/css-values-4/
[CSS21]
    Bert Bos; et al. ＜Cascading Style Sheets Level 2 Revision 1 (CSS 2.1) Specification＞. URL: https://drafts.csswg.org/css2/
[CSS3BG]
    Elika Etemad; Brad Kemper. ＜CSS Backgrounds and Borders Module Level 3＞. URL: https://drafts.csswg.org/css-backgrounds/
[HTML]
    Anne van Kesteren; et al. ＜HTML Standard＞. Living Standard. URL: https://html.spec.whatwg.org/multipage/
[RFC2119]
    S. Bradner. ＜Key words for use in RFCs to Indicate Requirement Levels＞. March 1997. Best Current Practice. URL: https://datatracker.ietf.org/doc/html/rfc2119
[SVG11]
    Erik Dahlström; et al. ＜Scalable Vector Graphics (SVG) 1.1 (Second Edition)＞. 16 August 2011. REC. URL: https://www.w3.org/TR/SVG11/

●●ref_informative

[PORTERDUFF]
    Thomas Porter; Tom Duff. ＜Compositing digital images＞. July 1984.

●●ref_additional
[COMPOSITING-2]
    ＜Compositing and Blending Module Level 2＞. Editor's Draft. URL: https://drafts.csswg.org/compositing-2/


●●trans_metadata
<p>
~THIS_PAGEは、
W3C により編集者草案として公開された
<a href="~SPEC_URL">Compositing and Blending Module Level 1</a>
を日本語に翻訳したものです。
~PUB
</p>

●●spec_metadata

最新公表バージョン
	https://www.w3.org/TR/compositing-1/
公表履歴
	https://www.w3.org/standards/history/compositing-1/
実装報告
	https://wpt.fyi/results/css/compositing
フィードバック
	<a href="https://github.com/w3c/csswg-drafts/labels/compositing-1">CSSWG Issues Repository</a>
編集
	<a href="mailto:chrishtr@chromium.org">Chris Harrelson</a> (Google Inc.)
前任編集者
	Rik Cabanier (then of Adobe Systems Inc.)
	<a href="mailto:Nikos.Andronikos@cisra.canon.com.au">Nikos Andronikos</a> (Canon Information Systems Research Australia)
Suggest an Edit for this Spec
	<a href="https://github.com/w3c/csswg-drafts/blob/main/compositing-1/Overview.bs">GitHub Editor</a>
テスト一式
	https://wpt.fyi/results/css/compositing/
commit 履歴
	https://github.com/w3c/csswg-drafts/commits/main/compositing-1/
commit 履歴（旧）
	https://github.com/w3c/fxtf-drafts/commits/main/compositing-1/

</script>

</head>

<body>

<!--%resource pool -->
<template id="_persisted_parts">

<!-- 
<div id="_dgm-PD_regions"><img
	alt="overview of the regions affected by porter duff"
	src="compositing/PD_regions.svg"></div>
-->

<div id="_dgm-blend_background_opacity"
	title="不透明度を伴って混色した例／example of blending with opacity"
>
<div style="top:0; height:100%; background:transparent"
><div style="background:#FF0000"></div></div>
<div style="top:0.5em; background:#00FF00"
><div style="background:#FFFF00"></div><span>RGB(0, 1, 0)</span></div>
<div style="top:5.5em; background:#7FFF7F"
><div style="background:#FF8000"></div><span>RGB(0, 1, 0, .5)</span></div>
<div style="top:10.5em; background:#E5FFE5"
><div style="background:#FF1A00"></div><span>RGB(0, 1, 0, .1)</span></div>
</div>

<!-- 
<div id="_dgm-blend_background_opacity"><img
	src="compositing/blend_background_opacity.svg"
	alt="example of blending with opacity"
></div>
<div id="_dgm-composite-source"><img
	src="compositing/composite-source.png"
	width="200"
	height="200"
></div>
-->

<div id="_dgm-mix-demo" class="trans-note">
<figure><figcaption>
以下の例に利用される source 画像（左）と後景
<input type="button" value="元に戻す" id="_reset_mix_demo" />
</figcaption>
<img
	src="compositing/composite-source.png"
	width="200"
	height="200"
>
<span class="mix-demo"></span>
</figure>

<p style="visibility: hidden;">
上の画像区画に画像をドラッグすると、
以下の例のブラウザ表示を変更できる。
<small>source （左）にドロップした画像は収まるように拡縮され，後景（右）にドロップした画像は拡縮されずに敷き詰められる。</small>
</p>
</div>


<div id="_dgm-normal"><img
	src="compositing/normal.png"
	alt="example of normal blending"
><span class="mix-demo"><img
	src="compositing/composite-source.png"
	style="mix-blend-mode: normal;"
	alt=""
></span></div>

<div id="_dgm-multiply"><img
	src="compositing/multiply.png"
	alt="example of multiply blending"
><span class="mix-demo"><img
	src="compositing/composite-source.png"
	style="mix-blend-mode: multiply;"
	alt=""
></span></div>

<div id="_dgm-screen"><img
	src="compositing/screen.png"
	alt="example of screen blending"
><span class="mix-demo"><img
	src="compositing/composite-source.png"
	style="mix-blend-mode: screen;"
	alt=""
></span></div>

<div id="_dgm-overlay"><img
	src="compositing/overlay.png"
	alt="example of overlay blending"
><span class="mix-demo"><img
	src="compositing/composite-source.png"
	style="mix-blend-mode: overlay;"
	alt=""
></span></div>

<div id="_dgm-darken"><img
	src="compositing/darken.png"
	alt="example of darken blending"
><span class="mix-demo"><img
	src="compositing/composite-source.png"
	style="mix-blend-mode: darken;"
	alt=""
></span></div>

<div id="_dgm-lighten"><img
	src="compositing/lighten.png"
	alt="example of lighten blending"
><span class="mix-demo"><img
	src="compositing/composite-source.png"
	style="mix-blend-mode: lighten;"
	alt=""
></span></div>

<div id="_dgm-color-dodge"><img
	src="compositing/colordodge.png"
	alt="example of color dodge blending"
><span class="mix-demo"><img
	src="compositing/composite-source.png"
	style="mix-blend-mode: color-dodge;"
	alt=""
></span></div>

<div id="_dgm-color-burn"><img
	src="compositing/colorburn.png"
	alt="example of color burn blending"
><span class="mix-demo"><img
	src="compositing/composite-source.png"
	style="mix-blend-mode: color-burn;"
	alt=""
></span></div>

<div id="_dgm-hard-light"><img
	src="compositing/hardlight.png"
	alt="example of hard light blending"
><span class="mix-demo"><img
	src="compositing/composite-source.png"
	style="mix-blend-mode: hard-light;"
	alt=""
></span></div>

<div id="_dgm-soft-light"><img
	src="compositing/softlight.png"
	alt="example of soft light blending"
><span class="mix-demo"><img
	src="compositing/composite-source.png"
	style="mix-blend-mode: soft-light;"
	alt=""
></span></div>

<div id="_dgm-difference"><img
	src="compositing/difference.png"
	alt="example of difference blending"
><span class="mix-demo"><img
	src="compositing/composite-source.png"
	style="mix-blend-mode: difference;"
	alt=""
></span></div>

<div id="_dgm-exclusion"><img
	src="compositing/exclusion.png"
	alt="example of exclusion blending"
><span class="mix-demo"><img
	src="compositing/composite-source.png"
	style="mix-blend-mode: exclusion;"
	alt=""
></span></div>

<div id="_dgm-hue"><img
	src="compositing/hue.png"
	alt="example of hue blending"
><span class="mix-demo"><img
	src="compositing/composite-source.png"
	style="mix-blend-mode: hue;"
	alt=""
></span></div>

<div id="_dgm-saturation"><img
	src="compositing/saturation.png"
	alt="example of saturation blending"
><span class="mix-demo"><img
	src="compositing/composite-source.png"
	style="mix-blend-mode: saturation;"
	alt=""
></span></div>

<div id="_dgm-color"><img
	src="compositing/color.png"
	alt="example of color blending"
><span class="mix-demo"><img
	src="compositing/composite-source.png"
	style="mix-blend-mode: color;"
	alt=""
></span></div>

<div id="_dgm-luminosity"><img
	src="compositing/luminosity.png"
	alt="example of luminosity blending"
><span class="mix-demo"><img
	src="compositing/composite-source.png"
	style="mix-blend-mode: luminosity;"
	alt=""
></span></div>

</template>

<header>
	<hgroup>
<h1>色の組成法と混色法 — Compositing and Blending Module Level 1</h1>
	</hgroup>
</header>

<div id="MAIN" hidden>

	<section id="abstract">
◎要約

<p>
Compositing （組成-法）は、
異なるいくつかの要素の図形を単独の画像の中へ組合せる方法を述べる。
組成-法には種々の~approachがあり得る。
~SVGと~CSSの以前の~versionでは、
`単純~alpha組成-法＠~SVG11/masking.html#SimpleAlphaBlending$ `SVG11$r が利用されていた。
この~modelでは、
各~要素は自前の~bufferに描画された上で，
~Porter-Duff `source-over$v 演算子を利用して `後景$に併合されていた。
この仕様は、
この単純~alpha組成~modelを拡張pして，
新たな組成~modelを定義する
— 次を提供することにより：
◎
Compositing describes how shapes of different elements are combined into a single image. There are various possible approaches for compositing. Previous versions of SVG and CSS used Simple Alpha Compositing. In this model, each element is rendered into its own buffer and is then merged with its backdrop using the Porter Duff source-over operator. This specification will define a new compositing model that expands upon the Simple Alpha Compositing model by offering:
</p>

<ul>
	<li>
追加的な~Porter-Duff組成~演算子
◎
additional Porter Duff compositing operators
</li>
	<li>
より先進的な混色~mode（ `blending mode^en ）
— それは、
図形が重合する区域で色を混合する方法を制御することを許容する
◎
advanced blending modes which allow control of how colors mix in the areas where shapes overlap
</li>
	<li>
組成~group
◎
compositing groups
</li>
</ul>

<p>
加えて，この仕様は、
混色-法と~group隔離~用の~CSS~prop, および
`globalCompositeOperation$m 属性の~propを定義する。
◎
In addition, this specification will define CSS properties for blending and group isolation and the properties of the globalCompositeOperation attribute.
</p>

~CSSisaLANG

	</section>
	<section id="sotd">
◎位置付け

<p>
これは、
編集者草案の公な複製です…
【以下，この節を成す内容は、~SOTD-CSSに移譲。】
</p>

	</section>

<main id="MAIN0">

	<section id="introduction">
<h2 title="Introduction">1. 序論</h2>

◎非規範的

<p>
この文書の前半部分では、
~CSSにおける組成-法を制御するための各種~propについて述べる。
後半部分では、
~Porter-Duff組成-法, および混色-法の，~algoについて述べる。
◎
The first part of this document describes the properties used to control the compositing in CSS. The second part will describe the algorithms of Porter Duff compositing and blending.
</p>

	</section>
	<section id="reading-this-document">
<h2 title="Reading This Document">2. この文書を読むにあたって</h2>

<p>
他から指定されない限り、
この文書の各~節は規範的とする。
◎
Each section of this document is normative unless otherwise specified.
</p>

		<section id="module-interactions">
<h3 title="Module interactions">2.1. ~module間の相互作用</h3>

<p>
この仕様は、
一群の~CSS~propを定義する。
それらは、
それらが適用される要素の視覚的な描画に影響する。
これらの効果は、［
要素が
`CSS21$r `§ 視覚-整形~model＠~CSS2J#visuren$
に則って~sizeされ, 位置された後
］に適用される。
これらの~propの一部の値による結果，`包含塊$や`積層~文脈$が作成される場合がある。
◎
This specification defines a set of CSS properties that affect the visual rendering of elements to which those properties are applied; these effects are applied after elements have been sized and positioned according to the Visual formatting model from [CSS21]. Some values of these properties result in the creation of a containing block, and/or the creation of a stacking context.
</p>

<p>
`background-blend-mode$p ~propは、
`CSS3BG$r にて`定義される~prop＠~CSSBG#placement$を基に築かれている。
◎
The background-blend-mode property also builds upon the properties defined in the CSS Backgrounds and Borders module [CSS3BG].
</p>

<p>
この仕様は、［
`SVG11$r にて指定される`単純~alpha組成-法＠~SVG11/masking.html#SimpleAlphaBlending$
］と［
`CSS-COLOR-4$r による`単純~alpha組成-法＠~CSSCOLOR#alpha$
］の規則も強化する。
◎
This specification also enhances the rules as specified in Section 14.2 Simple alpha compositing of [SVG11] and simple alpha compositing of [CSS-COLOR-4].
</p>

<p>
この~moduleは、
`globalCompositeOperation$m も拡張する。
◎
This module also extends the globalCompositeOperation attribute.
</p>

		</section>
		<section id="values">
<h3 title="Values">2.2. 値</h3>

<p class="trans-note">【
この節の内容は、
`~CSS日本語訳 共通~page＠~CSScommon#values$に移譲
】</p>

		</section>
	</section>
	<section id="csscompositingandblending">
<h2 title="Specifying Blending in CSS">3. ~CSSにおける混色-法の指定-法</h2>

		<section id="compositingandblendingorder">
<h3 title="Order of graphical operations">3.1. ~graphicな演算の順序</h3>

<p>
組成~modelは `~SVG組成~model$ `SVG11$r に従うモノトスル：
~filterがあれば，まずそれを適用してから、［
切抜き, ~mask法, 混色-法, 組成-法
］を順に適用する。
◎
The compositing model must follow the SVG compositing model [SVG11]: first any filter effect is applied, then any clipping, masking, blending and compositing.
</p>

		</section>
		<section id="csscompositingrules_CSS">
<h3 title="Behavior specific to HTML">3.2. ~HTMLに特有な挙動</h3>

<p>
~CSSにおいて`積層~文脈$を作成するものは、
【`参考（ MDN ）＠https://developer.mozilla.org/en-US/docs/Web/CSS/CSS_positioned_layout/Understanding_z-index/Stacking_context$】
すべて，`隔離d~group$になると見なすモノトスル。
~HTML要素~自体は、
~groupを作成するべきでない。
◎
Everything in CSS that creates a stacking context must be considered an ‘isolated’ group. HTML elements themselves should not create groups.
</p>

<p>
混色-法が適用された要素は、［
当の要素が属する`積層~文脈$を成す，下層の内容
］すべてと伴に混色するモノトスル。
◎
An element that has blending applied, must blend with all the underlying content of the stacking context [CSS21] that that element belongs to.
</p>

<p>
~HTML文書における`根~要素$は、
`文書~要素$を指す。
◎
The root element for an HTML document is the document element.
</p>

		</section>
		<section id="csscompositingrules_SVG">
<h3 title="Behavior specific to SVG">3.3. ~SVGに特有な挙動</h3>

<p>
既定では、
どの要素も非 `隔離d~group$を作成するモノトスル。
◎
By default, every element must create a non-isolated group.
</p>

<p>
しかしながら，~SVGにおける ある種の演算は、
`隔離d~group$を作成することになる。
次に挙げる いずれかの特能が利用された場合、
当の~groupを隔離するモノトスル：
◎
However, certain operations in SVG will create isolated groups. If one of the following features is used, the group must become isolated:
</p>

<ul>
	<li>
不透明度
◎
opacity
</li>
	<li>
~filter
◎
filters
</li>
	<li>
<p>
~3D変形（ `transforms^en, 座標系変換）
（ ~2D変形は、隔離を生じさせないモノトスル）。
</p>

<p class="trans-note">【
元々の~SVG仕様は，~3D変形を~supportしないが、
`CSS Transform Level 2^cite
により`拡張されている＠~TRANSFORM2#svg-three-dimensional-functions$。
】</p>
◎
3D transforms (2D transforms must NOT cause isolation)
</li>
	<li>
混色-法
◎
blending
</li>
	<li>
~mask法
◎
masking
</li>
</ul>

<p>
~SVG文書における`根~要素$は、
`~SVG要素＠~SVGstruct#NewDocument$
【！`~SVG要素＠~SVG11/struct.html#NewDocument$】
【<a href="~SVGstruct#TermOutermostSVGElement">最外縁な `svg^e 要素</a>？】
を指す。
◎
The root element for SVG is the SVG element.
</p>

		</section>
		<section id="csskeywords">
<h3 title="CSS Properties">3.4. 各種~CSS~prop</h3>

			<section id="mix-blend-mode">
<h4 title="The mix-blend-mode property">3.4.1. `mix-blend-mode^p ~prop</h4>

<p>
混色-~modeは、
色を後景に混合する際に利用されるモノトスル公式を定義する。
この挙動は、
`混色-法$secにて詳細に述べる。
◎
The blend mode defines the formula that must be used to mix the colors with the backdrop. This behavior is described in more detail in Blending.
</p>

<div>
◎名 `mix-blend-mode@p
◎値 `blend-mode$t | `plus-darker$v | `plus-lighter$v
◎初 `normal$v
◎適 
すべての要素。
~SVGにおいては、
`容器~要素$,
`~graphics要素$,
`~graphicを参照する要素$
`SVG11$r
◎継 されない
◎百 受容しない
◎算 指定されたとおり
◎順 文法に従う
◎ア 離散的
◎表終
◎
Name: 	mix-blend-mode
Value: 	&lt;blend-mode&gt;
Initial: 	normal
Applies to: 	All elements. In SVG, it applies to container elements, graphics elements and graphics referencing elements. [SVG11]
Inherited: 	no
Percentages: 	N/A
Computed value: 	as specified
Canonical order: 	per grammar
Animation type: 	discrete
Media: 	visual
</div>

<p class="trans-note">【
`plus-darker$v, `plus-lighter$v （この訳による追加）は、
`~level 2$ による拡張。
】</p>

<p>
`blend-mode$t の構文は：
◎
The syntax of the property of &lt;blend-mode&gt; is given with:
</p>

<pre class="prod">
`blend-mode@t
	= `normal$v
	| `darken$v
	| `multiply$v
	| `color-burn$v
	| `lighten$v
	| `screen$v
	| `color-dodge$v
	| `overlay$v
	| `soft-light$v
	| `hard-light$v
	| `difference$v
	| `exclusion$v
	| `hue$v
	| `saturation$v
	| `color$v
	| `luminosity$v
</pre>

<p>
`normal$v 以外の混色-~modeを要素に適用するときは、
新たな`積層~文脈$を確立するモノトスル。
この~groupは、
当の要素を包含する`積層~文脈$と伴に混色して, 組成するモノトスル。
◎
Applying a blendmode other than normal to the element must establish a new stacking context [CSS21]. This group must then be blended and composited with the stacking context that contains the element.
</p>

<div class="example" id="ex-duck-on-lime">
<p>
次の~markupと：
◎
Given the following sample markup:
</p>

`mix-blend-mode-1^xCode

<p>
次の~style規則が与えられたなら：
◎
And the following style rule:
</p>

<pre class="lang-css">
body { background-color: lime; }
</pre>

<p>
次の結果が生産されることになる：
◎
... will produce the following result:
</p>

<figure>
<figcaption id="_dgm-ducky_normal">
黄緑色（ `lime^v ）な後景~上の，部分的に透明な画像
◎
Partially transparent image on a lime backdrop
</figcaption></figure>

<p>
~style規則を，混色-法も含めて変更したとするとき：
◎
If we change the style rule to include blending:
</p>

<pre class="lang-css">
body { background-color: lime; }
img { `mix-blend-mode$p: `multiply$v; }
</pre>

<p>
`body$e 要素の黄緑色な背景と混色された画像が出力されることになる。
◎
... the output will be the image blending with the lime background of the &lt;body&gt; element.
</p>

<figure>
<figcaption id="_dgm-ducky_multiply">
黄緑色な後景~上の，透明な画像の混色-法
◎
Blending of a transparent image on a lime backdrop.
</figcaption></figure>

<!-- 
<figure>ducky_normal1^dgm
<figcaption>
（利用中の~browserによる表示）
</figcaption></figure>
 -->
</div>

<div class="example" id="ex-svg-screen-mode">
<p>
次の~SVG~codeと：
◎
Given the following svg code:
</p>

`mix-blend-mode-2^xCode

<p>
次の~style規則が与えられたなら：
◎
And the following style rule:
</p>

<pre class="lang-css">
circle { `mix-blend-mode$p: `screen$v; }
</pre>

<p>
３個の円が混色されて出力される。
各 円は，奥から前面にかけて描画され、
要素が重合する所では，混色-~modeにより色が変化する。
◎
... the output will be blending of the 3 circles. Each circle is rendered from bottom to top. Where the elements overlap, the blend mode produces a change in color.
</p>

<figure>
<figcaption id="_dgm-screen_example">
`screen$v 混色-~modeで混色された３個の円
◎
Example of 3 circles blending with a screen blend mode
</figcaption></figure>
</div>

<div class="example" id="ex-opacity-stacking">
<p>
次の~stylesheetと文書片において：
◎
In the following style sheet and document fragment:
</p>

<pre class="lang-css">
body { background-color: lime; }
div { background-color: red; width: 200px; opacity: .95}
img { `mix-blend-mode$p: `difference$v; }
</pre>

`mix-blend-mode-3^xCode

<p>
`div^e 要素~上の `opacity$p は、
新たな`積層~文脈$を作成する。
これにより，新たな~groupが作成され、
画像は `body$e の色とは混色されなくなる。
◎
... the opacity on the &lt;div&gt; element is causing the creation of a stacking context. This causes the creation of a new group so the image doesn’t blend with the color of the &lt;body&gt;.
</p>

<figure>
<figcaption id="_dgm-ducky_difference">
積層~文脈の中で混色した例
【 `div^e は左側の赤色~域を占める。元の画像の周辺部は透明。】
◎
Example of blending within a stacking context.
</figcaption></figure>

<p>
画像が黄緑色とは混色されなくなる様子に注意。
◎
Note how the image is not blending with the lime color.
</p>
</div>

<div class="example" id="ex-overlay-blend">
<p>
次の~markupと：
◎
Given the following sample markup:
</p>

`mix-blend-mode-4^xCode

<p>
次の~style規則が与えられたなら：
◎
And the following style rule:
</p>

<pre class="lang-css">
div { background-image: url('texture.png'); }
@font-face {
  font-family: "Mythos Std";
  src: url("http://myfontvendor.com/mythos.otf");
}
p {
  `mix-blend-mode$p: `overlay$v;
  font-family: "Mythos Std";
}
</pre>

<figure>
<figcaption id="_dgm-overlay_text">
画像~上に `overlay$v で混色される~text。
◎
Text with a blend overlay on top of an image.
</figcaption></figure>
</div>

			</section>
			<section id="isolation">
<h4 title="The isolation property">3.4.2. `isolation^p ~prop</h4>

<p>
~SVGにおいては、
これは，要素が隔離されるかどうかを定義する。
~CSSにおいては、
`isolation$p の値を `isolate^v にすることは，要素を`積層~文脈$に~~転換することを意味する。
◎
In SVG, this defines whether an element is isolated or not.
For CSS, setting isolation to isolate will turn the element into a stacking context.
</p>

<p>
要素の `isolation$p ~propは、
既定では，隔離しないことを含意する `auto^v をとる。
しかしながら，`積層~文脈$を作成させる演算に対しては、
~groupを隔離するモノトスル。
これらの演算については、
`§ ~HTMLに特有な挙動＠#csscompositingrules_CSS$,
`§ ~SVGに特有な挙動＠#csscompositingrules_SVG$
にて述べる。
◎
By default, elements use the auto keyword which implies that they are not isolated. However operations that cause the creation of stacking context [CSS21] must cause a group to be isolated. These operations are described in 'behavior specific to HTML' and 'behavior specific to SVG'.
</p>

<div>
◎名 `isolation@p
◎値 `isolation-mode$t
◎初 `auto^v
◎適
すべての要素。
~SVGにおいては、
`容器~要素$,
`~graphics要素$,
`~graphicを参照する要素$。
`SVG11$r
◎継 されない
◎百 受容しない
◎算 指定されたとおり
◎順 文法に従う
◎ア 離散的
◎表終
◎
Name: 	isolation
Value: 	&lt;isolation-mode&gt;
Initial: 	auto
Applies to: 	All elements. In SVG, it applies to container elements, graphics elements and graphics referencing elements. [SVG11]
Inherited: 	no
Percentages: 	N/A
Computed value: 	as specified
Canonical order: 	per grammar
Animation type: 	discrete
Media: 	visual
</div>

<p>
`isolation-mode$t の構文は：
◎
The syntax of the property of &lt;isolation-mode&gt; is given with:
</p>

<pre class="isolated">
`isolation-mode@t = `auto^v | `isolate^v
</pre>

<p id="img_isolation">
~CSSにおいては、
背景~画像や `img$e の内容は、
常に，`隔離d~group$の中へ描画するモノトスル。
例えば，
`img$e ~tagを通して~SVG~fileへ~linkを張っている場合、
~SVGの絵図は，内容の後景とは混色されないことになる。
◎
In CSS, a background image or the content of an img must always be rendered into an isolated group. For instance, if you link to an SVG file through the img tag, the artwork of that SVG will not blend with the backdrop of the content.
</p>

<p>
~SVGにおける `mask$p は、
常に，`隔離d~group$を作成する。
◎
In SVG, mask always creates an isolated group.
</p>

			</section>
			<section id="background-blend-mode">
<h4 title="The background-blend-mode property">3.4.3. `background-blend-mode^p ~prop</h4>

<p>
各 背景~層†の混色-~modeを定義する。
◎
Defines the blending mode of each background layer.
</p>

<p class="trans-note">【†
`background$p ~propにより指定される（画像などによる）背景
】</p>

<p>
各 背景~層は、［
その層より下の層にある要素の他の背景~層
］や［
要素の背景~色
］と混色するモノトスル。
背景~層は、
要素の背後にある内容とは混色しないモノトスル
— 代わりに，`隔離d~group$の中へ描画されたかのように動作するモノトスル。
<!-- ＊
背後の — 概ね，要素の先祖の内容？
 -->
◎
Each background layer must blend with the element’s background layer that is below it and the element’s background color. Background layers must not blend with the content that is behind the element, instead they must act as if they are rendered into an isolated group.
</p>

<p>
`background-blend-mode$p
~propの記述は次に従う：
◎
The description of the background-blend-mode property is as follows:
</p>

<div>
◎名 `background-blend-mode@p
◎値 `mix-blend-mode$tp#
◎初 `normal$v
◎適 すべての~HTML要素
◎継 されない
◎百 受容しない
◎算 指定されたとおり
◎順 文法に従う
◎ア 離散的
◎表終
◎
Name: 	background-blend-mode
Value: 	&lt;blend-mode&gt;#
Initial: 	normal
Applies to: 	All HTML elements
Inherited: 	no
Percentages: 	N/A
Computed value: 	as specified
Canonical order: 	per grammar
Animation type: 	discrete
Media: 	visual
</div>

<p>
`background-blend-mode$p ~listは、
`background-image$p `CSS3BG$r と同じ順序で適用するモノトスル。
すなわち、
~listを成す最初の要素が，現在の前面~層に適用されることになる。
~propに与えられた~commaで分離された値の個数が，層~数に満たない場合、
~UAは，~listの値を必要なだけ繰返して, その使用~値を計算するモノトスル。
◎
The background-blend-mode list must be applied in the same order as background-image [CSS3BG]. This means that the first element in the list will apply to the layer that is on top. If a property doesn’t have enough comma-separated values to match the number of layers, the UA must calculate its used value by repeating the list of values until there are enough.
</p>

<p>
`background$p 略式~prop `CSS3BG$r が利用されたときには、
当の要素の `background-blend-mode$p ~propは，
その初期~値に設定し直すモノトスル。
◎
If the background [CSS3BG] shorthand is used, the background-blend-mode property for that element must be reset to its initial value.
</p>

<div class="example" id="ex-background-blend">
<p>
次の~markupと：
◎
Given the following sample markup:
</p>

`background-blend-mode-1^xCode

<p>
次の~style規則が与えられたなら：
◎
And the following style rule:
</p>

<pre class="lang-css">
body { background-color: lime; }
div {
  width: 200px;
  height: 200px;
  background-size: 200px 200px;
  background-repeat:no-repeat;
  background-image: linear-gradient(to right, #000000 0%,#ffffff 100%), url('ducky.png');
  `background-blend-mode$p: difference, normal;
}
</pre>

<figure>
<p class="alt" hidden id="_dgm-ducky_background_blend">
`div^e 要素に伴われるアヒル画像（ `ducky.png^v ）と~gradientが混色されている例
◎
example of div that has an image of a duck and a gradient that is blending
</p>
<figcaption>
2 つの背景~画像の混色。
◎
Blending of 2 background images.
</figcaption></figure>

<p>
~gradient（ `linear-gradient^v ）は、
`body$e の色とは混色されないことに注意。
それは元の色を維持する。
◎
Note that the gradient is not blending with the color of body. Instead it retains its original color.
</p>

<p class="trans-note">【
この~code例の `ducky.png^v と~gradientの順序は逆であろう
（~gradientの方が前面になっている）。
この混色-~modeでは、
結果は同じになるが。
】</p>
</div>

			</section>
		</section>
	</section>
	<section id="canvascompositingandblending">
<h2 title="Specifying Compositing and Blending in Canvas 2D">4. ~Canvas~2Dにおける組成-法と混色-法の指定-法</h2>

<div>
<p>
~Canvas ~API用の`~2D描画~文脈＠~HEcanvas#2dcontext$ `HTML$r は、
`globalCompositeOperation$m 属性を定義する
— それは、
現在の［
組成／混色
］演算子を設定し，
次の値をとり得る（初期~値は `source-over$v ）：
</p>

<pre class="prod">
globalCompositeOperation
	= `composite-mode$t
	| `blend-mode$t
</pre>

◎
The canvas 2d context defines the globalCompositeOperation attribute that is used to set the current compositing and blending operator.
◎
This property takes the following value:
◎
‘globalCompositeOperation’
◎
Value:   	&lt;blend-mode&gt; | &lt;composite-mode&gt;
Initial:   	source-over
</div>

<p>
【`~Porter-Duff組成-法$を与える】
`composite-mode$t の構文は：
◎
The syntax of the property of &lt;composite-mode&gt; is given with:
</p>

<pre class="prod">
`composite-mode@t
	= `clear$v
	| `copy$v
	| `source-over$v
	| `destination-over$v
	| `source-in$v
	| `destination-in$v
	| `source-out$v
	| `destination-out$v
	| `source-atop$v
	| `destination-atop$v
	| `xor$v
	| `lighter$v
	| `plus-darker$v
	| `plus-lighter$v
</pre>

<p class="trans-note">【
`plus-darker$v, `plus-lighter$v （この訳による追加）は、
`~level 2$ による拡張。
】</p>

	</section>
	<section id="whatiscompositing">
<h2 title="Introduction to compositing">5. 組成-法 — 序論</h2>

<p>
組成-法（ `compositing^en ）が、
~graphic要素を，その`後景$に組合せる方法を成す。
◎
Compositing is the combining of a graphic element with its backdrop.
</p>

<p>
この仕様に述べる~modelにおける組成~演算は、
2 つの段［
`混色-法$と`~Porter-Duff組成-法$
］からなる。
混色~段は、
~graphic要素の色と後景の色とが，どう相互作用するかを決定する。
◎
In the model described in this specification there are two steps to the overall compositing operation - Porter-Duff compositing and blending. The blending step determines how the colors from the graphic element and the backdrop interact.
</p>

<p>
概して、
混色~段が先に遂行され，~Porter-Duff組成~段が後続する。
混色~段においては、
要素と`後景$を混合した結果の色が計算される。
~graphic要素の色は、
この結果の色に置換される。
それから、
~graphic要素は，指定された組成~演算子で`後景$に組成される。
◎
Typically, the blending step is performed first, followed by the Porter-Duff compositing step. In the blending step, the resultant color from the mix of the element and the the backdrop is calculated. The graphic element’s color is replaced with this resultant color. The graphic element is then composited with the backdrop using the specified compositing operator.
</p>

<p class="note">注記：
図形は、
数学的な記述により定義される。
所与の特定0の地点は、
図形の内側に入るか入らないかのいずれかになる。
中間段階は無い。
◎
Note: Shape is defined by the mathematical description of the shape. A particular point is either inside the shape or it is not. There are no gradations.
</p>

<p class="note">注記：
~alpha値で表される不透明度は、
各~地点ごとに色~値と伴に格納される。
~alpha値の範囲は 0 以上 1 以下の閉区間である。
値 0 は、
その地点における画素に対する図形の被覆率が 0 であり，
透明であることを意味する。
すなわち、
幾何的に その地点の画素には重合しないので，
当の画素の色への寄与分が無いことを意味する。
値 1 は、
画素が全-不透明であり，
~~形状が画素~全体に重合することを意味する。
◎
Note: Opacity is described using an alpha value, stored alongside the color value for each particular point. The alpha value is between 0 and 1, inclusive. A value of 0 means that the pixel has no coverage at that point, and is therefore transparent; i.e. there is no color contribution from any geometry because the geometry does not overlap this pixel. A value of 1 means that the pixel is fully opaque; the geometry completely overlaps the pixel.
</p>

		<section id="simplealphacompositing">
<h3 title="Simple alpha compositing">5.1. 単純~alpha組成-法</h3>

<!-- 
Cs = (1 − αb) × Cs + αb × B(Cb, Cs)
	B(Cb, Cs) = Cs
   = (1 − αb) × Cs + αb × Cs
   = Cs // そのまま

Co = αs × Fa × Cs + αb × Fb × Cb
	Fa = 1; Fb = 1 − αs // source over
   = αs × Cs + αb × (1 − αs) × Cb
   = αs Cs + cb − αs cb
   = αs Cs + cb(1 − αs)

 -->
<p>
単純~alpha組成-法の公式は：
◎
The formula for simple alpha compositing is
</p>

<pre class="formula">
%co = %Cs × %αs + %Cb × %αb × ( 1 − %αs )
</pre>

<div>
<p>
各種~変数は：
</p>

<table class="params"><tbody>

<tr><th>%co
<td>組成-後の，乗算済み画素 値

<tr><th>%Cs
<td>組成される~source~graphic要素（以下，単に “~source” と記す）の色~値

<tr><th>%αs
<td>~sourceの~alpha値

<tr><th>%Cb
<td>`後景$の色~値

<tr><th>%αb
<td>`後景$の~alpha値
</table>

◎
Where
• co: the premultiplied pixel value after compositing
• Cs: the color value of the source graphic element being composited
• αs: the alpha value of the source graphic element being composited
• Cb: the color value of the backdrop
• αb: the alpha value of the backdrop
</div>

<p class="note">注記：
すべての値は 0 〜 1 の閉区間に入る。
◎
Note: All values are between 0 and 1 inclusive.
</p>

<p class="trans-note">【
明示的に言及されていないので解り難くなっているが、
単純~alpha組成-法は，［
`§ 組成-法の序論＠#whatiscompositing$の冒頭に述べた一般の場合において、
混色~段は自明なもの（結果は，~sourceの色そのまま）にされ，
~Porter-Duff組成-法が `source-over$v にされた特殊な場合
］になる。
すなわち、
この節に示されている単純~alpha組成~公式の中の %Cs は，
`混色-法$の結果をそのまま表している。
】</p>

<p>
組成-後の画素 値（ %co ）は、
~sourceからの寄与分
[ %Cs × %αs ]
と, 後景からの寄与分
[ %Cb × %αb × ( 1 − %αs ) ]
を加算して与えられる。
色の寄与分を決定するため、
［
~source, 後景
］どちらも，その色~値は各自の~alphaで乗算される。
~alpha 0 は，色の寄与分がないことを意味し、
部分的な~alphaは，その割合の色が寄与することを意味する。
後景の寄与分は、
~sourceの不透明度に基づいて更に減量される：
概念的には、
後景のうち [ 1 − %αs ] の割合が~sourceを透過することを意味する
— すなわち、
~sourceが全-不透明（ %αs ＝ 1 ）ならば，
後景は透過しなくなる。
◎
The pixel value after compositing (co) is given by adding the contributions from the source graphic element [Cs x αs] and the backdrop [Cb x αb x (1 - αs)]. For both the graphic element and the backdrop, the color values are multiplied by the alpha to determine the amount of color that contributes. With zero alpha meaning that the color does not contribute and partial alpha means that some percentage of the color contributes. The contribution of the backdrop is further reduced based on the opacity of the graphic element. Conceptually, (1 - αs) of the backdrop shows through the graphic element, meaning that if the graphic element is fully opaque (αs=1) then no backdrop shows through.
</p>

<p>
上に挙げられた単純~alpha組成~公式は、［
後景と~source
］の色を，各自の~alphaによる重みで加重平均をとって得られる色を与える。
結果の組成~alpha値は、
単純に，組成される一連の要素が寄与する~alphaの合計になる。
結果の組成~alphaの公式は：
◎
The simple alpha compositing formula listed above gives a resultant color which is the result of the weighted average of the backdrop color and graphic element color, with the weighting determined by the backdrop and graphic element alphas. The resultant alpha value of the composite is simply the sum of the contributed alpha of the composited elements. The formula for the resultant alpha of the composite is
</p>

<pre class="formula">
%αo = %αs + %αb × ( 1 − %αs )
</pre>

<!-- 
αo = αs1 + αb (1 - αs1) = 1 - (1 - αb) (1 - αs1)
1 - αo = (1 - αb) (1 - αs1)

	Ti = 1 - αs[i]; i = 1, 2, ...
	T0 = 1 - αb
	αi = i-th αo; i = 1, 2, ...
	α0 = αb = 1 - T0

1 - αi = (1 - α[i-1]) Ti
	TOi = 1 - αi
TOi = TO[i-1] Ti

TO1 = TO0 T1 = T0 T1
TO2 = TO1 T2 = T0 T1 T2
...
TOi = T0 T1 T2 ... Ti
	結果の透明度 = 各 透明度すべての積

-->
<div>
<table class="params"><tbody>

<tr><th>%αo
<td>組成~alpha値

<tr><th>%αs
<td>~sourceの~alpha値

<tr><th>%αb
<td>`後景$の~alpha値
</table>

◎
Where
• αo: the alpha value of the composite
• αs: the alpha value of the graphic element being composited
• αb: the alpha value of the backdrop
</div>

<div class="note">
<p>
色と不透明度は、
乗算済みな値を格納した方がより効率的になることが多い。
乗算済みな値は：
◎
Often, it can be more efficient to store a pre-multiplied value for the color and opacity. The pre-multiplied value is given by
</p>

<pre class="formula">
%cs = %Cs × %αs
</pre>

<div>
<table class="params"><tbody>

<tr><th>%cs
<td>乗算済みな値

<tr><th>%Cs
<td>色~値

<tr><th>%αs
<td>~alpha値
</table>
◎
with
• cs: the pre-multiplied value
• Cs: the color value
• αs: the alpha value
</div>

<p>
したがって，乗算済みな値を利用する単純~alpha組成~公式は次の様になる：
◎
Thus the formula for simple alpha compositing using pre-multiplied values becomes
</p>

<pre class="formula">
%co = %cs + %cb × ( 1 − %αs )
</pre>

<p>
非 乗算済みでない色~成分は、
乗算済みな値から，公式を逆算して得られる：
◎
To extract the color component of a pre-multiplied value, the formula is reversed:
</p>

<pre class="formula">
%Co = %co ÷ %αo
</pre>
</div>

			<section id="simplealphacompositingexamples">
<h4 title="Examples of simple alpha compositing">5.1.1. 単純~alpha組成-法の例</h4>

<div class="example" id="ex-basic-alpha">

<figure>
<p class="alt" hidden id="_dgm-simple_box">
~alpha組成-法を示している単純な~box
◎
Simple box showing alpha compositing
</p>
</figure>

<p>
ここでは，最も基本的な事例を述べる。
それは、
ベタ色（ α = 1 ）で埋められた 1 個の図形からなる。
図形は、
空な背景に組成される。
空な背景は、
組成した結果に効果を持たない。
◎
This describes the most basic case. It consists of 1 shape that is filled with a solid color (α = 1). The shape is composited with an empty background. The empty background has no effect on the resultant composite.
</p>

<pre class="formula">
%Cs = RGB(1, 0, 0)
%αs = 1
%Cb = RGB(0, 0, 0)
%αb = 0

%co = %Cs × %αs + %Cb × %αb × ( 1 − %αs )
   = RGB(1, 0, 0) × 1 + RGB(0, 0, 0) × 0 × ( 1 − 1 )
   = RGB(1, 0, 0)
</pre>
</div>

<div class="example" id="ex-shapes-intersect">
<figure>
<p class="alt" hidden id="_dgm-two_box">
2 個の単純な図形
◎
simple shape
</p>
</figure>
<p>
次は，より複階的な例。
透明度は無いが、
2 個の図形が交差している。
◎
This is a more complex example. There is no transparency, but the 2 shapes intersect.
</p>

<p>
交差域に組成~公式を適用すると：
◎
Applying the compositing formula in the area of intersection, gives:
</p>

<pre class="formula">
%Cs = RGB(0, 0, 1)
%αs = 1
%Cb = RGB(1, 0, 0)
%αb = 1

%co = %Cs × %αs + %Cb × %αb × ( 1 − %αs )
   = RGB(0, 0, 1) × 1 + RGB(1, 0, 0) × 1 × ( 1 − 1 )
   = RGB(0, 0, 1)
</pre>

<p>
組成した結果の~alphaを計算する：
◎
Calculating the alpha of the resultant composite
</p>

<pre class="formula">
%αo = %αs + %αb × ( 1 − %αs )
   = 1 + 1 × ( 1 − 1 )
   = 1
</pre>

<p>
組成した結果の色~成分を計算する：
◎
Calculating the color component of the resultant composite
</p>

<pre class="formula">
%Co = %co ÷ %αo
   = RGB(0, 0, 1) ÷ 1
   = RGB(0, 0, 1)
</pre>
</div>

<div class="example" id="ex-transparent-over-opaque">
<figure>
<p class="alt" hidden id="_dgm-two_box_transparency">
ベタな~boxと その上にある透明な~boxとの相互作用
◎
interaction of a solid box with a transparent box on top
</p>
</figure>

<p>
図形には透明度があるが，`後景$は全-不透明な例。
◎
This is an example where the shape has some transparency, but the backdrop is fully opaque.
</p>

<p>
交差域に組成~公式を適用すると：
◎
Applying the compositing formula in the area of intersection, gives:
</p>

<pre class="formula">
%Cs = RGB(0, 0, 1)
%αs = 0.5
%Cb = RGB(1, 0, 0)
%αb = 1

%co = %Cs × %αs + %Cb × %αb × ( 1 − %αs )
   = RGB(0, 0, 1) × 0.5 + RGB(1, 0, 0) × 1 × ( 1 − 0.5 )
   = RGB(0, 0, 1) × 0.5 + RGB(1, 0, 0) × 0.5
   = RGB(0.5, 0, 0.5)
</pre>

<p>
組成した結果の~alphaを計算する：
◎
Calculating the alpha of the resultant composite
</p>

<pre class="formula">
%αo = %αs + %αb × ( 1 − %αs )
   = 0.5 + 1 × ( 1 − 0.5 )
   = 1
</pre>

<p>
組成した結果の色~成分を計算する：
◎
Calculating the color component of the resultant composite
</p>

<pre class="formula">
%Co = %co ÷ %αo
   = RGB(0.5, 0, 0.5) ÷ 1
   = RGB(0.5, 0, 0.5)
</pre>
</div>

<div class="example" id="ex-two-transparent">
<figure>
<p class="alt" hidden id="_dgm-two_box_transparency_both">
2 個の透明な~boxの相互作用
◎
interaction of 2 transparent boxes
</p>
</figure>

<p>
図形と`後景$どちらも透明な例
◎
Figure 4 shows an example where both the shape and the backdrop are transparent.
</p>

<p>
交差域に組成~公式を適用すると：
◎
Applying the compositing formula in the area of intersection, gives:
</p>

<pre class="formula">
%Cs = RGB(0, 0, 1)
%αs = 0.5
%Cb = RGB(1, 0, 0)
%αb = 0.5

%co = %Cs × %αs + %Cb × %αb × ( 1 − %αs )
   = RGB(0, 0, 1) × 0.5 + RGB(1, 0, 0) × 0.5 × ( 1 − 0.5 )
   = RGB(0, 0, 1) × 0.5 + RGB(1, 0, 0) × 0.25
   = RGB(0.25, 0, 0.5)
</pre>

<p>
組成した結果の~alphaを計算する：
◎
Calculating the alpha of the resultant composite
</p>

<pre class="formula">
%αo = %αs + %αb × ( 1 − %αs )
   = 0.5 + 0.5 × ( 1 − 0.5 )
   = 0.75
</pre>

<p>
組成した結果の色~成分を計算する：
◎
Calculating the color component of the resultant composite
</p>

<pre class="formula">
%Co = %co ÷ %αo
   = RGB(0.25, 0, 0.5) ÷ 0.75
   = RGB(0.33, 0, 0.66)
</pre>
</div>

			</section>
		</section>
	</section>
	<section id="generalformula">
<h2 title="General Formula for Compositing and Blending">6. 組成と混色の一般~公式</h2>

<p>
組成と混色~用の一般~公式は、
この 2 つの段において組成~演算子と混色~関数を選択することを許容する。
これらの関数の中で利用される項についての詳細は、
以下の各~節にて述べる。
◎
The general formula for compositing and blending which allows for selection of the compositing operator and blending function comprises two steps. The terms used in these functions will be described in detail in the following sections.
</p>

<p>
混色-時に適用される公式：
◎
Apply the blend in place
</p>

<pre class="formula">
%Cs = ( 1 − %αb ) × %Cs + %αb × B( %Cb, %Cs )
</pre>

<p>
組成-時に適用される公式：
◎
Composite
</p>

<pre class="formula">
%Co = %αs × %Fs × %Cs + %αb × %Fb × %Cb
</pre>

<div>
<table class="params"><tbody>

<tr><th>%Cs
<td>~source色

<tr><th>%Cb
<td>後景~色

<tr><th>%αs
<td>~source~alpha

<tr><th>%αb
<td>後景~alpha

<tr><th>B( %Cb, %Cs )
<td>混合~関数

<tr><th>%Fs, %Fb
<td>利用-中にある~Porter-Duff演算子にて定義される
</table>
◎
Where:
• Cs: is the source color
• Cb: is the backdrop color
• αs: is the source alpha
• αb: is the backdrop alpha
• B(Cb, Cs): is the mixing function
• Fa: is defined by the Porter Duff operator in use
• Fb: is defined by the Porter Duff operator in use
</div>

<p class="trans-note">【
%Fs は，原文では %Fa と表記されているが、
添字の対応関係が不規則で明快さに欠くので，この訳では %Fs と表記する
（この仕様~全体を通して）。
】</p>

	</section>
	<section id="backdropCalc">
<h2 title="Backdrop calculation">7. 後景の計算</h2>

<p>
`後景@
（ `backdrop^en ）とは、
要素の背後にある内容であり，要素の<em>組成-先</em>（ `destination^en ）になる。
このことは、
後景が，以前のすべての要素の組成による結果であることを意味する。
◎
The backdrop is the content behind the element and is what the element is composited with. This means that the backdrop is the result of compositing all previous elements.
</p>

<p class="trans-note">【
後景：
背景（ `background^en ）と語感が似るが，処理~modelにおける扱いは異なる
— 要素の背景は、
“要素の一部を成す” と見なされ，
<em>組成-元</em>（ `source^en ）になる。
】</p>

		<section id="backdropexamples">
<h3 title="Examples of backdrop calculation">7.1. 後景の計算~例</h3>

<div class="example" id="ex-simple-backdrop-calculation">
<figure>
<p class="alt" hidden id="_dgm-simple_backdrop">
単純な後景~計算の例
◎
example of a simple backdrop calculation
</p>
</figure>

<p>
この例には 2 個の単純な図形がある。
青色~図形に対する後景は、
赤色~図形の右下隅の部分を含んでいる。
点線は、
青色~図形を組成する際に調べられる区域を示す。
◎
This example has 2 simple shapes. The backdrop for the blue shape includes the bottom right corner of the red shape . The dotted line shows the area that is examined during compositing of the blue shape.
</p>
</div>

<div class="example" id="ex-backdrop-with-alpha">
<figure>
<p class="alt" hidden id="_dgm-simple_backdrop_alpha">
~alphaを伴う後景の例
◎
example of a backdrop with alpha
</p>
</figure>

<p>
後景の中の図形は~alpha値を持つ。
この後景の図形の~alpha値は，後景が計算される間 保全される。
◎
The shape in the backdrop has an alpha value. The alpha value of the backdrop shape is preserved when the backdrop is calculated.
</p>
</div>

		</section>
	</section>
	<section id="groups">
<h2 title="Compositing Groups">8. 組成~group</h2>

<p>
組成~group（ `compositing group^en ）は、
後景と組成するときの相互作用をもっと制御することを許容する。
~groupを利用すれば、［
~groupの中で組成した効果, すでに~sceneにある内容（後景）
］がどう相互作用するかを指定できる。
◎
Compositing groups allow more control over the interaction of compositing with the backdrop. Groups can be used to specify how a compositing effect within a group will interact with the content that is already in the scene (the backdrop).
</p>

<p>
組成~groupは、
任意~個数の要素からなり得る。
また、
他の組成~groupを包含し得る。
◎
Compositing groups may be made up of any number of elements, and may contain other compositing groups.
</p>

<p>
既定の~propを伴う組成~groupは、
~group化されないときと視覚的な相違は生じないモノトスル。
`~group不変性$secを見よ。
◎
The default properties of a compositing group shall cause no visual difference compared to having no group. See Group Invariance.
</p>

<p>
組成~groupの描画-時には、
まず，要素たちが成す~groupが`初期~後景$上に組成される。
その結果は、［
色, ~alpha
］情報を包含する単独の要素になる。
次に，この要素が`~group後景$上に組成される。
この手続きは、［
結果の`~group後景$が，最終的な組成-結果【後続の組成-演算】に寄与する単独の部分を成す
］ことを確保するように行うモノトスル。
◎
A compositing group is rendered by first compositing the elements of the group onto the initial backdrop. The result of this is a single element containing color and alpha information. This element is then composited onto the group backdrop. Steps shall be taken to ensure the group backdrop makes only a single contribution to the final composite.
</p>

<p>
各~groupには、
次が定義される：
◎
↓</p>
<dl>
	<dt>`初期~後景@</dt>
	<dd>
~groupを成す最初の要素を組成するときに利用される後景。
これは、
~groupが［
`隔離d~group$でないならば `~group後景$ ／
`隔離d~group$ならば 全-透明な後景
］と同じになる。
◎
The initial backdrop is the backdrop used for compositing the group’s first element. This will be the same as the group backdrop in a non-isolated group, or a fully transparent backdrop for an isolated group.
</dd>

	<dt>`~group後景@</dt>
	<dd>
［
~groupを成す最初の要素の直前までの，すべての要素
］を組成した結果。
◎
The group backdrop is the result of compositing all elements up to but not including the first element in the group.
</dd>
</dl>

		<section id="groupinvariance">
<h3 title="Group invariance">8.1. ~group不変性</h3>

<p>
`単純~alpha組成-法$の重要な特質として、
その演算が，~group不変性†を満たすことが挙げられる。
この挙動は、
この仕様の中で述べるより複階的な~modelにおいても保全される。
既定の属性により~group分けが追加されたり, 除去されても、
視覚的な相違は示さないモノトスル
（次の式の "+" は組成~演算を表す）：
◎
An important property of simple alpha compositing is its group invariance. This behavior is preserved in the more complex model described in this specification. Adding or removing grouping with default attributes shall not show visual differences.
</p>

<pre class="formula">
`source-over^v: A + B + C = A + (B + C) = (A + B) + C
</pre>

<p class="trans-note">【†
“~group不変性（ `group invariance^en ）”
— どのように “~group分け” しても結果は “不変” 。
すなわち、
組成~演算が`結合法則＠https://ja.wikipedia.org/wiki/%E7%B5%90%E5%90%88%E6%B3%95%E5%89%87$を満たすことを意味する
（`参考＠https://dbaron.org/log/20130306-compositing-blending$）。
</p>

<p>
この不変則は、
~groupに次に挙げるいずれかの属性が追加された場合，
満たされなくなり得る
⇒＃
隔離【 `isolation$p: `isolate^v 】,
`normal$v 以外の混色-~mode【 `mix-blend-mode$p 】,
`source-over$v 以外の~Porter-Duff組成~演算子
◎
When adding attributes to the group such as isolate, blending modes other than normal or Porter Duff compositing operators other than source-over, groups may no longer be invariant.
</p>

<div class="trans-note">

<p>【
この仕様に現れる語 “（組成）~group” とは、
組成~演算の結合順序を表現するための概念と捉えられる。
例えば、
層 A 上に層 B, C, D を順に組成することを考える。
このとき、
組成~演算を記号 + で表すならば，組成した結果を得る過程には：
</p>

<ul><li>((A + B) + C) + D
</li><li>A + (B + (C + D))
</li><li>A + ((B + C) + D)
</li></ul>

<p>
その他，種々の方法があり、
演算が結合法則を満たさなければ，結果は異なり得る。
そのため，式の括弧をどのように与えるかを定義する必要があり、
それが “~group” と呼ばれているものにあたる。
】</p>
</div>

		</section>
		<section id="isolatedgroups">
<h3 title="Isolated Groups">8.2. 隔離d~group</h3>

<p>
隔離d~group（ `isolated group^en ）における`初期~後景$は、
`透明な黒$になるモノトスル。
◎
In an isolated group, the initial backdrop shall be black and fully transparent.
</p>

<p>
この場合の`初期~後景$は、
`~group後景$と異なる。
`~group後景$との相互作用が生じるのは、
~groupに算出された［
色, 図形, ~alpha
］が後景と組成されるときに限るモノトスル。
◎
In this instance, the initial backdrop is different than the group backdrop. The only interaction with the group backdrop shall occur when the group’s computed color, shape and alpha are composited with it.
</p>

<p>
組成-法における`隔離d~group$の効果については、
`§ 隔離d~groupと各種~Porter-Duff~mode＠#groupcompositing$
を見よ。
混色-法における`隔離d~group$の効果については、
`~group隔離による混色-法に対する効果$sec
を見よ。
◎
See 'Isolated groups and Porter Duff modes' for a description of the effect of isolated groups on compositing. See 'Effect of group isolation on blending' for a description of the effect of isolated groups on blending.
</p>

		</section>
		<section id="pagebackdrop">
<h3 title="The Root Element Group">8.3. 根~要素~group</h3>

<p>
`根~要素$用の`隔離d~group$は、
根~要素~groupと称される。
すべての［
要素, 他の~group
］は、
この~groupの中へ組成される。
`~canvas背景$ `CSS3BG$r は，根~要素~groupの中へ塗られ、
それから，根~要素~用の［
~filter, 切抜き~path, ~mask, 不透明度
］が（もしあれば）
— `根~group$の中へ組成する前に —
適用される。
◎
The isolated group for the root element is the root element group. All elements and other groups are composited into this group. The canvas background [CSS3BG] is painted into the root element group, and any filter, clip-path, mask and and opacity for the root element is then applied, before compositing into the root group, if present.
</p>

		</section>
		<section id="rootgroup">
<h3 title="The Root Group">8.4. 根~group</h3>

<p>
根~groupは、
~canvas全体を包摂し，
~web~pageの`根~要素$の`根~要素~group$を包含する（その~~下地になる）。
◎
The root group encompasses the entire canvas and contains (or is below) the root element group of the root element of a web page.
</p>

<p class="note">注記：
~browserは，最終的な組成~用に［
根~group内の`~canvas表面$ `CSS3BG$r に無限な`全~不透明な白色＠~CSSCOLOR#valdef-color-canvas$【！~CSSCOLOR#sample】を利用する
］ことが多いが、
これは要求されない。
【例：`暗な色~scheme$】
◎
Browsers often use an infinite white, 100% opaque canvas surface [CSS3BG] in the root group, for final compositing, but this is not required.
</p>

		</section>
	</section>
	<section id="advancedcompositing">
<h2 title="Advanced compositing features">9. 先進的な組成-法を与える特能</h2>

<p>
`単純~alpha組成-法$は、
`source-over$v ~Porter-Duff組成~演算子を利用する。
◎
Simple alpha compositing uses the source-over Porter Duff compositing operator.
</p>

<p>
~Porter-Duff組成-法は、
画素
【概念的な微小域】
の最終的な色に寄与し得る，その画素の中の 2 つの図形（ `source^en と `destination^en 
【組成-元と組成-先 — 後者は長いので以下 “~dest” と略記する】
）による~modelに基づく。
画素は、
4 つの下位-画素 領域に分割0される。
各 領域は，~sourceと~destのアリな組合nを表現する。
`PORTERDUFF$r
◎
Porter Duff compositing is based on a model of a pixel in which two shapes (source and destination) may contribute to the final color of the pixel. The pixel is divided into 4 sub-pixel regions and each region represents a possible combination of source and destination. [PORTERDUFF]
</p>

<p>
４つの領域とは：
◎
The four regions are:
</p>

<dl>
	<dt title="Source Only">~sourceのみ</dt>
	<dd>
~sourceのみが画素~色に寄与する領域
◎
Where only the source contributes to the pixel color
</dd>

	<dt title="Destination only">~destのみ</dt>
	<dd>
~destのみが画素~色に寄与する領域
◎
where only the destination contributes to the pixel color
</dd>

	<dt title="Both">両者の組合n</dt>
	<dd>
画素~色が~sourceと~destの両者を組合せて定義され得る領域。
◎
Source and Destination – where both the source and destination may combine to define the pixel color
</dd>

	<dt title="None">なし</dt>
	<dd>
~sourceも~destも最終的な画素~色に寄与しない領域。
◎
No source or Destination – where neither make a contribution to the final pixel color
</dd>

</dl>

<p class="note">注記：
~destは、
後景の同義語である。
この節で利用される語~dest（ `destination^en ）は、
~Porter-Duff組成-法について述べるときの標準な語と見なされる。
加えて、
組成~演算子の名前には `destination^c が利用される。
◎
Note: Destination is synonymous with backdrop. The term destination is used in this section as this is considered the standard when working with Porter Duff compositing. Additionally, the compositing operators use destination in their names.
</p>

<figure>
<!-- PD_regions^dgm -->
<div class="comp-box" style="width: 300px; height: 300px; text-align:center; color: black;">
<div class="comp-dest" style="width:40%; left:60%;">~destのみ</div>
<div class="comp-source" style="height: 60%; top: 40%;">~sourceのみ</div>
<div class="comp-both" style="background: rgb(156, 201, 180);">両者の組合n</div>
<div class="comp-both" style="width:40%; height: 60%; left:60%; top: 40%;">両方なし</div>
</div>
<figcaption>
~Porter-Duff組成-法により影響される領域の概観。
（この図の “両者の組合n” の色は、
~~仮の色であり，`混色-法$に依存する。）
◎
overview of the regions affected by porter duff
</figcaption></figure>

<p>
各 領域からの最終的な画素~色への寄与分は、［
その画素における図形の被覆率, 利用-中にある演算子
］により定義される。
被覆率は、
~alpha（ α ）を通して指定される
— α = 1 は全て覆うことに対応し，
α = 0 は全く覆わないことに対応する。
すなわち、
画素の各 領域の面積は，画素に寄与している各 図形の被覆率に依存する。
各 領域の面積は、
【画素の面積を 1 として】
次の等式により計算できる：
◎
The contribution from each region to the final pixel color is defined by the coverage of the shape at that pixel, and the operator in use. Coverage is specified in terms of alpha. Full alpha (1) implies full coverage, while zero alpha (0) implies no coverage. This means that the area of each region within the sub-pixel is dependent on the coverage of each shape contributing to the pixel. The area of each region can be calculated with the following equations:
</p>

<div>

<figure>
<table>
<caption>
%αs = ~sourceの被覆率,
%αb = ~destの被覆率
</caption>
<thead style="background:var(--B-bg)"><tr><th>領域
<th>被覆率
<th>計算例（ %αs = 0.6,  %αb = 0.4 ）
<tbody>

<tr><th title="Both">両者の組合n
<td>%αs × %αb
<td>0.6 × 0.4 = 0.24

<tr><th title="Source only">~sourceのみ
<td>%αs × ( 1 − %αb )
<td>0.6 × ( 1 − 0.4 ) = 0.36

<tr><th title="Destination only">~destのみ
<td>%αb × ( 1 − %αs )
<td>0.4 × ( 1 − 0.6 ) = 0.16

<tr><th title="None">なし
<td style="padding-right: 2em;">( 1 − %αs ) × ( 1 − %αb )
<td>( 1 − 0.6 ) × ( 1 − 0.4 ) = 0.24
</table>

<figcaption>
（この計算例の被覆率は、
上の図式に示された~sourceと~destの被覆率に等しくなるように選ばれている）
</figcaption></figure>

◎
The figure above represents coverage of 0.5 for both source and destination.
◎
Both = 0.5 × 0.5 = 0.25 
Source Only = 0.5 (1 − 0.5) = 0.25
Destination Only = 0.5(1 − 0.5) = 0.25
None = (1 − 0.5)(1 − 0.5) = 0.25
◎
Therefore, the coverage of each region is 0.25 in this example.
</div>

<p class="trans-note">【
上の図式, および以下の節で述べる各種 演算子にて示される図式は、
1 画素の被覆率としても，あるいは図に示された通りの（不透明な） 2 枚の~graphic
（全高または全幅が全体に渡る長方形）の重合ngとして捉えることもできる。
前者の捉え方をより忠実に反映するため、
この訳では，原文の図式を改変している。
】</p>

		<section id="porterduffcompositingoperators">
<h3 title="The Porter Duff Compositing Operators">9.1. ~Porter-Duff組成~演算子</h3>

<p>
組成-法の代数は、
`Lucasfilm^en で働いていた `Thomas Porter^en と `Tom Duff^en による画期的な論文にて定義され，
12 個の “~Porter-Duff” 演算子が開発された。
これらの演算子は、［［
~alpha, あるいは画素 被覆率
］［
~channel／値
］を持つ~graphicな~obj
］の重合ngから形成される，４つの下位-画素 領域における混合の結果を制御する。
演算子たちには、
４つの領域による実用的な組合nすべてが利用されている。
◎
The landmark paper by Thomas Porter and Tom Duff, who worked for Lucasfilm, defined the algebra of compositing and developed the twelve "Porter Duff" operators. These operators control the results of mixing the four sub-pixel regions formed by the overlapping of graphical objects that have an alpha or pixel coverage channel/value. The operators use all practical combinations of the four regions.
</p>

<p>
12 個の基本的な~Porter-Duff演算子は、
~sourceと~destのアリな組合nすべてを網羅する。
◎
There are 12 basic Porter Duff operators, satisfying all possible combinations of source and destination.
</p>

<p>
各 演算子を幾何的に表現するなら、
各 図形からの寄与分は，出力に対する図形の合計の被覆率として捉えられる。
例えば， `source-over$v においては、
~sourceが寄与し得る割合分は 全体（ 1.0 ）であり,
~destの寄与し得る割合分は 残る ( 1 − %αs ) になる。<!-- ＊残る？ -->
これには、
画素の最終的な被覆率~用の等式を与えるため，
~sourceと~destの被覆率により改変される。
◎
From the geometric representation of each operator, the contribution of each shape can be seen to be expressed as a fraction of the total coverage of the output. For example, in source over, the possible contribution of source is full (1) and the possible contribution of destination is whatever is remaining (1 – αs). This is modified by the coverage of source and destination to give the equation for the final coverage of the pixel:
</p>

<pre class="formula">
%αo = %αs × 1 + %αb × ( 1 − %αs )
</pre>

<p>
各~演算子には、
割合分［
%Fs （この例では 1 ）,
%Fb （この例では 1 − %αs ）
］が定義され，［
最終的な画素 値に寄与し得る図形の被覆率
］を指定する。
被覆率~用の等式の一般~形は：
◎
The fractional terms Fa (1 in this example) and Fb (1 – αs in this example) are defined for each operator and specify the fraction of the shapes that may contribute to the final pixel value. The general form of the equation for coverage is:
</p>

<pre class="formula">
%αs × %Fs + %αb × %Fb
</pre>

<p>
色も組入れられた一般の~Porter-Duff等式は：
◎
and incorporating color gives the general Porter Duff equation
</p>

<pre class="formula">
%co = %αs × %Fs × %Cs + %αb × %Fb × %Cb
</pre>

<div>
<table class="params"><tbody>

<tr><th>%co
<td>出力~alphaにより乗算済みにされた，出力 色（ 0 ≤ %co ≤ 1 ）。

<tr><th>%Fs
<td>
演算子により定義され、
（~alphaにより乗算されていない）~source色 %Cs の含有率を制御する。
%αs は~source %Fs の被覆率を与える。

<tr><th>%Fb
<td>
演算子により定義され、
（~alphaにより乗算されていない）~dest色 %Cb の含有率を制御する。
%αb は~dest %Fb の被覆率を与える。
</table>
◎
Where:
• co is the output color pre-multiplied with the output alpha [0 &lt;= co &lt;= 1]
• αs is the coverage of the source Fa is defined by the operator and controls inclusion of the source Cs is the color of the source (not multiplied by alpha)
• αb is the coverage of the destination Fb is defined by the operator and controls inclusion of the destination Cb is the color of the destination (not multiplied by alpha)
</div>

			<section id="porterduffcompositingoperators_clear">
<h4 title="Clear">9.1.1. `clear@v</h4>

<p>
［
~source, ~dest
］どちらも結果に現れない。
◎
No regions are enabled.
</p>

<!-- 
<figure><img
	alt="example of porter duff clear"
	src="compositing/PD_clr.svg"
></figure>
 -->

<!-- 
<figure><img\s+alt="([^"]+)"\s+src="([^"]+)"\s*></figure>
<a href="$2" title="$1">元画像</a>
 -->

<table class="comp-table"><thead>
<tr><td>~source<td>~dest<td>結果
<tbody><tr><td><div class="comp-box">
<div class="comp-source"></div>
</div><td><div class="comp-box">
<div class="comp-dest"></div>
</div><td><div class="comp-box">
</div></table>

<pre class="formula">
%Fs = 0 ; %Fb = 0
%co = 0
%αo = 0
</pre>

			</section>
			<section id="porterduffcompositingoperators_src">
<h4 title="Copy">9.1.2. `copy@v</h4>

<p>
~sourceのみが結果に現れる。
◎
Only the source will be present.
</p>

<!-- 
<figure><img
	alt="example of porter duff copy"
	src="compositing/PD_src.svg"
></figure>
 -->

<table class="comp-table"><thead>
<tr><th>~source<th>~dest<th>結果
<tbody><tr><td><div class="comp-box">
<div class="comp-source"></div>
</div><td><div class="comp-box">
<div class="comp-dest"></div>
</div><td><div class="comp-box">
<div class="comp-source"></div>
</div></table>

<pre class="formula">
%Fs = 1 ; %Fb = 0
%co = %αs × %Cs
%αo = %αs
</pre>

			</section>
			<section id="porterduffcompositingoperators_dst">
<h4 title="Destination">9.1.3. `destination@v</h4>

<p>
~destのみが結果に現れる。
◎
Only the destination will be present.
</p>

<!-- 
<figure><img
	alt="example of porter duff destination"
	src="compositing/PD_dst.svg"
></figure>
 -->

<table class="comp-table"><thead>
<tr><th>~source<th>~dest<th>結果
<tbody><tr><td><div class="comp-box">
<div class="comp-source"></div>
</div><td><div class="comp-box">
<div class="comp-dest"></div>
</div><td><div class="comp-box">
<div class="comp-dest"></div>
</div></table>

<pre class="formula">
%Fs = 0 ; %Fb = 1
%co = %αb × %Cb
%αo = %αb
</pre>

			</section>
			<section id="porterduffcompositingoperators_srcover">
<h4 title="Source Over">9.1.4. `source-over@v</h4>

<p>
~sourceと~destが重合する所には~source,
他所には［
~source, ~dest
］が結果に現れる。
◎
Source is placed over the destination.
</p>

<!-- 
<figure><img
	alt="example of porter duff source over"
	src="compositing/PD_src-over.svg"
></figure>
 -->

<table class="comp-table"><thead>
<tr><th>~source<th>~dest<th>結果
<tbody><tr><td><div class="comp-box">
<div class="comp-source"></div>
</div><td><div class="comp-box">
<div class="comp-dest"></div>
</div><td><div class="comp-box">
<div class="comp-dest"></div>
<div class="comp-source"></div>
</div></table>

<pre class="formula">
%Fs = 1 ; %Fb = 1 − %αs
%co = %αs × %Cs + %αb × %Cb × ( 1 − %αs )
%αo = %αs + %αb × ( 1 − %αs )
</pre>

			</section>
			<section id="porterduffcompositingoperators_dstover">
<h4 title="Destination Over">9.1.5. `destination-over@v</h4>

<p>
~sourceと~destが重合する所には~dest,
他所には［
~source, ~dest
］が結果に現れる。
◎
Destination is placed over the source.
</p>

<!-- 
<figure><img
	alt="example of porter duff destination over"
	src="compositing/PD_dst-over.svg"
></figure>
 -->

<table class="comp-table"><thead>
<tr><th>~source<th>~dest<th>結果
<tbody><tr><td><div class="comp-box">
<div class="comp-source"></div>
</div><td><div class="comp-box">
<div class="comp-dest"></div>
</div><td><div class="comp-box">
<div class="comp-source"></div>
<div class="comp-dest"></div>
</div></table>

<pre class="formula">
%Fs = 1 − %αb ; %Fb = 1
%co = %αs × %Cs × ( 1 − %αb ) + %αb × %Cb
%αo = %αs × ( 1 − %αb ) + %αb
</pre>

			</section>
			<section id="porterduffcompositingoperators_srcin">
<h4 title="Source In">9.1.6. `source-in@v</h4>

<p>
~sourceと~destが重合する所にのみ，~sourceが結果に現れる
— 他所には何も現れない。
◎
The source that overlaps the destination, replaces the destination.
</p>

<!-- 
<figure><img
	alt="example of porter duff source in"
	src="compositing/PD_src-in.svg"
></figure>
 -->

<table class="comp-table"><thead>
<tr><th>~source<th>~dest<th>結果
<tbody><tr><td><div class="comp-box">
<div class="comp-source"></div>
</div><td><div class="comp-box">
<div class="comp-dest"></div>
</div><td><div class="comp-box">
<div class="comp-both comp-source"></div>
</div></table>

<pre class="formula">
%Fs = %αb ; %Fb = 0
%co = %αs × %Cs × %αb
%αo = %αs × %αb
</pre>

			</section>
			<section id="porterduffcompositingoperators_dstin">
<h4 title="Destination In">9.1.7. `destination-in@v</h4>

<p>
~sourceと~destが重合する所にのみ，~destが結果に現れる
— 他所には何も現れない。
◎
Destination which overlaps the source, replaces the source.
</p>

<!-- 
<figure><img
	alt="example of porter duff destination in "
	src="compositing/PD_dst-in.svg"
></figure>
 -->

<table class="comp-table"><thead>
<tr><th>~source<th>~dest<th>結果
<tbody><tr><td><div class="comp-box">
<div class="comp-source"></div>
</div><td><div class="comp-box">
<div class="comp-dest"></div>
</div><td><div class="comp-box">
<div class="comp-both comp-dest"></div>
</div></table>

<pre class="formula">
%Fs = 0 ; %Fb = %αs
%co = %αb × %Cb × %αs 
%αo = %αb × %αs
</pre>

			</section>
			<section id="porterduffcompositingoperators_srcout">
<h4 title="Source Out">9.1.8. `source-out@v</h4>

<p>
~sourceと~destが重合しない所にのみ，~sourceが結果に現れる
— 他所には何も現れない。
◎
Source is placed, where it falls outside of the destination.
</p>

<!-- 
<figure><img
	alt="example of porter duff source out"
	src="compositing/PD_src-out.svg"
></figure>
 -->

<table class="comp-table"><thead>
<tr><th>~source<th>~dest<th>結果
<tbody><tr><td><div class="comp-box">
<div class="comp-source"></div>
</div><td><div class="comp-box">
<div class="comp-dest"></div>
</div><td><div class="comp-box">
<div class="comp-source"></div>
<div class="comp-dest comp-negate"></div>
</div></table>

<pre class="formula">
%Fs = 1 − %αb ; %Fb = 0
%co = %αs × %Cs × ( 1 − %αb )
%αo = %αs × ( 1 − %αb )
</pre>

			</section>
			<section id="porterduffcompositingoperators_dstout">
<h4 title="Destination Out">9.1.9. `destination-out@v</h4>

<p>
~sourceと~destが重合しない所にのみ，~destが結果に現れる
— 他所には何も現れない。
◎
Destination is placed, where it falls outside of the source.
</p>

<!-- 
<figure><img
	alt="example of porter duff destination out"
	src="compositing/PD_dst-out.svg"
></figure>
 -->

<table class="comp-table"><thead>
<tr><th>~source<th>~dest<th>結果
<tbody><tr><td><div class="comp-box">
<div class="comp-source"></div>
</div><td><div class="comp-box">
<div class="comp-dest"></div>
</div><td><div class="comp-box">
<div class="comp-dest"></div>
<div class="comp-source comp-negate"></div>
</div></table>

<pre class="formula">
%Fs = 0 ; %Fb = 1 − %αs
%co = %αb × %Cb × ( 1 − %αs )
%αo = %αb × ( 1 − %αs )
</pre>

			</section>
			<section id="porterduffcompositingoperators_srcatop">
<h4 title="Source Atop">9.1.10. `source-atop@v</h4>

<p>
~sourceと~destが重合する所には~source,
他所には~destのみが結果に現れる。
◎
Source which overlaps the destination, replaces the destination. Destination is placed elsewhere.
</p>

<!-- 
<figure><img
	alt="example of porter duff source atop"
	src="compositing/PD_src-atop.svg"
></figure>
 -->

<table class="comp-table"><thead>
<tr><th>~source<th>~dest<th>結果
<tbody><tr><td><div class="comp-box">
<div class="comp-source"></div>
</div><td><div class="comp-box">
<div class="comp-dest"></div>
</div><td><div class="comp-box">
<div class="comp-dest"></div>
<div class="comp-both comp-source"></div>
</div></table>

<pre class="formula">
%Fs = %αb ; %Fb = 1 − %αs
%co = %αs × %Cs × %αb + %αb × %Cb × ( 1 − %αs )
%αo = %αs × %αb + %αb × ( 1 − %αs )
</pre>

			</section>
			<section id="porterduffcompositingoperators_dstatop">
<h4 title="Destination Atop">9.1.11. `destination-atop@v</h4>

<p>
~sourceと~destが重合する所には~dest,
他所には~sourceのみが結果に現れる。
◎
Destination which overlaps the source replaces the source. Source is placed elsewhere.
</p>

<!-- 
<figure><img
	alt="example of porter duff destination atop"
	src="compositing/PD_dst-atop.svg"
></figure>
 -->

<table class="comp-table"><thead>
<tr><th>~source<th>~dest<th>結果
<tbody><tr><td><div class="comp-box">
<div class="comp-source"></div>
</div><td><div class="comp-box">
<div class="comp-dest"></div>
</div><td><div class="comp-box">
<div class="comp-source"></div>
<div class="comp-both comp-dest"></div>
</div></table>

<pre class="formula">
%Fs = 1 − %αb ; %Fb = %αs
%co = %αs × %Cs × ( 1 − %αb ) + %αb × %Cb × %αs
%αo = %αs × ( 1 − %αb ) + %αb × %αs
</pre>

			</section>
			<section id="porterduffcompositingoperators_xor">
<h4 title="XOR">9.1.12. `xor@v</h4>

<p>
~sourceと~destが重合しない所にのみ，［
~source, ~dest
］が結果に現れる。
◎
The non-overlapping regions of source and destination are combined.
</p>

<!-- 
<figure><img
	alt="example of porter duff xor"
	src="compositing/PD_xor.svg"
></figure>
 -->

<table class="comp-table"><thead>
<tr><th>~source<th>~dest<th>結果
<tbody><tr><td><div class="comp-box">
<div class="comp-source"></div>
</div><td><div class="comp-box">
<div class="comp-dest"></div>
</div><td><div class="comp-box">
<div class="comp-dest"></div>
<div class="comp-source"></div>
<div class="comp-both comp-negate"></div>
</div></table>

<pre class="formula">
%Fs = 1 − %αb ; %Fb = 1 − %αs
%co = %αs × %Cs × ( 1 − %αb ) + %αb × %Cb × ( 1 − %αs )
%αo = %αs × ( 1 − %αb ) + %αb × ( 1 − %αs )
</pre>

			</section>
			<section id="porterduffcompositingoperators_plus">
<h4 title="Lighter">9.1.13. `lighter@v</h4>

<p>
~sourceと~destの和が結果に現れる。
~Porter-Duff論文 `PORTERDUFF$r では， “plus” 演算子として定義されている。
◎
Display the sum of the source image and destination image. It is defined in the Porter Duff paper as the plus operator [PORTERDUFF].
</p>

<pre class="formula">
%Fs = 1; %Fb = 1
%co = %αs × %Cs + %αb × %Cb
%αo = %αs + %αb
</pre>

			</section>
			<section id="porterduffcompositingoperators_plus_darker">
<h4 title="Plus-darker">9.1.14. `plus-darker@v</h4>

<p class="trans-note">【
この節（この訳による追加）は、
この仕様ではなく， `~level 2$ の内容。
】</p>

<p>
次の手続きが遂行される：
◎
With the plus-darker compositing operator, the following steps are performed:
</p>

<pre class="formula">
%Fs = 1; %Fb = 1
%co = max( 0, 1 − %αs x %Cs + 1 − %αb x %Cb )
%αo = max( 0, 1 − %αs + 1 − %αb )
</pre>

<p class="trans-note">【
この式だと， `max^op を適用しなくても結果は同じになるように見受けられる
（式の中の 2 つの "1" のうち 1 つは余計？）。
】</p>

			</section>
			<section id="porterduffcompositingoperators_plus_lighter">
<h4 title="Plus-lighter">9.1.15. `plus-lighter@v</h4>

<p class="trans-note">【
この節（この訳による追加）は、
この仕様ではなく，`~level 2$ の内容。
】</p>

<p>
次の手続きが遂行される：
◎
With the plus-lighter compositing operator, the following steps are performed:
</p>

<pre class="formula">
%Fs = 1; %Fb = 1
%co = min( 1, %αs x %Cs + %αb x %Cb )
%αo = min( 1, %αs + %αb )
</pre>

<div class="example">
<p>
`plus-lighter$v は、
特に，~cross-fade効果~用に有用になる。
◎
plus-lighter is particularly useful for cross-fade effects.
</p>

<p>
次の見本~markupと：
◎
Given the following sample markup:
</p>

`plus-lighter-1^xCode

<p>
次の~styleが与えられていて：
◎
And the following styles:
</p>

<pre class="lang-css">
.container {
  display: grid;
}
.container &gt; div {
  width: 100px;
  height: 100px;
  /* <span class="comment">
要素を互いに重なるよう配置する
◎
Place the elements on top of each other
</span> */
  grid-area: 1 / 1;
}
.from {
  background-color: rgb(100% 0% 0% / 50%);
}
.to {
  background-color: rgb(0% 0% 100% / 50%);
}
</pre>

<p>
`from^css と `to^css の合間で 50% ~cross-fadeを生産するよう求まれるなら、
素朴な~approachは，それぞれに不透明度 50% を与えることになろう：
◎
If you wanted to produce a 50% cross-fade between from and to, a naive approach would be to give each 50% opacity:
</p>

<pre class="lang-css">
.from {
  opacity: 0.5;
}
.to {
  opacity: 0.5;
}
</pre>

<p>
しかしながら、
既定の `source-over$v 組成-法で これが生産する結果は，
およそ `rgb(43% 0% 57% / 44%)^v になる†。
これは、
要素を “層~化する” ときには正しい値を与えるが，
50% ~cross-fade用には不正になる。
◎
However, with default source-over compositing, this produces a result of roughly rgb(43% 0% 57% / 44%). This is correct value when "layering" elements, but it’s incorrect for a 50% cross-fade.
</p>

<p class="trans-note">【†
`source-over$v の計算-法と合ってない
— `§ 単純~alpha組成-法の例＠#simplealphacompositingexamples$
の最後の例と同じ結果になるべきであろう。
】</p>

<p>
代わりに `plus-lighter$v を利用すれば：
◎
Instead, using plus-lighter:
</p>

<pre class="lang-css">.container {
  /* <span class="comment">
`plus-lighter^v 演算の視野を制限する
◎
Limit the scope of the plus-lighter operation
</span> */
  isolation: isolate;
}
.from {
  opacity: 0.5;
}
.to {
  opacity: 0.5;
  mix-blend-mode: plus-lighter;
}
</pre>

<p>
結果は `rgb(50% 0% 50% / 50%)^v になり，
`from^v, `to^v 2 つの色の正しい “中間点” になる。
◎
This results in rgb(50% 0% 50% / 50%), which is correctly "half-way" between the from and to colors.
</p>
</div>

			</section>
		</section>
		<section id="groupcompositing">
<h3 title="Group compositing behavior with Porter Duff modes">9.2. 各種~Porter-Duff~modeによる~group組成-法の挙動</h3>

<p>
`隔離d~group$の中の要素を組成するとき、
要素が組成される`初期~後景$は，`透明な黒$にされる。
~groupの中の最も奥側の要素が，後景に依存する~Porter-Duff組成~演算子 —
`destination$v,
`source-in$v,
`destination-in$v,
`destination-out$v,
`source-atop$v
など —
を利用している場合、
組成した結果は空になる。
~group内の後続な要素は、
最初に組成した結果に組成される。
<!-- ＊ 順次，累積的に？  -->
◎
When compositing the elements within an isolated group, the elements are composited over a transparent black initial backdrop. If the bottom element in the group uses a Porter Duff compositing operator which is dependent on the backdrop, such as destination, source-in, destination-in, destination-out or source-atop, then the result of the composite will be empty. Subsequent elements within the group are composited with the result of the first composite.
</p>

		</section>
	</section>
	<section id="blending">
<h2 title="Blending">10. 混色-法</h2>

<p>
混色-法（ `blending^en ）は、
組成-法の［
~source要素と`後景$とが重合する所における色の混合
］を計算する側面を成す。
概念的には、
~source要素の色が後景と混色された上で，結果の［
色が改変された~source要素
］が後景に組成される。
これは、
実施においては，一~段にまとめて遂行されるのが通例である。
混色~計算では、
乗算済み色~値は利用しない†モノトスル。
◎
Blending is the aspect of compositing that calculates the mixing of colors where the source element and backdrop overlap.
Conceptually, the colors in the source element are blended in place with the backdrop. After blending, the modified source element is composited with the backdrop. In practice, this is usually all performed in one step.
The blending calculations must not use pre-multiplied color values.
</p>

<p class="trans-note">【†
すなわち，以下に見られるとおり、
混色の本質的な部分を成す混色~関数 B() には，~alpha（不透明度）は関わらない。
】</p>

<p>
“混合” の公式は、
次で定義される：
◎
The "mixing" formula is defined as:
</p>

<pre class="formula">
%Cm = B( %Cb, %Cs )
</pre>

<div>
<table class="params"><tbody>

<tr><th>%Cm
<td>混色した結果の色

<tr><th>B
<td>混色を行う公式

<tr><th>%Cb
<td>`後景$色

<tr><th>%Cs
<td>~source色
</table>
◎
with:
• Cm: the result color after blending
• B: the formula that does the blending
• Cb: the backdrop color
• Cs: the source color
</div>

<p>
混色~公式の結果は、
色の範囲の最小／最大~値で切詰めるモノトスル。
◎
The result of the mixing formula must be clamped to the minimum and maximum values of the color range.
</p>

<p>
混合~関数の結果は、
後景~alphaにより変調される。
後景が全-不透明ならば、
混合~関数の結果がそのまま表示に~~現れる。
後景に透明度がある場合、
最終的な結果は，後景~alphaで制御される重みによる［
~source色, 混合された色
］の加重平均になる。
すなわち、
結果の色~値は次の様になる：
◎
The result of the mixing function is modulated by the backdrop alpha. A fully opaque backdrop allows the mixing function to be fully realized. A transparent backdrop will cause the final result to be a weighted average between the source color and mixed color with the weight controlled by the backdrop alpha. The value of the new color becomes:
</p>

<pre class="formula">
%Cr = ( 1 − %αb ) × %Cs + %αb × B( %Cb, %Cs )
</pre>

<div>
<table class="params"><tbody>

<tr><th>%Cr
<td>結果の色

<tr><th>B
<td>混色を行う公式

<tr><th>%Cs
<td>~source色

<tr><th>%Cb
<td>`後景$色

<tr><th>%αb
<td>`後景$~alpha
</table>
◎
with:
• Cr: the result color
• B: the formula that does the blending
• Cs: the source color
• Cb: the backdrop color
• αb: the backdrop alpha
</div>

<div class="example" id="ex-blend-with-opacity">
<figure>`blend_background_opacity^dgm
<figcaption>
不透明度が異なる緑色~矩形たちの上に赤色~矩形を置く混色~modeの例。
`後景$の不透明度が低くなるほど，前面に塗られる矩形は~~元の赤色に近くなる。
◎
This example has a red rectangle with a blending mode that is placed on top of a set of green rectangles that have different levels of opacity.
◎
Note how the top rectangle shifts more toward red as the opacity of the backdrop gets smaller.

</figcaption></figure>
</div>

<p class="note">注記：
~sourceと後景が交差する区域における色~値は，次の公式で与えられ、
指定された~Porter-Duff組成~公式により組成される。
単純~alpha混色~用の公式は次の様になる：
◎
Note: The following formula gives the color value in the area where the source and backdrop intersects and then composites with the specified Porter Duff compositing formula. For simple alpha blending, the formula thus becomes:
</p>

<p>
`単純~alpha組成-法$の公式：
◎
simple alpha compositing:
</p>

<pre class="formula">
%co = %cs + %cb × ( 1 − %αs )
</pre>

<p>
乗算済みでない値による公式は：
◎
written as non-premultiplied:
</p>

<pre class="formula">
%αo × %Co = %αs × %Cs + ( 1 − %αs ) × %αb × %Cb
</pre>

<p>
%Cs を［
混色した結果【 上述の %Cr 】
］で代用した【一般の混色-~modeの場合の】結果は：
◎
now substitute the result of blending for Cs:
</p>

<pre class="formula">
%αo × %Co = %αs × (( 1 − %αb ) × %Cs + %αb × B( %Cb, %Cs )) + ( 1 − %αs ) × %αb × %Cb
        = %αs × ( 1 − %αb ) × %Cs + %αs × %αb × B( %Cb, %Cs ) + ( 1 − %αs ) × %αb × %Cb
</pre>

		<section id="blendingseparable">
<h3 title="Separable blend modes">10.1. 成分別の混色-~mode</h3>

<p>
結果の各 色~成分が，`後景$と~sourceの対応する色~成分のみから決定される場合
— すなわち，混色~公式が，対応する成分ごとに<strong>別々に</strong>適用される場合 —
その混色-~modeを，成分別と呼ぶ。
◎
A blend mode is termed separable if each component of the result color is completely determined by the corresponding components of the constituent backdrop and source colors — that is, if the mixing formula is applied separately to each set of corresponding components.
</p>

<p>
以下に挙げる各種 混色-~modeは、
混色~公式 B( %Cb, %Cs ) を，各 色~成分ごとに適用することになる。
単純にするため、
この節のすべての例では， `source-over$v 組成-法を利用する。
◎
Each of the following blend modes will apply the blending function B(Cb, Cs) on each of the color components. For simplicity, all the examples in this chapter use source-over compositing.
</p>

`mix-demo^dgm

			<section id="blendingnormal">
<h4 id="valdef-blend-mode-normal" title="normal blend mode">10.1.1. `normal^v 混色-~mode</h4>

<p id="normal">
これが既定の値であり、
混色しないことを指定する。
混色~公式は、
単純に~source色を選択する。
◎
This is the default attribute which specifies no blending. The blending formula simply selects the source color.
</p>

<pre class="formula">
B( %Cb, %Cs ) = %Cs
</pre>

<figure>`normal^dgm
<figcaption>
想定される描画（左）と利用中の~browserによる表示
</figcaption></figure>

			</section>
			<section id="blendingmultiply">
<h4 id="valdef-blend-mode-multiply" title="multiply blend mode">10.1.2. `multiply^v 混色-~mode</h4>

<p>
~source色と~dest色を乗算する。
◎
The source color is multiplied by the destination color and replaces the destination.
</p>

<p>
結果の色は、
どの場所でも［
~source, ~dest
］のうち暗な方 以下の暗さになる。
どの色も［
黒色と `multiply$v した結果は黒色 ／
白色と `multiply$v した結果は元の色
］になる。

◎
The resultant color is always at least as dark as either the source or destination color. Multiplying any color with black results in black. Multiplying any color with white preserves the original color.
</p>

<pre class="formula">
B( %Cb, %Cs ) = %Cb × %Cs
</pre>

<figure>`multiply^dgm
<figcaption>
想定される描画（左）と利用中の~browserによる表示
</figcaption></figure>

			</section>
			<section id="blendingscreen">
<h4 id="valdef-blend-mode-screen" title="screen blend mode">10.1.3. `screen^v 混色-~mode</h4>

<p>
`後景$色の補色と~source色の補色を乗算した結果の補色をとる。
【補色 — 明度も反転された補色】
◎
Multiplies the complements of the backdrop and source color values, then complements the result.
</p>

<p>
結果の色は、
どの場所でも［
~source, ~dest
］のうち明な方 以上の明るさになる。
どの色も［
白色と `screen$v した結果は白色 ／
黒色と `screen$v した結果は元の色
］になる。
その効果は、
複数のスライド写真を同じ~screen上に同時に投影したときに類似する。
◎
The result color is always at least as light as either of the two constituent colors. Screening any color with white produces white; screening with black leaves the original color unchanged. The effect is similar to projecting multiple photographic slides simultaneously onto a single screen.
</p>

<pre class="formula">
B( %Cb, %Cs ) = 1 − ( 1 − %Cb ) × ( 1 − %Cs )
          = %Cb + %Cs − ( %Cb × %Cs )
</pre>

<figure>`screen^dgm
<figcaption>
想定される描画（左）と利用中の~browserによる表示
</figcaption></figure>

			</section>
			<section id="blendingoverlay">
<h4 id="valdef-blend-mode-overlay" title="overlay blend mode">10.1.4. `overlay^v 混色-~mode</h4>

<p>
`後景$の色~値に依存して， `multiply$v するか または `screen$v する
◎
Multiplies or screens the colors, depending on the backdrop color value.
</p>

<p>
~source色を，その光輝と陰影を保全しつつ，
`後景$に overlay する。
`後景$色は置換されないが、
`後景$の明度または暗度が反映されるよう，~source色と混合される。
◎
Source colors overlay the backdrop while preserving its highlights and shadows. The backdrop color is not replaced but is mixed with the source color to reflect the lightness or darkness of the backdrop.
</p>

<pre class="formula">
B( %Cb, %Cs ) = HardLight( %Cs, %Cb )
</pre>

<p>
`overlay$v は、
`hard-light$v 混色-~modeの反転である。
その公式については， `hard-light$v の定義を見よ。
◎
Overlay is the inverse of the hard-light blend mode. See the definition of hard-light for the formula.
</p>

<figure>`overlay^dgm
<figcaption>
想定される描画（左）と利用中の~browserによる表示
</figcaption></figure>

			</section>
			<section id="blendingdarken">
<h4 id="valdef-blend-mode-darken" title="darken blend mode">10.1.5. `darken^v 混色-~mode</h4>

<p>
`後景$と~source色のより暗な方を選択する。
◎
Selects the darker of the backdrop and source colors.
</p>

<p>
`後景$は、
~sourceがより暗な所では~sourceに置換され，
他所では不変なままにされる。
◎
The backdrop is replaced with the source where the source is darker; otherwise, it is left unchanged.
</p>

<pre class="formula">
B( %Cb, %Cs ) = min( %Cb, %Cs )
</pre>

<figure>`darken^dgm
<figcaption>
想定される描画（左）と利用中の~browserによる表示
</figcaption></figure>

			</section>
			<section id="blendinglighten">
<h4 id="valdef-blend-mode-lighten" title="lighten blend mode">10.1.6. `lighten^v 混色-~mode</h4>

<p>
`後景$と~source色の，より明な方を選択する。
◎
Selects the lighter of the backdrop and source colors.
</p>

<p>
`後景$は、
~sourceがより明な所では~sourceに置換され，
他所では不変なままにされる。
◎
The backdrop is replaced with the source where the source is lighter; otherwise, it is left unchanged.
</p>

<pre class="formula">
B( %Cb, %Cs ) = max( %Cb, %Cs )
</pre>

<p>
結果が範囲を超過する所【色域に入らない所】では，切り下げるモノトスル。
◎
Note: The result must be rounded down if it exceeds the range.
</p>

<figure>`lighten^dgm
<figcaption>
想定される描画（左）と利用中の~browserによる表示
</figcaption></figure>

			</section>
			<section id="blendingcolordodge">
<h4 id="valdef-blend-mode-color-dodge" title="color-dodge blend mode">10.1.7. `color-dodge^v 混色-~mode</h4>

<p>
~source色を反映するように，`後景$色を輝かせる。
黒色で塗っても，何も変わらない。
◎
Brightens the backdrop color to reflect the source color. Painting with black produces no changes.
</p>

<pre class="formula">
if( %Cb == 0)
    B( %Cb, %Cs ) = 0
else if( %Cs == 1)
    B( %Cb, %Cs ) = 1
else
    B( %Cb, %Cs ) = min( 1, %Cb ÷ ( 1 − %Cs ))
</pre>

<figure>`color-dodge^dgm
<figcaption>
想定される描画（左）と利用中の~browserによる表示
</figcaption></figure>

			</section>
			<section id="blendingcolorburn">
<h4 id="valdef-blend-mode-color-burn" title="color-burn blend mode">10.1.8. `color-burn^v 混色-~mode</h4>

<p>
~source色を反映するように`後景$色を暗化する。
白色で塗っても，何も変わらない。
◎
Darkens the backdrop color to reflect the source color. Painting with white produces no change.
</p>

<pre class="formula">
if( %Cb == 1)
    B( %Cb, %Cs ) = 1
else if( %Cs == 0)
    B( %Cb, %Cs ) = 0
else
    B( %Cb, %Cs ) = 1 − min( 1, ( 1 − %Cb ) ÷ %Cs )
</pre>

<figure>`color-burn^dgm
<figcaption>
想定される描画（左）と利用中の~browserによる表示
</figcaption></figure>

			</section>
			<section id="blendinghardlight">
<h4 id="valdef-blend-mode-hard-light" title="hard-light blend mode">10.1.9. `hard-light^v 混色-~mode</h4>

<p>
~source色~値に依存して，色を乗算するか `screen$v する。
その効果は、
`後景$上に~spotlightをきつく照らしたときに類似する。
◎
Multiplies or screens the colors, depending on the source color value. The effect is similar to shining a harsh spotlight on the backdrop.
</p>

<pre class="formula">
if( %Cs ≤ 0.5)
    B( %Cb, %Cs ) = Multiply( %Cb, 2 × %Cs )
else
    B( %Cb, %Cs ) = Screen( %Cb, 2 × %Cs − 1)
</pre>

<!--
B(Cb, Cs) = Cb + m (2 Cs - 1)

	m = (Cs <= 0.5) ? Cb : (1 - Cb)
-->

<p>
公式については `multiply$v と `screen$v の定義を見よ。
◎
See the definition of multiply and screen for their formulas.
</p>

<figure>`hard-light^dgm
<figcaption>
想定される描画（左）と利用中の~browserによる表示
</figcaption></figure>

			</section>
			<section id="blendingsoftlight">
<h4 id="valdef-blend-mode-soft-light" title="soft-light blend mode">10.1.10. `soft-light^v 混色-~mode</h4>

<p>
~source色~値に依存して，色を暗化するか明化する。
その効果は、
`後景$上に拡散~spotlightを照らしたときに類似する。
◎
Darkens or lightens the colors, depending on the source color value. The effect is similar to shining a diffused spotlight on the backdrop.
</p>

<pre class="formula">
if( %Cs ≤ 0.5)
    B( %Cb, %Cs ) = %Cb − ( 1 − 2 × %Cs ) × %Cb × ( 1 − %Cb )
else
    B( %Cb, %Cs ) = %Cb + ( 2 × %Cs − 1 ) × ( D( %Cb ) − %Cb )
    ここで
    if( %Cb ≤ 0.25)
        D( %Cb ) = (( 16 × %Cb − 12 ) × %Cb + 4 ) × %Cb
    else
        D( %Cb ) = sqrt( %Cb )
</pre>

<figure>`soft-light^dgm
<figcaption>
想定される描画（左）と利用中の~browserによる表示
</figcaption></figure>

			</section>
			<section id="blendingdifference">
<h4 id="valdef-blend-mode-difference" title="difference blend mode">10.1.11. `difference^v 混色-~mode</h4>

<p>
2 つの色の，より明な方の色からより暗な方の色を減算する。
◎
Subtracts the darker of the two constituent colors from the lighter color.
</p>

<p>
白色で塗ったときは，`後景$色を反転させる。
黒色で塗っても，何も変わらない。
◎
Painting with white inverts the backdrop color; painting with black produces no change.
</p>

<pre class="formula">
B( %Cb, %Cs ) = abs( %Cb − %Cs )
</pre>

<figure>`difference^dgm
<figcaption>
想定される描画（左）と利用中の~browserによる表示
</figcaption></figure>

			</section>
			<section id="blendingexclusion">
<h4 id="valdef-blend-mode-exclusion" title="exclusion blend mode">10.1.12. `exclusion^v 混色-~mode</h4>

<p>
`difference$v ~modeに類似な効果を生産するが、
~contrastは弱まる。
白色で塗ったときは，`後景$色を反転させる。
黒色で塗っても，何も変わらない。
◎
Produces an effect similar to that of the Difference mode but lower in contrast. Painting with white inverts the backdrop color; painting with black produces no change
</p>

<pre class="formula">
B( %Cb, %Cs ) = %Cb + %Cs − 2 × %Cb × %Cs
</pre>

<figure>`exclusion^dgm
<figcaption>
想定される描画（左）と利用中の~browserによる表示
</figcaption></figure>

			</section>
		</section>
		<section id="blendingnonseparable">
<h3 title="Non-separable blend modes">10.2. 成分別でない混色-~mode</h3>

<p>
成分別でない混色-~modeでは、
成分ごとに個別に~~扱わずに，
すべての色~成分の組合nを考慮する。
これらすべての混色-~modeは、
概念的には，次の手続きを要する：
◎
Nonseparable blend modes consider all color components in combination as opposed to the separable ones that look at each component individually. All of these blend modes conceptually entail the following steps:
</p>

<ol>
	<li>
`後景$と~source色を，混色~用の色~空間から中間処理~用の［
色相, 彩度, 光度
］（ `hue-saturation-luminosity^en ）による表現に変換する。
◎
Convert the backdrop and source colors from the blending color space to an intermediate hue-saturation-luminosity representation.
</li>
	<li>
`後景$と~sourceの色から選択される［
色相, 彩度, 光度
］成分の何らかの組合nに基づいて，新たな色を作成する。
◎
Create a new color from some combination of hue, saturation, and luminosity components selected from the backdrop and source colors.
</li>
	<li>
前~段の結果を逆~変換して元の色~空間へ戻す。
◎
Convert the result back to the original color space.
</li>
</ol>

<p>
成分別でない混色-~modeの公式は、
いくつかの補助~関数を用立てる：
◎
The nonseparable blend mode formulas make use of several auxiliary functions:
</p>

<pre class="formula">
Lum( %C ) {
    return 0.3 × %C.red + 0.59 × %C.green + 0.11 × %C.blue
}

Max( %C ) {
    return max( %C.red, %C.green, %C.blue )
}

Min( %C ) {
    return min( %C.red, %C.green, %C.blue )
}

ClipColor( %C ) {
    %L = Lum( %C )
    %max = Max( %C )
    %min = Min( %C )
    if( %min &lt; 0 ) {
        %C.red   = %L + ( %C.red   − %L ) × %L ÷ ( %L − %min )
        %C.green = %L + ( %C.green − %L ) × %L ÷ ( %L − %min )
        %C.blue  = %L + ( %C.blue  − %L ) × %L ÷ ( %L − %min )
    }
    if( %max &gt; 1 ) {
        %C.red   = %L + ( %C.red   − %L ) × ( 1 − %L ) ÷ ( %max − %L )
        %C.green = %L + ( %C.green − %L ) × ( 1 − %L ) ÷ ( %max − %L )
        %C.blue  = %L + ( %C.blue  − %L ) × ( 1 − %L ) ÷ ( %max − %L )
    }
    return %C
}

SetLum( %C, %l ) {
    %d = %l − Lum( %C )
    %C.red   += %d
    %C.green += %d
    %C.blue  += %d
    return ClipColor( %C )
}

Sat( %C ) {
    return Max( %C ) − Min( %C )
}
</pre>
<!-- 
Lum(C) = 0.3 x Cred + 0.59 x Cgreen + 0.11 x Cblue

ClipColor(C)
	L = Lum(C)
	n = min(Cred, Cgreen, Cblue)
	x = max(Cred, Cgreen, Cblue)
	if(n < 0)
		C = L + (((C - L) × L) / (L - n))

	if(x > 1)
		C = L + (((C - L) × (1 - L)) / (x - L))

	return C

SetLum(C, l)
	d = l - Lum(C)
	Cred = Cred + d
	Cgreen = Cgreen + d
	Cblue = Cblue + d
	return ClipColor(C)

Sat(C) = max(Cred, Cgreen, Cblue) - min(Cred, Cgreen, Cblue)

L = min
0.3 R + 0.59 G + 0.11 B == R
0.59 G + 0.11 B == 0.7R < 0
-->

<p>
次の関数の［
.min, .mid, .max
］は、
それぞれ，関数に入った時点で値が［
最小, ~~中央, 最大
］の異なる色~成分を指すとする。
◎
The subscripts min, mid, and max in the next function refer to the color components having the minimum, middle, and maximum values upon entry to the function.
</p>

<pre class="formula">
SetSat( %C, %s ) {
    if( %C.max &gt; %C.min ) {
        %C.mid = (( %C.mid − %C.min ) ÷ ( %C.max − %C.min )) × %s
        %C.max = %s
    } else {
        %C.mid = %C.max = 0
    }
    %C.min = 0
    return %C
}
</pre>

			<section id="blendinghue">
<h4 id="valdef-blend-mode-hue" title="hue blend mode">10.2.1. `hue^v 混色-~mode</h4>

<p>
~source色の色相, `後景$色の彩度と光度を伴う色を作成する。
◎
Creates a color with the hue of the source color and the saturation and luminosity of the backdrop color.
</p>

<pre class="formula">
B( %Cb, %Cs ) = SetLum(SetSat( %Cs, Sat( %Cb )), Lum( %Cb ))
</pre>

<figure>`hue^dgm
<figcaption>
想定される描画（左）と利用中の~browserによる表示
</figcaption></figure>

			</section>
			<section id="blendingsaturation">
<h4 id="valdef-blend-mode-saturation" title="saturation blend mode">10.2.2. `saturation^v 混色-~mode</h4>

<p>
~source色の彩度, `後景$色の色相と光度を伴う色を作成する。
`後景$の中の純粋な灰色（彩度なし）区域に，この~modeで塗っても、
何も変わらない。
◎
Creates a color with the saturation of the source color and the hue and luminosity of the backdrop color. Painting with this mode in an area of the backdrop that is a pure gray (no saturation) produces no change.
</p>

<pre class="formula">
B( %Cb, %Cs ) = SetLum(SetSat( %Cb, Sat( %Cs )), Lum( %Cb ))
</pre>

<figure>`saturation^dgm
<figcaption>
想定される描画（左）と利用中の~browserによる表示
</figcaption></figure>

			</section>
			<section id="blendingcolor">
<h4 id="valdef-blend-mode-color" title="color blend mode">10.2.3. `color^v 混色-~mode</h4>

<p>
~source色の色相と彩度, `後景$色の光度を伴う色を作成する。
これは、
`後景$の灰色~levelを保全し，~monochrome画像の色~付けや, ~color画像の色彩強調（ `tinting^en ）に有用になる。
◎
Creates a color with the hue and saturation of the source color and the luminosity of the backdrop color. This preserves the gray levels of the backdrop and is useful for coloring monochrome images or tinting color images.
</p>

<pre class="formula">
B( %Cb, %Cs ) = SetLum( %Cs, Lum( %Cb ))
</pre>

<figure>`color^dgm
<figcaption>
想定される描画（左）と利用中の~browserによる表示
</figcaption></figure>

			</section>
			<section id="blendingluminosity">
<h4 id="valdef-blend-mode-luminosity" title="luminosity blend mode">10.2.4. `luminosity^v 混色-~mode</h4>

<p>
~source色の光度，および`後景$色の色相と彩度を伴う色を作成する。
これは、
`color$v ~modeの反転~効果を生産する。
◎
Creates a color with the luminosity of the source color and the hue and saturation of the backdrop color. This produces an inverse effect to that of the Color mode.
</p>

<pre class="formula">
B( %Cb, %Cs ) = SetLum( %Cb, Lum( %Cs ))
</pre>

<figure>`luminosity^dgm
<figcaption>
想定される描画（左）と利用中の~browserによる表示
</figcaption></figure>

			</section>
		</section>
		<section id="isolationblending">
<h3 title="Effect of group isolation on blending">10.3. ~group隔離による混色-法に対する効果</h3>

<div class="example" id="ex-isolated-group">
<p>
次の例では、
図左の紙飛行機を構築するために利用されている要素は 通常の~group,
図右の紙飛行機は`隔離d~group$に属し，両者とも混色-~modeは `multiply$v に設定されているとする。
◎
Note: In the following example, the elements used to construct the paper airplane are within a group. Each of these elements has their blend mode set to multiply.
◎
The airplane on the left is a normal group, the airplane on the right is an isolated group.
</p>

<p>
図右の`隔離d~group$においては、
~group内の要素は，空（から）にされた`初期~後景$上に組成されるので、
図の地面と~~空（そら）が描かれた後景（以下 %B と記す）とは乗算されない。
図左の通常の~groupにおいては、
~group内の要素は，
<!-- ＊ 個別的ではなく ~group一体として？ -->
%B 上に組成されるので、
%B で乗算される。
両者とも，~group組成した結果は、
`mix-blend-mode$p に `normal$v
（~groupに適用される既定の `mix-blend-mode$p ）を利用して，%B 上に組成される。
◎
In the isolated group, the elements within the group are composited onto an empty initial backdrop, this stops the elements within the group multiplying with the backdrop. In the normal group, the elements within the group are composited onto the initial backdrop containing the land and sky. Therefore the elements of the airplane multiply with the land and sky. In both instances, the result of the group composite is composited onto the land and sky using the normal mix-blend-mode (the default mix-blend-mode applied to the group).
</p>

<figure>
<p class="alt" hidden id="_dgm-isolate_blend_example">
隔離d~groupを混色した例
◎
example of isolated group blending
</p>
</figure>
</div>

		</section>
	</section>
	<section id="privacy">
<h2 title="Privacy Considerations">~privacyの考慮点</h2>

<p>
この仕様に対し報告された，新たな~privacyの考慮点は、無い。
◎
No new privacy considerations have been reported on this specification.
</p>

	</section>
	<section id="security">
<h2 title="Security Considerations">~securityの考慮点</h2>

<p>
［
混色~演算／組成~演算
］にかかる時間は、［
~source, ~dest
］どちらの画素にも依存しないことが重要である。
画素の値に関わらず，演算にかかる時間は一定になる仕方で実装するモノトスル。
◎
It is important that the timing to the blending and compositing operations is independent of the source and destination pixel. Operations must be implemented in such a way that they always take the same amount of time regardless of the pixel values.
</p>

<div class="note">
<p>
この規則に従わない場合、
攻撃者が情報を推定したり, 計時~攻撃を仕掛けることが可能になる。
◎
If this rule is not followed, an attacker could infer information and mount a timing attack.
</p>

<p>
計時~攻撃は、
演算にかかる時間を調査して，保護されている内容についての情報を得する手法である。
例えば、
赤色~画素を描く時間が緑色~画素より長くかかるとき、
要素の内容への~accessを要することなく，描画された要素の大まかな画像を再構築し得る。
◎
A timing attack is a method of obtaining information about content that is otherwise protected, based on studying the amount of time it takes for an operation to occur. If, for example, red pixels took longer to draw than green pixels, one might be able to reconstruct a rough image of the element being rendered, without ever having access to the content of the element.
</p>
</div>

	</section>
	<section id="changes">
<h2 title="Changes">変更点</h2>

<dl>
	<dt>
`2015年 1月 13日 勧告候補＠~TR/2015/CR-compositing-1-20150113/$
からの変更点
◎
The following changes were made relative to the Candidate Recommendation of 13 January 2015:
</dt>
	<dd>
§ ~privacy, § ~security
を追加した
◎
Added Privacy and Security sections
</dd>
	<dd>
【~prop定義~表tの】
“~animate可否: 不可” を “~animation型: 離散的” へ更新した
◎
Updated Animatable: no to Animation type: discrete
</dd>
	<dd>
［
~HTML, ~SVG
］用の［
根~要素, 根~要素~group
］を定義した。
◎
Defined root elements for HTML and SVG, and the root element group
</dd>
	<dd>
根~group【における`~canvas表面$】を不透明な白色にすることは，必要yでないことを明確化した。
◎
Clarified that root groups are not necessarily opaque white
</dd>
	<dd>
根~groupと隔離d~group用の定義をもっと良くした。
◎
Better definitions for root group and isolating groups
</dd>
	<dd>
乗算~記号に x や * ではなく × を一貫して利用するようにした。
◎
Consistently use the multiplication symbol × rather than x or *
</dd>
	<dd>
`lime^v が意味されていたが `green^v を利用していた例を正した。
◎
Corrected examples that used green where lime was meant
</dd>
	<dd>
`background-blend-mode$p の初期~値を正した。
◎
Corrected initial value of background-blend-mode
</dd>
	<dd>
~markupや~linkに対する雑多な修正s。
◎
Assorted markup and linking fixes
</dd>

	<dt>
`2014年 2月 20日 勧告候補＠~TR/2014/CR-compositing-1-20140220/$
からの変更点
◎
The following changes were made relative to the Candidate Recommendation of 20 February 2014:
</dt>
	<dd>
`img^e 要素で埋込まれた~SVG画像に対する
`isolation$p の強制-は、
~risk下でなくなった。
◎
force isolation of SVG images embedded as &lt;img&gt; no longer at risk
</dd>
	<dd>
`composite-mode$t 用の~option `destination$v を除去した。
◎
removed destination as an option for &lt;composite-mode&gt;
</dd>

	<dt>
`2014年 1月 7日 最終草案＠~TR/2013/WD-compositing-1-20131010/$
からの変更点
◎
The following changes were made relative to the Last Call Working draft of 7 January 2014:
</dt>
	<dd>
不要な参照文献を除去した。
◎
unneeded normative and informative references were removed
</dd>

	<dt>
`2013年 10月 10日 最終草案＠~TR/2013/WD-compositing-1-20131010/$
からの変更点
◎
The following changes were made relative to the Last Call Working draft of 10 October 2013:
</dt>
	<dd>
`knockout^en を規範的でない節から除去した。
◎
knockout was removed from the non-normative section
</dd>
	<dd>
~SVGについての段落を単純~alpha組成-法から除去した
◎
removed paragraph on SVG from simple alpha compositing
</dd>
	<dd>
~CSSを含むように~~要約を更新し，意図を明確化した。
◎
updated abstract to include CSS and clarify intent
</dd>
	<dd>
clip-to-self とその参照文献を除去した。
◎
removed clip-to-self and its references
</dd>
	<dd>
§ 5 〜 § 10 を規範的に変更した。
それらの節の注記や例を明確化した。
◎
Changed section 5-10 to be normative + clarified notes/examples in those sections
</dd>

	<dt>
`2013年 6月 25日 草案＠~TR/2013/WD-compositing-1-20130625/$
からの変更点
◎
The following changes were made relative to the Working Draft of 2013-06-25:
</dt>
	<dd>
~SVGにおいて`隔離d~group$を作成する演算子の一つ，
`clipping^v を除去した。
◎
clipping was removed as one of the operators that creates an isolated group in SVG
</dd>
	<dd>
`background-blend-mode$p を［
他の `background-*^p 構文における繰返しの挙動
］と合致するように変更した。
◎
background-blend-mode was changed so it matches repeating behavior of other background syntaxes.
</dd>
	<dd>
`mix-composite^p ~propを除去した。
◎
The mix-composite property was removed
</dd>
	<dd>
すべての open 課題を解決した。
◎
all open issues were resolved
</dd>
</dl>

	</section>
</main></div>
