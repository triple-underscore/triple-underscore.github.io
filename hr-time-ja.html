<!DOCTYPE html><html lang="ja"><head><meta charset="utf-8">
<title>High Resolution Time Level 2（日本語訳）</title>

<link rel="stylesheet" href="common.css" type="text/css" />
<link rel="stylesheet" href="common-w3c.css" type="text/css" />


<style >
dl.idl-def > dt {
	font-family: monospace0, monospace;
}
</style>

<script src="common0.js" ></script>
<script src="common1.js" async></script>

<script>

Util.ready = function(){
	var source_data = {
		generate: expand
	};
	Util.switchWordsInit(source_data);

//	Util.del_j(); // checked: 170727 spec
}

function expand(){

	var class_map = {
		l: 'literal',
		E: 'dom-error',
	};

	var tag_map = {
		I: 'code',
		m: 'code',
		d: 'code',
		c: 'code',
		E: 'code',
		l: 'code',
		v: 'var',
		b: 'b',
		i: 'i',
	};

	var link_map = this.link_map;

	return this.html.replace(
		/%[\w~一-鿆]+|`(.+?)([$@\^])(\w*)/g,
		create_html
	);

	function create_html(match, key, indicator, klass){

if(!key) {//%
	return '<var>' + match.slice(1) + '</var>';
}

var text = key;
var href = '';
var classname = class_map[klass];
var tag = tag_map[klass];

switch(klass){
case 'r': // ref
	text = '[' + key + ']';
	href = '#bib-' + key;
	break;
case 'l': // literal
	text = '"<code class="literal">' + text + '</code>"'
	break;
}

if(tag) {
	text = '<' + tag + (
		classname ? ' class="' + classname + '"' : ''
	) + '>' + text + '</' + tag + '>';
}


if(indicator !== '^'){
	href = link_map[klass ? (klass + '.' + key) : key] || href;
	if(!href){
		console.log(match); // check error
		return match;
	}

	switch(indicator){
	case '$':
		text = '<a href="' + href + '">' + text + '</a>';
		break;
	case '@':
		text = '<dfn id="' + href.slice(1) + '">' + text + '</dfn>';
		break;
	}
}

return text;


	}
}

</script>

<script type="text/plain" id="_source_data">


●●options

spec_date:2018-02-28
trans_update:2018-03-01
page_state_key:TIMING
original_url:https://w3c.github.io/hr-time/
spec_status:ED
ref_id_prefix:bib-
conformance:w3c
copyright:2018,permissive
trans_1st_pub:2015-07-22


●●original_id_map


●●link_map


Replaceable:~WEBIDL#Replaceable
Exposed:~WEBIDL#Exposed
Default:~WEBIDL#Default

I.DOMHighResTimeStamp:#dom-domhighrestimestamp
	#idl-def-domhighrestimestamp
I.Performance:#dfn-performance
	#idl-def-performance
I.WindowOrWorkerGlobalScope:~HTMLGAPI#windoworworkerglobalscope
	#dom-windoworworkerglobalscope
I.WorkerGlobalScope:~WORKERS#the-workerglobalscope-common-interface
	https://w3c.github.io/workers/#the-workerglobalscope-common-interface
I.DOMTimeStamp:~WEBIDL#DOMTimeStamp

I.Window:~WINDOW#window
I.Worker:#worker
I.SharedWorker:#sharedworker
I.EventTarget:~DOM4#eventtarget
I.BroadcastChannel:~HTMLcomms#broadcastchannel

m.performance:#dom-windoworworkerglobalscope-performance
m.now():#dom-performance-now
m.performance.now():#dom-performance-now
m.timeOrigin:#dom-performance-timeorigin
m.toJSON():#dom-performance-tojson


外的な時計~調整:#_clock-adjustments
時刻起点:#dfn-time-origin
時刻起点~時刻印:#dfn-time-origin-timestamp
単調増加~時計:#dfn-monotonic-clock
大域的な単調増加~時計:#dfn-global-monotonic-clock
現在の高分解能~時刻:#dfn-current-high-resolution-time

公式的な作成時点:~WORKERS#official-moment-of-creation
専用~worker:~WORKERS#worker
共用~worker:~WORKERS#sharedworker
	共用~worker:#shared-workers

閲覧文脈が作成され:~BROWSERS#creating-a-new-browsing-context
関連する大域~obj:~WAPI#concept-relevant-global
大域~obj:~WAPI#global-object
結付けられている文書:~WINDOW#concept-document-window
~navi:~NAVI#navigate
~unloadを~promptする:~NAVI#prompt-to-unload-a-document

既定の~toJSON演算:~WEBIDL#default-tojson-operation

~Unix時間:https://en.wikipedia.org/wiki/Unix_time


●●words_table1


	HTML51:https://www.w3.org/TR/html51


●●words_table


	●計時
Unix:
zero:::ゼロ
時系列順:chronological::~
時系列線:timeline::~
計時:timing::~
計時側からの:timing side-channel::~
計測-:measure:~
計測:measurement:~
時間:time::~
	時間~差:time 差
時刻:time::~
現在時:present time::~
時刻印:timestamp::~
時刻起点:time origin::~
	長時間:longer time period
分解能:resolution::~
高分解能:high resolution::~
	確度
	高:high
時計:clock::~:クロック
	従来の時計:time-of-day
milli:milli-::ミリ
micro:micro-::マイクロ
	~milli秒:milliseconds
	~milli秒より細かい:sub-millisecond
	microseconds
	秒:seconds
	調整:skew/adjustment:~
	skew:::スキュー
system:::システム
単調増加:monotonic::~
単調増加-:monotonic に increase::~
減少-:decrease::~
精確:precise:~
正確:accurate::~
	正確~さ:accurate to
	~~精度に止める:inaccurate
正確さ:accuracy::~
更新:update:~
	挿入:cue
frame:::フレーム
rate:::レート
計算-:calculate:~
費やさ:elapse さ:~
暦:calendar::~
記録:record::~
格納-:store:~
比較-:compare:~
所要時間:duration::~
同期-:synchronize::~
同期:synchronization::~
相対的:relative::~
絶対的:absolute::~
実行時の:runtime::~

大域:global::~:グローバル
大域的な:global::~:グローバル
局所的:local::~:ローカル
epoch:

	●保安
API:
cache:::キャッシュ
保安:security::~:セキュリティ
privacy:::プライバシー
scheduling:::スケジュール処理
page:::ページ
code:::コード
timer:::タイマー
counter:::カウンタ
情報:information:~
効果:effect:~
攻撃:attack:~
攻撃者:attacker:~
防止-:prevent:~
訪問:visit:~
軽減-:mitigate :~
懸念:concern:~
統計的:statistical:~
指紋収集:fingerprinting:~
指紋収集-:fingerprint:~
悪意的な:malicious:悪意のある
共通する:commonな:~
活動:activity:~
体験:experience:~
	可能にする:enables
検出-:detect:~
複雑さ:complexity:~
向上-:improve:~
速度:speed:~

公開-:expose:~
露呈-:reveal:~
隔離-:isolate:~
応答性:responsiveness:~
	担当する:responsible
協調-:coordinate:~
	部位:component:~
退歩:regressions:~
追跡-:track:~
	推測:guess and infer:~
解析:analysis:~
解析-:analyse:~
音:sound:~
見積もり:estimate:~
	反復:repeat:~
	側からの:side channel
機密的:confidential:~
	~~基盤:primitives

mode:::モード
message:::メッセージ
messaging:::メッセージ処理
TCP:
client:::クライアント
server:::サーバ
session:::セッション
view:::ビュー
entropy:::エントロピー
prop:property::プロパティ
drift:::同期ずれ
縛られ:tie され:~
分別-:differentiate:~
低層:lower-layer:~

	●仕様
app:application::アプリ
algo:algorithm::アルゴリズム
UA:user agent:UA
support:::サポート
version:::バージョン
任意選択:optional:~
適正:proper:~
歴史:history:~
利用者:user:~
要件:requirements:~
適合性:conformance:~
開発者:developer:~
実施:practice:~
推奨-:recommend:~
仕様:spec:~
定義-:define:~
定義:definition:~
未定義:undefined:~
有用:useful:~
純粋:genuine:~
課題:issue:~
	作業草案:Working Draft:~
提案-:propose:~
要約-:summarize:~
供-:provide:~
供せ:provide でき:~
解決-:resolve:~
導入-:introduce:~
拘束:constraints:~
勧告候補:Candidate Recommendation:~
実用的:practical:~
決定的:critical:~
有意:significant:~
確保-:ensure:~
可用:available:~
要求-:require:~
試みる:attempt する:~
適用-:apply:~
避ける:avoid する:~
仕組み:mechanism:~
	必要:need
推定-:infer:~
目的:purpose:~
容易:easy:~
基底:base:~
欲され:desire され:~
望む:wish する:~
助け:help:~
	今日:today:~
	知る:know
	利用-:use
	見よ:see
	しかしながら，:however
	決して:never
	一方で:whereas
	因る／因り:due to
	可能性がある:potentially

	●未分類（動詞
描画-:render:~::レンダー
renderer:
animation:::アニメーション
navi:navigation::ナビ
unload:
prompt:
upload:::アップロード
fetching:::fetch 処理
実行:execution:~
実行-:execute:~
access:::アクセス
読込み:loading::読み込み:ロード処理
設定-:set:~
開始-:start:~
	各~開始:restart
確認-:confirm:~
確認:confirmation:~
表示-:display:~
識別-:identify:~
起動-:initiate:~
作成-:create:~
関係-:relate:~
表現-:represent:~
決定-:determine:~
閲覧文脈:browsing context:~
閲覧:browsing:~
文脈:context:~
専用:dedicated::~
共用:shared::~
被呼出時:被 invoke 時:~
呼出され:invoke され:~
換算-:translate:~
作業:work:~
保持-:hold:~
共有-:share:~
再設定-:reset:~
到達-:reach:~
参照-:reference:~
取得-:get:~
取得子:getter:~
変化-:change:~
変化:changes:~
	得-:obtain
処理能:performance:~
送信-:send:~
相違-:differ:~
相違:difference:~
統一-:unify:~
観測-:observe:~
記録-:record:~
調整:adjustment:~
	返す:return
駆動-:drive:~
交換-:exchange:~
報告-:report:~
訪問:visit:~
挙動:behavior:ふるまい
実行時runtime
再起動:restart:~
考慮点:considerations:~

	●未分類
interface:::インタフェース
method:::メソッド
event:::イベント
task:::タスク
worker:
toJSON:
call:
instance:::インスタンス
obj:object::オブジェクト
属性:attribute:~
型:type:~
演算:operation:~
構築-:contruct:~
cue:
website:web site::ウェブサイト
script:::スクリプト
software:::ソフトウェア
entry:::エントリ
data:::データ
	文書~navi:navigating to a Document
hardware:::ハードウェア
browser:::ブラウザ
dialog:::ダイアログ
offline:::オフライン

資源:resource::~:リソース
公式的:official:~
作成時点:moment of creation:~
既定の:default:~::デフォルト

文書:document:~
	細かさに:minimum 
音声:audio:~
関連する:relevant な:~
状態:state:~
値:value:~
物理的:physical:~
論理的:logical:~
自動的:automatic:~
対象:subject:~

	負の:negative
	量:amount
	point
	using
	-:assert
	基準:with respect to
	across
	incognito
	過去現在未来:past, present, and future,
	より長い:longer
	:in place#1
	against

	●指示語
結付けら:associate さ:結び付けら
特定0の:particular:ある特定の
特定の:specific な:~
新たな:new:~
現在の:current:~
	結果:result
	0 :zero
	2 個の:two
	この:this
	すべての:all
	その:that
	そのような:such
	それらを:them
	他の:other
	前者:former
	これらの:these
	すでに:already
	上:above
	べき:should
	各:each
	複数の:multiple
	追加の:additional
	等々:etc
	同様／類する:similar
	介:via
	間:between
	同じ:same
	所与の:given
	以前:previously
	別の:another
	様々な:various


●●ref_normative

[HTML]
    HTML Standard. Anne van Kesteren; Domenic Denicola; Ian Hickson; Philip Jägenstedt; Simon Pieters. WHATWG. Living Standard. URL: https://html.spec.whatwg.org/multipage/ 
[RFC2119]
    Key words for use in RFCs to Indicate Requirement Levels. S. Bradner. IETF. March 1997. Best Current Practice. URL: https://tools.ietf.org/html/rfc2119 
[WEBIDL]
    Web IDL. Cameron McCormack; Boris Zbarsky; Tobie Langel. W3C. 15 December 2016. W3C Editor’s Draft. URL: https://heycam.github.io/webidl/ 

●●ref_informative

[CACHE-ATTACKS]
    The Spy in the Sandbox - Practical Cache Attacks in Javascript. Yossef Oren; Vasileios P. Kemerlis; Simha Sethumadhavan; Angelos D. Keromytis.March 2015. URL: https://arxiv.org/abs/1502.07373 
[ECMA-262]
    ECMAScript Language Specification. Ecma International. URL: https://tc39.github.io/ecma262/ 
[PERFORMANCE-TIMELINE]
    Performance Timeline. Jatinder Mann; Zhiheng Wang. W3C. 12 December 2013. W3C Recommendation. URL: https://www.w3.org/TR/performance-timeline/ 
[WORKERS]
    Web Workers. Ian Hickson. W3C. 24 September 2015. W3C Working Draft. URL: https://www.w3.org/TR/workers/ 

●●trans_metadata
<p>
~THIS_PAGEは、~W3Cにより
勧告候補として公開された
<a href="~SPEC_URL">High Resolution Time</a>
を日本語に翻訳したものです。
~PUB
</p>


●●spec_metadata

最新発行バージョン
	https://www.w3.org/TR/hr-time-2/

編集者草案
	https://w3c.github.io/hr-time/

テスト一式
	https://w3c.github.io/hr-time/

編集
    Ilya Grigorik, Google Inc., <a href="mailto:igrgiroik@gmail.com">igrigorik@gmail.com</a>
	James Simonsen, Google Inc., <a href="mailto:simonjam@google.com">simonjam@google.com</a> (Until January 2015)
	Jatinder Mann, Microsoft Corp., <a href="mailto:jmann@microsoft.com">jmann@microsoft.com</a> (Until February 2014)

リポジトリ
	<a href="https://github.com/w3c/hr-time/">GitHub w3c/hr-time</a>
	<a href="https://github.com/w3c/hr-time/issues">File a bug.</a>
	<a href="https://github.com/w3c/hr-time/commits/gh-pages">Commit history.</a>

実装
	<a href="http://caniuse.com/#feat=high-resolution-time">Can I use High Resolution Time?</a>

Mailing list
	<a href="mailto:public-web-perf@w3.org?subject=%5Bhr-time%5D">public-web-perf@w3.org</a> (<a href="mailto:public-web-perf-request@w3.org?subject=subscribe">subscribe</a>, <a href="https://lists.w3.org/Archives/Public/public-web-perf/">archives</a>)

</script>

</head>
<body>

<header>


	<hgroup>
<h1>高分解能の計時 — High Resolution Time Level 2</h1>
	</hgroup>

</header>


<div id="MAIN" style="display:none;">

	<section id="abstract">
<h2 title="Abstract">要約</h2>

<p>
この仕様は、［
~milli秒より細かい†（ sub-millisecond ）分解能であって, かつ
`外的な時計~調整$（ system clock skew or adjustments ）の対象にされない
］ような，`時刻起点$, 現在の時刻を供する~APIを規定する。
【†<a href="#desired-resolution" >具体的な精度は決まっていない</a>。】
◎
This specification defines an API that provides the time origin, and current time in sub-millisecond resolution, such that it is not subject to system clock skew or adjustments.
</p>

	</section>

	<section id="sotd">
<h2 title="Status of This Document">この文書の位置付け</h2>

<p>
この節では、発行時点における…
<!-- 
これは編集者草案の公開の複製です…
-->
【以下、この節の他の内容は <a href="w3c-common-ja.html#status" >W3C 日本語訳 共通ページ</a>に委譲。】
</p>


<p>
High Resolution Time Level 2 は、
<a href="https://www.w3.org/TR/hr-time-1/">その最初の~version</a>
を置き換え、次を含みます：
◎
High Resolution Time Level 2 replaces the first version of High Resolution Time and includes:
</p>

<ul>
	<li>
処理能~時系列線に関係する すべての仕様の目的に，`時刻起点$を精確に定義する。
◎
Defines a precise definition of time origin for the purpose of all performance timeline related specifications; 
</li>
	<li>
`timeOrigin$m 属性を定義する。
それは、`時刻起点$からの~zero時刻に対応する，大域的な時刻を供する。
◎
Defines performance.timeOrigin attribute that provides the global time of the zero time of time origin;
</li>
	<li>
以前に `PERFORMANCE-TIMELINE$r に指定されていた
`Performance$I ~interfaceの基底を成す定義は、今やこの仕様に移動し，その
`now()$m ~methodの Web Workers `WORKERS$r における~supportも含められた。
◎
The base definition for the Performance interface, previously specified in [PERFORMANCE-TIMELINE], is now moved to this specification and now includes support for the Performance.now method in Web Workers [WORKERS];
</li>
</ul>

<p>
この文書は
<a href="https://www.w3.org/webperf/">Web Performance Working Group</a>
により発行されました。
◎
This document was published by the Web Performance Working Group as an Editor's Draft. Comments regarding this document are welcome. Please send them to public-web-perf@w3.org (subscribe, archives) with [hr-time] at the start of your email's subject.
</p>

	</section>

<main id="MAIN0">

	<section id="_conventions">
<h2>【この訳に固有の表記規約】</h2>

<ul>
	<li>
この訳の~algoや定義の記述に利用されている各種記号（ ~LET, 此れ, ~IF, ~THROW 等々）の意味や定義の詳細は、~SYMBOL_DEF_REFを~~参照されたし。
</li>
	<li>
原文にて［
`HTML51$r ／ `WORKERS$r
］仕様による定義を参照している用語は、便宜のため，この訳では WHATWG HTML 仕様（の和訳）による定義を参照している。
</li>
	<li>
`外的な時計~調整@
— この訳では、原文の
“system clock adjustments”, “system clock skew”
の総称として，この語を用いることにする。
原文には説明されていないが、前者の system clock adjustments は、 NTP などの外部の時計と~system時計とのずれを
— 自動的に，場合によっては利用者が —
補正することを指すようだ。
後者の clock skew は、 Wikipedia によれば［
熱などの物理的な／回路構成などの機械的な
］要因による，~system内の複数箇所の間の同期のずれを意味するようだが、この語の用いられ方から，それに対処するために~system時計を補正することを指すようだ。
</li>
</ul>


	</section>
	<section id="introduction">
<h2 title="Introduction">1. 序論</h2>

~INFORMATIVE

<p>
ECMAScript 言語~仕様 `ECMA-262$r は、
1970 年 1 月 1 日 UTC からの~milli秒~単位による時間を表現する時刻~値として，
`Date^c ~objを定義する。
この値は， 1970 年 1 月 1 日 UTC から約 28 万 5616 年間のどの時刻も~milli秒~単位で表現でき、ほとんどの目的においては，この定義で足りる。
`DOMTimeStamp$I `WEBIDL$r も同様に定義されている。
◎
The ECMAScript Language specification [ECMA-262] defines the Date object as a time value representing time in milliseconds since 01 January, 1970 UTC. For most purposes, this definition of time is sufficient as these values represent time to millisecond precision for any instant that is within approximately 285,616 years from 01 January, 1970 UTC. The DOMTimeStamp is defined similarly [WEBIDL].
</p>

<p>
これらの定義による時刻は、実施においては，`外的な時計~調整$の対象にもなる。
時刻~値は常に単調増加するとは限らず，後続の値は減少したり, 同じままになることもある。
◎
In practice, these definitions of time are subject to both clock skew and adjustment of the system clock. The value of time may not always be monotonically increasing and subsequent values may either decrease or remain the same.
</p>

<div class="example">
<p>
例えば 次の~scriptは、
%duration の計算結果として［
正の値, 負の値, 0
］いずれも記録し得る。
◎
For example, the following script may record a positive number, negative number, or zero for computed duration:
◎
Example 1
</p>

<pre>
var %mark_start = Date.now();
doTask(); // <span class="comment">何らかの~task</span>
var %duration = Date.now() - %mark_start;
</pre>

</div>

<p>
この定義による時刻は、~milli秒より細かい分解能はなく, `外的な時計~調整$の対象にもなるので、ある種の~taskには不足する。
例えば：
◎
For certain tasks this definition of time may not be sufficient as it does not allow for sub-millisecond resolution and is subject to system clock skew. For example,
</p>

<ul>
	<li>
文書~navi, 資源の~fetching, ~scriptの実行
などに費やされた時間を正確に計測しようと試みるとき、~milli秒より細かい分解能, かつ単調増加する時計が欲される。
◎
When attempting to accurately measure the elapsed time of navigating to a Document, fetching of resources or execution of script, a monotonically increasing clock with sub-millisecond resolution is desired.
</li>
	<li>
~scriptから~animationの状態を計算するとき、~animationを次の場面へ適正に更新するためには，開発者は ~animationに費やされた時間の長さを正確に知る必要がある。
◎
When calculating the animation state from script, developers will need to accurately know the amount of time that has elapsed in the animation in order to properly update the next scene of the animation.
</li>
	<li>
~scriptに基づく~animationの~frame~rateを計算するとき、~animationが 60 FPS で描画されているかどうか決定するためには，~milli秒より細かい分解能が必要になる。
~milli秒より細かくなければ、開発者は 58.8 FPS と 62.5 FPS を区別するのが限界になる。
【1 ~frameあたり前者が 1/58.8 = 約 0.017 秒, 後者は 0.016 秒で，その差 1/1000 秒】
◎
When calculating the frame rate of a script based animation, developers will need sub-millisecond resolution in order to determine if an animation is drawing at 60 FPS. Without sub-millisecond resolution, a developer can only determine if an animation is drawing at 58.8 FPS or 62.5 FPS.
</li>
	<li>
~animation内の特定の時点に音声を~cueしようと試みるときや,
音声と~animationの同期を確保するためには、開発者は，~animationと音声に費やされる時間の長さを正確に知る必要がある。
◎
When attempting to cue audio to a specific point in an animation or ensure that the audio is synchronized with the animation, developers will need to accurately know the amount of time elapsed in the animation and audio.
</li>
	<li>
複数の文脈~下の作業を，~milli秒より細かい分解能で互いに同期させる必要があるとき（例：
`専用~worker$ ／ `共用~worker$
を用いて，~renderer文脈~下で~animation, 音声, 等々を駆動する）や、複数の文脈で生じた~eventたちが成す時系列線の，統一された~viewを作成する必要があるとき。
◎
When multiple contexts need to synchronize work with sub-millisecond resolution (e.g. when using dedicated or shared workers to drive animation, audio, etc., in a renderer context), or to create a unified view of the event timeline.
</li>

</ul>

<p>
この仕様は、 `Date.now()^c `ECMA-262$r の挙動を変更するよう提案するものではない。
それは、暦における現在の時刻~値を決定する点においては純粋に有用であり，長い利用の歴史がある。
`DOMHighResTimeStamp$I 型と
`Performance$I ~interfaceの［
`now()$m  ~method／
`timeOrigin$m 属性
］が、［
単調増加する, ~milli秒より細かい分解能による時刻~値
］を供することにより，上に挙げた課題を解決する。
◎
This specification does not propose changing the behavior of Date.now() [ECMA-262] as it is genuinely useful in determining the current value of the calendar time and has a long history of usage. The DOMHighResTimeStamp type, performance.now method, and performance.timeOrigin attributes of the Performance interface resolve above issues by providing monotonically increasing time values with sub-millisecond resolution.
</p>

		<section id="examples">
<h3 title="Examples">1.1. 例</h3>

~INFORMATIVE

<p>
開発者は、自身の~app全体にわたり，`時刻起点$が異なる［
`専用~worker$／`共用~worker$
］からの~eventも含むような時系列線を構築したいと望むこともあろう。
`timeOrigin$m 属性の助けを借りて 各~eventの `DOMHighResTimeStamp$I 値を換算すれば、~appは，そのような~eventたちを同じ時系列線~上に表示できる。
◎
A developer may wish to construct a timeline of their entire application, including events from dedicated or shared workers, which have different time origin's. To display such events on the same timeline, the application can translate the DOMHighResTimeStamp's with the help of the performance.timeOrigin attribute.
</p>

<p class="trans-note">【†
時系列線（ timeline ）：
生じた~eventをその時刻とともに時系列順に記録するもの。
】</p>

<div class="example">

<pre>
// ---- worker.js -----------------------------
/* <span class="comment">
共用~worker内の~script
◎
Shared worker script
</span> */
onconnect = function(%e) {
  var %port = %e.ports[0];
  %port.onmessage = function(%e) {
    /* <span class="comment">
~worker内での計時~task
◎
Time execution in worker
</span> */
    var %task_start = performance.now();
    %result = runSomeWorkerTask();
    var %task_end = performance.now();
  }

  /* <span class="comment">
結果と, および~epochに相対的な時刻印を，別の文脈へ送信する
◎
Send results and epoch-relative timestamps to another context
</span> */
  %port.postMessage({
     'task': 'Some worker task',
     'start_time': %task_start + performance.timeOrigin,
     'end_time': %task_end + performance.timeOrigin,
     'result': %result
  });
}

// ---- application.js ------------------------
/* <span class="comment">
文書~内での計時~task
◎
Timing tasks in the document
</span> */
var %task_start = performance.now();
runSomeApplicationTask();
var %task_end = performance.now();

/* <span class="comment">
実行時の処理能~dataを~uploadするために開発者が供した~method
◎
developer provided method to upload runtime performance data
</span> */
reportEventToAnalytics({
  'task': 'Some document task',
  'start_time': %task_start,
  'duration': %task_end - %task_start
});

/* <span class="comment">
~workerの時刻印を文書の`時刻起点$に換算する
◎
Translating worker timestamps into document's time origin
</span> */
var %worker = new SharedWorker('worker.js');
%worker.port.onmessage = function (%event) {
  var %msg = %event.data;

  /* <span class="comment">
~epochに相対的な時刻印を文書の`時刻起点$に換算する
◎
translate epoch-relative timestamps into document's time origin
</span> */
  %msg.start_time = %msg.start_time - performance.timeOrigin;
  %msg.end_time = %msg.end_time - performance.timeOrigin;

  reportEventToAnalytics(%msg);
}
</pre>

</div>

		</section>
	</section>
	<section id="conformance">
<h2 title="Conformance">2. 適合性</h2>

<p class="trans-note">【
この節の内容は
<a href="w3c-common-ja.html#conformance" >W3C 日本語訳 共通ページ</a>
に委譲
】</p>

	</section>
	<section id="sec-time-origin">
<h2 title="Time Origin">3. 時刻起点</h2>

<p>
`時刻起点@
（ time origin ）とは、時間を計測する起点であり，所与の`大域~obj$に応じて，次で定義される時点にされ~MUST：
◎
The time origin is the time value from which time is measured:
</p>

<dl class="switch">
	<dt>
`Window$I ~objである場合：
◎
If the global object is a Window object, the time origin MUST be equal to: 
</dt>
	<dd>
前の文書がない場合
⇒
最初に`閲覧文脈が作成され$た時点
◎
the time when the browsing context is first created if there is no previous document;
</dd>
	<dd>
他の場合，前の文書が存在し, それが`~unloadを~promptする$間に利用者に確認~dialogが表示された場合
⇒
利用者が~naviを確認した時点
◎
otherwise, the time of the user confirming the navigation during the previous document's prompt to unload algorithm, if a previous document exists and if the confirmation dialog was displayed; 
</dd>
	<dd>
他の場合
⇒
`Window$I ~objに`結付けられている文書$の読込みを担当する`~navi$を開始した時点
◎
otherwise, the time of starting the navigation responsible for loading the Window object's newest Document object.
</dd>

	<dt>`WorkerGlobalScope$I ~objである場合：</dt>
	<dd>
~workerの`公式的な作成時点$。
`WORKERS$r
◎
If the global object is a WorkerGlobalScope object, the time origin MUST be equal to the official moment of creation of the worker.
</dd>

	<dt>他の場合：</dt>
	<dd>
未定義とする。
◎
Otherwise, the time origin is undefined.
</dd>
</dl>

<p>
`時刻起点~時刻印@
は、`時刻起点$を指す
【大域的な】
時刻を与える，高分解能な時刻~値である。
所与の`大域~obj$ %G の`時刻起点~時刻印$は：
◎
The time origin timestamp is the high resolution time value at which time origin is zero. To obtain the time origin timestamp given a global object ( global):
◎
Assert that global's time origin is not undefined.
</p>

<ul>
	<li>
%G の`時刻起点$が未定義の場合は定義されない。
</li>
	<li>
<p>
他の場合、次の 2 つを加算した結果として定義される：
</p>
		<ul>
			<li>
`~Unix時間$による［
`大域的な単調増加~時計$が時刻 0 を指す時点
］の時刻を，高分解能で表現している `DOMHighResTimeStamp$I 値
◎
Let t1 be the DOMHighResTimeStamp representing the high resolution Unix time at which the global monotonic clock is zero.
</li>
			<li>
`大域的な単調増加~時計$による［
%G の`時刻起点$
］の時刻を，高分解能で表現している `DOMHighResTimeStamp$I 値
◎
Let t2 be the DOMHighResTimeStamp representing the high resolution time value of the global monotonic clock at global's time origin.
◎
Return the sum of t1 and t2.
</li>
		</ul>
	</li>
</ul>


<p class="note">注記：
`時刻起点~時刻印$は、`外的な時計~調整$の対象でない`大域的な単調増加~時計$を基準に記録されるので，［
`Date.now()^c を “~zero時刻”
【すなわち、時刻起点】
に実行したときの結果と相違し得る。
<a href="#sec-monotonic-clock">単調増加~時計 節</a>
を見よ。
◎
Note
◎
The time origin timestamp and the value returned by Date.now() executed at "zero time" can differ because the former is recorded with respect to a global monotonic clock that is not subject to system and user clock adjustments, clock skew, and so on—see 7. Monotonic Clock.
</p>

<p>
`現在の高分解能~時刻@
は、`時刻起点$から現在時（概して， “今（ now ）” とも呼ばれる）までの時間~差を，高分解能で表す時刻~値である。
◎
The current high resolution time is the high resolution time from the time origin to the present time (typically called "now").
</p>

	</section>
	<section id="sec-domhighrestimestamp">
<h2 title="The DOMHighResTimeStamp Type">4. `DOMHighResTimeStamp^I 型</h2>

<div class="p">
<p>
`DOMHighResTimeStamp@I
型は、次のいずれかを表現する，~milli秒~単位による値を格納するために利用される：
</p>

<ul ><li>`時刻起点$から相対的に計測された時刻
</li><li>`大域的な単調増加~時計$から相対的に計測された時刻
</li><li>2 つの `DOMHighResTimeStamp$I 値の時間~差
</li></ul>
◎
The DOMHighResTimeStamp type is used to store a time value in milliseconds, measured relative from the time origin, global monotonic clock, or a time value that represents a duration between two DOMHighResTimeStamp's.

</div>


<pre class="idl">
typedef double `DOMHighResTimeStamp$I;
</pre>

<p id="desired-resolution">
`DOMHighResTimeStamp$I 値は、~milli秒~単位の時間を，［
計測には十分, かつ計時~攻撃は防止する
］正確~さで表現するべきである。
追加の考慮点については、<a href="#clock-resolution">時計の分解能</a>節を見よ。
◎
A DOMHighResTimeStamp SHOULD represent a time in milliseconds accurate enough to allow measurement while preventing timing attack - see 8.1 Clock resolution for additional considerations.
</p>

<p class="note">注記：
~UAは、~hardwareまたは~softwareに因る拘束から，
`DOMHighResTimeStamp$I 値による時間を~milli秒より細かい正確~さで供せない場合には、~milli秒の正確~さで表現できる。
<!--＊原文更新漏れ 5 microseconds -->
◎
Note
◎
If the User Agent is unable to provide a time value accurate to 5 microseconds due to hardware or software constraints, the User Agent can represent a DOMHighResTimeStamp as a time in milliseconds accurate to a millisecond.
</p>



	</section>
	<section id="sec-performance">
<h2 title="The Performance interface">5. `Performance^I ~interface</h2>


<pre class="idl">
[`Exposed$=(Window,Worker)]
interface `Performance@I : `EventTarget$I {
    `DOMHighResTimeStamp$I `now()$m;
    readonly attribute `DOMHighResTimeStamp$I `timeOrigin$m;
    [`Default$] object `toJSON()$m;
};
</pre>

<dl class="idl-def">
	<dt>`now()@m</dt>
<!-- ＊TODO
data-tests='basic.any.html, basic.any.worker.html'
-->
	<dd>
被呼出時には、`現在の高分解能~時刻$を返さ~MUST。
◎
The now() method MUST return the current high resolution time.
</dd>

	<dt>`timeOrigin@m</dt>
<!-- ＊TODO
data-tests='timeOrigin.html, window-worker-timeOrigin.window.html'
-->
	<dd>
取得子は、此れに`関連する大域~obj$用の`時刻起点~時刻印$を高分解能で表現する， `DOMHighResTimeStamp$I 値を返さ~MUST。
◎
The timeOrigin attribute MUST return a DOMHighResTimeStamp representing the high resolution time of the time origin timestamp for the relevant global object of the Performance object.
</dd>

	<dt>`toJSON()@m</dt>
	<dd>
被呼出時には、 `WEBIDL$r による`既定の~toJSON演算$を走らす。
◎
When toJSON is called, run [WEBIDL]'s default toJSON operation.
</dd>
</dl>

	</section>
	<section id="the-performance-attribute">
<h2 title="The performance attribute">6. `performance^m 属性</h2>

<p class="idl-def">
`WindowOrWorkerGlobalScope$I 上の
`performance@m
属性は、`大域~obj$からの［
処理能に関係する属性や~method
］へ~accessできるようにする。
◎
The performance attribute on the WindowOrWorkerGlobalScope allows access to performance related attributes and methods from the global object.
</p>

<pre class="idl">
partial interface `WindowOrWorkerGlobalScope$I {
    [`Replaceable$] readonly attribute `Performance$I `performance$m;
};
</pre>

	</section>
	<section id="sec-monotonic-clock">
<h2 title="Monotonic Clock">7. 単調増加~時計</h2>

<div class="p">
<p>
［
同じ`時刻起点$を共有する，各 `Performance$I ~obj
］の `now()$m ~methodが返す時刻~値は、同じ`単調増加~時計$を利用し~MUST。
同じ `Performance$I ~objの `now()$m ~methodが返す，時系列順に記録された 2 つの時刻~値の差は、決して負になっては~MUST_NOT。
</p>

<p>
`単調増加~時計@
とは、`外的な時計~調整$の対象にされることなく，単調増加するような時計である。
</p>

<p class="trans-note">【
どの `Performance$I ~objたちが同じ`時刻起点$を共有するものとされるかは、ここには述べられていない。
】</p>

◎
The time values returned when calling the performance.now() method on Performance objects with the same time origin MUST use the same monotonic clock that is monotonically increasing and not subject to system clock adjustments or system clock skew. The difference between any two chronologically recorded time values returned from the performance.now() method MUST never be negative if the two time values have the same time origin.
</div>

<div class="p">
<p>
<!-- ＊TODO
data-tests='test_cross_frame_start.html'
 -->
`timeOrigin$m が返す時刻~値には、同じ`大域的な単調増加~時計$が利用され~MUST†。
`大域的な単調増加~時計@
とは、`~Unix時間$を基準にするような`単調増加~時計$であり，いくつかの`時刻起点$から共有される。
<a href="#sec-privacy-security">~privacyと保安</a>
を見よ。
</p>

<p class="trans-note">【
どの`時刻起点$
— 言い換えれば、`大域~obj$ —
たちが同じこの時計を共有するものとされるかは，ここには規定されていないが、下の注記に見られるように，互いに情報をやりとりできる`大域~obj$どうしは共有することになるであろう。
】【†
この要件をより詳細に述べるなら、
“2 つの`大域~obj$ %G1, %G2 が同じ`大域的な単調増加~時計$を共有するならば、
%G1, %G2 の `performance$m 属性が返す `Performance$I ~objの `timeOrigin$m が返す時刻~値には，その時計が利用され~MUST”
となるであろう。
】</p>

◎
The time values returned when getting performance.timeOrigin MUST use the same global monotonic clock that is shared by time origin's, is monotonically increasing and not subject to system clock adjustments or system clock skew, and whose reference point is the Unix time—see 8. Privacy and Security.
</div>

<p class="note">注記：
~UAは、［
~browserの各~再起動 ／
他から隔離された閲覧~session（例： incognito 【private】
または それに類する閲覧~mode）の各~開始
］ごとに，自身の`大域的な単調増加~時計$を再設定できる。
そのため，開発者は、［［
過去現在未来すべての文脈にわたり，単調増加するような~prop
］を保持する，絶対的な時刻
］には，大域的な時刻印を利用するべきでない。
実施において，単調増加する~propを適用できる用途は、［
供されている~messagingの仕組み
— 例： `postMessage()^m, `BroadcastChannel$I, 等々 —
を介して~messageを交換することにより，他へ到達できるような文脈
］に限られる。
◎
Note
◎
The user agent can reset its global monotonic clock across browser restarts, or whenever starting an isolated browsing session—e.g. incognito or similar browsing mode. As a result, developers should not use global timestamps as absolute time that holds its monotonic properties across all past, present, and future contexts; in practice, the monotonic properties only apply for contexts that can reach other by exchanging messages via one of the provided messaging mechanisms - e.g. postMessage, BroadcastChannel, etc.
</p>

	</section>
	<section id="sec-privacy-security">
<h2 title="Privacy and Security">8. ~privacyと保安</h2>

		<section id="clock-resolution">
<h3 title="Clock resolution">8.1. 時計の分解能</h3>

<p>
正確な計時~情報への~accessは、計測と~scheduling 両~目的において，多くの~appに共通する要件である。
例えば， ~animation, 音, その他の~page上の活動を協調させ，より良い利用者~体験を供するためには、高分解能な時間への~accessを要する。
同様に，計測により、開発者は，~codeの決定的な部位における処理能を追跡したり, 退歩を検出する, 等々
が可能になる。
◎
Access to accurate timing information, both for measurement and scheduling purposes, is a common requirement for many applications. For example, coordinating animations, sound, and other activity on the page requires access to high-resolution time to provide a good user experience. Similarly, measurement enables developers to track the performance of critical code components, detect regressions, and so on.
</p>

<p>
しかしながら，その同じ正確な計時~情報への~accessは、さもなければ攻撃者が見たり~accessできない~dataを推測可能にするような，悪意的な攻撃~目的にも利用され得る。
例えば~cache攻撃と統計的~指紋収集（ statistical fingerprinting ）は、悪意的な~websiteが，［
~browserや~appから起動される様々な演算による，高分解能な計時~data
］を［
利用者たちを分別したり, 場合によっては特定0の利用者を識別する
］ために利用し得るときの、~privacyと保安~上の懸念である
— `CACHE-ATTACKS$r を見よ。
◎
However, access to the same accurate timing information can sometimes be also used for malicious purposes by an attacker to guess and infer data that they can't see or access otherwise. For example, cache attacks and statistical fingerprinting is a privacy and security concern where a malicious web site may use high resolution timing data of various browser or application-initiated operations to differentiate between subset of users, and in some cases identify a particular user - see [CACHE-ATTACKS].
</p>

<p>
<!-- ＊TODO
data-tests='timing-attack.html'
-->
この仕様は、これまで `DOMTimeStamp$I に公開され可用であった~milli秒の分解能より正確な，より細かい時間~分解能を供する~APIを定義する。
しかしながら，この新たな~APIがなくとも、攻撃者は，~~反復~実行と統計的~解析を通して，高分解能の見積もりを得ることはできる。
新たな~APIにより，そのような攻撃の正確さや速度が有意に向上されないことを確保するため、
`DOMHighResTimeStamp$I 型の分解能は，攻撃を防止するに十分な~~精度に止めることが推奨される。
◎
This specification defines an API that provides sub-millisecond time resolution, which is more accurate than the previously available millisecond resolution exposed by DOMTimeStamp. However, even without this new API an attacker may be able to obtain high-resolution estimates through repeat execution and statistical analysis. To ensure that the new API does not significantly improve the accuracy or speed of such attacks, the recommended minimum resolution of the DOMHighResTimeStamp type should be inaccurate enough to prevent attacks.
</p>

<p>
そのような計時側からの攻撃を まるごと軽減するような実施は、可能でない：
そのためには、すべての演算の実行~時間は，機密的~情報の値に応じて変わらないようにするか、~appを，時間に関係するあらゆる~~基盤（時計, ~timer, ~counter, 等々）から隔離する必要があるが、いずれも
~browserと~app開発者に関わる複雑さや，処理能への負の効果, ~appの応答性に関わるものであり、実用的でない。
◎
Mitigating such timing side-channel attacks entirely is practically not possible: either all operations would have to execute in a time that does not vary based on the value of any confidential information, or, the application would need to be isolated from any time-related primitives (clock, timers, counters, etc). Neither is practical due to the associated complexity for the browser and application developers and the associated negative effects on performance and responsiveness of applications.
</p>

		</section>
		<section id="clock-drift">
<h3 title="Clock drift">8.2. 時計の~drift</h3>

<p>
この仕様は、［
~milli秒より細かい分解能による`時刻起点~時刻印$
］を供する~APIも定義する。
~APIには［
すべての~browser文脈にわたって共有され~MUST，`大域的な単調増加~時計$
］が要求され，それを~appに公開する。
この時計は，物理的な時刻に縛られる必要はないが、新たな［
利用者についての指紋収集-
］~entropyを公開するのを避けるため，`~Unix時間$を基準に設定することが推奨される。
~Unix時間は，すでに~appにより容易に得られる一方で、新たな論理的~時計を公開するのは，新たな情報を供するに等しいので。
◎
This specification also defines an API that provides sub-millisecond time resolution of the zero time of the time origin, which requires and exposes a global monotonic clock to the application, and that must be shared across all the browser contexts. The global monotonic clock does not need to be tied to physical time, but is recommended to be set with respect to the Unix time to avoid exposing new fingerprint entropy about the user—e.g. this time can already be easily obtained by the application, whereas exposing a new logical clock provides new information.
</p>

<p>
しかしながら，上述した仕組みの下でも、`大域的な単調増加~時計$は，
<a href="https://en.wikipedia.org/wiki/Clock_drift">時計の~drift</a>
（ clock drift, “遅れ／進み” ）に関する分解能も供し得る。
今日の~appは、同じ文脈の中の複数の時点で，［
従来の時計による時刻印, 単調増加~時計による時刻印
］を（順に， `Date.now()^c, `performance.now()$m を介して）得て，それらの間の~drift
— 例えば`外的な時計~調整$に因るそれ —
を観測できる。

攻撃者はまた、［
`大域的な単調増加~時計$から報告される`時刻起点~時刻印$
］を `timeOrigin$m 属性から得た上で、それと，現在の［
従来の時計により，`大域的な単調増加~時計$が 0 を指すと見積もられる時点（すなわち ( `Date.now()^c − `performance.now()$m ) ）
］の時刻とを，長時間にわたり比較して、これらの時計どうしの時計の~driftを観測できる可能性がある。
◎
However, even with above mechanism in place, the global monotonic clock may provide additional clock drift resolution. Today, the application can timestamp the time-of-day and monotonic time values (via Date.now() and performance.now()) at multiple points within the same context and observe drift between them—e.g. due to automatic or user clock adjustments. With the performance.timeOrigin attribute, the attacker can also compare the time at which time origin is zero, as reported by the global monotonic clock, against the current time-of-day estimate of when it is zero (i.e. difference between Date.now()-performance.now() and performance.timeOrigin) and potentially observe clock drift between these clocks over a longer time period.
</p>

<p class="trans-note">【
例えば暗号処理を考える。
その処理の重さ（計算量）に因る CPU 熱は、`外的な時計~調整$（この事例では clock skew ）をもたらす結果，時計の~driftに反映され得る。
攻撃者は、いくつかの入力とその計算量との相関関係を解析して，ある程度の情報を推定できるかもしれない。
】</p>

<p>
実施においては、~appは，同じ時刻~driftを複数回の~naviにわたり観測できる：
~appは、各~文脈における論理的な時刻を記録し，
~client／~server
時刻~同期の仕組みを利用して、利用者の時計における変化を推定できる。
同様に~TCP時刻印などの低層の仕組みは、複数回の訪問を要することなく，同じ高分解能な情報を~serverに露呈し得る。
そのようなわけで，この~APIにより供される情報は、有意な, あるいは以前までは可用でなかった，利用者についての~entropyを公開するべきでない。
◎
In practice, the same time drift can be observed by an application across multiple navigations: the application can record logical time in each context and use a client or server time synchronization mechanism to infer changes in the user's clock. Similarly, lower-layer mechanisms such as TCP timestamps may reveal same high-resolution information to the server without the need for multiple visits. As such, the information provided by this API should not expose any significant or previously not available entropy about the user.
</p>

		</section>
	</section>

</main></div><!-- id="MAIN" -->


	<section id="acknowledgments">
<h2 title="Acknowledgments">謝辞</h2>

<p>
次の方々によるこの仕事への寄与に感謝する：
</p>

<p lang="en-x-a0">
The editors would like to thank the following people for contributing to this specification: Karen Anderson, Nat Duca, Tony Gentilcore, Arvind Jain, Jason Weber, Boris Zbarsky, Yossef Oren, Vasileios P. Kemerlis, Simha Sethumadhavan, and Angelos D. Keromytis to acknowledge their contributions to this work.
</p>
	</section>

