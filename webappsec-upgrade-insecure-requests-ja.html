<!DOCTYPE html><html lang="ja"><head><meta charset="utf-8">
<title>Upgrade Insecure Requests （日本語訳）</title>

<link rel="stylesheet" href="common.css" type="text/css" />
<link rel="stylesheet" href="common-w3c.css" type="text/css" />

<style>

samp {
	white-space: nowrap;
	background: #F0F0F0;
	margin-left: 0.5em;
	margin-right: 0.5em;
}

pre.http-code {
	background: #EEE;
}
pre.html-code {
	background: #FFE;
}

.scheme {
	color: #006633;
}

i {
	color: purple;
	text-decoration: underline;
}

</style>


<script src="common0.js" ></script>
<script src="common1.js" async></script>

<script>

Util.ready = function(){
	const source_data = {
		toc_main: 'MAIN0',
		generate: expand
	};
	Util.switchWordsInit(source_data);
}

function expand(){
	const class_map = this.class_map;
	const tag_map = this.tag_map;
	const link_map = this.link_map;

	return this.html.replace(
		/%[\w\-~一-鿆]+|`(.*?)([$@^])(\w*)/g,
		create_html
	);

	function create_html(match, key, indicator, klass){

if(!indicator) {//%
	return `<var>${match.slice(1)}</var>`;
}

let text = key;
let href = '';

switch(klass){
case 'r':
	text = `[${key}]`;
	href = `#biblio-${key.toLowerCase()}`;
	break;
case 'l':
	text = `"<code class="literal">${key}</code>"`;
	break;
case 'sc':
	text = `${key}:`;
	break;
}

let tag = tag_map[klass];
if(tag) {
	let classname = class_map[klass];
	classname = classname ? ` class="${classname}"` : '';
	text = `<${tag}${classname}>${text}</${tag}>`;
}

if(indicator !== '^'){
	href = link_map[ klass ? `${klass}.${key}` : key ] || href;
	if(!href){
		console.log(match); // check error
		return match;
	}

	switch(indicator){
	case '$':
		text = `<a href="${href}">${text}</a>`;
		break;
	case '@':
		text = `<dfn id="${href.slice(1)}">${text}</dfn>`;
		break;
	}
}

return text;

	}
}
</script>

<script type="text/plain" id="_source_data">


●●options

spec_date:2016-05-11
trans_update:2016-07-06
source_checked:160511
page_state_key:WEBAPPSEC
original_url:https://w3c.github.io/webappsec-upgrade-insecure-requests/
spec_status:ED
ref_id_prefix:biblio-
ref_id_lowercase:true
conformance:w3c
copyright:2016,use
trans_1st_pub:2016-07-06


●●class_map
P:production
h:header
dir:directive
e:element
a:attr
et:event-type
v:value
sc:scheme

●●tag_map
p:var
P:code
h:code
dir:code
e:code
a:code
et:code
I:code
m:code
sc:code
v:code
c:code
V:var
s:samp
i:i
em:em

●●words_table



	●仕様
opt-in:opt in:::オプトイン
opt-into::::オプトイン
variant::::バージョン
	べき:ought
健全:sane:~
円滑:seamless:~
保つ:keepする:~
利点:advantage:~

協働-:work-with::~
取代わる:supplantする:取って代わる

恒久的:permanent:~
手作業:manual:~
強いら:forceさ:~
指図-:instruct:~
指図:instruction:~
機会:chance:~
気付いた:noticeした::~
管理者:administrator:~
要-:require:~
触れる:touchする:~
設備:fixture::~
適度:reasonable:~
	標準でない:non-standard
古い:old::~
不可能:impossible:~
暗黙:implicit:~
	imply
告知-:advertise:~
縛られ:tieされ:~
悟った:realizeした:~
労せず:effortなしに:~
要旨-:outline:~
本当:real:~

	前提に:assume
	個々の
	~~供:-
	取り~~扱う:fire off
	受け取って:just as though
	問題領域:problem space
	喜ばしい:happier
	対象が広過ぎる:too broad
	幸いなことに:happily
	当座しのぎ:stopgap measure
	当面は:for the moment
	最適と言えない:suboptimal
	悩みの種になり得る:potential to cause real headache
	成立することになるstatements ought to hold
	手短に言えば:is a long way of saying
	対処-:deal
	~~扱われなくなる:flag
	指摘-:point out
	更には、:moreover,
	次の様になるであろう:might look like this
	相当:substantial
	真に:truly
	確かでない:not sure
	突き止めれる:track down
	築き上げ:carveouts
	築き上げる:carving out
	継続的に行う:pursue a gradual
	考えれば:considerすれば
	~~要約すると:In short
	読み通して:going through
	逆の性格の様な何か:something like the opposite assertion
	無論これは，ごく単純~化されており、~~実際の環境設定はずっと複階的になるであろう。:This is, of course, greatly simplified; your configuration will likely be significantly more complex.

	●保安／昇格
HSTS:
被保護:protected:~
pin:
先天的:a priori:~
暗号化-:encrypt:~
書直され:rewriteされ:書き直され
書直して:rewriteして:書き直して
書直し:rewriting:書き直し
書直す:rewriteする:書き直す
混在:mixed::~
混在内容:Mixed-Content:~
漏洩-:leak:~
漏洩:leakage:~
監視-:monitor::~
監視:monitoring::~
直書き:hard-code::~
直書きの:hardcoded::~
移行-:migrate:~
移行:migration:~
移行0-:transit:移行
移行0:transition:移行
移行前の:pre-migration:~
端点:endpoint:~

証明書:certificate::~
認証-:authenticate::~
	認証-済み:authenticated
透過的:transparent:~
昇格不可:Do Not Upgrade::昇格するな
昇格可:Upgrade::昇格せよ
昇格-:upgrade::~
昇格:upgrade::~
降格-:downgrade::~
格下げ:degrade::~
当事者主体:first-party::~
中間者:man-in-the-middle:~
能動的:active:~
受動的:passive::~
外方への:outgoing:~
失効-:expire:~
失効:expiration:~
平文text:plaintext:::平文テキスト

	報告-先:reporting
	~secureでない:insecure
	非~secure:insecure

	●network
Nginx:
redirect::::リダイレクト
redirection::::リダイレクト指示
	website
	~cacheできなく:uncachable
WebSocket:
main:
事前読込-:preload::事前読み込み::事前ロード
	事前読込-可能:preloadable
為す:makeする:~
為され:makeされ:~
叩く:hitする:~
refresh:
	準備:ready
	準備作業~legwork
	特に、:most notably
	申し分なく~~働く:serves as a fine
	選ぶ:choose
	閉じ込められ:lock up
	~~通達-:signify

	●未分類
現任の:incumbent:~
SSL-stripping:SSL stripping
archive::::アーカイブ
database::::データベース
partner::::パートナー
registry::::レジストリ
	~access可能:accessible
sniffing:
tradeoff:
detach:

タダ:free:~
担当の:responsible:~
出自に:originate::~
割合:percentage::~
定期的:periodical:~
届出る:submitする:届け出る
取込まれ:importされ::取り込まれ
埋込元:embedder::埋め込み元
文献:references:~
束ねる:bindする::~
条件付き:conditional:~
条件付きで:conditionalに:~
編集-:edit:~
負担:burden:~
遭遇-:encounter:~
修正-:fix:~

	設定しておく:set up
	:skip the remaining substeps
	HSTS Preload Lists:HSTS preload lists
	Megacorp
	Tinycorp
	abstract
	away
	bit
	end
	goes
	help
	lock
	made
	note
	part
	real
	server側:server-side
	thereby
	time
	we
	allowing
	capable
	come
	doing
	due
	immediately is, well, iffy
	in order to
	non
	onto
	2 〜 3 日後に迫っている:a few days from
	壊す:break
	最も〜見込まれ:most likely
	満たす:met
	~pageを壊す~~確度:potential for breakage
	高める:higher 
	~serveし続ける:retain
	成立する:the following statements ought to hold
	~~仕事:task
	~~対処できない:not be feasible
	~~相応:enough
	〜による:navigational
	かなりの手間がかかる:huge undertaking
	この文書による:laid out in this document
	ざらにある:often
	し続ける-:will continue to have
	すぐに:quickに
	そのため、To that end,
	その逆:vice-versa
	できていない:quite
	とり得る:potential
	ますます:increasingly
	までには，長い年月を要する:going to be a long, long time before
	優先して:prioritize
	全く想定され:never mind
	もたらす:bring
	よくない結果になるnegative consequences
	よる:laid out
	主要な:key
	何もしない:no-op
	伴わせて:along with
	冒頭:at the top
	壊され:breakage／break／broken
	始動時:spinning up
	小さい:small
	得られる:comes
	得る:takes place
	抗して:against
	消え失せる:vanish
	発せられる:goes out
	社:inc
	組:tuple
	要-:require
	離れて:away from

●●original_id_map


●●words_table1

CSP2:CSP-ja.html
RFC6454:RFC6454-ja.html
	~IETF/rfc6454
RFC6455:RFC6455-ja.html
	~IETF/rfc6455
	HTML50:https://www.w3.org/TR/html5

●●mdn_urls
upgrade-insecure-requests-http-request-header-field:HTTP/Headers/Upgrade-Insecure-Requests

●●link_map


	●
I.Document:~HTMLdom#document
	~DOM4#interface-document
	http://www.w3.org/TR/dom/#interface-document
I.Worker:~WORKERS#worker
	http://www.w3.org/TR/workers/#worker
I.SecurityPolicyViolationEvent:~CSP2#securitypolicyviolationevent

h.Content-Security-Policy-Report-Only:~CSP2#content-security-policy-report-only-header-field
	~CSP3#cspro-header
h.Content-Security-Policy:~CSP2#content-security-policy-header-field
	~CSP3#csp-header
h.Prefer:~IETF/rfc7240#section-2
h.Strict-Transport-Security:~IETF/rfc6797#section-6.1
h.Upgrade-Insecure-Requests:#upgrade-insecure-requests-http-request-header-field
h.Cache-Control:~RFC7234#section-5.2
h.Vary:~RFC7231#section-7.1.4
h.Location:~RFC7231#section-7.1.2


dir.block-all-mixed-content:~MIXED-CONTENT#block-all-mixed-content
dir.default-src:~CSP2#directive-default-src
	~CSP3#directive-default-src
dir.no-store:~RFC7234#section-5.2.2.3
dir.report-uri:~CSP2#directive-report-uri
	~CSP3#directive-report-uri
dir.upgrade-insecure-requests:#upgrade-insecure-requests
dir.includeSubDomains:~IETF/rfc6797#section-6.1.2


P.WSP:~IETF/rfc5234#appendix-B.1
P.directive-name:~CSP2#directive_name
	~CSP3#grammardef-directive-name
P.directive-value:~CSP2#directive_value
	~CSP3#grammardef-directive-value

e.iframe:~HEembed#the-iframe-element

~URL:~URL1#concept-url
url.~scheme:~URL1#concept-url-scheme
url.~host:~URL1#concept-url-host
url.~path:~URL1#concept-url-path
url.~port:~URL1#concept-url-port


昇格の仕組み:#_upgrade-mechanism
i.昇格不可:#valdef-insecure-requests-policy-do-not-upgrade
i.昇格可:#valdef-insecure-requests-policy-upgrade
~HSTS安全:#hsts-safe-origin
条件付きで~HSTS安全:#conditionally-hsts-safe-origin
~secureでない要請~施策:#insecure-requests-policy
事前読込-可能な~HSTS~host:#preloadable-hsts-host
安全に昇格-可能:#safely-upgradable-requests
要請を昇格する:#upgrade-a-request
昇格する:#upgrade-a-request
~secureでない~navi昇格~集合:#upgrade-insecure-navigations-set

適切になるなら，要請を先天的に認証-済み~URLに昇格する:#upgrade-request
適切になるなら，先天的に認証-済み~URLに昇格する:#upgrade-request
	§#examples
	§#example-nonnavigational
	§#recommendations
	§#delivery
	§#preference
	§#nesting
	§#reporting-upgrades
	§#relation-to-hsts
~secureでない要請は昇格されるべきか？:#should-upgrade-for-client

~headerを付加する:~FETCH#concept-header-list-append
~fetching:~FETCH#fetching
~main~fetch:~FETCH#main-fetch
~navi要請:~FETCH#navigation-request
要請:~FETCH#concept-request
rq.~header~list:~FETCH#concept-request-header-list
rq.~client:~FETCH#concept-request-client
rq.~target閲覧文脈:#
	＊~FETCH#concept-request-target-browsing-context
rq.~URL:~FETCH#concept-request-url

	~HTML50/browsers.html → ~BROWSERS／~NAVI
	~HTML50/webappapis.html → ~WAPI
閲覧文脈:~BROWSERS#browsing-context
属する閲覧文脈:~BROWSERS#concept-document-bc
新たな文書を作成-:~NAVI#initialise-the-document-object
	~HTML50/browsers.html#create-a-document-object
	~BROWSERS#create-a-document-object
入子の閲覧文脈:~BROWSERS#nested-browsing-context
環境~設定群~obj:~WAPI#settings-object
現任の設定群~obj:~WAPI#incumbent-settings-object
	＊~scriptに関連な設定群~obj
関連な設定群~obj:~WAPI#relevant-settings-object-for-a-script
	~HTML50/webappapis.html#relevant-settings-object-for-a-script
担当の閲覧文脈:~WAPI#responsible-browsing-context
担当の文書:~WAPI#responsible-document

先天的に認証-済み:~MIXED-CONTENT#a-priori-authenticated-url
先天的に認証-済み~URL:~MIXED-CONTENT#a-priori-authenticated-url
埋込んでいる文書:~MIXED-CONTENT#embedding-document
厳密~mode:~MIXED-CONTENT#strict-mode

	施行-:~CSP3#enforced
	監視-:~CSP3#monitored
施行-:~CSP2#enforce
監視-:~CSP2#monitor
被保護~資源:~CSP2#protected-resource
違反~報告を送信-:~CSP2#send-violation-reports
x.違反~報告:~CSP2#example-violation-report
違反~報告:~CSP2#send-violation-reports

既知な~HSTS~host:~IETF/rfc6797#section-8.1.1
	Known HSTS Host Domain Name Matching:~IETF/rfc6797#section-8.2
	congruent match:~IETF/rfc6797#section-8.2
	superdomain match:~IETF/rfc6797#section-8.2

~WebSocket接続を確立-:~RFC6455#section-4.1
生成元:~RFC6454#section-3.2
資源~表現:~RFC7231#section-3

~worker環境~設定群~objを設定しておく:~WORKERS#script-settings-for-workers
	http://www.w3.org/TR/workers/#script-settings-for-workers

	hstspreload.appspot.com:https://hstspreload.appspot.com/
	w3/webappsec#216:https://github.com/w3c/webappsec/issues/216
	w3c/webappsec#216:https://github.com/w3c/webappsec/issues/216


●●spec_metadata



最新発行バージョン
	http://www.w3.org/TR/upgrade-insecure-requests/

編集者草案
	https://w3c.github.io/webappsec-upgrade-insecure-requests/

以前のバージョン
	http://www.w3.org/TR/2015/WD-upgrade-insecure-requests-20150226/

バージョン履歴
	https://github.com/w3c/webappsec-upgrade-insecure-requests/commits/master/index.src.html

フィードバック
	<span><a href="mailto:public-webappsec@w3.org?subject=%5Bupgrade-insecure-requests%5D%20YOUR%20TOPIC%20HERE">public-webappsec@w3.org</a> with subject line “<kbd>[upgrade-insecure-requests] <i>… message topic …</i></kbd>” (<a href="https://lists.w3.org/Archives/Public/public-webappsec/" rel="discussion">archives</a>)</span>

編集
	<a href="mailto:mkwst@google.com">Mike West</a> (Google Inc.)

Participate:
	<span><a href="https://github.com/w3c/webappsec-upgrade-insecure-requests/issues/new">File an issue</a> (<a href="https://github.com/w3c/webappsec-upgrade-insecure-requests/issues">open issues</a>)</span>

●●ref_key_map
WHATWGDOM:DOM
WHATWGURL:URL

●●ref_normative
[ABNF]
    D. Crocker, Ed.; P. Overell. Augmented BNF for Syntax Specifications: ABNF. January 2008. Internet Standard. URL: https://tools.ietf.org/html/rfc5234 
[CSP]
    Mike West; Adam Barth; Dan Veditz. Content Security Policy. CR. URL: https://www.w3.org/TR/CSP/ 
[FETCH]
    Anne van Kesteren. Fetch Standard. Living Standard. URL: https://fetch.spec.whatwg.org/ 
[HTML5]
    Ian Hickson; et al. HTML5. 28 October 2014. REC. URL: http://www.w3.org/html/wg/drafts/html/master/ 
[MIX]
    Mike West. Mixed Content. 8 October 2015. CR. URL: https://w3c.github.io/webappsec/specs/mixedcontent/ 
[RFC2119]
    S. Bradner. Key words for use in RFCs to Indicate Requirement Levels. March 1997. Best Current Practice. URL: https://tools.ietf.org/html/rfc2119 
[RFC3864]
    G. Klyne; M. Nottingham; J. Mogul. Registration Procedures for Message Header Fields. September 2004. Best Current Practice. URL: https://tools.ietf.org/html/rfc3864 
[RFC6454]
    A. Barth. The Web Origin Concept. December 2011. Proposed Standard. URL: https://tools.ietf.org/html/rfc6454 
[RFC6455]
    I. Fette; A. Melnikov. The WebSocket Protocol. December 2011. Proposed Standard. URL: https://tools.ietf.org/html/rfc6455 
[RFC6797]
    J. Hodges; C. Jackson; A. Barth. HTTP Strict Transport Security (HSTS). November 2012. Proposed Standard. URL: https://tools.ietf.org/html/rfc6797 
[RFC7231]
    R. Fielding, Ed.; J. Reschke, Ed.. Hypertext Transfer Protocol (HTTP/1.1): Semantics and Content. June 2014. Proposed Standard. URL: https://tools.ietf.org/html/rfc7231 
[RFC7762]
    M. West. Initial Assignment for the Content Security Policy Directives Registry. January 2016. Informational. URL: https://tools.ietf.org/html/rfc7762 
[WHATWG-DOM]
    Anne van Kesteren. DOM Standard. Living Standard. URL: https://dom.spec.whatwg.org/ 
[WHATWG-URL]
    Anne van Kesteren; Sam Ruby. URL Standard. Living Standard. URL: https://url.spec.whatwg.org/ 
[WORKERS]
    Ian Hickson. Web Workers. WD. URL: http://www.w3.org/TR/workers/


●●ref_informative
[BBC-ARCHIVE]
    Neil McIntosh. Labelling BBC Online’s archived websites. URL: http://www.bbc.co.uk/blogs/internet/entries/f7126d19-2afa-3231-9c4e-0f7198c468ab 
[HTML]
    Ian Hickson. HTML Standard. Living Standard. URL: https://html.spec.whatwg.org/multipage/ 
[NYT-HTTPS]
    Eitan Konigsburg; Rajiv Pant; Elena Kvochko. Embracing HTTPS. URL: http://open.blogs.nytimes.com/2014/11/1%33/embracing-https/ 
[RFC7234]
    R. Fielding, Ed.; M. Nottingham, Ed.; J. Reschke, Ed.. Hypertext Transfer Protocol (HTTP/1.1): Caching. June 2014. Proposed Standard. URL: https://tools.ietf.org/html/rfc7234 
[RFC7240]
    J. Snell. Prefer Header for HTTP. June 2014. Proposed Standard. URL: https://tools.ietf.org/html/rfc7240 
[WEB-HTTPS]
    Mark Nottingham. Securing the Web. TAG Finding. URL: http://www.w3.org/2001/tag/doc/web-https


●●trans_metadata
<p>
~THIS_PAGEは、~W3Cにより作業草案として公開された
<a href="~SPEC_URL">Upgrade Insecure Requests</a>
を日本語に翻訳したものです。
~PUB
</p>

</script>


<body>

<header>
	<hgroup>
<h1>セキュアでない要請の昇格 — Upgrade Insecure Requests</h1>
	</hgroup>
</header>

<div id="MAIN" hidden>

	<section id="abstract">
~ABSTRACT

<p>
この文書は、~secureでない資源への要請を~fetchする前に~secure~transportへ昇格するよう，作者が~UAに指図できるようにする仕組みを定義する。
◎
This document defines a mechanism which allows authors to instruct a user agent to upgrade insecure resource requests to secure transport before fetching them.
</p>

	</section>
	<section id="status">
~STATUSofTHIS

<p>
<!-- 
この節では、発行時点における…
 -->
これは編集者草案の公の複製です…
【以下、この節の他の内容は <a href="w3c-common-ja.html#status" >W3C 日本語訳 共通ページ</a>に委譲。】
</p>

<p><strong>
この文書に対する変更点は、
<a href="https://github.com/w3c/webappsec">https://github.com/w3c/webappsec</a>
にて追跡できます。
</strong>
◎
Changes to this document may be tracked at https://github.com/w3c/webappsec.
</p>

<p>
この文書は
<a href="http://www.w3.org/2011/webappsec/">Web Application Security Working Group</a>
により制作されました。
◎
This document was produced by the Web Application Security Working Group.
</p>

	</section>

<main id="MAIN0">

	<section id="intro">
<h2 title="Introduction">1. 序論</h2>

~INFORMATIVE

<p>
作者には、自身による~siteや~appを，~secureでない~transportから離れて，暗号化されかつ認証された接続へ移行0することが、ますます奨励されている
`WEB-HTTPS$r
。
この移行には，作者, 利用者~双方にとり有意な利点があるが、負な副作用もないわけではない。
◎
Increasingly, we encourage authors to transition their sites and applications away from insecure transport, and onto encrypted and authenticated connections [WEB-HTTPS]. While this migration has significant advantages for both authors and users, it isn’t without negative side-effects.
</p>

<p class="trans-note">【
この仕様の “作者（ author ）” は、~page内容の作者というより，~site管理者（~serverの環境設定の作者）を指している。
】</p>

<p>
特に，混在~内容の検査-法 `MIX$r は、相当~量の旧来の内容を ~HTTPSに移動する~~仕事を抱える管理者たちにとって，悩みの種になり得る。
古い内容を読み通して，資源~URLを手作業で書直すには、かなりの手間がかかる。
さらには、［
BBC ~siteの~archive `BBC-ARCHIVE$r や,
New York Times の直書きされた~URL `NYT-HTTPS$r
］を考えればわかるように、真に旧来の内容は，更新-が困難あるいは不可能なこともざらにある。
◎
Most notably, mixed content checking [MIX] has the potential to cause real headache for administrators tasked with moving substantial amounts of legacy content onto HTTPS. In particular, going through old content and rewriting resource URLs manually is a huge undertaking. Moreover, it’s often the case that truly legacy content is difficult or impossible to update. Consider the BBC’s archived websites [BBC-ARCHIVE], or the New York Times' hard-coded URLs [NYT-HTTPS].
</p>

<p>
この負担は、~site作者から除去されるべきである
— ［
~siteは~secureな資源のみ読込むことを意図していて，~secureでない~URLは 等価な~secure~URLに置換されたかのように扱われるべきである
］ことを，作者が~UAに表明できるようにすることにより。
◎
We should remove this burden from site authors by allowing them to assert to a user agent that they intend a site to load only secure resources, and that insecure URLs ought to be treated as though they had been replaced with equivalent secure URLs.
</p>

<p>
この文書は、新たな
<abbr title="Content Security Policy">~CSP</abbr>
指令 `upgrade-insecure-requests$dir を定義する。
作者は、この指令を通して，上述について表明できる。
この施策は~headerとして送達されることに注意。
これにより、管理者は，~source~codeを個々に触れることなく，~pageの集合を昇格の仕組みに容易に~opt-intoできるようになる。
施策を~HTMLの中に~inline化するような~approach†では、上述した旧来の内容などには~~対処できないであろう。
◎
This document defines a new Content Security Policy directive, upgrade-insecure-requests, through which authors can make this assertion. Note: Delivering the policy as a header allows an administrator to easily opt a set of pages into the upgrade mechanism without touching their source code individually. The legacy content examples above would not be feasible with an approach that inlined the policy into HTML, for example.
</p>

<p class="trans-note">【†
とは言え、
<a href="~CSP3#meta-element">`meta^e 要素~内に~inline化して</a>
送達された場合に無視されるわけではないであろう。
】</p>

		<section id="goals">
<h3 title="Goals">1.1. 目標</h3>

<p>
包括的な目標は、［
混在~内容の阻止-法 `MIX$r による負な副作用を抑制する
］ことにより，~siteを~secureでない生成元から移行する際の負担を抑制することである。
◎
The overarching goal is to reduce the burden of migrating websites from insecure origins by reducing the negative side effects of mixed content blocking [MIX].
</p>

<p>
作者が［
~server側で準備作業を済ませておくこと（
証明書を得る ／ ~serverを環境設定する ／ ~redirectを設定しておく
）］，および［［
当事者主体, 第三者主体
］の両~内容とも，~secure`~scheme$url上の
【~secureでない~scheme上のそれと】
`同じ^em ( `~host$url, `~path$url ) 組で~access可能になること
］を確保することを前提に，この特能が実装されたならば、次が成立するべきである：
◎
If we assume that authors do the server-side legwork (obtaining a certificate, configuring the server, setting up redirects), and that authors also ensure that both first- and third-party content is accessible at the same host and path on a secure scheme, then the following statements ought to hold after implementing this feature:
</p>

<ol>
	<li>
<p>
作者は、所与の~pageから要請されるすべての内容が，成功裡かつ~secureに読込まれることを確保できるべきである。
混在~内容を阻止して~secureな生成元へ移行した結果，~pageが壊されるべきでない。
◎
Authors should be able to ensure that all content requested by a given page loads successfully, and securely. Mixed content blocking should not break pages as a result of migrating to a secure origin.
</p>

<p class="note">注記：
混在内容の`厳密~mode$は、この要件を`満たさない^em
— それが表明するのは、逆の性格の様な何かである。
◎
Note: This requirement is not met by Mixed Content’s strict mode, which makes something like the opposite assertion.
</p>
	</li>
	<li>
~UAは、前項の結果として、要請している混在~内容に関係するどの~security指示子も格下げするべきでない
— どのような~secureでない内容も要請されないべきである。
◎
As a result of #1, the user agent should not degrade any security indicators related to requesting mixed content, as no insecure content should be requested.
</li>
	<li>
作者は、すべての内部~linkが，利用者にとって ~siteの~secure~addressへ
— 移行前の~secureでない~addressではなく —
正しく送信されることを確保できるべきである。
◎
Authors should be able to ensure that all internal links correctly send users to the site’s secure address, and not to its pre-migration insecure address.
</li>
	<li>
作者は、~siteの内容を編集せずに，以上の目標すべてを達成できるべきである。
このことは、保守が~~相応に困難で, 昇格など全く~~想定されてない，~archiveされた内容や旧来の~systemにとり、特に重要である。
◎
Authors should be able to achieve all these goals without editing a site’s content. This is particularly important for archived content and legacy systems for which maintenance is difficult enough, never mind upgrades.
</li>
	<li>
作者は、`昇格の仕組み$を~supportする~clientには~secureな資源を~serveしつつ，~supportしない~clientに対しても~secureでない資源を~serveし続けることで、~secureでないから~secureへの移行0を，~~継続的に行えるべきである。
◎
Authors should be able to pursue a gradual transition from insecure to secure, serving secure resources to clients that support upgrades, while retaining insecure resources for clients that don’t.
</li>
</ol>

<p class="note">注記：
ここに定義される`昇格の仕組み$は、
Strict Transport Security `RFC6797$r
に取代わることを意図するもの`ではない^em。
詳細は、
<a href="#relation-to-hsts">§ ~HSTSとの関係</a>を見よ。
◎
Note: The mechanism defined here does not intend to supplant Strict Transport Security [RFC6797]. See §8.2 Relation to HSTS for details.
</p>

		</section>
		<section id="examples">
<h3 title="Examples">1.2. 各種~例</h3>

			<section id="example-nonnavigational">
<h4 title="Non-navigational Upgrades">1.2.1. 非~naviによる昇格</h4>

<div class="example">
<p>
Megacorp 社は、
`http://example.com/^s
から
`https://example.com^s
へ移行したいと望んでいるとする。
彼らは、所有する資源が~HTTPS越しに可用になるよう，自身の~serverを設定しておいた上で、第三者主体~widgetも~secureに可用にするため，~partnerたちとも協働する。
◎
Megacorp, Inc. wishes to migrate http://example.com/ to https://example.com. They set up their servers to make their own resources available over HTTPS, and work with partners in order to make third-party widgets available securely as well.
</p>

<p>
しかしながら，彼らはすぐに、それらの内容の大部分が，古い内容~管理~systemに縛られた~database内に閉じ込められていて，~secureでない資源を指す直書きの~link（例： 画像その他の内容への http:// ~URL ）を包含することを悟った。
あいにく、それを更新するには相当な作業~量を~~要する。
◎
They quickly realize, however, that the majority of their content is locked up in a database tied to an old content management system, and it contains hardcoded links to insecure resources (e.g., http:// URLs to images and other content). Unfortunately, it’s a substantial amount of work to update it.
</p>

<p>
当座しのぎとして、 Megacorp 社は，それらの~serverから発せられる どの~HTML応答の中にも次の~headerを注入することにした：
◎
As a stopgap measure, Megacorp injects the following header field into every HTML response that goes out from their servers:
</p>

<pre class="http-code">
`Content-Security-Policy$h: `upgrade-insecure-requests$dir
</pre>

<p>
これは、それらの~pageからの~secureでない資源~要請すべてに対し，~secure~variantへ自動的に昇格させ、~UAが，次の~HTML~codeを：
◎
This automatically upgrades all insecure resource requests from their pages to secure variants, allowing a user agent to treat the following HTML code:
</p>

<pre>
&lt;img src="http://example.com/image.png"&gt;
&lt;img src="http://not-example.com/image.png"&gt;
</pre>

<p>
次が送達されたかのように扱えるようにする：
◎
as though it had been delivered as:
</p>

<pre>
&lt;img src="https://example.com/image.png"&gt;
&lt;img src="https://not-example.com/image.png"&gt;
</pre>

<p>
~URLは、要請が為される前に書直されることになる
— それは、~secureでない要請が~networkを叩くことはないことを意味する。
すべての資源~要請は，労せず透過的に昇格されることになるので、利用者にとっては より安全になり， Megacorp 社の管理者にとっては喜ばしい結果になる。
◎
The URL will be rewritten before the request is made, meaning that no insecure requests will hit the network. Users will be safer, and Megacorp’s administrators will be happier, as all resource requests will be transparently upgraded with no effort on their part.
</p>

</div>

			</section>
			<section id="example-navigation">
<h4 title="Navigational Upgrades">1.2.2. ~naviによる昇格</h4>

<div class="example">
<p>
Megacorp 社は、まだ
`Strict-Transport-Security$h ~header `RFC6797$r
を送達する準備はできていないが、アリなときは，利用者を~secure~page上に保つよう求めているとする。
幸いなことに，これは `upgrade-insecure-requests$dir にタダでついてくる。
すなわち、彼らはすでに，次の~headerを伴わせて~pageを送達している：
◎
Megacorp, Inc. isn’t quite ready to deliver Strict Transport Security headers [RFC6797], but does want to keep users on secure pages when possible. Happily, this comes for free with upgrade-insecure-requests. That is, they’re already delivering pages with the following header:
</p>

<pre class="http-code">
`Content-Security-Policy$h: `upgrade-insecure-requests$dir
</pre>

<p>
これは、~UAが次の~HTML~codeを：
◎
This allows user agents to treat the following HTML code:
</p>

<pre>
&lt;a href="http://example.com/"&gt;Home&lt;/a&gt;
</pre>

<p>
次が送達されたかのように扱えるようにする：
◎
as though it had been delivered as:
</p>

<pre>
&lt;a href="https://example.com/"&gt;Home&lt;/a&gt;
</pre>

<p>
一方で、第三者主体~siteへの~linkは，昇格されないことになる。
すなわち、次の~HTML~code：
◎
Links to third-party sites will not be upgraded. That is, the following HTML code:
</p>

<pre>
&lt;a href="http://not-example.com/"&gt;Home&lt;/a&gt;
</pre>

<p>
は，昇格されない。
◎
won’t be upgraded.
</p>

</div>

			</section>
			<section id="example-failed">
<h4 title="Failed Upgrade">1.2.3. 失敗した昇格</h4>

<div class="example">
<p>
Tinycorp 社は `upgrade-insecure-requests$dir を可能化したが、時期尚早であった
— 実際にはまだ `http://cdn.example.com/^s 上で~HTTPSを~supportしていなかったので。
次の~codeが与えられたとする：
◎
Tinycorp, Inc. enabled upgrade-insecure-requests a bit earlier than they should have, as they don’t actually support HTTPS on http://cdn.example.com/. Given the following code:
</p>

<pre>
&lt;img src="http://cdn.example.com/image.png"&gt;
</pre>

<p>
~UAは、
<a href="#example-nonnavigational">§ 非~naviによる昇格</a>に述べたように，~URLを
`https://cdn.example.com/image.png^s
に書直して要請を昇格することになる。
~serverは~secureな要請に応答しないので、その結果は~network~errorになる。
◎
User agents will upgrade requests, as described in §1.2.1 Non-navigational Upgrades, rewriting the URL as https://cdn.example.com/image.png. As the server doesn’t respond to secure requests, this results in a network error.
</p>

<p>
この局面に際しては、~fallbackはない。
~UAは、［
意図的に，そのように要請を為すものとされた
］と受け取って動作するので、要請は失敗する。
◎
There is no fallback in this scenario: the user agent acts just as though the request had been intentionally made, and the request fails.
</p>

</div>

			</section>
		</section>
		<section id="recommendations">
<h3 title="Recommendations">1.3. 各種~推奨</h3>

<p>
作者【~server運用者】
には、`昇格の仕組み$を~supportする~UAが，アリな限り~secureになるよう確保したいと望むなら，次を行うことを推奨する：
◎
We recommend that authors who wish to ensure that user agents which support upgrade-insecure-requests are as secure as possible do the following:
</p>

<ol>
	<li>
<p>
~secureでないかつ`安全に昇格-可能$な要請に対しては、状態s~code `307^st を伴う `Location$h ~headerで応答することにより，~HTTPから~HTTPSへ~redirectする。
◎
Redirect insecure, safely upgradable requests from HTTP to HTTPS by responding with a Location header and a 307 status code.
</p>

<div class="example">
<p>
~Nginxにおいては、この種の~redirectionは，次の様になるであろう：
◎
In Nginx, this kind of redirection might look like this:
</p>

<pre>
server {
  if ($http_upgrade_insecure_requests = "1") {
    add_header Vary Upgrade-Insecure-Requests;
    return 307 https://$host$request_uri;
  }
}
</pre>

<p>
無論これは，ごく単純~化されており、~~実際の環境設定はずっと複階的になるであろう。
◎
This is, of course, greatly simplified; your configuration will likely be significantly more complex.
</p>
</div>

	</li>
	<li>
<p>
`先天的に認証-済み$かつ`安全に昇格-可能$な要請に対しては、要請されている資源に必要とされるなら， `upgrade-insecure-requests$dir 指令を伴わせて応答する。
◎
Respond to a priori authenticated safely upgradable requests with a upgrade-insecure-requests directive if necessary for the resource being requested.
</p>

<div class="example">
<p>
~Nginxにてこの指令を追加するときは、次の様になるであろう:
◎
In Nginx, adding this directive might look like this:
</p>

<pre>
server {
  ...

  add_header `Content-Security-Policy$h `upgrade-insecure-requests$dir;

  ...
}

</pre>

<p>
無論これは，ごく単純~化されており、~~実際の環境設定はずっと複階的になるであろう。
◎
This is, of course, greatly simplified; your configuration will likely be significantly more complex.
</p></div>

	</li>
	<li>
<p>
生成元が`~HSTS安全$である場合、~SSL-stripping中間者~攻撃に抗して保護するため、
`preload^dir 指令を伴う `Strict-Transport-Security$h ~headerを送信して，混在内容の`厳密~mode$を可能化することにより，~secureでない内容は決して読込まれないことを確保する。
◎
If the origin is HSTS-safe, then protect against SSL-stripping man-in-the-middle attacks by sending a Strict-Transport-Security header with the preload directive, and ensure that insecure content is never loaded by enabling Mixed Content’s strict mode.
</p>

<div class="example">
<p>
~Nginxにてこの~headerを追加するときは、次の様になるであろう（
`preload^dir <!-- ＊ preloaded 誤記 -->
指令の利用は、この生成元の~HSTS状態を~~通達し，~UAの
HSTS Preload Lists
に安全に取込まれることに注意）:
◎
In Nginx, adding this header might look like this (note the use of the preloaded directive, which signifies that this origin’s HSTS state can be safely imported into user agents' HSTS preload lists):
</p>

<pre>
server {
  ...
  
  add_header `Strict-Transport-Security$h "max-age=10886400; preload"
  add_header `Content-Security-Policy$h `block-all-mixed-content$dir;

  ...
}
</pre>

<p>
無論これは，ごく単純~化されており、~~実際の環境設定はずっと複階的になるであろう。
◎
This is, of course, greatly simplified; your configuration will likely be significantly more complex.
</p>

</div>

<p>
加えて、~UA~vendorたちと協働する
— 当の生成元を
HSTS Preload Lists
に追加することを通して（例えば、当の生成元を
<a href="https://hstspreload.appspot.com/">hstspreload.appspot.com</a>
まで届出ることにより）。
◎
Additionally, work with user agent vendors to add the origin to HSTS Preload Lists (for example, by submitting the origin to hstspreload.appspot.com).
</p>
	</li>
	<li>
<p>
生成元が`条件付きで~HSTS安全$の場合、`安全に昇格-可能$な要請のみに呼応して~HSTSを~opt-intoする。
◎
If the origin is conditionally HSTS-safe, then opt-into HSTS only in response to safely upgradable requests.
</p>

<div class="example">
<p>
~Nginxにて この~headerを条件付きに追加するときは、次の様になるであろう（
note the use of `map^c, as setting headers inside `if^c without returning immediately is, well, iffy
【~Nginxには不詳なので，原文のままにしておく】
）：
<!-- 
`map^c の用法に注意
— わかっているだろうが、即時に返さずに `if^c の内側で~headerを設定することは、よくないので。
 -->
◎
In Nginx, adding this header conditionally might look like this (note the use of map, as setting headers inside if without returning immediately is, well, iffy):
</p>

<pre>
server {
  ...

  map $http_https $sts {
    "1" "max-age=10886400"
  }
  
  add_header `Strict-Transport-Security$h $sts;

  ...
}
</pre>

<p>
無論これは，ごく単純~化されており、~~実際の環境設定はずっと複階的になるであろう。
◎
This is, of course, greatly simplified; your configuration will likely be significantly more complex.
</p>
</div>
	</li>
</ol>

		</section>
	</section>
	<section id="key-concepts">
<h2 title="Key Concepts and Terminology">2. 主要な概念と各種用語</h2>

<dl>
	<dt>`昇格の仕組み@</dt>
	<dd>
この文書に述べる，（~URLを透過的に~secure~URLに昇格しても）~pageが壊されないようにするための
`upgrade-insecure-requests$dir の仕組みを指す。
（~page／資源／~site が）
“昇格の仕組みを要する”
とは、［
~UAにおいて`昇格の仕組み$が~supportされている
］ことを要することを意味する。
</dd>
	<dd class="trans-note">【
この用語は、本文の記述を 簡潔に, かつ一貫させるために，この訳に導入している。
原文では、
“この文書に述べる〜”
に記した様な長い修飾がいちいち付いていて，読みにくいので
— おそらく、 HTTP `Upgrade^h ~headerなどによる，他の “昇格の仕組み” と区別するためと思われるが、
“昇格” が他の意味を指す箇所は，この仕様には現れない。
】</dd>
	<dt>
要請を
`昇格する@
◎
upgrade
</dt>
	<dd>
~URLの`~scheme$url が［
`http^l ／ `ws^l
］から［
`https^l ／ `wss^l
］に書直された`要請$は、<strong>昇格された</strong>という。
◎
A request is said to be upgraded if it is rewritten to contain a URL with a scheme of https or wss.
</dd>

	<dt>
`安全に昇格-可能@
な要請
◎
safely upgradable requests
</dt>
	<dd>
<p>
次のいずれかを満たす`要請$は、
<strong>安全に昇格-可能</strong>
とされる：
</p>

<ul><li>返される`資源~表現$は、`昇格の仕組み$を要さない。
</li><li>`要請$の`~header~list$rqは、値 `1^v にされた `Upgrade-Insecure-Requests$h ~headerを包含している。
</li></ul>

◎
A request is said to be safely upgradable if the resource representation which will be returned does not require the upgrade-insecure-requests mechanism described in this document to avoid breakage, or if the request’s header-list contains an Upgrade-Insecure-Requests header field with a value of 1.
</dd>

	<dt>
`~HSTS安全@
な生成元
◎
HSTS-safe origin
</dt>
	<dd>
<p>
次のいずれも満たす`生成元$は、
<strong>~HSTS安全</strong>とされる：
</p>

<ul><li>それが返す どの`資源~表現$も `昇格の仕組み$を要さない, かつ
</li><li>それが返す どの`資源~表現$も~HTTPS越しに~serveされる。
</li></ul>

◎
An origin is said to be HSTS-safe if no resource representations it returns requires the the upgrade-insecure-requests mechanism described in this document to avoid breakage, and if all resource representations it returns can be served over HTTPS.
</dd>
	<dd>
`~HSTS安全$な生成元は、すべての~UAに対し
`Strict-Transport-Security$h
を安全に~opt-intoできる
— `昇格の仕組み$を~supportしない~UAに対しても，~pageが壊される~riskなしに。
◎
HSTS-safe origins can safely opt-into Strict-Transport-Security for all user agents, without risking broken pages for user agents which do not support upgrade-insecure-requests.
</dd>

	<dt>
`条件付きで~HSTS安全@
な生成元
◎
conditionally HSTS-safe origin
</dt>
	<dd>
<p>
次のいずれも満たす`生成元$は、
<strong>条件付きで~HSTS安全</strong>
とされる：
</p>

<ul><li>それが返す ある`資源~表現$は `昇格の仕組み$を要する, かつ
</li><li>それが返す どの`資源~表現$も~HTTPS越しに~serveされる。
</li></ul>
◎
An origin is said to be conditionally HSTS-safe if one or more resource representations it returns requires the upgrade-insecure-requests mechanism described in this document to avoid breakage, and if all resource representations it returns can be served over HTTPS.
</dd>
	<dd>
`条件付きで~HSTS安全$な生成元は、`昇格の仕組み$を~supportする~UAに対してのみ，
`Strict-Transport-Security$h
を安全に~opt-intoできる。
◎
Conditionally HSTS-safe origins can safely opt-into Strict-Transport-Security only for user agents which support upgrade-insecure-requests.
</dd>

	<dt>
`事前読込-可能な~HSTS~host@
◎
preloadable HSTS host
</dt>
	<dd>
<p>
`~host$url %~host は、
<a href="~IETF/rfc6797#section-8.2">Known HSTS Host Domain Name Matching</a>
（
“既知な~HSTS~host~domain名との照合”
）を遂行したとき，次のいずれかを満たすならば、
<strong>事前読込-可能な~HSTS~host</strong>
とされる：
</p>

		<ul>
			<li>
%~host は、［
`includeSubDomains$dir, `preload^dir
の両~指令とも表明している ある`既知な~HSTS~host$
］に
<a href="~IETF/rfc6797#section-8.2">superdomain match</a>
する†
</li>
			<li>
%~host は、［
`preload^dir 指令を表明している ある`既知な~HSTS~host$
］に
<a href="~IETF/rfc6797#section-8.2">congruent match</a>
する††
</li>
</ul>

<p class="trans-note">【†
“上位~domain合致”
— ~HSTS~hostは %~host の ある上位~domainに一致する
】【††
“合同~合致”
— ~HSTS~hostは %~host に一致する
】</p>

◎
A host host is a preloadable HSTS host if, when performing Known HSTS Host Domain Name Matching, host is a superdomain match for a Known HSTS Host which asserts both the includeSubDomains directive and the preload directive, or host is a congruent matchfor a Known HSTS Host which asserts the preload directive.
</dd>
	<dd class="note">注記：
手短に言えば、これらは，
“~UAが、［
`preload^dir 指令を包含していた `Strict-Transport-Security$h ~header
］を，手元に~pinしておいた~hostたち”
である。
◎
Note: This is a long way of saying "any host the user agent has pinned with a Strict-Transport-Security header that contained a preload directive".
</dd>

</dl>

<p>
<a href="#delivery">§ `upgrade-insecure-requests^dir ~CSP指令</a>
に利用される~ABNF（ Augmented Backus-Naur Form ）記法は、
`ABNF$r （ RFC5234 ）にて指定される。
◎
The Augmented Backus-Naur Form (ABNF) notation used in §3.1 The upgrade-insecure-requests Content Security Policy directive is specified in RFC5234. [ABNF]
</p>

		<section id="_conventions">
<h3>【この訳に固有の表記規約】</h3>

<p>
この訳の，~algoや定義の記述に利用されている各種記号（ ~LET, ~IF, ~RET, 等々）の意味や定義の詳細は、~SYMBOL_DEF_REFを~~参照されたし。
</p>

		</section>
	</section>
	<section id="upgrading">
<h2 title="Upgrading Insecure Resource Requests">3. ~secureでない資源~要請の昇格-法</h2>

<p>
作者は、資源~要請の~URLを`先天的に認証-済み$~variantに透過的に昇格するよう，
 ~UAに指図してよい。
これにより、~secureでない生成元から移行するときの負な副作用を軽減できる。
◎
In order to allow authors to mitigate the negative side-effects of migration away from insecure origins, authors may instruct the user agent to transparently upgrade resource requests to a priori authenticated variants of the original request’s URL.
</p>

<p>
この指図を~supportするため、各［
`環境~設定群~obj$ ／ `閲覧文脈$
］には、次のものが結び付けられる†：
◎
To support this instruction:
◎
↓</p>

<dl class="def-list">
	<dt>`~secureでない要請~施策@</dt>
	<dd>
`昇格不可@i ／ `昇格可@i
のいずれかを値にとり、他から指定されない限り`昇格不可$iに設定される。
この施策は、［
`~fetching$の間に，非~navi要請や~form提出が昇格されるべきかどうかを決定する
］ために，［
`適切になるなら，要請を先天的に認証-済み~URLに昇格する$
］ときに検査される。
◎
Environment settings objects and browsing contexts are given an insecure requests policy which has two potential values Do Not Upgrade and Upgrade. It is set to Do Not Upgrade unless otherwise specified. This policy is checked in §4.1 Upgrade request to an a priori authenticated URL, if appropriate in order to determine whether or not non-navigation requests and form submissions should be upgraded during fetching.
</dd>

	<dt>`~secureでない~navi昇格~集合@</dt>
	<dd>
~naviが昇格するべきとされる，いくつかの
( `~host$url, `~port$url ) 組
からなる集合であり、他から指定されない限り空~集合とする。
この集合は、［
`~navi要請$が昇格されるべきかどうか決定する
］ために，［
`適切になるなら，要請を先天的に認証-済み~URLに昇格する$
］ときに検査される。
◎
Environment settings objects and browsing contexts are given an upgrade insecure navigations set which contains a set of (host, port) tuples to which navigations ought to be upgraded. Its value is the empty set unless otherwise specified. This set is checked in §4.1 Upgrade request to an a priori authenticated URL, if appropriate in order to determine whether or not navigation requests should be upgraded.
</dd>

</dl>

<p class="trans-note">【†
“文書（ `Document$I ）の`~secureでない要請~施策$（または `~secureでない~navi昇格~集合$）”
のような句も現れる
— これは、文書が`属する閲覧文脈$の`~secureでない要請~施策$を指しているものと思われる。
】</p>

		<section id="delivery">
<h3 title="The upgrade-insecure-requests Content Security Policy directive ">3.1. `upgrade-insecure-requests^dir ~CSP指令</h3>

<p>
~serverは、［
`upgrade-insecure-requests@dir
指令を包含する `Content-Security-Policy$h ~header `CSP$r
］を送信することにより，［
特定0の`被保護~資源$に対する~secureでない要請
］を昇格するよう，~UAに指図してもヨイ。
この指令は、次の `ABNF$r 文法で定義される：
◎
A server MAY instruct a user agent to upgrade insecure requests for a particular protected resource by sending a Content-Security-Policy header [CSP] that contains a upgrade-insecure-requests directive, defined via the following ABNF grammar:
</p>

<pre class="ABNF">
`directive-name$P  = "upgrade-insecure-requests"
`directive-value$P = ""
</pre>

<p>
`upgrade-insecure-requests^dir 指令を`施行-$するときは：
◎
When enforcing the upgrade-insecure-requests directive:
</p>

<ol>
	<li>
%設定群 ~LET `被保護~資源$の`現任の設定群~obj$
◎
Let settings be the protected resource’s incumbent settings object.
</li>
	<li>
%設定群 の`~secureでない要請~施策$ ~SET `昇格可$i
◎
Set settings’s insecure requests policy to Upgrade.
</li>
	<li>
%組 ~LET `被保護~資源$の`~URL$の ( `~host$url, `~port$url ) 組
◎
Let tuple be a tuple of the protected resource’s URL's host and port.
</li>
	<li>
%組 を %設定群 の`~secureでない~navi昇格~集合$に挿入する
◎
Insert tuple into settings’s upgrade insecure navigations set.
</li>
</ol>

<div class="p">
<p>
`監視-$時においては、 `upgrade-insecure-requests^dir 指令の効果はない
— すなわち、この指令が `Content-Security-Policy-Report-Only$h ~headerを介して送信されたときは無視される。
作者は、 `Content-Security-Policy-Report-Only$h を介して，昇格された資源の元の~URLが~secureでないであったかどうかを決定できる。
例えば次のように：
</p>

<pre class="http-code">
`Content-Security-Policy-Report-Only$h: default-src https:; report-uri /endpoint
</pre>

<p>
追加的な詳細は、
<a href="#reporting-upgrades">§ 昇格の報告-法</a>を見よ。
</p>
◎
Monitoring the upgrade-insecure-requests directive has no effect: the directive is ignored when sent via a Content-Security-Policy-Report-Only header. Authors can determine whether or not upgraded resources' original URLs were insecure via Content-Security-Policy-Report-Only. For example, Content-Security-Policy-Report-Only: default-src https:; report-uri /endpoint. See §3.4 Reporting Upgrades for additional detail.
</div>

			<section id="mix">
<h4 title="Relation to &quot;Mixed Content&quot;">3.1.1. “混在~内容” との関係</h4>

<p>
`upgrade-insecure-requests$dir 指令は、
`~fetching$ ~algo `FETCH$r
の冒頭にて，［
`適切になるなら，要請を先天的に認証-済み~URLに昇格する$
］の結果に従って，要請が書直されるようにする。
この書直しは、［
混在内容 `MIX$r ／ ~CSP `CSP$r
］による検査-の効果が`生じる前^emに起こることが重要であることに注意。
この順序付けは、次を意味する：
◎
The upgrade-insecure-requests directive results in requests being rewritten at the top of the Fetching algorithm [FETCH], as specified in §4.1 Upgrade request to an a priori authenticated URL, if appropriate. It’s important to note that the rewrite happens before either Mixed Content [MIX] or Content Security Policy checks take effect [CSP].
</p>

<div>
<ul>
	<li>
昇格された要請は、混在~内容として`~~扱われなくなる^em。
</li>
	<li>
<p >
`upgrade-insecure-requests$dir 指令の効果は，
`block-all-mixed-content$dir 指令が当の要請を阻止する機会を得る前に生じる。
前者が設定された場合、後者は実質的に何もしないことになる。
</p>
<p >
作者には、
<a href="#recommendations">§ 各種~推奨</a>
にて要旨されるように，この 2 つの指令のうち いずれか一方は設定することが推奨される。
</p>
	</li>
</ul>

◎
This ordering means that upgraded requests will not be flagged as mixed content. Moreover, it means that upgrade-insecure-requests’s effect takes place before the block-all-mixed-content directive would have a chance to block the request. If the former is set, the latter is effectively a no-op.
◎
We recommend that authors set one directive or the other, as outlined in §1.3 Recommendations.
</div>

			</section>
		</section>
		<section id="feature-detect">
<h3 title="Feature Detecting Clients Capable of Upgrading">3.2. ~clientの昇格-能力についての特能の検出-法</h3>

<p>
［
~secureな移行0-越しに，利用者に適度な体験を供する
］ために，`昇格の仕組み$を要する~siteは、何らかの仕方で［
個々の`要請$について，それを~HTTPから~HTTPS（あるいは その逆）へ安全に~redirectできるかどうか
］を決定する必要がある。
更には、`条件付きで~HSTS安全$な生成元は，
【昇格の仕組みを】~supportする~UAに限って
`Strict-Transport-Security$h を~opt-intoできる
— そうしなければ、~siteの利用者にとって よくない結果になりかねない。
◎
Sites which require the upgrade mechanism laid out in this document in order to provide users with a reasonable experience over secure transit need some way to determine whether or not a particular request can safely be redirected from HTTP to HTTPS (and vice-versa). Moreover, conditionally HSTS-safe origins can only opt-into Strict-Transport-Security for supported user agents, and doing otherwise could have negative consequences for the site’s users.
</p>

<p>
この裁定は，~UA~sniffing
【~serverが，~UAが昇格の仕組みを~supportするかどうか推定（ sniff ）する？】
に依拠して下すものではない
— ~UAは、`~navi要請$を為すときに `Upgrade-Insecure-Requests$h ~headerを含ませることにより，自身の昇格~能力を告知できる。
<a href="#preference">§ `Upgrade-Insecure-Requests^h ~HTTP要請~header</a>
を見よ。
◎
Rather than relying on user-agent sniffing to make this decision, user agents can advertise their upgrade capability when making navigation requests by including an Upgrade-Insecure-Requests header field as described in §3.2.1 The Upgrade-Insecure-Requests HTTP Request Header Field.
</p>

			<section id="preference">
<h4 title="The Upgrade-Insecure-Requests HTTP Request Header Field ">3.2.1. `Upgrade-Insecure-Requests^h ~HTTP要請~header</h4>

<div >
<p>
`Upgrade-Insecure-Requests@h
~HTTP要請~headerは、次を表出する通達を~serverへ向けて送信する：
</p>
<ul ><li>~clientは、暗号化-済みかつ認証-済みの応答を選好すること，および
</li><li>~clientは、`upgrade-insecure-requests$dir 指令を成功裡に取扱えるので，その選好をアリな限り円滑に供せる。
</li></ul>
◎
The Upgrade-Insecure-Requests HTTP request header field sends a signal to the server expressing the client’s preference for an encrypted and authenticated response, and that it can successfully handle the upgrade-insecure-requests directive in order to make that preference as seamless as possible to provide.
</div>

<p>
この選好は、次の `ABNF$r 文法で表現される：
◎
This preference is represented by the following ANBF:
</p>

<pre class="ABNF">
"Upgrade-Insecure-Requests:" *`WSP$P "1" *`WSP$P
</pre>

<p class="note">注記：
`Upgrade-Insecure-Requests^h ~headerは 選好を表出するが、既存の `Prefer$h ~headerを介してそれを送信するのは，問題になり得る
— ~serverからの応答に利用されるそれは、~cache~keyの一部になることが予期されるので。
<a href="https://github.com/w3c/webappsec/issues/216">w3/webappsec#216</a>
に論じられるように、
<samp>`Vary$h: `Prefer^v</samp>
は，対象が広過ぎる。
◎
Note: Though the Upgrade-Insecure-Requests header expresses a preference, sending it via the existing Prefer header is problematic, as we expect the response from the server to use it as part of the cache key. Vary: Prefer is too broad, as discussed in w3/webappsec#216.
</p>

<p>
~UAの適合性についての詳細は、［
`適切になるなら，要請を先天的に認証-済み~URLに昇格する$
］~algoの段 #1 にて述べる。
その段は、次のような~UA要件を表現する：
◎
User agent conformance details are described in step #1 of the the §4.1 Upgrade request to an a priori authenticated URL, if appropriate algorithm. That step represents the following requirements:
</p>

<ol>
	<li>
以下における %~URL は、~UAが送信する`要請$の`~URL$rq を表すとする。
◎
↓</li>
	<li>
<p>
%~URL が~secureでないならば、`要請$に `Upgrade-Insecure-Requests$h ~headerも伴わせるモノトスル。
◎
User agents MUST send an Upgrade-Insecure-Requests header field along with requests for insecure URLs.
</p>

<p class="note">注記：
~serverは、この通達を利用して，`昇格の仕組み$を要する~pageに対する ~HTTP要請を，~HTTPSに昇格できる。
◎
Note: Servers can use this signal to upgrade HTTP requests to HTTPS for pages that require upgrade-insecure-requests support.
</p>
	</li>
	<li>
<p>
%~URL が`先天的に認証-済み$であって,
%~URL の`~host$urlは`事前読込-可能な~HSTS~host$`ではない^em
ならば、`要請$に `Upgrade-Insecure-Requests$h ~headerを伴わせるモノトスル。
◎
User agents MUST send an Upgrade-Insecure-Requests header field along with requests for a priori authenticated URLs whose url’s host is not a preloadable HSTS host.
</p>

<p class="note">注記：
~serverは、この通達が無いことを利用して，`昇格の仕組み$を要する~pageに対する ~HTTPS要請を，~HTTPに降格できる。
◎
Note: Servers can use the absence of this signal to downgrade HTTPS requests to HTTP for pages that require upgrade-insecure-requests support.
</p>

	</li>
	<li>
<p>
%~URL が`先天的に認証-済み$であって,
%~URL の`~host$urlは`事前読込-可能な~HSTS~host$`である^em
ならば、定期的に，`要請$に `Upgrade-Insecure-Requests$h ~headerを伴わせるべきである。
例えば、表明された `max-age^dir の失効が 2 〜 3 日後に迫っているときや,
少ない割合の要請に限って，
`Upgrade-Insecure-Requests$h ~headerを送信することもできる。
◎
User agents SHOULD periodically send an Upgrade-Insecure-Requests header field along with requests for a priori authenticated URLs whose url’s host is a preloadable HSTS host. For example, user agents could send an Upgrade-Insecure-Requests header field only when the asserted max-age is a few days from expiration, or only for a small percentage of requests.
</p>

<p class="note">注記：
`事前読込-可能な~HSTS~host$は，自身は`~HSTS安全$であると表明-済みなので、降格する通達は必要はない。
そのような~hostは，表明された `max-age^dir が失効する前に~HSTS状態sを~refreshする必要があり、
`Upgrade-Insecure-Requests$h ~headerは，その~HSTSを~refreshさせる通達として申し分なく~~働く。
◎
Note: preloadable HSTS hosts have asserted that they are HSTS-safe, and therefore don’t need a downgrade signal. They will need to refresh HSTS status before the asserted max-age expires, and the Upgrade-Insecure-Requests header field serves as a fine signal that HSTS could be refreshed.
</p>
	</li>
</ol>

<p>
~serverが~HTTP要請の~header内でこの選好に遭遇したときは：
◎
↓</p>

<ul>
	<li>
要請されている資源の `先天的に認証-済み$の表現へ，利用者を~redirectするべきである。
◎
When a server encounters this preference in an HTTP request’s headers, it SHOULD redirect the user to a a priori authenticated representation of the resource being requested.
</li>
	<li>
要請の`~host$urlが［
`~HSTS安全$／ `条件付きで~HSTS安全$
］ならば、応答~内に `Strict-Transport-Security$h ~header `RFC6797$r
を含ませるべきである。
◎
When a server encounters this preference in an HTTPS request’s headers, it SHOULD include a Strict-Transport-Security header in the response if the request’s host is HSTS-safe or conditionally HSTS-safe [RFC6797].
</li>
</ul>

<div class="example">
<p>
`昇格の仕組み$を~supportする~clientは、
`http://example.com/^s
へ、次のように要請する：
◎
A client that supports this document’s upgrade mechanism requests http://example.com/ as follows:
</p>

<pre class="http-code">
GET / HTTP/1.1
Host: example.com
`Upgrade-Insecure-Requests$h: 1
</pre>

<p>
~serverが、選好を構文解析して，利用者の~clientが昇格-要請に上手く対処できることに気付いたので、要請に対し，利用者が要請している資源の~secure~versionへ~redirectするよう 応答する場合：
◎
The server parses the preference, notices that the user’s client can deal well with upgrade requests, and therefore responds to the request by redirecting the user to a secure version of the resource she’s requesting:
</p>

<pre class="http-code">
HTTP/1.1 307 Moved Temporarily
`Location$h: https://example.com/
`Vary$h: `Upgrade-Insecure-Requests$h
</pre>

<p>
`Vary$h ~header内には `Upgrade-Insecure-Requests$h ~headerが~listされている
—
さもなければ、~redirect応答は，［
`昇格の仕組み$を~supportしない~client
］用の~cacheにより~serveされるようになるかもしれないので。
類似な効果は、 `Cache-Control$h ~headerを用いて，この~redirect応答を~cacheできなくすることでも達成できる：
◎
The Upgrade-Insecure-Requests header field is listed in the Vary header, as the redirect response might otherwise be served by caches to clients that don’t support the upgrade mechanism defined here. A similar effect could be achieved by making this redirect response uncachable via the Cache-Control header:
</p>

<pre class="http-code">
HTTP/1.1 307 Moved Temporarily
`Location$h: https://example.com/
`Cache-Control$h: `no-store$dir
</pre>

</div>

			</section>
		</section>
		<section id="nesting">
<h3 title="Policy Inheritance">3.3. 施策の継承</h3>

<p>
［
`Document$I の`現任の設定群~obj$ の`~secureでない要請~施策$ ~EQ `昇格可$i
］の場合、~UAは，次の仕方で，すべての`入子の閲覧文脈$に設定が継承されることを確保するモノトスル：
◎
If a Document's incumbent settings object’s insecure requests policy is set to Upgrade, the user agent MUST ensure that all nested browsing contexts inherit the setting in the following ways:
</p>

<ol>
	<li>
<p>
`入子の閲覧文脈$ %文脈 を作成するときは：
◎
When a nested browsing context context is created:
</p>
		<ol>
			<li>
%文書 ~LET %文脈 を`埋込んでいる文書$
◎
↓</li>
			<li>
<p>
~IF［
%文書 の`~secureでない要請~施策$ ~EQ `昇格可$i
］：
◎
If context’s embedding document’s insecure requests policy is Upgrade, then:
</p>
				<ol>
					<li>
%文脈 の`~secureでない要請~施策$ ~SET `昇格可$i
◎
Set context’s insecure requests policy to Upgrade.
</li>
					<li>
［
%文書 の`~secureでない~navi昇格~集合$
］内の ~EACH ( %値 ) に対し
⇒
%文脈 の`~secureでない~navi昇格~集合$に %値 を追加する
◎
For each value in context’s embedding document’s upgrade insecure navigations set, add value to context’s upgrade insecure navigations set.
</li>
				</ol>
			</li>
		</ol>
	</li>
	<li>
<p>
`閲覧文脈$ %文脈 内に`新たな文書を作成-$をするときは：
◎
When creating a new Document object document in a browsing context context:
</p>
		<ol>
			<li>
<p>
~IF［
%文脈 の`~secureでない要請~施策$ ~EQ `昇格可$i
］：
◎
If context’s insecure requests policy is Upgrade, then:
</p>
				<ol>
					<li>
%設定群 ~LET 作成される文書の`現任の設定群~obj$
◎
Let settings be document’s incumbent settings object.
</li>
					<li>
%設定群 の`~secureでない要請~施策$ ~SET `昇格可$i
◎
Set settings’ insecure requests policy to Upgrade.
</li>
					<li>
%文脈 の`~secureでない~navi昇格~集合$内の ~EACH ( %値 ) に対し
⇒
%設定群 の`~secureでない~navi昇格~集合$に %値 を追加する
◎
For each value in context’s upgrade insecure navigations set, add value to settings’s upgrade insecure navigations set.
</li>
				</ol>
			</li>
		</ol>
	</li>
</ol>

<p>
同様に、~workerの~~始動時には、~UAは，次の仕方で それを作成した文脈から設定が継承されることを確保するモノトスル：
◎
Likewise, when spinning up a worker, the user agent MUST ensure that it inherits the setting from the context that created it in the following ways:
</p>

<ol>
	<li>
<p>
`~worker環境~設定群~objを設定しておく$
~algoの，現在の段 #4 の後に次の手続きを~~挿入する：
◎
When executing the set up a worker environment settings object algorithm, perform the following steps after the current step #4:
</p>
		<ol start="5">
			<li>
<p>
~IF［
`継承した担当の閲覧文脈^V の`~secureでない要請~施策$ ~EQ `昇格可$i
］：
◎
If inherited responsible browsing context’s insecure requests policy is Upgrade, then:
</p>
				<ol>
					<li>
%設定群~obj の`~secureでない要請~施策$ ~SET `昇格可$i
◎
Set settings object’s insecure requests policy to Upgrade.
</li>
					<li>
［
`継承した担当の閲覧文脈^V の`~secureでない~navi昇格~集合$
］内の ~EACH ( %値 ) に対し
⇒
%設定群~obj の`~secureでない~navi昇格~集合$に %値 を追加する
◎
For each value in inherited responsible browsing context’s upgrade insecure navigations set, add value to settings object’s upgrade insecure navigations set.
</li>
				</ol>
			</li>
		</ol>
	</li>
</ol>

		</section>
		<section id="reporting-upgrades">
<h3 title="Reporting Upgrades">3.4. 昇格の報告-法</h3>

<p>
~secureでない要請の昇格-法は、［
`昇格の仕組み$を~supportしない~UAにおいて要請が~secureでないになるかどうかを，作者が突き止めれる能
］には，干渉しないモノトスル。
そのため、昇格は，［
%要請 を`監視-$下にある~security施策すべてに対し評価した`後^em
］, かつ［
%要請 を`施行-$下にある~security施策すべてに対し評価する`前^em
］に遂行するモノトスル。
◎
Upgrading insecure requests MUST not interfere with an authors' ability to track down requests that would be insecure in a user agent that does not support upgrades. To that end, upgrades MUST be performed after evaluating request against all monitored security policies, but before evaluating request against all enforced policies.
</p>

<div class="example">
<p>
`被保護~資源$が，~secureでないな画像
`&lt;img src="http://example.com/image.png"&gt;^s
を包含していて，次の~HTTP~headerを送達するような文脈の中では：
◎
Within the context of a protected resource which contains the insecure image &lt;img src="http://example.com/image.png"&gt;, and delivers the following HTTP headers:
</p>

<pre class="http-code">
`Content-Security-Policy$h: `upgrade-insecure-requests$dir; `default-src$dir https:
`Content-Security-Policy-Report-Only$h: `default-src$dir https:; `report-uri$dir /endpoint
</pre>

<p>
~UAは、`要請$ %要請 を次のように取り~~扱うことになる：
◎
The user agent will fire off a request request that:
</p>

<ol>
	<li>
%要請 が`監視-$下にある施策に違反するならば、それに従って
`/endpoint^s へ`違反~報告$xを送達する。
◎
Violates the policy being monitored, thereby delivering a violation report to /endpoint.
</li>
	<li>
%要請 を
`http://example.com/image.png^s
から
`http<strong>s</strong>://example.com/image.png^s
へ昇格する。
◎
Is upgraded from http://example.com/image.png to https://example.com/image.png.
</li>
	<li>
%要請 は、`施行-$下にある施策には違反しない。
◎
Does not violate the policy being enforced.
</li>
</ol>

</div>

<p class="note">注記：
`CSP$r が`FETCH$r の用語を通して書直されたなら、これは，有意に明確化されることになる。
◎
Note: This will be significantly clarified once [CSP] is rewritten in terms of [FETCH].
</p>

		</section>
	</section>
	<section id="algorithms">
<h2 title="Processing Algorithms">4. 各種 処理~algo</h2>

		<section id="upgrade-request">
<h3 title="Upgrade request to an a priori authenticated URL, if appropriate ">4.1. 適切になるなら %要請 を先天的に認証-済み~URLに昇格する</h3>

<p>
この~algoは、所与の`要請$ %要請 に対し，［
%要請 が出自にしている`~client$rq
］が昇格を~opt-inしていたならば、
%要請 の`~URL$rqを書直す。
それはまた、~secureでない`~navi要請$に対し，［
~serverによる~clientの昇格~特能を検出する能を改善する
］ために， `Upgrade-Insecure-Requests$h ~headerを注入する。
◎
Given a request request, this algorithm will rewrite its url if the client from which the request originates has opted-in to upgrades. It will also inject an Upgrade-Insecure-Requests header field header for insecure navigation requests in order to improve a server’s ability to feature-detect a client’s upgrade capabilities.
</p>

<p>
~form提出は例外として、非同一-生成元`~navi要請$は昇格されない。
~form提出は、平文text提出を介して~dataが漏洩される~riskを軽減するため，昇格されることになる。
◎
We will not upgrade cross-origin navigation requests, with the exception of form submissions. Form submissions will be upgraded to mitigate the risk of data leakage via plaintext submissions.
</p>

<p class="note">注記：
この~algoは、`~main~fetch$~algoの冒頭で~callされる。
◎
Note: This algorithm is called at the top of the Main Fetch algorithm.
</p>

<ol>
	<li>
%~url ~LET %要請 の`~URL$rq
◎
↓</li>
	<li>
<p>
~IF［
%要請 は`~navi要請$である
］~AND［［
%~url は`先天的に認証-済み$でない
］~OR［
%~url の`~host$urlは`事前読込-可能な~HSTS~host$`でない^em
］］
⇒
%要請 の`~header~list$rqに`~headerを付加する$( `Upgrade-Insecure-Requests^h / `1^v )
◎
If request is a navigation request, append a header named Upgrade-Insecure-Requests with a value of 1 to request’s header-list if any of the following criteria are met:
• request’s url is not a priori authenticated
• request’s url’s host is not a preloadable HSTS host
</p>

<p class="note">注記：
~UAは、他の要請に対しても
`Upgrade-Insecure-Requests$h ~headerを付加することを選べる
—
<a href="#preference">§ `Upgrade-Insecure-Requests^h ~HTTP要請~header</a>
にて論じたように。
◎
Note: User agents can choose to append the Upgrade-Insecure-Requests header field for other requests, as discussed in §3.2.1 The Upgrade-Insecure-Requests HTTP Request Header Field.
</p>
	</li>
	<li>
<p>
~IF［
次のすべてが満たされる
］
⇒
~RET：
◎
If request is a navigation request, then:
</p>
		<ul>
			<li>
%要請 は`~navi要請$である
</li>
			<li>
%要請 は~form提出でない
◎
If request is a form submission, skip the remaining substeps, and continue upgrading request.
</li>
			<li>
%要請 の`~target閲覧文脈$rqは`入子の閲覧文脈$でない
◎
If request’s target browsing context is a nested browsing context, skip the remaining substeps and continue upgrading request.
</li>
			<li>
%~url の ( `~host$url, `~port$url ) 組
~NIN %要請 の`~client$rqの`~secureでない~navi昇格~集合$
◎
Let tuple be a tuple of request’s url’s host and port.
◎
If tuple is contained in client’s upgrade insecure navigations set, then skip the remaining substeps, and continue upgrading request.
◎
Return without further modifying request.
</li>
		</ul>

<p class="note">注記：
~top-level`~navi要請$が昇格されるのは、特定0の`被保護~資源$に対し 挙動を明示的に~opt-intoしている~hostに限られる
— <a href="#examples">§ 各種~例</a>
にて述べたように。
第三者主体~資源への~top-level~naviに対し 昇格を遂行することは、~pageを壊す~~確度を有意に高めるので，当面は避けることにしている。
入子の~navi（例えば `iframe$e を介するもの）に対しては、その埋込元の~security状態sに影響するので、必要に応じて，その昇格を確保する。
◎
Note: We only upgrade top-level navigation requests for hosts that have explicitly opted-into the behavior for a particular protected resource, as described in §1.2 Examples. Performing upgrades for top-level navigations to third-party resources brings a significantly higher potential for breakage, so we’re avoiding it for the moment. Nested navigations (via iframe, for example) affect the security status of their embedder, so we ensure that they are upgraded if necessary.
</p>

	</li>
	<li>
~IF［［
%要請 の`~client$rqに対する`~secureでない要請は昇格されるべきか？$
］の結果 ~EQ `昇格不可$i
］
⇒
~RET
◎
Let upgrade state be the result of executing §4.2 Should insecure requests be upgraded for client? upon request’s client.
◎
If upgrade state is Do Not Upgrade, return without modifying request.
</li>
	<li>
~IF［
%~url の`~scheme$url ~EQ `http^c
］
⇒
%~url の`~scheme$url ~SET `https^c；<br />
~RET
◎
If request’s url’s scheme is http, set request’s url’s scheme to https, and return.
</li>
	<li>
<p>
~IF［
%~url の`~port$url ~EQ `80^c
］
⇒
%~url の`~port$url ~SET `443^c
◎
If request’s urls port is 80, set request’s urls port to 443.
</p>

<p class="note">注記：
~portが明示的に `80^c に設定されている場合は，~UAは
~URLの~portのみを変更し、［
~portが設定されていない／何か標準でない値に設定されている
］場合は，その値を改変しないことになる。
この実装には、~HSTSと同じ~tradeoffがある【？】（
`RFC6797$r を見よ
— 特定的には，
<a href="~IETF/rfc6797#section-8.3">Section 8.3</a>
の段 #5,
<a href="~IETF/rfc6797#appendix-A">Appendix A</a>
の~item #6
）。
◎
Note: This will only change the URL’s port if the port is explicitly set to 80. If the port is not set, or if it is set to some non-standard value, the user agent will not modify that value. This implementation makes the same tradeoffs as HSTS (see [RFC6797], and specifically step #5 of Section 8.3, and item #6 in Appendix A).
</p>
	</li>
</ol>

<p class="note">注記：
`FETCH$r の再帰的な資質に因り、この~algoは，初期~要請のみならず ~redirectに対しても，~secureでないな要請を昇格することになる。
◎
Note: Due to [FETCH]'s recursive nature, this algorithm will upgrade insecurely-redirected requests as well as insecure initial requests.
</p>

		</section>
		<section id="should-upgrade-for-client">
<h3 title="Should insecure requests be upgraded for client? ">4.2. %~client に対する~secureでない要請は昇格されるべきか？</h3>

<p>
この~algoは、所与の［
`要請$の`~client$rq
］ %~client （`環境~設定群~obj$）に結付けられている~secureでない要請が昇格されるべきならば `昇格可$i <!-- Enforced Upgrade＊？ -->／
~ELSE_ `昇格不可$i
］を返す。
~~要約すると、これは %~client を検査して，［
%~client, または %~client の`閲覧文脈$
］に設定されている適切な`~secureでない要請~施策$を返す：
◎
Given an request’s client client (an environment settings object), this algorithm returns Enforced Upgrade if insecure requests associated with that client should be upgraded, or Do Not Upgrade otherwise. In short, this will check the client and return the appropriate insecure requests policy set on it or its browsing context.
</p>

<ol>
	<li>
<p>
~IF［
%~client には`担当の文書$がある
］
⇒
~RET それ†の`~secureでない要請~施策$の値
◎
If client has a responsible document, return the value of its insecure requests policy.
</p>

<div class="note">
<p>注記：
これは，次のいずれかに該当する［
`Document$I ／ `Worker$I
］を~catchする：
</p>

<ul ><li>`upgrade-insecure-requests$dir 指令により施策が直に設定されているもの
</li><li>`埋込んでいる文書$から施策を継承しているもの
</li></ul>

◎
Note: This catches Documents or Workers whose policy is set directly by the upgrade-insecure-requests directive, or which have inherited the policy from an embedding document.
</div>

<p class="trans-note">【†
この “それ” と下の段の “それ” は、おそらく（ %~client ではなく）
“担当の〜” の方を指す。
】</p>

	</li>
	<li>
<p>
~IF［
%~client には`担当の閲覧文脈$がある
］
⇒
~RET それ†の`~secureでない要請~施策$の値
◎
If client has a responsible browsing context, return the value of its insecure requests policy.
</p>

<p class="note">注記：
これは、~detachされた`~client$rq から誘発された要請を~catchする。
<a href="#nesting">§ 施策の継承</a>
に定義される継承~構造が与えられた下で、これが本当に必要とされるかどうかは確かでない。
【？】
◎
Note: This catches requests triggered from detached clients. Not sure this is necessary, really, given the inheritance structure defined in §3.3 Policy Inheritance.
</p>
	</li>
	<li>
~RET `昇格不可$i
◎
Return Do Not Upgrade.
</li>
</ol>

		</section>
	</section>
	<section id="websockets-integration">
<h2 title="Modifications to WebSockets">5. ~WebSocketに対する改変</h2>

<p>
~WebSocketは`~fetching$~algoを利用しないので、それによる要請は，別々に取扱う必要がある。
◎
WebSockets do not use the fetching algorithm, so we need to handle those requests separately.
</p>

<p>
`~WebSocket接続を確立-$する~algo `RFC6455$r
は、次に従って改変される：
◎
The establish a WebSocket connection algorithm [RFC6455] is modified as follows:
</p>

<ul>
	<li>
<p>
現在の段 1 の後（かつ， `MIX$r にて導入された新たな段 #2 の前）に，次の段を遂行する：
◎
After the current step 1 (and before the new step #2 introduced in [MIX]), perform the following step:
</p>
		<ol>
			<li>
<p>
~IF［
%secure ~EQ ~F
］~AND［［［
%~client の%~entry~script に`関連な設定群~obj$
］に対する`~secureでない要請は昇格されるべきか？$
］の結果 ~EQ `昇格可$i
］：
◎
If secure is false:
◎
• Let upgrade state be the result of executing §4.2 Should insecure requests be upgraded for client? upon the relevant settings object for client’s entry script.
◎
• If upgrade state is Do Not Upgrade, skip the remaining substeps.
</p>
				<ol>
					<li>
%secure ~SET ~T
◎
Set secure to true.
</li>
					<li>
<p>
~IF［
%~port ~EQ `80^c
］
⇒
%~port ~SET `443^c
◎
If port is 80, set port to 443.
</p>

<p class="note">注記：
~portが明示的に `80^c に設定されている場合は，~UAは
~URLの~portのみを変更し、［
~portが設定されていない／何か非~標準な値に設定されている
］場合は，その値を改変しないことになる。
この実装には、~HSTSと同じ~tradeoffがある【？】（
`RFC6797$r を見よ
— 特定的には，
<a href="~IETF/rfc6797#section-8.3">Section 8.3</a>
の段 #5,
<a href="~IETF/rfc6797#appendix-A">Appendix A</a>
の~item #6
）。
◎
Note: This will only change the URL’s port if the port is explicitly set to 80. If the port is not set, or if it is set to some non-standard value, the user agent will not modify that value. This implementation makes the same tradeoffs as HSTS (see [RFC6797], and specifically step #5 of Section 8.3, and item #6 in Appendix A).
</p>
					</li>
				</ol>
			</li>
		</ol>
	</li>
</ul>

	</section>
	<section id="security">
<h2 title="Security Considerations">6. ~security上の考慮点</h2>

		<section id="hsts">
<h3 title="Interaction with HSTS">6.1. ~HSTSとの相互作用</h3>

<p>
`upgrade-insecure-requests$dir 指令は、
`Strict-Transport-Security$h ~HTTP応答~header `RFC6797$r
を置換するものではない。
自身の~siteを~secure~transport越しに~serveしている作者は、利用者が悪意的な［
能動的／受動的
］~network攻撃者による［
~SSL-stripping攻撃や, 監視
］の~subjectにされないことを確保するため、適切な `max-age^dir を伴う~headerを送信するべきである。
◎
The upgrade-insecure-requests directive does not replace the Strict-Transport-Security HTTP response header [RFC6797]. Authors who serve their site over secure transport SHOULD send that header with an appropriate max-age in order to ensure that users are not subject to SSL stripping attacks by maliciously active network attackers, or monitoring by maliciously passive network attackers.
</p>

		</section>
		<section id="violation-report-target">
<h3 title="CSP Violation Reports">6.2. ~CSP違反~報告</h3>

<p>
~UAは、昇格された資源に対し違反~報告を送信するときは、当の要請を誘発した［
`Document$I ／ `Worker$I
］を~targetにするモノトスル
— `upgrade-insecure-requests$dir 指令が設定された［
`Document$I ／ `Worker$I
］ではなく。
<a href="#nesting">§ 施策の継承</a>
に因り，後者は 前者の非同一-生成元 先祖かもしれず、その場合，違反~報告を［
報告-先 端点の集合
］へ送信すると，期待されない仕方で~dataが漏洩され得るので。
◎
When sending a violation report for an upgraded resource, user agents MUST target the Document or Worker that triggered the request, rather than the Document or Worker on which the upgrade-insecure-requests directive was set. Due to §3.3 Policy Inheritance, the latter might be a cross-origin ancestor of the former, and sending violation reports to that set of reporting endpoints could leak data in unexpected ways.
</p>

<p>
同じ理由から、 `SecurityPolicyViolationEvent$I は、当の要請を誘発した `Document$I 以外は~targetにしないモノトスル。
◎
Likewise, the SecurityPolicyViolationEvent MUST NOT target any Document other than the one which triggered the request, for the same reasons.
</p>

		</section>
	</section>
	<section id="performance">
<h2 title="Performance Considerations">7. 処理能~上の考慮点</h2>

<p>
`昇格の仕組み$は、`事前読込-可能な~HSTS~host$でない~hostへ向けた外方へのどの`~navi要請$にも
`Upgrade-Insecure-Requests: 1\r\n^s
を追加する（
public-webappsec@w3.org, および
<a href="https://github.com/w3c/webappsec/issues/216">w3c/webappsec#216</a>
にて長く論じられているように）。
この~headerの利点と意図は、
<a href="#preference">§ `Upgrade-Insecure-Requests^h ~HTTP要請~header</a>
にて~~述べる
— ~platformの恒久的な設備にはならないよう，しかるべき手続き（`事前読込-可能な~HSTS~host$を築き上げること）はとられているが、この~headerが消え失せる日が来るまでには，長い長い年月を~~要するであろう。
◎
The upgrade mechanism specified here adds Upgrade-Insecure-Requests: 1\r\n to every outgoing navigation request to non-preloadable HSTS hosts (as discussed at length on public-webappsec@, and w3c/webappsec#216). The advantages and intent of the header are laid out in §3.2.1 The Upgrade-Insecure-Requests HTTP Request Header Field, and though we’ve taken some steps to ensure that it won’t be a permanent fixture of the platform (by carving out preloadable HSTS hosts), it’s going to be a long, long time before the header vanishes.
</p>

<p>
~UAには、追加的な築き上げを見出して，それを実装することが奨励される。
◎
User agents are encouraged to find additional carveouts, and implement them.
</p>

	</section>
	<section id="authoring">
<h2 title="Authoring Considerations">8. 著作~上の考慮点</h2>

		<section id="legacy-clients">
<h3 title="Legacy Clients">8.1. 旧来の~client</h3>

<p>
混在~内容の阻止-法 `MIX$r は~supportするが`昇格の仕組み$は~supportしない，旧来の~clientは、~secureでない~URLを包含している~page上で，最適と言えない体験を~~供し続けることになる。
作者は、それらに`違反~報告を送信-$させ，収集された情報を利用して、利用者にとって最も問題になり得る資源はどれかを見定め，最もよく要請されると見込まれる旧来の内容~内の~URLを優先して修正するべきである。
◎
Legacy clients which do support mixed content blocking [MIX], but do not support the upgrade-insecure-requests directive will continue to have a suboptimal experience on pages containing insecure URLs. Authors SHOULD ensure that they collect violation reports in order to determine which resources are most problematic for their users, and SHOULD use that information to prioritize fixes for URLs in legacy content that users will most likely request.
</p>

		</section>
		<section id="relation-to-hsts">
<h3 title="Relation to HSTS">8.2. ~HSTSとの関係</h3>

<p>
`昇格の仕組み$が対処するのは、特定の`被保護~資源$用の~security施策に限られる。
それは、 `Strict-Transport-Security^h ~HTTP応答~header `RFC6797$r を［
非推奨にする ／ 置換する ／ 何らかの仕方で抑制する
］ものではない。
作者は、［
利用者が，~SSL-stripping降格-攻撃の~subjectにされないことを確保する
］ため，その~headerを利用し続けれるし、また，し続けるべきである
— `upgrade-insecure-requests$dir 指令は、［
利用者が，第三者主体~siteの~linkを介して作者~siteを訪問すること
］による~top-level~naviに対しては，~HTTPSへの昇格を確保しないので。
◎
The mechanism specified here deals only with the security policy for a specific protected resource. It does not deprecate, replace, or in any way reduce the value of the Strict-Transport-Security HTTP response header [RFC6797]. Authors can and should continue to use that header to ensure that their users are not subject to SSL stripping downgrade attacks, as the upgrade-insecure-requests directive will not ensure that users visiting your site via links on third-party sites will be upgraded to HTTPS for the top-level navigation.
</p>

<p>
同様に、 `Strict-Transport-Security^h ~headerが，暗黙に `upgrade-insecure-requests$dir を作動化するよう挙動することはない。
それは、［
ある生成元から要請される資源が~networkを非~secureに叩くことは，決してない
］ことのみを確保する。
◎
Likewise, the Strict-Transport-Security header does not imply the behavior that upgrade-insecure-requests activates. It only ensures that resources requested from an origin will never hit the network insecurely.
</p>

<p>
これらの概念は、意図的に別個に保たれている
— 作者は、どちらの挙動を作動化させることも選べるが、双方を一緒に束ねるよう強いられるべきでない。
◎
We are intentionally keeping these concepts distinct, as authors may choose to activate one or the other behavior, but ought not be forced to bind them together.
</p>

		</section>
	</section>
	<section id="iana-considerations">
<h2 title="IANA Considerations">9. IANA 考慮点</h2>

		<section id="iana-https">
<h3 title="Upgrade-Insecure-Requests Header ">9.1. `Upgrade-Insecure-Requests^h ~header</h3>

<p>
恒久的~message~header~registry `RFC3864$r は、次の登録で更新されるべきである：
◎
The permanent message header field registry should be updated with the following registration: [RFC3864]
</p>

<div >

<dl ><dt>~header~field名
</dt><dd>`Upgrade-Insecure-Requests^h

</dd><dt>適用-可能な~protocol
</dt><dd>http

</dd><dt>位置付け
</dt><dd>標準

</dd><dt>~~作成／変更管理者
</dt><dd>W3C

</dd><dt>仕様~文書
</dt><dd>この仕様（
<a href="#preference">§ `Upgrade-Insecure-Requests^h ~HTTP要請~header</a>
を見よ）
</dd></dl>

◎
Header field name
• Upgrade-Insecure-Requests
Applicable protocol
• http
Status
• standard
Author/Change controller
• W3C
Specification document
• This specification (See §3.2.1 The Upgrade-Insecure-Requests HTTP Request Header Field)
</div>

		</section>
		<section id="iana-directive">
<h3 title="Upgrade-Insecure-Requests Directive ">9.2. `upgrade-insecure-requests^dir 指令</h3>

<p>
~CSP指令~registry `RFC7762$r
は、次の登録で更新されるべきである：
◎
The Content Security Policy Directive registry should be updated with the following registration: [RFC7762]
</p>

<div >
<dl ><dt>指令~名
</dt><dd>`upgrade-insecure-requests$dir

</dd><dt>参照先
</dt><dd>この文書（
<a href="#delivery">§ `upgrade-insecure-requests^dir ~CSP指令</a>
）

</dd></dl>

◎
Directive name
• Upgrade-Insecure-Requests
Reference
• This specification (See §3.1 The upgrade-insecure-requests Content Security Policy directive)
</div>

		</section>
	</section>
	<section id="acknowledgements">
<h2 title="Acknowledgements">10. 謝辞</h2>

<p>
この文書の初期~草案を健全に仕立てた
Anne van Kesteren 氏に。
問題領域を明確化して，影響iを指摘された
Peter Eckersley 氏, Daniel Kahn Gillmor 氏に。
◎
Anne van Kesteren helped ensure that the initial draft of this document was sane. Peter Eckersley and Daniel Kahn Gillmor clarified the problem space, and helped point out the impact.
</p>
	</section>

</main></div>
