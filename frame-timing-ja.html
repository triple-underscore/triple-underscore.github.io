<!DOCTYPE html><html lang="ja"><head><meta charset="utf-8">
<title>Frame Timing （日本語訳）</title>

<link rel="stylesheet" href="common.css" type="text/css" />
<link rel="stylesheet" href="common-w3c.css" type="text/css" />
<style>

#_frames1 {
	white-space: nowrap;
}
#_frames1 > span {
	border: solid black 2px;
	padding: 3px;
	border-radius: 5px;
	background: yellow;
	vertical-align: middle;
}

#_frames1 > div {
	display: inline-block;
	border-left: dashed currentcolor 2px;
	color: red;
	height: 4em;
	width: 0;
	vertical-align: middle;
	position: relative;
}
#_frames1 > div > div {
	position:absolute;
	text-align:center;
}

</style>

<script src="common0.js" ></script>
<script src="common1.js" async></script>


<script>

Util.ready = function(){
	const source_data = {
		generate: expand
	};
	Util.switchWordsInit(source_data);
}

function expand(){

	const class_map = this.class_map;
	const tag_map = this.tag_map;
	const link_map = this.link_map;

	return this.html.replace(
		/`(.+?)([$@\^])(\w*)/g,
		create_html
	);

	function create_html(match, key, indicator, klass){

let text = key;
let href = '';

switch(klass){
case 'r':
	text = `[${key}]`;
	href = `#bib-${key}`;
	break;
case 'l':
	text = `"<code class="literal">${text}</code>"`;
	break;
case 'I':
	href = `#${key}`;//.toLowerCase();
	break;
}

let tag = tag_map[klass];
if(tag) {
	let classname = class_map[klass];
	classname = classname ? ` class="${classname}"` : '';
	text = `<${tag}${classname}>${text}</${tag}>`;
}

if(indicator !== '^'){
	href = link_map[ klass ? `${klass}.${key}` : key ] || href;
	if(!href){
		console.log(match); // check error
		return match;
	}

	switch(indicator){
	case '$':
		text = `<a href="${href}">${text}</a>`;
		break;
	case '@':
		text = `<dfn id="${href.slice(1)}">${text}</dfn>`;
		break;
	}
}

return text;


	}
}
</script>
<script type="text/plain" id="_source_data">


●●options

spec_date:2021-04-23
trans_update:2021-09-22
source_checked:150925
page_state_key:TIMING
spec_status:EDCG
original_url:https://wicg.github.io/frame-timing/
ref_id_prefix:bib-
	conformance:w3c
trans_1st_pub:2015-01-25


●●class_map

●●tag_map
I:code
m:code
c:code
e:code
v:var

●●original_id_map


PerformanceFrameTiming:dom-performanceframetiming
	PerformanceFrameTiming:idl-def-performanceframetiming
	PerformanceFrameTiming:idl-def-PerformanceFrameTiming
	PerformanceFrameTiming:dom-PerformanceFrameTiming
	PerformanceFrameTiming:dfn-performanceframetiming
dom-PerformanceFrameTiming-duration:widl-PerformanceFrameTiming-duration
dom-PerformanceFrameTiming-startTime:widl-PerformanceFrameTiming-startTime
dom-PerformanceFrameTiming-nam:widl-PerformanceFrameTiming-name
dom-PerformanceFrameTiming-entryType:widl-PerformanceFrameTiming-entryType


●●link_map

Exposed:~WEBIDLjs#Exposed

I.PerformanceEntry:~TIMELINE#dom-performanceentry
I.PerformanceFrameTiming:#dom-performanceframetiming
I.DOMHighResTimeStamp:~HRTIME#dom-domhighrestimestamp
I.Document:~HTMLdom#document

m.duration:#dom-PerformanceFrameTiming-duration
m.startTime:#dom-PerformanceFrameTiming-startTime
m.name:#dom-PerformanceFrameTiming-name
m.entryType:#dom-PerformanceFrameTiming-entryType

m.Performance.now():~HRTIME#dom-performance-now

m.requestIdleCallback():~REQUESTIDLECALLBACK#dom-window-requestidlecallback
m.requestAnimationFrame():~HTMLGAPI#dom-animationframeprovider-requestanimationframe
~frame:#dfn-frame
~frame時間枠:#dfn-time-budget-for-the-frame
	Performance Timeline:http://www.w3.org/TR/performance-timeline/
~event~loop:~WAPI#event-loops
~event~loop処理~model:~WAPI#event-loop-processing-model
	continuous event loop
	step 1 of the browser processing model
	step 8.10 of the browser processing model
処理能~entryを~queueする:~TIMELINE#dfn-queue-a-performanceentry


●●words_table1


REQUESTIDLECALLBACK:requestidlecallback-ja.html
	https://w3c.github.io/requestidlecallback/


●●words_table


step:
touch::::タッチ
仕事:work:~
偽陽性:false-positive:~
元凶:culprit:~
割当て:allotted:~

見合う:matchする:~
塗り:paint:~
試行錯誤-:exercise:~
稼働時:runtime::~
稼働時の:runtime::~
差挟む:interleaveする:差し挟む
応答性:responsiveness:~
手助け:help:~
捕捉-:capture:~
	improve
時間枠:time budget:~
時間差:difference:~
更新率:refresh rate:~::リフレッシュレート
小task:microtask:小 task:小タスク
機敏:responsive:~::レスポンシブ
滑らか:smooth:~
特定-:identify:~
超過-:exceed:~
連続する:successive:~
遊休:idle::~
適応させ:adaptす:~
閾値:threshold:しきい値
電力消費:power consumption:~
頻度:frequency:~
高価:expensive:~
予定済の:scheduled::予定済みの
不揃い:inconsistent:~
提供-:deliver:~
織込む:accountする:織り込む
遅い:slow:~
遅いこ:slowなこ:~

原因:cause:~

集約-:aggregate:~
解析:analytics:~
申込む:subscribe:申し込む


vsync::video 同期:ビデオ同期

	~~目的の:target
	ある:certain
	必要とされる:necessary
	最も近い:closest

	欠かせない:critical
	order
	責を負うresponsible
	~~処理running
	hurt:悪化する
	長くかかるlong-running
	stay
	instance
	map
	hook
	step
	entry
	基づく／subject
	long
	おそらくprobably


●●ref_normative

[HR-Time-2]
    High Resolution Time Level 2. Ilya Grigorik. W3C. 21 November 2019. W3C Recommendation. URL: https://www.w3.org/TR/hr-time-2/
[HTML]
    HTML Standard. Anne van Kesteren; Domenic Denicola; Ian Hickson; Philip Jägenstedt; Simon Pieters. WHATWG. Living Standard. URL: https://html.spec.whatwg.org/multipage/
[HTML5]
    HTML5. Ian Hickson; Robin Berjon; Steve Faulkner; Travis Leithead; Erika Doyle Navara; Theresa O'Connor; Silvia Pfeiffer. W3C. 27 March 2018. W3C Recommendation. URL: https://www.w3.org/TR/html5/
[Performance-Timeline-2]
    Performance Timeline Level 2. Nicolas Pena Moreno; Ilya Grigorik. W3C. 19 August 2021. W3C Working Draft. URL: https://www.w3.org/TR/performance-timeline-2/
[RFC2119]
    Key words for use in RFCs to Indicate Requirement Levels. S. Bradner. IETF. March 1997. Best Current Practice. URL: https://tools.ietf.org/html/rfc2119
[RFC8174]
    Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words. B. Leiba. IETF. May 2017. Best Current Practice. URL: https://tools.ietf.org/html/rfc8174
[webidl]
    Web IDL. Boris Zbarsky. W3C. 15 December 2016. W3C Editor's Draft. URL: https://heycam.github.io/webidl/


●●trans_metadata
<p>
~THIS_PAGEは、
<a href="http://www.w3.org/">WICG</a> により，副題に日付にて編集者草案として公開された
<a href="~SPEC_URL">Frame Timing</a>
を日本語に翻訳したものです。
~PUB
</p>


●●spec_metadata

最新の編集者草案
	http://wicg.github.io/frame-timing/

編集
	<a href="mpb@google.com">Michael Blain</a> (Google)
	<a href="igrigorik@gmail.com">Ilya Grigorik</a> (Google)

リポジトリ
	<a href="https://github.com/wicg/frame-timing/">We are on Github.</a>
	<a href="https://github.com/wicg/frame-timing/issues">File a bug.</a>
	<a href="https://github.com/wicg/frame-timing/commits/gh-pages/index.html">Commit history.</a>

</script>



</head>

<body>

<header>
	<hgroup>
<h1>フレームの計時 — Frame Timing</h1>
	</hgroup>

</header>


<div id="MAIN" hidden>

	<section id="abstract" class="introductory">
~ABSTRACT

<p>
~web~appは、滑らかで機敏な利用者~体験を提供するため，［
描画（ rendering ）, 入力の処理, その他の欠かせない仕事
］を遅延させる課題を特定して修正する必要がある。
この仕様は、［
~appが，~browserによる~event~loopの［
稼働時の処理能
］情報に~accessする
］ための~interfaceを定義し、それを可能にする。
◎
This specification defines an interface for web applications to access runtime performance information of the browser event loop, enabling them to identify and fix issues that cause delayed rendering, processing of input, and other critical work necessary to deliver a smooth and responsive user experience.
</p>

	</section>
	<section id="sotd">

~STATUSofTHIS

<p>
この仕様は〜により公表されました。
これは W3C Standards ではなく W3C Standards Track の対象でもありません。
<a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a>
の下， opt-out には制限があり、他の条件も適用され得ることに注意してください。
~~詳細は
<a href="http://www.w3.org/community/">W3C Community and Business Groups</a>
に。
◎
This specification was published by the . It is not a W3C Standard nor is it on the W3C Standards Track. Please note that under the W3C Community Contributor License Agreement (CLA) there is a limited opt-out and other conditions apply. Learn more about W3C Community and Business Groups.
</p>

<p>
これは<strong>進行中の作業</strong>であり、予告なしに変更され得ます。
◎
This is a work in progress and may change without any notices.
</p>
	</section>

<main id="MAIN0">

	<section class="informative" id="introduction">

<h2 title="Introduction">1. 序論</h2>

~INFORMATIVE

<p>
対話的な利用者~体験を提供するため、`~event~loop処理~model$では，ある更新~頻度（例： 更新率 60Hz ）で，絶え間なく`~event~loop$を走らす。
この~event~loopの各~実行は、次に挙げるもの その他の，必要とされる仕事に対し責を負う：
予定済の~task（例： 入力, ~touch, ~scroll, 等々） ／
結付けられている小task ／
予定済の~callback（例： `requestAnimationFrame()$m, `requestIdleCallback()$m
） ／
必要とされる描画の更新~~処理。
◎
In order to deliver an interactive user experience the browser processing model runs a continuous event loop at a certain update frequency - e.g. 60Hz refresh rate. Each execution of the event loop is responsible for processing scheduled tasks (e.g. input, touch, scroll, etc.), associated microtasks, scheduled callbacks (e.g. requestAnimationFrame, requestIdleCallback), running the necessary rendering updates, and other necessary work.
</p>

<!-- frame-timing/frame.png -->
<figure>
<div style="padding-bottom: 3.5em;">
	<div style="border-bottom: solid black 1px;" title="時間軸">
時間 →
<span style="float:right;">→</span>
	</div>

	<div id="_frames1">
…
<span style="border-color:#3A7726; background:#B7D8AA;">遊休~callback</span>
		<div>
<div style="top:-1.3em;left:-4em;width:8em; font-size:small;">~vsync</div>
<div style="bottom:-1em; left:-1px; width:20em; height:10px; border:solid black 1px; border-style:none none solid solid"></div>
		</div>

<span style="border-color:#4385C5; background:#D0E2F2;">~taskを走らす</span>
<span style="border-color:#F0C441; background:#FEF3CE;">描画の更新</span>
<span style="border-color:#3A7726; background:#B7D8AA;">遊休~callback</span>
		<div>
<div style="top:-1.3em;left:-4em;width:8em; font-size:small;">~vsync</div>
<div style="bottom:-1em; right:1px; width:20em; border:solid black 1px; height:10px; border-style:none solid solid none"></div>
<div style="color:black;border:solid black 1px; bottom:-2em; right:8em; background: white; padding:0.2em;">~frame</div>
		</div>
…
	</div>
</div>
<figcaption>
毎~frameごとに その時間枠~内で行われる仕事
◎
Fig. 1 Illustration of a frame within an event loop
</figcaption></figure>

<p>
~event~loopの各~実行
— すなわち， `~frame@ —
の中で行われる仕事すべてが，割当て時間枠（例： 更新率 60Hz なら 16.6ms ）内に完了するならば、~browserは，滑らか かつ機敏な体験を保証できる。
しかしながら、~frameの中の仕事が，何らかの事由で この時間枠を超過する場合、いくつかの~frameは飛ばされ，その結果［
応答, 処理, 描画
］の各~時間が不揃いになり、利用者~体験は悪化する。
◎
If all of the work within each execution of the event loop (i.e. within a "frame") is completed in allotted time budget (e.g. 16.6ms for 60Hz refresh rate), the browser can guarantee a smooth and responsive experience. However, if the work within the frame exceeds this time budget, for whatever reason, then one or more frames is skipped, resulting in inconsistent response, processing, and rendering times, which hurts the user experience.
</p>

<div class="example">

<pre class="lang-html">
&lt;!doctype html&gt;
&lt;html&gt;&lt;head&gt;
&lt;script&gt;
  /* <span class="comment">
遅い~frameに対する~frame計時の通知を申込む
</span> */
  var observer = new PerformanceObserver(function(list) {
    var perfEntries = list.getEntries();
    for (var i = 0; i &lt; perfEntries.length; i++) {
      /* <span class="comment">
遅い~frameの通知を処理する：<br>
• 処理と描画の~logicを適応させる。<br>
• 解析と監視のために，集約して報告する。<br>
• …
</span> */
      console.log("げっ、~frame遅い…：", perfEntries[i]);
    }
   });
  observer.observe({entryTypes: ['frame']});
&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;
...
&lt;/body&gt;&lt;/html&gt;
</pre>

<!-- 
  // subscribe to Frame Timing notifications for slow frames
  var observer = new PerformanceObserver(function(list) {
    var perfEntries = list.getEntries();
    for (var i = 0; i &lt; perfEntries.length; i++) {
      // Process slow-frame notifications:
      // - adapt processing and rendering logic
      // - aggregate and report back for analytics and monitoring
      // - ...
      console.log("Uh oh, slow frame: ", perfEntries[i]);
    }
   });
  observer.observe({entryTypes: ['frame']});

-->
</div>

<p>
この仕様
— Frame Timing API —
は、~web開発者が，［
この割当て時間枠を超過するような，長くかかる~frameに因り、~browserが欲される更新率を提供できなくなったとき
］を観測して，利用者が体験する~appの処理能を監視できるようにする。
開発者は、そうなる事例や その原因を特定することにより，［
割当て時間枠~内に収まる, あるいは
~browserが提供する利用者~体験の改善を手助けする
］ように，~appの~logicを適応させる／修正することが可能になる。
◎
The Frame Timing API enables web developers to monitor the performance of their applications, as experienced by their users, by observing when the browser is unable to deliver the desired refresh rate due to long-running frames that exceed the allotted time budget. By identifying such cases, and their cause, web developers can adapt or fix their logic to stay within the allotted budget and help the browser deliver an improved user experience.
</p>

	</section>
	<section id="conformance">
<h2 title="Conformance">2. 適合性</h2>

<p class="trans-note">【
この節の内容は
<a href="~W3Ccommon#conformance">~W3C日本語訳 共通~page</a>
に移譲。
】</p>

	</section>
	<section id="frame-timing">

<h2 title="Frame Timing">3. ~frameの計時</h2>


		<section id="performanceframetiming-interface">

<h3>3.1. `PerformanceFrameTiming^I ~interface</h3>


<pre class="idl">
[`Exposed$=Window]
interface `PerformanceFrameTiming@I : `PerformanceEntry$I {
};
</pre>

			<section id="attributes">

<h4 title="Attributes">3.1.1 属性</h4>

<!-- 
id="widl-PerformanceFrameTiming-XXXXX
 -->

<dl class="attributes">
	<dt>`name@m</dt>
	<dd>
この属性は、現在の
<a href="~DOM4#concept-document-url">文書 URL</a>
を返すモノトスル。
◎
This attribute MUST return the current document's address.
</dd>
	<dt>`entryType@m</dt>
	<dd>
この属性は `DOMString^I `frame^l を返すモノトスル。
◎
This attribute MUST return the DOMString "frame".
</dd>
	<dt>`startTime@m</dt>
	<dd>
この属性は、~frameの始端~時刻を指示する
`DOMHighResTimeStamp$I `HR-Time-2$r
を返すモノトスル。
◎
This attribute MUST return a DOMHighResTimeStamp [HR-Time-2] indicating the frame start time.
</dd>
	<dt>`duration@m</dt>
	<dd>
この属性は、連続する各~frame間の `startTime^m の時間差を指示する `DOMHighResTimeStamp$I を返すモノトスル。
◎
This attribute MUST return a DOMHighResTimeStamp indicating the difference between the startTime's of two successive frames.
</dd>

</dl>

			</section>
		</section>
		<section id="processing">

<h3 title="Processing">3.2 処理</h3>

<p>
`PerformanceFrameTiming$I ~interfaceは、 `Performance-Timeline-2$r に関与し，`~event~loop処理~model$を拡張する。
◎
The PerformanceFrameTiming interface participates in the [Performance-Timeline-2] and extends the browser processing model.
</p>

<p class="issue">
HTML 仕様~内に適正な~hookを定義する必要がある…
◎
TODO: define proper hook in the HTML spec...
</p>

<p>
`~event~loop処理~model$の最初の段を走らすに先立って，次の手続きを走らす：
◎
Run the following steps prior to running step 1 of the browser processing model:
</p>

<ol>
	<li>
`~frame始端~時刻^v ~LET
`Performance.now()$m ~methodが返すものと同じ結果
◎
Let frame startTime be the value that would be returned by the Performance object's now() method.
</li>
</ol>

<p>
`~event~loop処理~model$の［
~animation~frame~callbackを走らす段
］の後に次の手続きを走らす：
◎
Run the following steps after running step 8.10 of the browser processing model:
</p>


<ol>
	<li>
`~frame終端~時刻^v ~LET
`Performance.now()$m ~methodが返すものと同じ結果
◎
Let frame endTime be the value that would be returned by the Performance object's now() method.
</li>
	<li>
`~frame所要時間^v ~LET 時間差
( `~frame終端~時刻^v − `~frame始端~時刻^v )
◎
Let frame duration be the difference between the values of frame endTime and frame startTime.
</li>
	<li>
<p>
`~frame所要時間^v が，~UAにより決定された`~frame時間枠$を超えるならば：
◎
If frame duration value exceeds the user agent determined time budget for the frame, then:
</p>
		<ol>
			<li>
`entry^v ~LET 新たな `PerformanceFrameTiming$I ~obj
◎
Let entry be a new PerformanceFrameTiming object.
</li>
			<li>
`entry^v の `startTime$m  ~SET `~frame始端~時刻^v
◎
Set entry startTime to frame startTime.
</li>
			<li>
`entry^v の `duration$m ~SET `~frame所要時間^v
◎
Set entry duration to frame duration.
</li>
			<li>
`docs^v 内の各
<a href="~BROWSERS#fully-active">全部的に作動中の</a>
`Document$I
に対し
⇒
`処理能~entryを~queueする$( `entry^v )
◎
For each fully active Document in docs, queue entry.
</li>
    </ol>
  </li>
</ol>

<p>
この仕様は、
`~frame時間枠@
に対し，［
`PerformanceFrameTiming$I ~entryを提供させるような，いかなる値
］も<strong>義務付けない</strong>。
この値は、~UAの環境設定, および 稼働時における各種~要因に基づくことになる。
例えば~UAは、~~目的の更新~頻度（ 60Hz, 30Hz, 等々）に異なる~~値を設定して，［
機器~処理能, 電力消費, 応答性, その他の要件
］に基いて，稼働時に調整してもヨイ。
◎
This specification does not mandate any particular value for time budget for the frame that results in delivery of a PerformanceFrameTiming entry. This value is subject to user agent configuration and runtime factors. For example, the user agent may set different target update frequencies (60Hz, 30Hz, etc) and adjust this target at runtime based on device performance, power consumption, responsiveness, and other requirements.
</p>

<p>
~UAは、開発者に偽陽性が報告されないようにするため、自身による所要時間の閾値を，期待されている［
~frame所要時間／更新~頻度
］に見合うように調整するベキである。
<!-- 
すなわち、~app側からの明示的な指示があるにも関わらず，閾値を超えたものとされること。
-->
例えば~UAが遊休~中にある場合、遊休~~時間の長い~callback（例： `requestIdleCallback()$m を介して 50ms 間 遊休する~callback）を差挟むであろう
— それに伴い、遅い~frameに対する所要時間の閾値を，そのような~frameも織込むように調整するべきである。
◎
The user agent SHOULD adjust its duration thresholds to match the expected frame duration and update frequency to avoid reporting false-positives to the developer. For example, if the user agent is idle, it may interleave long idle callbacks (e.g. 50ms idle callback via requestIdleCallback) and the duration threshold for slow frames should be adjusted accordingly to account for such frames.
</p>

<p class="issue">
<em>何故</em> ~frameが遅いかを説明する~~機能（おそらく，~version 2 で）：
現在の定義は，~frameが遅いことは報告するが、元凶が何であったか（例： 遅い入力~handler？ `requestAnimationFrame()$m？ 高価な塗り？）を決定するための単純な仕組みは~~用意されていない。
これを捕捉するような追加的な属性で，
`PerformanceFrameTiming$I ~interfaceを拡張するよう求まれるかもしれない。
◎
Explain why frame is slow (in v2, probably): current definition reports slow frames, but there is no simple mechanism to determine what was the culprit (e.g. slow input handler vs. rAF vs. expensive paint). We may want to extend the PerformanceFrameTiming interface with additional attributes that capture this.
</p>

		</section>
	</section>
	<section class="informative" id="privacy-and-security">

<h2 title="Privacy and Security">4. ~privacyと~security</h2>

~INFORMATIVE

<p>
`PerformanceFrameTiming$I ~interfaceは、~browserによる`~event~loop$の処理~costについての計時~情報を公開する。
公開される情報を制限するため、~interfaceは，他の手段（例： `requestAnimationFrame()$m ）を通してすでに観測できるような，遅い~frameのみを報告するように制約される。
また、~UAには，遅い~frameによる~eventの送達について［
自前の閾値を 設定する／試行錯誤する
］ことも許容される。
◎
The PerformanceFrameTiming interface exposes timing information about the processing costs of the browser event loop. To limit the exposed information the interface is restricted to reporting slow frames only, which are already observable through other means (e.g. requestAnimationFrame), and the user agent is allowed to set and exercise own thresholds for delivery of slow frame events.
</p>

	</section>
	<section class="appendix" id="acknowledgments">

<h2 title="Acknowledgements">謝辞</h2>

<div lang="en">
Thanks to Enne Walker, Rick Byers, Chris Harrelson, Timothy Robert
Ansell, Vladimir Levin, and Nat Duca for their helpful comments and
contributions to this work.
</div>

	</section>

</main></div><!-- id="MAIN"／MAIN0 -->
